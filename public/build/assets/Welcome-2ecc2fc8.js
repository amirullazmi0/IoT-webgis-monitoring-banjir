import{r as Fe,R as Uc,c as Ep,f as Au,a as jt,F as Ga,j as Si,g as Cu,h as Cp,b as Ip}from"./app-2c482088.js";function Mu(vt,pt){const V=Fe.useRef(pt);Fe.useEffect(function(){pt!==V.current&&vt.attributionControl!=null&&(V.current!=null&&vt.attributionControl.removeAttribution(V.current),pt!=null&&vt.attributionControl.addAttribution(pt)),V.current=pt},[vt,pt])}function kp(vt,pt,V){pt.center!==V.center&&vt.setLatLng(pt.center),pt.radius!=null&&pt.radius!==V.radius&&vt.setRadius(pt.radius)}const Ap=1;function Mp(vt){return Object.freeze({__version:Ap,map:vt})}function Lu(vt,pt){return Object.freeze({...vt,...pt})}const zu=Fe.createContext(null),Du=zu.Provider;function Gc(){const vt=Fe.useContext(zu);if(vt==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return vt}function Ru(vt){function pt(V,it){const{instance:J,context:wt}=vt(V).current;return Fe.useImperativeHandle(it,()=>J),V.children==null?null:Uc.createElement(Du,{value:wt},V.children)}return Fe.forwardRef(pt)}function Lp(vt){function pt(V,it){const[J,wt]=Fe.useState(!1),{instance:bt}=vt(V,wt).current;Fe.useImperativeHandle(it,()=>bt),Fe.useEffect(function(){J&&bt.update()},[bt,J,V.children]);const d=bt._contentNode;return d?Ep.createPortal(V.children,d):null}return Fe.forwardRef(pt)}function zp(vt){function pt(V,it){const{instance:J}=vt(V).current;return Fe.useImperativeHandle(it,()=>J),null}return Fe.forwardRef(pt)}function Hc(vt,pt){const V=Fe.useRef();Fe.useEffect(function(){return pt!=null&&vt.instance.on(pt),V.current=pt,function(){V.current!=null&&vt.instance.off(V.current),V.current=null}},[vt,pt])}function Vl(vt,pt){const V=vt.pane??pt.pane;return V?{...vt,pane:V}:vt}function Dp(vt,pt){return function(it,J){const wt=Gc(),bt=vt(Vl(it,wt),wt);return Mu(wt.map,it.attribution),Hc(bt.current,it.eventHandlers),pt(bt.current,wt,it,J),bt}}var Vc={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(vt,pt){(function(V,it){it(pt)})(Au,function(V){var it="1.9.4";function J(r){var l,_,x,E;for(_=1,x=arguments.length;_<x;_++){E=arguments[_];for(l in E)r[l]=E[l]}return r}var wt=Object.create||function(){function r(){}return function(l){return r.prototype=l,new r}}();function bt(r,l){var _=Array.prototype.slice;if(r.bind)return r.bind.apply(r,_.call(arguments,1));var x=_.call(arguments,2);return function(){return r.apply(l,x.length?x.concat(_.call(arguments)):arguments)}}var d=0;function Ot(r){return"_leaflet_id"in r||(r._leaflet_id=++d),r._leaflet_id}function yt(r,l,_){var x,E,N,$;return $=function(){x=!1,E&&(N.apply(_,E),E=!1)},N=function(){x?E=arguments:(r.apply(_,arguments),setTimeout($,l),x=!0)},N}function Se(r,l,_){var x=l[1],E=l[0],N=x-E;return r===x&&_?r:((r-E)%N+N)%N+E}function At(){return!1}function Ht(r,l){if(l===!1)return r;var _=Math.pow(10,l===void 0?6:l);return Math.round(r*_)/_}function le(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function ce(r){return le(r).split(/\s+/)}function Gt(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?wt(r.options):{});for(var _ in l)r.options[_]=l[_];return r.options}function Nt(r,l,_){var x=[];for(var E in r)x.push(encodeURIComponent(_?E.toUpperCase():E)+"="+encodeURIComponent(r[E]));return(!l||l.indexOf("?")===-1?"?":"&")+x.join("&")}var Ft=/\{ *([\w_ -]+) *\}/g;function de(r,l){return r.replace(Ft,function(_,x){var E=l[x];if(E===void 0)throw new Error("No value provided for variable "+_);return typeof E=="function"&&(E=E(l)),E})}var be=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function ci(r,l){for(var _=0;_<r.length;_++)if(r[_]===l)return _;return-1}var yi="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Ci(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var Yi=0;function hi(r){var l=+new Date,_=Math.max(0,16-(l-Yi));return Yi=l+_,window.setTimeout(r,_)}var Ui=window.requestAnimationFrame||Ci("RequestAnimationFrame")||hi,gi=window.cancelAnimationFrame||Ci("CancelAnimationFrame")||Ci("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function we(r,l,_){if(_&&Ui===hi)r.call(l);else return Ui.call(window,bt(r,l))}function Ii(r){r&&gi.call(window,r)}var Qi={__proto__:null,extend:J,create:wt,bind:bt,get lastId(){return d},stamp:Ot,throttle:yt,wrapNum:Se,falseFn:At,formatNum:Ht,trim:le,splitWords:ce,setOptions:Gt,getParamString:Nt,template:de,isArray:be,indexOf:ci,emptyImageUrl:yi,requestFn:Ui,cancelFn:gi,requestAnimFrame:we,cancelAnimFrame:Ii};function Vi(){}Vi.extend=function(r){var l=function(){Gt(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},_=l.__super__=this.prototype,x=wt(_);x.constructor=l,l.prototype=x;for(var E in this)Object.prototype.hasOwnProperty.call(this,E)&&E!=="prototype"&&E!=="__super__"&&(l[E]=this[E]);return r.statics&&J(l,r.statics),r.includes&&(lr(r.includes),J.apply(null,[x].concat(r.includes))),J(x,r),delete x.statics,delete x.includes,x.options&&(x.options=_.options?wt(_.options):{},J(x.options,r.options)),x._initHooks=[],x.callInitHooks=function(){if(!this._initHooksCalled){_.callInitHooks&&_.callInitHooks.call(this),this._initHooksCalled=!0;for(var N=0,$=x._initHooks.length;N<$;N++)x._initHooks[N].call(this)}},l},Vi.include=function(r){var l=this.prototype.options;return J(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},Vi.mergeOptions=function(r){return J(this.prototype.options,r),this},Vi.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),_=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(_),this};function lr(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=be(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Ye={on:function(r,l,_){if(typeof r=="object")for(var x in r)this._on(x,r[x],l);else{r=ce(r);for(var E=0,N=r.length;E<N;E++)this._on(r[E],l,_)}return this},off:function(r,l,_){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var x in r)this._off(x,r[x],l);else{r=ce(r);for(var E=arguments.length===1,N=0,$=r.length;N<$;N++)E?this._off(r[N]):this._off(r[N],l,_)}return this},_on:function(r,l,_,x){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,_)===!1){_===this&&(_=void 0);var E={fn:l,ctx:_};x&&(E.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(E)}},_off:function(r,l,_){var x,E,N;if(this._events&&(x=this._events[r],!!x)){if(arguments.length===1){if(this._firingCount)for(E=0,N=x.length;E<N;E++)x[E].fn=At;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var $=this._listens(r,l,_);if($!==!1){var at=x[$];this._firingCount&&(at.fn=At,this._events[r]=x=x.slice()),x.splice($,1)}}},fire:function(r,l,_){if(!this.listens(r,_))return this;var x=J({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var E=this._events[r];if(E){this._firingCount=this._firingCount+1||1;for(var N=0,$=E.length;N<$;N++){var at=E[N],Tt=at.fn;at.once&&this.off(r,Tt,at.ctx),Tt.call(at.ctx||this,x)}this._firingCount--}}return _&&this._propagateEvent(x),this},listens:function(r,l,_,x){typeof r!="string"&&console.warn('"string" type argument expected');var E=l;typeof l!="function"&&(x=!!l,E=void 0,_=void 0);var N=this._events&&this._events[r];if(N&&N.length&&this._listens(r,E,_)!==!1)return!0;if(x){for(var $ in this._eventParents)if(this._eventParents[$].listens(r,l,_,x))return!0}return!1},_listens:function(r,l,_){if(!this._events)return!1;var x=this._events[r]||[];if(!l)return!!x.length;_===this&&(_=void 0);for(var E=0,N=x.length;E<N;E++)if(x[E].fn===l&&x[E].ctx===_)return E;return!1},once:function(r,l,_){if(typeof r=="object")for(var x in r)this._on(x,r[x],l,!0);else{r=ce(r);for(var E=0,N=r.length;E<N;E++)this._on(r[E],l,_,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[Ot(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[Ot(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,J({layer:r.target,propagatedFrom:r.target},r),!0)}};Ye.addEventListener=Ye.on,Ye.removeEventListener=Ye.clearAllEventListeners=Ye.off,Ye.addOneTimeEventListener=Ye.once,Ye.fireEvent=Ye.fire,Ye.hasEventListeners=Ye.listens;var xi=Vi.extend(Ye);function Le(r,l,_){this.x=_?Math.round(r):r,this.y=_?Math.round(l):l}var br=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(r){return this.clone()._add(Ae(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(Ae(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new Le(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new Le(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=br(this.x),this.y=br(this.y),this},distanceTo:function(r){r=Ae(r);var l=r.x-this.x,_=r.y-this.y;return Math.sqrt(l*l+_*_)},equals:function(r){return r=Ae(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=Ae(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+Ht(this.x)+", "+Ht(this.y)+")"}};function Ae(r,l,_){return r instanceof Le?r:be(r)?new Le(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new Le(r.x,r.y):new Le(r,l,_)}function fi(r,l){if(r)for(var _=l?[r,l]:r,x=0,E=_.length;x<E;x++)this.extend(_[x])}fi.prototype={extend:function(r){var l,_;if(!r)return this;if(r instanceof Le||typeof r[0]=="number"||"x"in r)l=_=Ae(r);else if(r=mi(r),l=r.min,_=r.max,!l||!_)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=_.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(_.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(_.y,this.max.y)),this},getCenter:function(r){return Ae((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return Ae(this.min.x,this.max.y)},getTopRight:function(){return Ae(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,_;return typeof r[0]=="number"||r instanceof Le?r=Ae(r):r=mi(r),r instanceof fi?(l=r.min,_=r.max):l=_=r,l.x>=this.min.x&&_.x<=this.max.x&&l.y>=this.min.y&&_.y<=this.max.y},intersects:function(r){r=mi(r);var l=this.min,_=this.max,x=r.min,E=r.max,N=E.x>=l.x&&x.x<=_.x,$=E.y>=l.y&&x.y<=_.y;return N&&$},overlaps:function(r){r=mi(r);var l=this.min,_=this.max,x=r.min,E=r.max,N=E.x>l.x&&x.x<_.x,$=E.y>l.y&&x.y<_.y;return N&&$},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,_=this.max,x=Math.abs(l.x-_.x)*r,E=Math.abs(l.y-_.y)*r;return mi(Ae(l.x-x,l.y-E),Ae(_.x+x,_.y+E))},equals:function(r){return r?(r=mi(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function mi(r,l){return!r||r instanceof fi?r:new fi(r,l)}function ui(r,l){if(r)for(var _=l?[r,l]:r,x=0,E=_.length;x<E;x++)this.extend(_[x])}ui.prototype={extend:function(r){var l=this._southWest,_=this._northEast,x,E;if(r instanceof _e)x=r,E=r;else if(r instanceof ui){if(x=r._southWest,E=r._northEast,!x||!E)return this}else return r?this.extend(Pe(r)||Qe(r)):this;return!l&&!_?(this._southWest=new _e(x.lat,x.lng),this._northEast=new _e(E.lat,E.lng)):(l.lat=Math.min(x.lat,l.lat),l.lng=Math.min(x.lng,l.lng),_.lat=Math.max(E.lat,_.lat),_.lng=Math.max(E.lng,_.lng)),this},pad:function(r){var l=this._southWest,_=this._northEast,x=Math.abs(l.lat-_.lat)*r,E=Math.abs(l.lng-_.lng)*r;return new ui(new _e(l.lat-x,l.lng-E),new _e(_.lat+x,_.lng+E))},getCenter:function(){return new _e((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new _e(this.getNorth(),this.getWest())},getSouthEast:function(){return new _e(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof _e||"lat"in r?r=Pe(r):r=Qe(r);var l=this._southWest,_=this._northEast,x,E;return r instanceof ui?(x=r.getSouthWest(),E=r.getNorthEast()):x=E=r,x.lat>=l.lat&&E.lat<=_.lat&&x.lng>=l.lng&&E.lng<=_.lng},intersects:function(r){r=Qe(r);var l=this._southWest,_=this._northEast,x=r.getSouthWest(),E=r.getNorthEast(),N=E.lat>=l.lat&&x.lat<=_.lat,$=E.lng>=l.lng&&x.lng<=_.lng;return N&&$},overlaps:function(r){r=Qe(r);var l=this._southWest,_=this._northEast,x=r.getSouthWest(),E=r.getNorthEast(),N=E.lat>l.lat&&x.lat<_.lat,$=E.lng>l.lng&&x.lng<_.lng;return N&&$},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=Qe(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Qe(r,l){return r instanceof ui?r:new ui(r,l)}function _e(r,l,_){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,_!==void 0&&(this.alt=+_)}_e.prototype={equals:function(r,l){if(!r)return!1;r=Pe(r);var _=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return _<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+Ht(this.lat,r)+", "+Ht(this.lng,r)+")"},distanceTo:function(r){return un.distance(this,Pe(r))},wrap:function(){return un.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,_=l/Math.cos(Math.PI/180*this.lat);return Qe([this.lat-l,this.lng-_],[this.lat+l,this.lng+_])},clone:function(){return new _e(this.lat,this.lng,this.alt)}};function Pe(r,l,_){return r instanceof _e?r:be(r)&&typeof r[0]!="object"?r.length===3?new _e(r[0],r[1],r[2]):r.length===2?new _e(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new _e(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new _e(r,l,_)}var vn={latLngToPoint:function(r,l){var _=this.projection.project(r),x=this.scale(l);return this.transformation._transform(_,x)},pointToLatLng:function(r,l){var _=this.scale(l),x=this.transformation.untransform(r,_);return this.projection.unproject(x)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,_=this.scale(r),x=this.transformation.transform(l.min,_),E=this.transformation.transform(l.max,_);return new fi(x,E)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?Se(r.lng,this.wrapLng,!0):r.lng,_=this.wrapLat?Se(r.lat,this.wrapLat,!0):r.lat,x=r.alt;return new _e(_,l,x)},wrapLatLngBounds:function(r){var l=r.getCenter(),_=this.wrapLatLng(l),x=l.lat-_.lat,E=l.lng-_.lng;if(x===0&&E===0)return r;var N=r.getSouthWest(),$=r.getNorthEast(),at=new _e(N.lat-x,N.lng-E),Tt=new _e($.lat-x,$.lng-E);return new ui(at,Tt)}},un=J({},vn,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var _=Math.PI/180,x=r.lat*_,E=l.lat*_,N=Math.sin((l.lat-r.lat)*_/2),$=Math.sin((l.lng-r.lng)*_/2),at=N*N+Math.cos(x)*Math.cos(E)*$*$,Tt=2*Math.atan2(Math.sqrt(at),Math.sqrt(1-at));return this.R*Tt}}),tn=6378137,Dn={R:tn,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,_=this.MAX_LATITUDE,x=Math.max(Math.min(_,r.lat),-_),E=Math.sin(x*l);return new Le(this.R*r.lng*l,this.R*Math.log((1+E)/(1-E))/2)},unproject:function(r){var l=180/Math.PI;return new _e((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:function(){var r=tn*Math.PI;return new fi([-r,-r],[r,r])}()};function qn(r,l,_,x){if(be(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=_,this._d=x}qn.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new Le((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function Bi(r,l,_,x){return new qn(r,l,_,x)}var wr=J({},un,{code:"EPSG:3857",projection:Dn,transformation:function(){var r=.5/(Math.PI*Dn.R);return Bi(r,.5,-r,.5)}()}),Pt=J({},wr,{code:"EPSG:900913"});function cr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Wr(r,l){var _="",x,E,N,$,at,Tt;for(x=0,N=r.length;x<N;x++){for(at=r[x],E=0,$=at.length;E<$;E++)Tt=at[E],_+=(E?"L":"M")+Tt.x+" "+Tt.y;_+=l?ft.svg?"z":"x":""}return _||"M0 0"}var ii=document.documentElement.style,Ve="ActiveXObject"in window,Xr=Ve&&!document.addEventListener,ms="msLaunchUri"in navigator&&!("documentMode"in document),_s=ut("webkit"),Di=ut("android"),jn=ut("android 2")||ut("android 3"),gs=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),oi=Di&&ut("Google")&&gs<537&&!("AudioNode"in window),Vt=!!window.opera,$n=!ms&&ut("chrome"),en=ut("gecko")&&!_s&&!Vt&&!Ve,ys=!$n&&ut("safari"),Tr=ut("phantom"),Zt="OTransition"in ii,Be=navigator.platform.indexOf("Win")===0,Ie=Ve&&"transition"in ii,ji="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!jn,Oi="MozPerspective"in ii,Me=!window.L_DISABLE_3D&&(Ie||ji||Oi)&&!Zt&&!Tr,En=typeof orientation<"u"||ut("mobile"),Sr=En&&_s,Cn=En&&ji,$i=!window.PointerEvent&&window.MSPointerEvent,Gi=!!(window.PointerEvent||$i),Ke="ontouchstart"in window||!!window.TouchEvent,Bs=!window.L_NO_TOUCH&&(Ke||Gi),Gn=En&&Vt,X=En&&en,D=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,B=function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",At,l),window.removeEventListener("testPassiveEventSupport",At,l)}catch{}return r}(),Z=function(){return!!document.createElement("canvas").getContext}(),Q=!!(document.createElementNS&&cr("svg").createSVGRect),nt=!!Q&&function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),ht=!Q&&function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}}(),st=navigator.platform.indexOf("Mac")===0,rt=navigator.platform.indexOf("Linux")===0;function ut(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var ft={ie:Ve,ielt9:Xr,edge:ms,webkit:_s,android:Di,android23:jn,androidStock:oi,opera:Vt,chrome:$n,gecko:en,safari:ys,phantom:Tr,opera12:Zt,win:Be,ie3d:Ie,webkit3d:ji,gecko3d:Oi,any3d:Me,mobile:En,mobileWebkit:Sr,mobileWebkit3d:Cn,msPointer:$i,pointer:Gi,touch:Bs,touchNative:Ke,mobileOpera:Gn,mobileGecko:X,retina:D,passiveEvents:B,canvas:Z,svg:Q,vml:ht,inlineSvg:nt,mac:st,linux:rt},kt=ft.msPointer?"MSPointerDown":"pointerdown",It=ft.msPointer?"MSPointerMove":"pointermove",fe=ft.msPointer?"MSPointerUp":"pointerup",ke=ft.msPointer?"MSPointerCancel":"pointercancel",ie={touchstart:kt,touchmove:It,touchend:fe,touchcancel:ke},ae={touchstart:Zi,touchmove:Hn,touchend:Hn,touchcancel:Hn},ve={},Ze=!1;function Ne(r,l,_){return l==="touchstart"&&Pi(),ae[l]?(_=ae[l].bind(this,_),r.addEventListener(ie[l],_,!1),_):(console.warn("wrong event specified:",l),At)}function $e(r,l,_){if(!ie[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(ie[l],_,!1)}function ni(r){ve[r.pointerId]=r}function Fi(r){ve[r.pointerId]&&(ve[r.pointerId]=r)}function Te(r){delete ve[r.pointerId]}function Pi(){Ze||(document.addEventListener(kt,ni,!0),document.addEventListener(It,Fi,!0),document.addEventListener(fe,Te,!0),document.addEventListener(ke,Te,!0),Ze=!0)}function Hn(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var _ in ve)l.touches.push(ve[_]);l.changedTouches=[l],r(l)}}function Zi(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&qi(l),Hn(r,l)}function In(r){var l={},_,x;for(x in r)_=r[x],l[x]=_&&_.bind?_.bind(r):_;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var Rn=200;function vs(r,l){r.addEventListener("dblclick",l);var _=0,x;function E(N){if(N.detail!==1){x=N.detail;return}if(!(N.pointerType==="mouse"||N.sourceCapabilities&&!N.sourceCapabilities.firesTouchEvents)){var $=fr(N);if(!($.some(function(Tt){return Tt instanceof HTMLLabelElement&&Tt.attributes.for})&&!$.some(function(Tt){return Tt instanceof HTMLInputElement||Tt instanceof HTMLSelectElement}))){var at=Date.now();at-_<=Rn?(x++,x===2&&l(In(N))):x=1,_=at}}}return r.addEventListener("click",E),{dblclick:l,simDblclick:E}}function so(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var ki=bs(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),nn=bs(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),hr=nn==="webkitTransition"||nn==="OTransition"?nn+"End":"transitionend";function di(r){return typeof r=="string"?document.getElementById(r):r}function ur(r,l){var _=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!_||_==="auto")&&document.defaultView){var x=document.defaultView.getComputedStyle(r,null);_=x?x[l]:null}return _==="auto"?null:_}function Ue(r,l,_){var x=document.createElement(r);return x.className=l||"",_&&_.appendChild(x),x}function bi(r){var l=r.parentNode;l&&l.removeChild(r)}function Ni(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Or(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function Wn(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function dr(r,l){if(r.classList!==void 0)return r.classList.contains(l);var _=Xn(r);return _.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(_)}function re(r,l){if(r.classList!==void 0)for(var _=ce(l),x=0,E=_.length;x<E;x++)r.classList.add(_[x]);else if(!dr(r,l)){var N=Xn(r);pr(r,(N?N+" ":"")+l)}}function ai(r,l){r.classList!==void 0?r.classList.remove(l):pr(r,le((" "+Xn(r)+" ").replace(" "+l+" "," ")))}function pr(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function Xn(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function kn(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&xs(r,l)}function xs(r,l){var _=!1,x="DXImageTransform.Microsoft.Alpha";try{_=r.filters.item(x)}catch{if(l===1)return}l=Math.round(l*100),_?(_.Enabled=l!==100,_.Opacity=l):r.style.filter+=" progid:"+x+"(opacity="+l+")"}function bs(r){for(var l=document.documentElement.style,_=0;_<r.length;_++)if(r[_]in l)return r[_];return!1}function Fr(r,l,_){var x=l||new Le(0,0);r.style[ki]=(ft.ie3d?"translate("+x.x+"px,"+x.y+"px)":"translate3d("+x.x+"px,"+x.y+"px,0)")+(_?" scale("+_+")":"")}function Ai(r,l){r._leaflet_pos=l,ft.any3d?Fr(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function Kr(r){return r._leaflet_pos||new Le(0,0)}var ws,Os,Fs;if("onselectstart"in document)ws=function(){De(window,"selectstart",qi)},Os=function(){ti(window,"selectstart",qi)};else{var Pr=bs(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ws=function(){if(Pr){var r=document.documentElement.style;Fs=r[Pr],r[Pr]="none"}},Os=function(){Pr&&(document.documentElement.style[Pr]=Fs,Fs=void 0)}}function Kn(){De(window,"dragstart",qi)}function oo(){ti(window,"dragstart",qi)}var Ns,Jn;function Ts(r){for(;r.tabIndex===-1;)r=r.parentNode;r.style&&(an(),Ns=r,Jn=r.style.outlineStyle,r.style.outlineStyle="none",De(window,"keydown",an))}function an(){Ns&&(Ns.style.outlineStyle=Jn,Ns=void 0,Jn=void 0,ti(window,"keydown",an))}function Us(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function Nr(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var Ss={__proto__:null,TRANSFORM:ki,TRANSITION:nn,TRANSITION_END:hr,get:di,getStyle:ur,create:Ue,remove:bi,empty:Ni,toFront:Or,toBack:Wn,hasClass:dr,addClass:re,removeClass:ai,setClass:pr,getClass:Xn,setOpacity:kn,testProp:bs,setTransform:Fr,setPosition:Ai,getPosition:Kr,get disableTextSelection(){return ws},get enableTextSelection(){return Os},disableImageDrag:Kn,enableImageDrag:oo,preventOutline:Ts,restoreOutline:an,getSizedParentNode:Us,getScale:Nr};function De(r,l,_,x){if(l&&typeof l=="object")for(var E in l)dn(r,E,l[E],_);else{l=ce(l);for(var N=0,$=l.length;N<$;N++)dn(r,l[N],_,x)}return this}var An="_leaflet_events";function ti(r,l,_,x){if(arguments.length===1)Jr(r),delete r[An];else if(l&&typeof l=="object")for(var E in l)pn(r,E,l[E],_);else if(l=ce(l),arguments.length===2)Jr(r,function(at){return ci(l,at)!==-1});else for(var N=0,$=l.length;N<$;N++)pn(r,l[N],_,x);return this}function Jr(r,l){for(var _ in r[An]){var x=_.split(/\d/)[0];(!l||l(x))&&pn(r,x,null,null,_)}}var Ps={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function dn(r,l,_,x){var E=l+Ot(_)+(x?"_"+Ot(x):"");if(r[An]&&r[An][E])return this;var N=function(at){return _.call(x||r,at||window.event)},$=N;!ft.touchNative&&ft.pointer&&l.indexOf("touch")===0?N=Ne(r,l,N):ft.touch&&l==="dblclick"?N=vs(r,N):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(Ps[l]||l,N,ft.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(N=function(at){at=at||window.event,Zs(r,at)&&$(at)},r.addEventListener(Ps[l],N,!1)):r.addEventListener(l,$,!1):r.attachEvent("on"+l,N),r[An]=r[An]||{},r[An][E]=N}function pn(r,l,_,x,E){E=E||l+Ot(_)+(x?"_"+Ot(x):"");var N=r[An]&&r[An][E];if(!N)return this;!ft.touchNative&&ft.pointer&&l.indexOf("touch")===0?$e(r,l,N):ft.touch&&l==="dblclick"?so(r,N):"removeEventListener"in r?r.removeEventListener(Ps[l]||l,N,!1):r.detachEvent("on"+l,N),r[An][E]=null}function Er(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function Yr(r){return dn(r,"wheel",Er),this}function Ur(r){return De(r,"mousedown touchstart dblclick contextmenu",Er),r._leaflet_disable_click=!0,this}function qi(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function Ee(r){return qi(r),Er(r),this}function fr(r){if(r.composedPath)return r.composedPath();for(var l=[],_=r.target;_;)l.push(_),_=_.parentNode;return l}function qe(r,l){if(!l)return new Le(r.clientX,r.clientY);var _=Nr(l),x=_.boundingClientRect;return new Le((r.clientX-x.left)/_.x-l.clientLeft,(r.clientY-x.top)/_.y-l.clientTop)}var ko=ft.linux&&ft.chrome?window.devicePixelRatio:ft.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Vs(r){return ft.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/ko:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function Zs(r,l){var _=l.relatedTarget;if(!_)return!0;try{for(;_&&_!==r;)_=_.parentNode}catch{return!1}return _!==r}var Wo={__proto__:null,on:De,off:ti,stopPropagation:Er,disableScrollPropagation:Yr,disableClickPropagation:Ur,preventDefault:qi,stop:Ee,getPropagationPath:fr,getMousePosition:qe,getWheelDelta:Vs,isExternalTarget:Zs,addListener:De,removeListener:ti},Qr=xi.extend({run:function(r,l,_,x){this.stop(),this._el=r,this._inProgress=!0,this._duration=_||.25,this._easeOutPower=1/Math.max(x||.5,.2),this._startPos=Kr(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=we(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,_=this._duration*1e3;l<_?this._runFrame(this._easeOut(l/_),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var _=this._startPos.add(this._offset.multiplyBy(r));l&&_._round(),Ai(this._el,_),this.fire("step")},_complete:function(){Ii(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),Xe=xi.extend({options:{crs:wr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=Gt(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=bt(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(Pe(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=nn&&ft.any3d&&!ft.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),De(this._proxy,hr,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,_){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(Pe(r),l,this.options.maxBounds),_=_||{},this._stop(),this._loaded&&!_.reset&&_!==!0){_.animate!==void 0&&(_.zoom=J({animate:_.animate},_.zoom),_.pan=J({animate:_.animate,duration:_.duration},_.pan));var x=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,_.zoom):this._tryAnimatedPan(r,_.pan);if(x)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,_.pan&&_.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(ft.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(ft.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,_){var x=this.getZoomScale(l),E=this.getSize().divideBy(2),N=r instanceof Le?r:this.latLngToContainerPoint(r),$=N.subtract(E).multiplyBy(1-1/x),at=this.containerPointToLatLng(E.add($));return this.setView(at,l,{zoom:_})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():Qe(r);var _=Ae(l.paddingTopLeft||l.padding||[0,0]),x=Ae(l.paddingBottomRight||l.padding||[0,0]),E=this.getBoundsZoom(r,!1,_.add(x));if(E=typeof l.maxZoom=="number"?Math.min(l.maxZoom,E):E,E===1/0)return{center:r.getCenter(),zoom:E};var N=x.subtract(_).divideBy(2),$=this.project(r.getSouthWest(),E),at=this.project(r.getNorthEast(),E),Tt=this.unproject($.add(at).divideBy(2).add(N),E);return{center:Tt,zoom:E}},fitBounds:function(r,l){if(r=Qe(r),!r.isValid())throw new Error("Bounds are not valid.");var _=this._getBoundsCenterZoom(r,l);return this.setView(_.center,_.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=Ae(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Qr,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){re(this._mapPane,"leaflet-pan-anim");var _=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,_,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,_){if(_=_||{},_.animate===!1||!ft.any3d)return this.setView(r,l,_);this._stop();var x=this.project(this.getCenter()),E=this.project(r),N=this.getSize(),$=this._zoom;r=Pe(r),l=l===void 0?$:l;var at=Math.max(N.x,N.y),Tt=at*this.getZoomScale($,l),Dt=E.distanceTo(x)||1,oe=1.42,me=oe*oe;function je(Ti){var Ys=Ti?-1:1,Zo=Ti?Tt:at,wa=Tt*Tt-at*at+Ys*me*me*Dt*Dt,Eo=2*Zo*me*Dt,os=wa/Eo,oa=Math.sqrt(os*os+1)-os,aa=oa<1e-9?-18:Math.log(oa);return aa}function Mi(Ti){return(Math.exp(Ti)-Math.exp(-Ti))/2}function ln(Ti){return(Math.exp(Ti)+Math.exp(-Ti))/2}function Xi(Ti){return Mi(Ti)/ln(Ti)}var Je=je(0);function Ei(Ti){return at*(ln(Je)/ln(Je+oe*Ti))}function Aa(Ti){return at*(ln(Je)*Xi(Je+oe*Ti)-Mi(Je))/me}function Po(Ti){return 1-Math.pow(1-Ti,1.5)}var ra=Date.now(),sa=(je(1)-Je)/oe,Gr=_.duration?1e3*_.duration:1e3*sa*.8;function Vo(){var Ti=(Date.now()-ra)/Gr,Ys=Po(Ti)*sa;Ti<=1?(this._flyToFrame=we(Vo,this),this._move(this.unproject(x.add(E.subtract(x).multiplyBy(Aa(Ys)/Dt)),$),this.getScaleZoom(at/Ei(Ys),$),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,_.noMoveStart),Vo.call(this),this},flyToBounds:function(r,l){var _=this._getBoundsCenterZoom(r,l);return this.flyTo(_.center,_.zoom,l)},setMaxBounds:function(r){return r=Qe(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var _=this.getCenter(),x=this._limitCenter(_,this._zoom,Qe(r));return _.equals(x)||this.panTo(x,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var _=Ae(l.paddingTopLeft||l.padding||[0,0]),x=Ae(l.paddingBottomRight||l.padding||[0,0]),E=this.project(this.getCenter()),N=this.project(r),$=this.getPixelBounds(),at=mi([$.min.add(_),$.max.subtract(x)]),Tt=at.getSize();if(!at.contains(N)){this._enforcingBounds=!0;var Dt=N.subtract(at.getCenter()),oe=at.extend(N).getSize().subtract(Tt);E.x+=Dt.x<0?-oe.x:oe.x,E.y+=Dt.y<0?-oe.y:oe.y,this.panTo(this.unproject(E),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=J({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var _=this.getSize(),x=l.divideBy(2).round(),E=_.divideBy(2).round(),N=x.subtract(E);return!N.x&&!N.y?this:(r.animate&&r.pan?this.panBy(N):(r.pan&&this._rawPanBy(N),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(bt(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:_}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=J({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=bt(this._handleGeolocationResponse,this),_=bt(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,_,r):navigator.geolocation.getCurrentPosition(l,_,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(this._container._leaflet_id){var l=r.code,_=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+_+"."})}},_handleGeolocationResponse:function(r){if(this._container._leaflet_id){var l=r.coords.latitude,_=r.coords.longitude,x=new _e(l,_),E=x.toBounds(r.coords.accuracy*2),N=this._locateOptions;if(N.setView){var $=this.getBoundsZoom(E);this.setView(x,N.maxZoom?Math.min($,N.maxZoom):$)}var at={latlng:x,bounds:E,timestamp:r.timestamp};for(var Tt in r.coords)typeof r.coords[Tt]=="number"&&(at[Tt]=r.coords[Tt]);this.fire("locationfound",at)}},addHandler:function(r,l){if(!l)return this;var _=this[r]=new l(this);return this._handlers.push(_),this.options[r]&&_.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),bi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ii(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)bi(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var _="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),x=Ue("div",_,l||this._mapPane);return r&&(this._panes[r]=x),x},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),_=this.unproject(r.getTopRight());return new ui(l,_)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,_){r=Qe(r),_=Ae(_||[0,0]);var x=this.getZoom()||0,E=this.getMinZoom(),N=this.getMaxZoom(),$=r.getNorthWest(),at=r.getSouthEast(),Tt=this.getSize().subtract(_),Dt=mi(this.project(at,x),this.project($,x)).getSize(),oe=ft.any3d?this.options.zoomSnap:1,me=Tt.x/Dt.x,je=Tt.y/Dt.y,Mi=l?Math.max(me,je):Math.min(me,je);return x=this.getScaleZoom(Mi,x),oe&&(x=Math.round(x/(oe/100))*(oe/100),x=l?Math.ceil(x/oe)*oe:Math.floor(x/oe)*oe),Math.max(E,Math.min(N,x))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Le(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var _=this._getTopLeftPoint(r,l);return new fi(_,_.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var _=this.options.crs;return l=l===void 0?this._zoom:l,_.scale(r)/_.scale(l)},getScaleZoom:function(r,l){var _=this.options.crs;l=l===void 0?this._zoom:l;var x=_.zoom(r*_.scale(l));return isNaN(x)?1/0:x},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(Pe(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(Ae(r),l)},layerPointToLatLng:function(r){var l=Ae(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(Pe(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(Pe(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(Qe(r))},distance:function(r,l){return this.options.crs.distance(Pe(r),Pe(l))},containerPointToLayerPoint:function(r){return Ae(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return Ae(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(Ae(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Pe(r)))},mouseEventToContainerPoint:function(r){return qe(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=di(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");De(l,"scroll",this._onScroll,this),this._containerId=Ot(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&ft.any3d,re(r,"leaflet-container"+(ft.touch?" leaflet-touch":"")+(ft.retina?" leaflet-retina":"")+(ft.ielt9?" leaflet-oldie":"")+(ft.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=ur(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ai(this._mapPane,new Le(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(re(r.markerPane,"leaflet-zoom-hide"),re(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,_){Ai(this._mapPane,new Le(0,0));var x=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var E=this._zoom!==l;this._moveStart(E,_)._move(r,l)._moveEnd(E),this.fire("viewreset"),x&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,_,x){l===void 0&&(l=this._zoom);var E=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),x?_&&_.pinch&&this.fire("zoom",_):((E||_&&_.pinch)&&this.fire("zoom",_),this.fire("move",_)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ii(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Ai(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[Ot(this._container)]=this;var l=r?ti:De;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),ft.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ii(this._resizeRequest),this._resizeRequest=we(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var _=[],x,E=l==="mouseout"||l==="mouseover",N=r.target||r.srcElement,$=!1;N;){if(x=this._targets[Ot(N)],x&&(l==="click"||l==="preclick")&&this._draggableMoved(x)){$=!0;break}if(x&&x.listens(l,!0)&&(E&&!Zs(N,r)||(_.push(x),E))||N===this._container)break;N=N.parentNode}return!_.length&&!$&&!E&&this.listens(l,!0)&&(_=[this]),_},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var _=r.type;_==="mousedown"&&Ts(l),this._fireDOMEvent(r,_)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,_){if(r.type==="click"){var x=J({},r);x.type="preclick",this._fireDOMEvent(x,x.type,_)}var E=this._findEventTargets(r,l);if(_){for(var N=[],$=0;$<_.length;$++)_[$].listens(l,!0)&&N.push(_[$]);E=N.concat(E)}if(E.length){l==="contextmenu"&&qi(r);var at=E[0],Tt={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var Dt=at.getLatLng&&(!at._radius||at._radius<=10);Tt.containerPoint=Dt?this.latLngToContainerPoint(at.getLatLng()):this.mouseEventToContainerPoint(r),Tt.layerPoint=this.containerPointToLayerPoint(Tt.containerPoint),Tt.latlng=Dt?at.getLatLng():this.layerPointToLatLng(Tt.layerPoint)}for($=0;$<E.length;$++)if(E[$].fire(l,Tt,!0),Tt.originalEvent._stopped||E[$].options.bubblingMouseEvents===!1&&ci(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return Kr(this._mapPane)||new Le(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var _=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return _.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var _=this.getSize()._divideBy(2);return this.project(r,l)._subtract(_)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,_){var x=this._getNewPixelOrigin(_,l);return this.project(r,l)._subtract(x)},_latLngBoundsToNewLayerBounds:function(r,l,_){var x=this._getNewPixelOrigin(_,l);return mi([this.project(r.getSouthWest(),l)._subtract(x),this.project(r.getNorthWest(),l)._subtract(x),this.project(r.getSouthEast(),l)._subtract(x),this.project(r.getNorthEast(),l)._subtract(x)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,_){if(!_)return r;var x=this.project(r,l),E=this.getSize().divideBy(2),N=new fi(x.subtract(E),x.add(E)),$=this._getBoundsOffset(N,_,l);return Math.abs($.x)<=1&&Math.abs($.y)<=1?r:this.unproject(x.add($),l)},_limitOffset:function(r,l){if(!l)return r;var _=this.getPixelBounds(),x=new fi(_.min.add(r),_.max.add(r));return r.add(this._getBoundsOffset(x,l))},_getBoundsOffset:function(r,l,_){var x=mi(this.project(l.getNorthEast(),_),this.project(l.getSouthWest(),_)),E=x.min.subtract(r.min),N=x.max.subtract(r.max),$=this._rebound(E.x,-N.x),at=this._rebound(E.y,-N.y);return new Le($,at)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),_=this.getMaxZoom(),x=ft.any3d?this.options.zoomSnap:1;return x&&(r=Math.round(r/x)*x),Math.max(l,Math.min(_,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ai(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var _=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(_)?!1:(this.panBy(_,l),!0)},_createAnimProxy:function(){var r=this._proxy=Ue("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var _=ki,x=this._proxy.style[_];Fr(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),x===this._proxy.style[_]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){bi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();Fr(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,_){if(this._animatingZoom)return!0;if(_=_||{},!this._zoomAnimated||_.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var x=this.getZoomScale(l),E=this._getCenterOffset(r)._divideBy(1-1/x);return _.animate!==!0&&!this.getSize().contains(E)?!1:(we(function(){this._moveStart(!0,_.noMoveStart||!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,_,x){this._mapPane&&(_&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,re(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:x}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(bt(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ai(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function pa(r,l){return new Xe(r,l)}var Yn=Vi.extend({options:{position:"topright"},initialize:function(r){Gt(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),_=this.getPosition(),x=r._controlCorners[_];return re(l,"leaflet-control"),_.indexOf("bottom")!==-1?x.insertBefore(l,x.firstChild):x.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(bi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),ao=function(r){return new Yn(r)};Xe.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",_=this._controlContainer=Ue("div",l+"control-container",this._container);function x(E,N){var $=l+E+" "+l+N;r[E+N]=Ue("div",$,_)}x("top","left"),x("top","right"),x("bottom","left"),x("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)bi(this._controlCorners[r]);bi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Xo=Yn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,_,x){return _<x?-1:x<_?1:0}},initialize:function(r,l,_){Gt(this,_),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var x in r)this._addLayer(r[x],x);for(x in l)this._addLayer(l[x],x,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return Yn.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(Ot(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){re(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(re(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):ai(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ai(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=Ue("div",r),_=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Ur(l),Yr(l);var x=this._section=Ue("section",r+"-list");_&&(this._map.on("click",this.collapse,this),De(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var E=this._layersLink=Ue("a",r+"-toggle",l);E.href="#",E.title="Layers",E.setAttribute("role","button"),De(E,{keydown:function(N){N.keyCode===13&&this._expandSafely()},click:function(N){qi(N),this._expandSafely()}},this),_||this.expand(),this._baseLayersList=Ue("div",r+"-base",x),this._separator=Ue("div",r+"-separator",x),this._overlaysList=Ue("div",r+"-overlays",x),l.appendChild(x)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&Ot(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,_){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:_}),this.options.sortLayers&&this._layers.sort(bt(function(x,E){return this.options.sortFunction(x.layer,E.layer,x.name,E.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ni(this._baseLayersList),Ni(this._overlaysList),this._layerControlInputs=[];var r,l,_,x,E=0;for(_=0;_<this._layers.length;_++)x=this._layers[_],this._addItem(x),l=l||x.overlay,r=r||!x.overlay,E+=x.overlay?0:1;return this.options.hideSingleBase&&(r=r&&E>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(Ot(r.target)),_=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;_&&this._map.fire(_,l)},_createRadioElement:function(r,l){var _='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",x=document.createElement("div");return x.innerHTML=_,x.firstChild},_addItem:function(r){var l=document.createElement("label"),_=this._map.hasLayer(r.layer),x;r.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="leaflet-control-layers-selector",x.defaultChecked=_):x=this._createRadioElement("leaflet-base-layers_"+Ot(this),_),this._layerControlInputs.push(x),x.layerId=Ot(r.layer),De(x,"click",this._onInputClick,this);var E=document.createElement("span");E.innerHTML=" "+r.name;var N=document.createElement("span");l.appendChild(N),N.appendChild(x),N.appendChild(E);var $=r.overlay?this._overlaysList:this._baseLayersList;return $.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){if(!this._preventClick){var r=this._layerControlInputs,l,_,x=[],E=[];this._handlingClick=!0;for(var N=r.length-1;N>=0;N--)l=r[N],_=this._getLayer(l.layerId).layer,l.checked?x.push(_):l.checked||E.push(_);for(N=0;N<E.length;N++)this._map.hasLayer(E[N])&&this._map.removeLayer(E[N]);for(N=0;N<x.length;N++)this._map.hasLayer(x[N])||this._map.addLayer(x[N]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,_,x=this._map.getZoom(),E=r.length-1;E>=0;E--)l=r[E],_=this._getLayer(l.layerId).layer,l.disabled=_.options.minZoom!==void 0&&x<_.options.minZoom||_.options.maxZoom!==void 0&&x>_.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var r=this._section;this._preventClick=!0,De(r,"click",qi),this.expand();var l=this;setTimeout(function(){ti(r,"click",qi),l._preventClick=!1})}}),fa=function(r,l,_){return new Xo(r,l,_)},lo=Yn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",_=Ue("div",l+" leaflet-bar"),x=this.options;return this._zoomInButton=this._createButton(x.zoomInText,x.zoomInTitle,l+"-in",_,this._zoomIn),this._zoomOutButton=this._createButton(x.zoomOutText,x.zoomOutTitle,l+"-out",_,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),_},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,_,x,E){var N=Ue("a",_,x);return N.innerHTML=r,N.href="#",N.title=l,N.setAttribute("role","button"),N.setAttribute("aria-label",l),Ur(N),De(N,"click",Ee),De(N,"click",E,this),De(N,"click",this._refocusOnMap,this),N},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";ai(this._zoomInButton,l),ai(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(re(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(re(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});Xe.mergeOptions({zoomControl:!0}),Xe.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new lo,this.addControl(this.zoomControl))});var co=function(r){return new lo(r)},ho=Yn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",_=Ue("div",l),x=this.options;return this._addScales(x,l+"-line",_),r.on(x.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),_},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,_){r.metric&&(this._mScale=Ue("div",l,_)),r.imperial&&(this._iScale=Ue("div",l,_))},_update:function(){var r=this._map,l=r.getSize().y/2,_=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(_)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),_=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,_,l/r)},_updateImperial:function(r){var l=r*3.2808399,_,x,E;l>5280?(_=l/5280,x=this._getRoundNum(_),this._updateScale(this._iScale,x+" mi",x/_)):(E=this._getRoundNum(l),this._updateScale(this._iScale,E+" ft",E/l))},_updateScale:function(r,l,_){r.style.width=Math.round(this.options.maxWidth*_)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),_=r/l;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,l*_}}),Ao=function(r){return new ho(r)},Es='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',uo=Yn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ft.inlineSvg?Es+" ":"")+"Leaflet</a>"},initialize:function(r){Gt(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=Ue("div","leaflet-control-attribution"),Ur(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var _=[];this.options.prefix&&_.push(this.options.prefix),r.length&&_.push(r.join(", ")),this._container.innerHTML=_.join(' <span aria-hidden="true">|</span> ')}}});Xe.mergeOptions({attributionControl:!0}),Xe.addInitHook(function(){this.options.attributionControl&&new uo().addTo(this)});var Ko=function(r){return new uo(r)};Yn.Layers=Xo,Yn.Zoom=lo,Yn.Scale=ho,Yn.Attribution=uo,ao.layers=fa,ao.zoom=co,ao.scale=Ao,ao.attribution=Ko;var Bn=Vi.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Bn.addTo=function(r,l){return r.addHandler(l,this),this};var ts={Events:Ye},Mo=ft.touch?"touchstart mousedown":"mousedown",Mn=xi.extend({options:{clickTolerance:3},initialize:function(r,l,_,x){Gt(this,x),this._element=r,this._dragStartTarget=l||r,this._preventOutline=_},enable:function(){this._enabled||(De(this._dragStartTarget,Mo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Mn._dragging===this&&this.finishDrag(!0),ti(this._dragStartTarget,Mo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(this._enabled&&(this._moved=!1,!dr(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){Mn._dragging===this&&this.finishDrag();return}if(!(Mn._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(Mn._dragging=this,this._preventOutline&&Ts(this._element),Kn(),ws(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,_=Us(this._element);this._startPoint=new Le(l.clientX,l.clientY),this._startPos=Kr(this._element),this._parentScale=Nr(_);var x=r.type==="mousedown";De(document,x?"mousemove":"touchmove",this._onMove,this),De(document,x?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,_=new Le(l.clientX,l.clientY)._subtract(this._startPoint);!_.x&&!_.y||Math.abs(_.x)+Math.abs(_.y)<this.options.clickTolerance||(_.x/=this._parentScale.x,_.y/=this._parentScale.y,qi(r),this._moved||(this.fire("dragstart"),this._moved=!0,re(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),re(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(_),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Ai(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(r){ai(document.body,"leaflet-dragging"),this._lastTarget&&(ai(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ti(document,"mousemove touchmove",this._onMove,this),ti(document,"mouseup touchend touchcancel",this._onUp,this),oo(),Os();var l=this._moved&&this._moving;this._moving=!1,Mn._dragging=!1,l&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)})}});function es(r,l,_){var x,E=[1,4,2,8],N,$,at,Tt,Dt,oe,me,je;for(N=0,oe=r.length;N<oe;N++)r[N]._code=Et(r[N],l);for(at=0;at<4;at++){for(me=E[at],x=[],N=0,oe=r.length,$=oe-1;N<oe;$=N++)Tt=r[N],Dt=r[$],Tt._code&me?Dt._code&me||(je=et(Dt,Tt,me,l,_),je._code=Et(je,l),x.push(je)):(Dt._code&me&&(je=et(Dt,Tt,me,l,_),je._code=Et(je,l),x.push(je)),x.push(Tt));r=x}return r}function Lo(r,l){var _,x,E,N,$,at,Tt,Dt,oe;if(!r||r.length===0)throw new Error("latlngs not passed");qt(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var me=Pe([0,0]),je=Qe(r),Mi=je.getNorthWest().distanceTo(je.getSouthWest())*je.getNorthEast().distanceTo(je.getNorthWest());Mi<1700&&(me=qs(r));var ln=r.length,Xi=[];for(_=0;_<ln;_++){var Je=Pe(r[_]);Xi.push(l.project(Pe([Je.lat-me.lat,Je.lng-me.lng])))}for(at=Tt=Dt=0,_=0,x=ln-1;_<ln;x=_++)E=Xi[_],N=Xi[x],$=E.y*N.x-N.y*E.x,Tt+=(E.x+N.x)*$,Dt+=(E.y+N.y)*$,at+=$*3;at===0?oe=Xi[0]:oe=[Tt/at,Dt/at];var Ei=l.unproject(Ae(oe));return Pe([Ei.lat+me.lat,Ei.lng+me.lng])}function qs(r){for(var l=0,_=0,x=0,E=0;E<r.length;E++){var N=Pe(r[E]);l+=N.lat,_+=N.lng,x++}return Pe([l/x,_/x])}var ei={__proto__:null,clipPolygon:es,polygonCenter:Lo,centroid:qs};function js(r,l){if(!l||!r.length)return r.slice();var _=l*l;return r=w(r,_),r=$s(r,_),r}function Hi(r,l,_){return Math.sqrt(he(r,l,_,!0))}function po(r,l,_){return he(r,l,_)}function $s(r,l){var _=r.length,x=typeof Uint8Array!=void 0+""?Uint8Array:Array,E=new x(_);E[0]=E[_-1]=1,M(r,E,l,0,_-1);var N,$=[];for(N=0;N<_;N++)E[N]&&$.push(r[N]);return $}function M(r,l,_,x,E){var N=0,$,at,Tt;for(at=x+1;at<=E-1;at++)Tt=he(r[at],r[x],r[E],!0),Tt>N&&($=at,N=Tt);N>_&&(l[$]=1,M(r,l,_,x,$),M(r,l,_,$,E))}function w(r,l){for(var _=[r[0]],x=1,E=0,N=r.length;x<N;x++)Lt(r[x],r[E])>l&&(_.push(r[x]),E=x);return E<N-1&&_.push(r[N-1]),_}var I;function q(r,l,_,x,E){var N=x?I:Et(r,_),$=Et(l,_),at,Tt,Dt;for(I=$;;){if(!(N|$))return[r,l];if(N&$)return!1;at=N||$,Tt=et(r,l,at,_,E),Dt=Et(Tt,_),at===N?(r=Tt,N=Dt):(l=Tt,$=Dt)}}function et(r,l,_,x,E){var N=l.x-r.x,$=l.y-r.y,at=x.min,Tt=x.max,Dt,oe;return _&8?(Dt=r.x+N*(Tt.y-r.y)/$,oe=Tt.y):_&4?(Dt=r.x+N*(at.y-r.y)/$,oe=at.y):_&2?(Dt=Tt.x,oe=r.y+$*(Tt.x-r.x)/N):_&1&&(Dt=at.x,oe=r.y+$*(at.x-r.x)/N),new Le(Dt,oe,E)}function Et(r,l){var _=0;return r.x<l.min.x?_|=1:r.x>l.max.x&&(_|=2),r.y<l.min.y?_|=4:r.y>l.max.y&&(_|=8),_}function Lt(r,l){var _=l.x-r.x,x=l.y-r.y;return _*_+x*x}function he(r,l,_,x){var E=l.x,N=l.y,$=_.x-E,at=_.y-N,Tt=$*$+at*at,Dt;return Tt>0&&(Dt=((r.x-E)*$+(r.y-N)*at)/Tt,Dt>1?(E=_.x,N=_.y):Dt>0&&(E+=$*Dt,N+=at*Dt)),$=r.x-E,at=r.y-N,x?$*$+at*at:new Le(E,N)}function qt(r){return!be(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function Ge(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),qt(r)}function xe(r,l){var _,x,E,N,$,at,Tt,Dt;if(!r||r.length===0)throw new Error("latlngs not passed");qt(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var oe=Pe([0,0]),me=Qe(r),je=me.getNorthWest().distanceTo(me.getSouthWest())*me.getNorthEast().distanceTo(me.getNorthWest());je<1700&&(oe=qs(r));var Mi=r.length,ln=[];for(_=0;_<Mi;_++){var Xi=Pe(r[_]);ln.push(l.project(Pe([Xi.lat-oe.lat,Xi.lng-oe.lng])))}for(_=0,x=0;_<Mi-1;_++)x+=ln[_].distanceTo(ln[_+1])/2;if(x===0)Dt=ln[0];else for(_=0,N=0;_<Mi-1;_++)if($=ln[_],at=ln[_+1],E=$.distanceTo(at),N+=E,N>x){Tt=(N-x)/E,Dt=[at.x-Tt*(at.x-$.x),at.y-Tt*(at.y-$.y)];break}var Je=l.unproject(Ae(Dt));return Pe([Je.lat+oe.lat,Je.lng+oe.lng])}var ze={__proto__:null,simplify:js,pointToSegmentDistance:Hi,closestPointOnSegment:po,clipSegment:q,_getEdgeIntersection:et,_getBitCode:Et,_sqClosestPointOnSegment:he,isFlat:qt,_flat:Ge,polylineCenter:xe},Qn={project:function(r){return new Le(r.lng,r.lat)},unproject:function(r){return new _e(r.y,r.x)},bounds:new fi([-180,-90],[180,90])},fo={R:6378137,R_MINOR:6356752314245179e-9,bounds:new fi([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,_=this.R,x=r.lat*l,E=this.R_MINOR/_,N=Math.sqrt(1-E*E),$=N*Math.sin(x),at=Math.tan(Math.PI/4-x/2)/Math.pow((1-$)/(1+$),N/2);return x=-_*Math.log(Math.max(at,1e-10)),new Le(r.lng*l*_,x)},unproject:function(r){for(var l=180/Math.PI,_=this.R,x=this.R_MINOR/_,E=Math.sqrt(1-x*x),N=Math.exp(-r.y/_),$=Math.PI/2-2*Math.atan(N),at=0,Tt=.1,Dt;at<15&&Math.abs(Tt)>1e-7;at++)Dt=E*Math.sin($),Dt=Math.pow((1-Dt)/(1+Dt),E/2),Tt=Math.PI/2-2*Math.atan(N*Dt)-$,$+=Tt;return new _e($*l,r.x*l/_)}},mo={__proto__:null,LonLat:Qn,Mercator:fo,SphericalMercator:Dn},ma=J({},un,{code:"EPSG:3395",projection:fo,transformation:function(){var r=.5/(Math.PI*fo.R);return Bi(r,.5,-r,.5)}()}),_o=J({},un,{code:"EPSG:4326",projection:Qn,transformation:Bi(1/180,1,-1/180,.5)}),go=J({},vn,{projection:Qn,transformation:Bi(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var _=l.lng-r.lng,x=l.lat-r.lat;return Math.sqrt(_*_+x*x)},infinite:!0});vn.Earth=un,vn.EPSG3395=ma,vn.EPSG3857=wr,vn.EPSG900913=Pt,vn.EPSG4326=_o,vn.Simple=go;var fn=xi.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[Ot(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[Ot(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var _=this.getEvents();l.on(_,this),this.once("remove",function(){l.off(_,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});Xe.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=Ot(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=Ot(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return Ot(r)in this._layers},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},_addLayers:function(r){r=r?be(r)?r:[r]:[];for(var l=0,_=r.length;l<_;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[Ot(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=Ot(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,_=this._getZoomSpan();for(var x in this._zoomBoundLayers){var E=this._zoomBoundLayers[x].options;r=E.minZoom===void 0?r:Math.min(r,E.minZoom),l=E.maxZoom===void 0?l:Math.max(l,E.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,_!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Vr=fn.extend({initialize:function(r,l){Gt(this,l),this._layers={};var _,x;if(r)for(_=0,x=r.length;_<x;_++)this.addLayer(r[_])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),_,x;for(_ in this._layers)x=this._layers[_],x[r]&&x[r].apply(x,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return Ot(r)}}),zo=function(r,l){return new Vr(r,l)},xn=Vr.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),Vr.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),Vr.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new ui;for(var l in this._layers){var _=this._layers[l];r.extend(_.getBounds?_.getBounds():_.getLatLng())}return r}}),Cs=function(r,l){return new xn(r,l)},is=Vi.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){Gt(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var _=this._getIconUrl(r);if(!_){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var x=this._createImg(_,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(x,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),x},_setIconStyles:function(r,l){var _=this.options,x=_[l+"Size"];typeof x=="number"&&(x=[x,x]);var E=Ae(x),N=Ae(l==="shadow"&&_.shadowAnchor||_.iconAnchor||E&&E.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(_.className||""),N&&(r.style.marginLeft=-N.x+"px",r.style.marginTop=-N.y+"px"),E&&(r.style.width=E.x+"px",r.style.height=E.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return ft.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function yo(r){return new is(r)}var _i=is.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof _i.imagePath!="string"&&(_i.imagePath=this._detectIconPath()),(this.options.imagePath||_i.imagePath)+is.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(_,x,E){var N=x.exec(_);return N&&N[E]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=Ue("div","leaflet-default-icon-path",document.body),l=ur(r,"background-image")||ur(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var _=document.querySelector('link[href$="leaflet.css"]');return _?_.href.substring(0,_.href.length-11-1):""}}),Cr=Bn.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new Mn(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),re(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ai(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,_=l._map,x=this._marker.options.autoPanSpeed,E=this._marker.options.autoPanPadding,N=Kr(l._icon),$=_.getPixelBounds(),at=_.getPixelOrigin(),Tt=mi($.min._subtract(at).add(E),$.max._subtract(at).subtract(E));if(!Tt.contains(N)){var Dt=Ae((Math.max(Tt.max.x,N.x)-Tt.max.x)/($.max.x-Tt.max.x)-(Math.min(Tt.min.x,N.x)-Tt.min.x)/($.min.x-Tt.min.x),(Math.max(Tt.max.y,N.y)-Tt.max.y)/($.max.y-Tt.max.y)-(Math.min(Tt.min.y,N.y)-Tt.min.y)/($.min.y-Tt.min.y)).multiplyBy(x);_.panBy(Dt,{animate:!1}),this._draggable._newPos._add(Dt),this._draggable._startPos._add(Dt),Ai(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=we(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(Ii(this._panRequest),this._panRequest=we(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,_=l._shadow,x=Kr(l._icon),E=l._map.layerPointToLatLng(x);_&&Ai(_,x),l._latlng=E,r.latlng=E,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){Ii(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),mn=fn.extend({options:{icon:new _i,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){Gt(this,l),this._latlng=Pe(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=Pe(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),_=r.icon.createIcon(this._icon),x=!1;_!==this._icon&&(this._icon&&this._removeIcon(),x=!0,r.title&&(_.title=r.title),_.tagName==="IMG"&&(_.alt=r.alt||"")),re(_,l),r.keyboard&&(_.tabIndex="0",_.setAttribute("role","button")),this._icon=_,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&De(_,"focus",this._panOnFocus,this);var E=r.icon.createShadow(this._shadow),N=!1;E!==this._shadow&&(this._removeShadow(),N=!0),E&&(re(E,l),E.alt=""),this._shadow=E,r.opacity<1&&this._updateOpacity(),x&&this.getPane().appendChild(this._icon),this._initInteraction(),E&&N&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ti(this._icon,"focus",this._panOnFocus,this),bi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&bi(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Ai(this._icon,r),this._shadow&&Ai(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(re(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Cr)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Cr(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&kn(this._icon,r),this._shadow&&kn(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(r){var l=this.options.icon.options,_=l.iconSize?Ae(l.iconSize):Ae(0,0),x=l.iconAnchor?Ae(l.iconAnchor):Ae(0,0);r.panInside(this._latlng,{paddingTopLeft:x,paddingBottomRight:_.subtract(x)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Jo(r,l){return new mn(r,l)}var mr=fn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return Gt(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Gs=mr.extend({options:{fill:!0,radius:10},initialize:function(r,l){Gt(this,l),this._latlng=Pe(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=Pe(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return mr.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,_=this._clickTolerance(),x=[r+_,l+_];this._pxBounds=new fi(this._point.subtract(x),this._point.add(x))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Zr(r,l){return new Gs(r,l)}var Hs=Gs.extend({initialize:function(r,l,_){if(typeof l=="number"&&(l=J({},_,{radius:l})),Gt(this,l),this._latlng=Pe(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new ui(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:mr.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,_=this._map,x=_.options.crs;if(x.distance===un.distance){var E=Math.PI/180,N=this._mRadius/un.R/E,$=_.project([l+N,r]),at=_.project([l-N,r]),Tt=$.add(at).divideBy(2),Dt=_.unproject(Tt).lat,oe=Math.acos((Math.cos(N*E)-Math.sin(l*E)*Math.sin(Dt*E))/(Math.cos(l*E)*Math.cos(Dt*E)))/E;(isNaN(oe)||oe===0)&&(oe=N/Math.cos(Math.PI/180*l)),this._point=Tt.subtract(_.getPixelOrigin()),this._radius=isNaN(oe)?0:Tt.x-_.project([Dt,r-oe]).x,this._radiusY=Tt.y-$.y}else{var me=x.unproject(x.project(this._latlng).subtract([this._mRadius,0]));this._point=_.latLngToLayerPoint(this._latlng),this._radius=this._point.x-_.latLngToLayerPoint(me).x}this._updateBounds()}});function vo(r,l,_){return new Hs(r,l,_)}var qr=mr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){Gt(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,_=null,x=he,E,N,$=0,at=this._parts.length;$<at;$++)for(var Tt=this._parts[$],Dt=1,oe=Tt.length;Dt<oe;Dt++){E=Tt[Dt-1],N=Tt[Dt];var me=x(r,E,N,!0);me<l&&(l=me,_=x(r,E,N))}return _&&(_.distance=Math.sqrt(l)),_},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xe(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=Pe(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new ui,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return qt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],_=qt(r),x=0,E=r.length;x<E;x++)_?(l[x]=Pe(r[x]),this._bounds.extend(l[x])):l[x]=this._convertLatLngs(r[x]);return l},_project:function(){var r=new fi;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new Le(r,r);this._rawPxBounds&&(this._pxBounds=new fi([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,_){var x=r[0]instanceof _e,E=r.length,N,$;if(x){for($=[],N=0;N<E;N++)$[N]=this._map.latLngToLayerPoint(r[N]),_.extend($[N]);l.push($)}else for(N=0;N<E;N++)this._projectLatlngs(r[N],l,_)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,_,x,E,N,$,at,Tt;for(_=0,E=0,N=this._rings.length;_<N;_++)for(Tt=this._rings[_],x=0,$=Tt.length;x<$-1;x++)at=q(Tt[x],Tt[x+1],r,x,!0),at&&(l[E]=l[E]||[],l[E].push(at[0]),(at[1]!==Tt[x+1]||x===$-2)&&(l[E].push(at[1]),E++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,_=0,x=r.length;_<x;_++)r[_]=js(r[_],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var _,x,E,N,$,at,Tt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(_=0,N=this._parts.length;_<N;_++)for(at=this._parts[_],x=0,$=at.length,E=$-1;x<$;E=x++)if(!(!l&&x===0)&&Hi(r,at[E],at[x])<=Tt)return!0;return!1}});function _a(r,l){return new qr(r,l)}qr._flat=Ge;var Is=qr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Lo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=qr.prototype._convertLatLngs.call(this,r),_=l.length;return _>=2&&l[0]instanceof _e&&l[0].equals(l[_-1])&&l.pop(),l},_setLatLngs:function(r){qr.prototype._setLatLngs.call(this,r),qt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return qt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,_=new Le(l,l);if(r=new fi(r.min.subtract(_),r.max.add(_)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var x=0,E=this._rings.length,N;x<E;x++)N=es(this._rings[x],r,!0),N.length&&this._parts.push(N)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,_,x,E,N,$,at,Tt,Dt;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(N=0,Tt=this._parts.length;N<Tt;N++)for(_=this._parts[N],$=0,Dt=_.length,at=Dt-1;$<Dt;at=$++)x=_[$],E=_[at],x.y>r.y!=E.y>r.y&&r.x<(E.x-x.x)*(r.y-x.y)/(E.y-x.y)+x.x&&(l=!l);return l||qr.prototype._containsPoint.call(this,r,!0)}});function Ia(r,l){return new Is(r,l)}var _r=xn.extend({initialize:function(r,l){Gt(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=be(r)?r:r.features,_,x,E;if(l){for(_=0,x=l.length;_<x;_++)E=l[_],(E.geometries||E.geometry||E.features||E.coordinates)&&this.addData(E);return this}var N=this.options;if(N.filter&&!N.filter(r))return this;var $=tr(r,N);return $?($.feature=ks(r),$.defaultOptions=$.options,this.resetStyle($),N.onEachFeature&&N.onEachFeature(r,$),this.addLayer($)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=J({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function tr(r,l){var _=r.type==="Feature"?r.geometry:r,x=_?_.coordinates:null,E=[],N=l&&l.pointToLayer,$=l&&l.coordsToLatLng||xo,at,Tt,Dt,oe;if(!x&&!_)return null;switch(_.type){case"Point":return at=$(x),Do(N,r,at,l);case"MultiPoint":for(Dt=0,oe=x.length;Dt<oe;Dt++)at=$(x[Dt]),E.push(Do(N,r,at,l));return new xn(E);case"LineString":case"MultiLineString":return Tt=Ro(x,_.type==="LineString"?0:1,$),new qr(Tt,l);case"Polygon":case"MultiPolygon":return Tt=Ro(x,_.type==="Polygon"?1:2,$),new Is(Tt,l);case"GeometryCollection":for(Dt=0,oe=_.geometries.length;Dt<oe;Dt++){var me=tr({geometry:_.geometries[Dt],type:"Feature",properties:r.properties},l);me&&E.push(me)}return new xn(E);case"FeatureCollection":for(Dt=0,oe=_.features.length;Dt<oe;Dt++){var je=tr(_.features[Dt],l);je&&E.push(je)}return new xn(E);default:throw new Error("Invalid GeoJSON object.")}}function Do(r,l,_,x){return r?r(l,_):new mn(_,x&&x.markersInheritOptions&&x)}function xo(r){return new _e(r[1],r[0],r[2])}function Ro(r,l,_){for(var x=[],E=0,N=r.length,$;E<N;E++)$=l?Ro(r[E],l-1,_):(_||xo)(r[E]),x.push($);return x}function Ws(r,l){return r=Pe(r),r.alt!==void 0?[Ht(r.lng,l),Ht(r.lat,l),Ht(r.alt,l)]:[Ht(r.lng,l),Ht(r.lat,l)]}function Bo(r,l,_,x){for(var E=[],N=0,$=r.length;N<$;N++)E.push(l?Bo(r[N],qt(r[N])?0:l-1,_,x):Ws(r[N],x));return!l&&_&&E.length>0&&E.push(E[0].slice()),E}function Xs(r,l){return r.feature?J({},r.feature,{geometry:l}):ks(l)}function ks(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var Yo={toGeoJSON:function(r){return Xs(this,{type:"Point",coordinates:Ws(this.getLatLng(),r)})}};mn.include(Yo),Hs.include(Yo),Gs.include(Yo),qr.include({toGeoJSON:function(r){var l=!qt(this._latlngs),_=Bo(this._latlngs,l?1:0,!1,r);return Xs(this,{type:(l?"Multi":"")+"LineString",coordinates:_})}}),Is.include({toGeoJSON:function(r){var l=!qt(this._latlngs),_=l&&!qt(this._latlngs[0]),x=Bo(this._latlngs,_?2:l?1:0,!0,r);return l||(x=[x]),Xs(this,{type:(_?"Multi":"")+"Polygon",coordinates:x})}}),Vr.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(_){l.push(_.toGeoJSON(r).geometry.coordinates)}),Xs(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var _=l==="GeometryCollection",x=[];return this.eachLayer(function(E){if(E.toGeoJSON){var N=E.toGeoJSON(r);if(_)x.push(N.geometry);else{var $=ks(N);$.type==="FeatureCollection"?x.push.apply(x,$.features):x.push($)}}}),_?Xs(this,{geometries:x,type:"GeometryCollection"}):{type:"FeatureCollection",features:x}}});function Ir(r,l){return new _r(r,l)}var gr=Ir,As=fn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,_){this._url=r,this._bounds=Qe(l),Gt(this,_)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(re(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){bi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Or(this._image),this},bringToBack:function(){return this._map&&Wn(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=Qe(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:Ue("img");if(re(l,"leaflet-image-layer"),this._zoomAnimated&&re(l,"leaflet-zoom-animated"),this.options.className&&re(l,this.options.className),l.onselectstart=At,l.onmousemove=At,l.onload=bt(this.fire,this,"load"),l.onerror=bt(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),_=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;Fr(this._image,_,l)},_reset:function(){var r=this._image,l=new fi(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),_=l.getSize();Ai(r,l.min),r.style.width=_.x+"px",r.style.height=_.y+"px"},_updateOpacity:function(){kn(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),Wi=function(r,l,_){return new As(r,l,_)},ns=As.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:Ue("video");if(re(l,"leaflet-image-layer"),this._zoomAnimated&&re(l,"leaflet-zoom-animated"),this.options.className&&re(l,this.options.className),l.onselectstart=At,l.onmousemove=At,l.onloadeddata=bt(this.fire,this,"load"),r){for(var _=l.getElementsByTagName("source"),x=[],E=0;E<_.length;E++)x.push(_[E].src);this._url=_.length>0?x:[l.src];return}be(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var N=0;N<this._url.length;N++){var $=Ue("source");$.src=this._url[N],l.appendChild($)}}});function Ha(r,l,_){return new ns(r,l,_)}var ka=As.extend({_initImage:function(){var r=this._image=this._url;re(r,"leaflet-image-layer"),this._zoomAnimated&&re(r,"leaflet-zoom-animated"),this.options.className&&re(r,this.options.className),r.onselectstart=At,r.onmousemove=At}});function Wa(r,l,_){return new ka(r,l,_)}var Ln=fn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof _e||be(r))?(this._latlng=Pe(r),Gt(this,l)):(Gt(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&kn(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&kn(this._container,1),this.bringToFront(),this.options.interactive&&(re(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(kn(this._container,0),this._removeTimeout=setTimeout(bt(bi,void 0,this._container),200)):bi(this._container),this.options.interactive&&(ai(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=Pe(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Or(this._container),this},bringToBack:function(){return this._map&&Wn(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof xn){l=null;var _=this._source._layers;for(var x in _)if(_[x]._map){l=_[x];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=Ae(this.options.offset),_=this._getAnchor();this._zoomAnimated?Ai(this._container,r.add(_)):l=l.add(r).add(_);var x=this._containerBottom=-l.y,E=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=x+"px",this._container.style.left=E+"px"}},_getAnchor:function(){return[0,0]}});Xe.include({_initOverlay:function(r,l,_,x){var E=l;return E instanceof r||(E=new r(x).setContent(l)),_&&E.setLatLng(_),E}}),fn.include({_initOverlay:function(r,l,_,x){var E=_;return E instanceof r?(Gt(E,x),E._source=this):(E=l&&!x?l:new r(x,this),E.setContent(_)),E}});var Ms=Ln.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,Ln.prototype.openOn.call(this,r)},onAdd:function(r){Ln.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof mr||this._source.on("preclick",Er))},onRemove:function(r){Ln.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof mr||this._source.off("preclick",Er))},getEvents:function(){var r=Ln.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=Ue("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),_=this._wrapper=Ue("div",r+"-content-wrapper",l);if(this._contentNode=Ue("div",r+"-content",_),Ur(l),Yr(this._contentNode),De(l,"contextmenu",Er),this._tipContainer=Ue("div",r+"-tip-container",l),this._tip=Ue("div",r+"-tip",this._tipContainer),this.options.closeButton){var x=this._closeButton=Ue("a",r+"-close-button",l);x.setAttribute("role","button"),x.setAttribute("aria-label","Close popup"),x.href="#close",x.innerHTML='<span aria-hidden="true">&#215;</span>',De(x,"click",function(E){qi(E),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var _=r.offsetWidth;_=Math.min(_,this.options.maxWidth),_=Math.max(_,this.options.minWidth),l.width=_+1+"px",l.whiteSpace="",l.height="";var x=r.offsetHeight,E=this.options.maxHeight,N="leaflet-popup-scrolled";E&&x>E?(l.height=E+"px",re(r,N)):ai(r,N),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),_=this._getAnchor();Ai(this._container,l.add(_))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var r=this._map,l=parseInt(ur(this._container,"marginBottom"),10)||0,_=this._container.offsetHeight+l,x=this._containerWidth,E=new Le(this._containerLeft,-_-this._containerBottom);E._add(Kr(this._container));var N=r.layerPointToContainerPoint(E),$=Ae(this.options.autoPanPadding),at=Ae(this.options.autoPanPaddingTopLeft||$),Tt=Ae(this.options.autoPanPaddingBottomRight||$),Dt=r.getSize(),oe=0,me=0;N.x+x+Tt.x>Dt.x&&(oe=N.x+x-Dt.x+Tt.x),N.x-oe-at.x<0&&(oe=N.x-at.x),N.y+_+Tt.y>Dt.y&&(me=N.y+_-Dt.y+Tt.y),N.y-me-at.y<0&&(me=N.y-at.y),(oe||me)&&(this.options.keepInView&&(this._autopanning=!0),r.fire("autopanstart").panBy([oe,me]))}},_getAnchor:function(){return Ae(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),jr=function(r,l){return new Ms(r,l)};Xe.mergeOptions({closePopupOnClick:!0}),Xe.include({openPopup:function(r,l,_){return this._initOverlay(Ms,r,l,_).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),fn.include({bindPopup:function(r,l){return this._popup=this._initOverlay(Ms,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&(this instanceof xn||(this._popup._source=this),this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){Ee(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof mr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var ee=Ln.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){Ln.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){Ln.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=Ln.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ue("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Ot(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,_,x=this._map,E=this._container,N=x.latLngToContainerPoint(x.getCenter()),$=x.layerPointToContainerPoint(r),at=this.options.direction,Tt=E.offsetWidth,Dt=E.offsetHeight,oe=Ae(this.options.offset),me=this._getAnchor();at==="top"?(l=Tt/2,_=Dt):at==="bottom"?(l=Tt/2,_=0):at==="center"?(l=Tt/2,_=Dt/2):at==="right"?(l=0,_=Dt/2):at==="left"?(l=Tt,_=Dt/2):$.x<N.x?(at="right",l=0,_=Dt/2):(at="left",l=Tt+(oe.x+me.x)*2,_=Dt/2),r=r.subtract(Ae(l,_,!0)).add(oe).add(me),ai(E,"leaflet-tooltip-right"),ai(E,"leaflet-tooltip-left"),ai(E,"leaflet-tooltip-top"),ai(E,"leaflet-tooltip-bottom"),re(E,"leaflet-tooltip-"+at),Ai(E,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&kn(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return Ae(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Qo=function(r,l){return new ee(r,l)};Xe.include({openTooltip:function(r,l,_){return this._initOverlay(ee,r,l,_).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),fn.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ee,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",_={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?_.add=this._openTooltip:(_.mouseover=this._openTooltip,_.mouseout=this.closeTooltip,_.click=this._openTooltip,this._map?this._addFocusListeners():_.add=this._addFocusListeners),this._tooltip.options.sticky&&(_.mousemove=this._moveTooltip),this[l](_),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&(this instanceof xn||(this._tooltip._source=this),this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&(De(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),De(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var l=this;this._map.once("moveend",function(){l._openOnceFlag=!1,l._openTooltip(r)});return}this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0)}},_moveTooltip:function(r){var l=r.latlng,_,x;this._tooltip.options.sticky&&r.originalEvent&&(_=this._map.mouseEventToContainerPoint(r.originalEvent),x=this._map.containerPointToLayerPoint(_),l=this._map.layerPointToLatLng(x)),this._tooltip.setLatLng(l)}});var bo=is.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),_=this.options;if(_.html instanceof Element?(Ni(l),l.appendChild(_.html)):l.innerHTML=_.html!==!1?_.html:"",_.bgPos){var x=Ae(_.bgPos);l.style.backgroundPosition=-x.x+"px "+-x.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function rs(r){return new bo(r)}is.Default=_i;var wo=fn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ft.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){Gt(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),bi(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Or(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Wn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=yt(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof Le?r:new Le(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,_=-r(-1/0,1/0),x=0,E=l.length,N;x<E;x++)N=l[x].style.zIndex,l[x]!==this._container&&N&&(_=r(_,+N));isFinite(_)&&(this.options.zIndex=_+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ft.ielt9){kn(this._container,this.options.opacity);var r=+new Date,l=!1,_=!1;for(var x in this._tiles){var E=this._tiles[x];if(!(!E.current||!E.loaded)){var N=Math.min(1,(r-E.loaded)/200);kn(E.el,N),N<1?l=!0:(E.active?_=!0:this._onOpaqueTile(E),E.active=!0)}}_&&!this._noPrune&&this._pruneTiles(),l&&(Ii(this._fadeFrame),this._fadeFrame=we(this._updateOpacity,this))}},_onOpaqueTile:At,_initContainer:function(){this._container||(this._container=Ue("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var _ in this._levels)_=Number(_),this._levels[_].el.children.length||_===r?(this._levels[_].el.style.zIndex=l-Math.abs(r-_),this._onUpdateLevel(_)):(bi(this._levels[_].el),this._removeTilesAtZoom(_),this._onRemoveLevel(_),delete this._levels[_]);var x=this._levels[r],E=this._map;return x||(x=this._levels[r]={},x.el=Ue("div","leaflet-tile-container leaflet-zoom-animated",this._container),x.el.style.zIndex=l,x.origin=E.project(E.unproject(E.getPixelOrigin()),r).round(),x.zoom=r,this._setZoomTransform(x,E.getCenter(),E.getZoom()),At(x.el.offsetWidth),this._onCreateLevel(x)),this._level=x,x}},_onUpdateLevel:At,_onRemoveLevel:At,_onCreateLevel:At,_pruneTiles:function(){if(this._map){var r,l,_=this._map.getZoom();if(_>this.options.maxZoom||_<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var x=l.coords;this._retainParent(x.x,x.y,x.z,x.z-5)||this._retainChildren(x.x,x.y,x.z,x.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)bi(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,_,x){var E=Math.floor(r/2),N=Math.floor(l/2),$=_-1,at=new Le(+E,+N);at.z=+$;var Tt=this._tileCoordsToKey(at),Dt=this._tiles[Tt];return Dt&&Dt.active?(Dt.retain=!0,!0):(Dt&&Dt.loaded&&(Dt.retain=!0),$>x?this._retainParent(E,N,$,x):!1)},_retainChildren:function(r,l,_,x){for(var E=2*r;E<2*r+2;E++)for(var N=2*l;N<2*l+2;N++){var $=new Le(E,N);$.z=_+1;var at=this._tileCoordsToKey($),Tt=this._tiles[at];if(Tt&&Tt.active){Tt.retain=!0;continue}else Tt&&Tt.loaded&&(Tt.retain=!0);_+1<x&&this._retainChildren(E,N,_+1,x)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,_,x){var E=Math.round(l);this.options.maxZoom!==void 0&&E>this.options.maxZoom||this.options.minZoom!==void 0&&E<this.options.minZoom?E=void 0:E=this._clampZoom(E);var N=this.options.updateWhenZooming&&E!==this._tileZoom;(!x||N)&&(this._tileZoom=E,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),E!==void 0&&this._update(r),_||this._pruneTiles(),this._noPrune=!!_),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var _ in this._levels)this._setZoomTransform(this._levels[_],r,l)},_setZoomTransform:function(r,l,_){var x=this._map.getZoomScale(_,r.zoom),E=r.origin.multiplyBy(x).subtract(this._map._getNewPixelOrigin(l,_)).round();ft.any3d?Fr(r.el,E,x):Ai(r.el,E)},_resetGrid:function(){var r=this._map,l=r.options.crs,_=this._tileSize=this.getTileSize(),x=this._tileZoom,E=this._map.getPixelWorldBounds(this._tileZoom);E&&(this._globalTileRange=this._pxBoundsToTileRange(E)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],x).x/_.x),Math.ceil(r.project([0,l.wrapLng[1]],x).x/_.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],x).y/_.x),Math.ceil(r.project([l.wrapLat[1],0],x).y/_.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,_=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),x=l.getZoomScale(_,this._tileZoom),E=l.project(r,this._tileZoom).floor(),N=l.getSize().divideBy(x*2);return new fi(E.subtract(N),E.add(N))},_update:function(r){var l=this._map;if(l){var _=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var x=this._getTiledPixelBounds(r),E=this._pxBoundsToTileRange(x),N=E.getCenter(),$=[],at=this.options.keepBuffer,Tt=new fi(E.getBottomLeft().subtract([at,-at]),E.getTopRight().add([at,-at]));if(!(isFinite(E.min.x)&&isFinite(E.min.y)&&isFinite(E.max.x)&&isFinite(E.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Dt in this._tiles){var oe=this._tiles[Dt].coords;(oe.z!==this._tileZoom||!Tt.contains(new Le(oe.x,oe.y)))&&(this._tiles[Dt].current=!1)}if(Math.abs(_-this._tileZoom)>1){this._setView(r,_);return}for(var me=E.min.y;me<=E.max.y;me++)for(var je=E.min.x;je<=E.max.x;je++){var Mi=new Le(je,me);if(Mi.z=this._tileZoom,!!this._isValidTile(Mi)){var ln=this._tiles[this._tileCoordsToKey(Mi)];ln?ln.current=!0:$.push(Mi)}}if($.sort(function(Je,Ei){return Je.distanceTo(N)-Ei.distanceTo(N)}),$.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Xi=document.createDocumentFragment();for(je=0;je<$.length;je++)this._addTile($[je],Xi);this._level.el.appendChild(Xi)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var _=this._globalTileRange;if(!l.wrapLng&&(r.x<_.min.x||r.x>_.max.x)||!l.wrapLat&&(r.y<_.min.y||r.y>_.max.y))return!1}if(!this.options.bounds)return!0;var x=this._tileCoordsToBounds(r);return Qe(this.options.bounds).overlaps(x)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,_=this.getTileSize(),x=r.scaleBy(_),E=x.add(_),N=l.unproject(x,r.z),$=l.unproject(E,r.z);return[N,$]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),_=new ui(l[0],l[1]);return this.options.noWrap||(_=this._map.wrapLatLngBounds(_)),_},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),_=new Le(+l[0],+l[1]);return _.z=+l[2],_},_removeTile:function(r){var l=this._tiles[r];l&&(bi(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){re(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=At,r.onmousemove=At,ft.ielt9&&this.options.opacity<1&&kn(r,this.options.opacity)},_addTile:function(r,l){var _=this._getTilePos(r),x=this._tileCoordsToKey(r),E=this.createTile(this._wrapCoords(r),bt(this._tileReady,this,r));this._initTile(E),this.createTile.length<2&&we(bt(this._tileReady,this,r,null,E)),Ai(E,_),this._tiles[x]={el:E,coords:r,current:!0},l.appendChild(E),this.fire("tileloadstart",{tile:E,coords:r})},_tileReady:function(r,l,_){l&&this.fire("tileerror",{error:l,tile:_,coords:r});var x=this._tileCoordsToKey(r);_=this._tiles[x],_&&(_.loaded=+new Date,this._map._fadeAnimated?(kn(_.el,0),Ii(this._fadeFrame),this._fadeFrame=we(this._updateOpacity,this)):(_.active=!0,this._pruneTiles()),l||(re(_.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:_.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ft.ielt9||!this._map._fadeAnimated?we(this._pruneTiles,this):setTimeout(bt(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new Le(this._wrapX?Se(r.x,this._wrapX):r.x,this._wrapY?Se(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new fi(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function Kt(r){return new wo(r)}var ss=wo.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=Gt(this,l),l.detectRetina&&ft.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var _=document.createElement("img");return De(_,"load",bt(this._tileOnLoad,this,l,_)),De(_,"error",bt(this._tileOnError,this,l,_)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(_.referrerPolicy=this.options.referrerPolicy),_.alt="",_.src=this.getTileUrl(r),_},getTileUrl:function(r){var l={r:ft.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var _=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=_),l["-y"]=_}return de(this._url,J(l,this.options))},_tileOnLoad:function(r,l){ft.ielt9?setTimeout(bt(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,_){var x=this.options.errorTileUrl;x&&l.getAttribute("src")!==x&&(l.src=x),r(_,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,_=this.options.zoomReverse,x=this.options.zoomOffset;return _&&(r=l-r),r+x},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=At,l.onerror=At,!l.complete)){l.src=yi;var _=this._tiles[r].coords;bi(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:_})}},_removeTile:function(r){var l=this._tiles[r];if(l)return l.el.setAttribute("src",yi),wo.prototype._removeTile.call(this,r)},_tileReady:function(r,l,_){if(!(!this._map||_&&_.getAttribute("src")===yi))return wo.prototype._tileReady.call(this,r,l,_)}});function ta(r,l){return new ss(r,l)}var ga=ss.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var _=J({},this.defaultWmsParams);for(var x in l)x in this.options||(_[x]=l[x]);l=Gt(this,l);var E=l.detectRetina&&ft.retina?2:1,N=this.getTileSize();_.width=N.x*E,_.height=N.y*E,this.wmsParams=_},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,ss.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),_=this._crs,x=mi(_.project(l[0]),_.project(l[1])),E=x.min,N=x.max,$=(this._wmsVersion>=1.3&&this._crs===_o?[E.y,E.x,N.y,N.x]:[E.x,E.y,N.x,N.y]).join(","),at=ss.prototype.getTileUrl.call(this,r);return at+Nt(this.wmsParams,at,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+$},setParams:function(r,l){return J(this.wmsParams,r),l||this.redraw(),this}});function ea(r,l){return new ga(r,l)}ss.WMS=ga,ta.wms=ea;var $r=fn.extend({options:{padding:.1},initialize:function(r){Gt(this,r),Ot(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),re(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var _=this._map.getZoomScale(l,this._zoom),x=this._map.getSize().multiplyBy(.5+this.options.padding),E=this._map.project(this._center,l),N=x.multiplyBy(-_).add(E).subtract(this._map._getNewPixelOrigin(r,l));ft.any3d?Fr(this._container,N,_):Ai(this._container,N)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),_=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new fi(_,_.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Oo=$r.extend({options:{tolerance:0},getEvents:function(){var r=$r.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){$r.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");De(r,"mousemove",this._onMouseMove,this),De(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),De(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){Ii(this._redrawRequest),delete this._ctx,bi(this._container),ti(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$r.prototype._update.call(this);var r=this._bounds,l=this._container,_=r.getSize(),x=ft.retina?2:1;Ai(l,r.min),l.width=x*_.x,l.height=x*_.y,l.style.width=_.x+"px",l.style.height=_.y+"px",ft.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){$r.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[Ot(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,_=l.next,x=l.prev;_?_.prev=x:this._drawLast=x,x?x.next=_:this._drawFirst=_,delete r._order,delete this._layers[Ot(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),_=[],x,E;for(E=0;E<l.length;E++){if(x=Number(l[E]),isNaN(x))return;_.push(x)}r.options._dashArray=_}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){this._map&&(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||we(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new fi,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var _=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,_.x,_.y),this._ctx.clip()}this._drawing=!0;for(var x=this._drawFirst;x;x=x.next)r=x.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(this._drawing){var _,x,E,N,$=r._parts,at=$.length,Tt=this._ctx;if(at){for(Tt.beginPath(),_=0;_<at;_++){for(x=0,E=$[_].length;x<E;x++)N=$[_][x],Tt[x?"lineTo":"moveTo"](N.x,N.y);l&&Tt.closePath()}this._fillStroke(Tt,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,_=this._ctx,x=Math.max(Math.round(r._radius),1),E=(Math.max(Math.round(r._radiusY),1)||x)/x;E!==1&&(_.save(),_.scale(1,E)),_.beginPath(),_.arc(l.x,l.y/E,x,0,Math.PI*2,!1),E!==1&&_.restore(),this._fillStroke(_,r)}},_fillStroke:function(r,l){var _=l.options;_.fill&&(r.globalAlpha=_.fillOpacity,r.fillStyle=_.fillColor||_.color,r.fill(_.fillRule||"evenodd")),_.stroke&&_.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=_.opacity,r.lineWidth=_.weight,r.strokeStyle=_.color,r.lineCap=_.lineCap,r.lineJoin=_.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),_,x,E=this._drawFirst;E;E=E.next)_=E.layer,_.options.interactive&&_._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(_))&&(x=_);this._fireEvent(x?[x]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(ai(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var _,x,E=this._drawFirst;E;E=E.next)_=E.layer,_.options.interactive&&_._containsPoint(l)&&(x=_);x!==this._hoveredLayer&&(this._handleMouseOut(r),x&&(re(this._container,"leaflet-interactive"),this._fireEvent([x],r,"mouseover"),this._hoveredLayer=x)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(bt(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,_){this._map._fireDOMEvent(l,_||l.type,r)},_bringToFront:function(r){var l=r._order;if(l){var _=l.next,x=l.prev;if(_)_.prev=x;else return;x?x.next=_:_&&(this._drawFirst=_),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(l){var _=l.next,x=l.prev;if(x)x.next=_;else return;_?_.prev=x:x&&(this._drawLast=x),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function Fo(r){return ft.canvas?new Oo(r):null}var To=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ya={_initContainer:function(){this._container=Ue("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||($r.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=To("shape");re(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=To("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[Ot(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;bi(l),r.removeInteractiveTarget(l),delete this._layers[Ot(r)]},_updateStyle:function(r){var l=r._stroke,_=r._fill,x=r.options,E=r._container;E.stroked=!!x.stroke,E.filled=!!x.fill,x.stroke?(l||(l=r._stroke=To("stroke")),E.appendChild(l),l.weight=x.weight+"px",l.color=x.color,l.opacity=x.opacity,x.dashArray?l.dashStyle=be(x.dashArray)?x.dashArray.join(" "):x.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=x.lineCap.replace("butt","flat"),l.joinstyle=x.lineJoin):l&&(E.removeChild(l),r._stroke=null),x.fill?(_||(_=r._fill=To("fill")),E.appendChild(_),_.color=x.fillColor||x.color,_.opacity=x.fillOpacity):_&&(E.removeChild(_),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),_=Math.round(r._radius),x=Math.round(r._radiusY||_);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+_+","+x+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Or(r._container)},_bringToBack:function(r){Wn(r._container)}},Ks=ft.vml?To:cr,Js=$r.extend({_initContainer:function(){this._container=Ks("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ks("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){bi(this._container),ti(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$r.prototype._update.call(this);var r=this._bounds,l=r.getSize(),_=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,_.setAttribute("width",l.x),_.setAttribute("height",l.y)),Ai(_,r.min),_.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=Ks("path");r.options.className&&re(l,r.options.className),r.options.interactive&&re(l,"leaflet-interactive"),this._updateStyle(r),this._layers[Ot(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){bi(r._path),r.removeInteractiveTarget(r._path),delete this._layers[Ot(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,_=r.options;l&&(_.stroke?(l.setAttribute("stroke",_.color),l.setAttribute("stroke-opacity",_.opacity),l.setAttribute("stroke-width",_.weight),l.setAttribute("stroke-linecap",_.lineCap),l.setAttribute("stroke-linejoin",_.lineJoin),_.dashArray?l.setAttribute("stroke-dasharray",_.dashArray):l.removeAttribute("stroke-dasharray"),_.dashOffset?l.setAttribute("stroke-dashoffset",_.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),_.fill?(l.setAttribute("fill",_.fillColor||_.color),l.setAttribute("fill-opacity",_.fillOpacity),l.setAttribute("fill-rule",_.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,Wr(r._parts,l))},_updateCircle:function(r){var l=r._point,_=Math.max(Math.round(r._radius),1),x=Math.max(Math.round(r._radiusY),1)||_,E="a"+_+","+x+" 0 1,0 ",N=r._empty()?"M0 0":"M"+(l.x-_)+","+l.y+E+_*2+",0 "+E+-_*2+",0 ";this._setPath(r,N)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Or(r._path)},_bringToBack:function(r){Wn(r._path)}});ft.vml&&Js.include(ya);function So(r){return ft.svg||ft.vml?new Js(r):null}Xe.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&Fo(r)||So(r)}});var zn=Is.extend({initialize:function(r,l){Is.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=Qe(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Ls(r,l){return new zn(r,l)}Js.create=Ks,Js.pointsToPath=Wr,_r.geometryToLayer=tr,_r.coordsToLatLng=xo,_r.coordsToLatLngs=Ro,_r.latLngToCoords=Ws,_r.latLngsToCoords=Bo,_r.getFeature=Xs,_r.asFeature=ks,Xe.mergeOptions({boxZoom:!0});var va=Bn.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){De(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ti(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){bi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),ws(),Kn(),this._startPoint=this._map.mouseEventToContainerPoint(r),De(document,{contextmenu:Ee,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=Ue("div","leaflet-zoom-box",this._container),re(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new fi(this._point,this._startPoint),_=l.getSize();Ai(this._box,l.min),this._box.style.width=_.x+"px",this._box.style.height=_.y+"px"},_finish:function(){this._moved&&(bi(this._box),ai(this._container,"leaflet-crosshair")),Os(),oo(),ti(document,{contextmenu:Ee,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(bt(this._resetState,this),0);var l=new ui(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Xe.addInitHook("addHandler","boxZoom",va),Xe.mergeOptions({doubleClickZoom:!0});var ia=Bn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,_=l.getZoom(),x=l.options.zoomDelta,E=r.originalEvent.shiftKey?_-x:_+x;l.options.doubleClickZoom==="center"?l.setZoom(E):l.setZoomAround(r.containerPoint,E)}});Xe.addInitHook("addHandler","doubleClickZoom",ia),Xe.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var No=Bn.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new Mn(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}re(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ai(this._map._container,"leaflet-grab"),ai(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=Qe(this._map.options.maxBounds);this._offsetLimit=mi(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,_=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(_),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),_=this._initialWorldOffset,x=this._draggable._newPos.x,E=(x-l+_)%r+l-_,N=(x+l+_)%r-l-_,$=Math.abs(E+_)<Math.abs(N+_)?E:N;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=$},_onDragEnd:function(r){var l=this._map,_=l.options,x=!_.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),x)l.fire("moveend");else{this._prunePositions(+new Date);var E=this._lastPos.subtract(this._positions[0]),N=(this._lastTime-this._times[0])/1e3,$=_.easeLinearity,at=E.multiplyBy($/N),Tt=at.distanceTo([0,0]),Dt=Math.min(_.inertiaMaxSpeed,Tt),oe=at.multiplyBy(Dt/Tt),me=Dt/(_.inertiaDeceleration*$),je=oe.multiplyBy(-me/2).round();!je.x&&!je.y?l.fire("moveend"):(je=l._limitOffset(je,l.options.maxBounds),we(function(){l.panBy(je,{duration:me,easeLinearity:$,noMoveStart:!0,animate:!0})}))}}});Xe.addInitHook("addHandler","dragging",No),Xe.mergeOptions({keyboard:!0,keyboardPanDelta:80});var na=Bn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),De(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ti(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,_=r.scrollTop||l.scrollTop,x=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(x,_)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},_=this.keyCodes,x,E;for(x=0,E=_.left.length;x<E;x++)l[_.left[x]]=[-1*r,0];for(x=0,E=_.right.length;x<E;x++)l[_.right[x]]=[r,0];for(x=0,E=_.down.length;x<E;x++)l[_.down[x]]=[0,r];for(x=0,E=_.up.length;x<E;x++)l[_.up[x]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},_=this.keyCodes,x,E;for(x=0,E=_.zoomIn.length;x<E;x++)l[_.zoomIn[x]]=r;for(x=0,E=_.zoomOut.length;x<E;x++)l[_.zoomOut[x]]=-r},_addHooks:function(){De(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ti(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,_=this._map,x;if(l in this._panKeys){if(!_._panAnim||!_._panAnim._inProgress)if(x=this._panKeys[l],r.shiftKey&&(x=Ae(x).multiplyBy(3)),_.options.maxBounds&&(x=_._limitOffset(Ae(x),_.options.maxBounds)),_.options.worldCopyJump){var E=_.wrapLatLng(_.unproject(_.project(_.getCenter()).add(x)));_.panTo(E)}else _.panBy(x)}else if(l in this._zoomKeys)_.setZoom(_.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&_._popup&&_._popup.options.closeOnEscapeKey)_.closePopup();else return;Ee(r)}}});Xe.addInitHook("addHandler","keyboard",na),Xe.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var xa=Bn.extend({addHooks:function(){De(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ti(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Vs(r),_=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var x=Math.max(_-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(bt(this._performZoom,this),x),Ee(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),_=this._map.options.zoomSnap||0;r._stop();var x=this._delta/(this._map.options.wheelPxPerZoomLevel*4),E=4*Math.log(2/(1+Math.exp(-Math.abs(x))))/Math.LN2,N=_?Math.ceil(E/_)*_:E,$=r._limitZoom(l+(this._delta>0?N:-N))-l;this._delta=0,this._startTime=null,$&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+$):r.setZoomAround(this._lastMousePos,l+$))}});Xe.addInitHook("addHandler","scrollWheelZoom",xa);var yr=600;Xe.mergeOptions({tapHold:ft.touchNative&&ft.safari&&ft.mobile,tapTolerance:15});var wi=Bn.extend({addHooks:function(){De(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ti(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new Le(l.clientX,l.clientY),this._holdTimeout=setTimeout(bt(function(){this._cancel(),this._isTapValid()&&(De(document,"touchend",qi),De(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),yr),De(document,"touchend touchcancel contextmenu",this._cancel,this),De(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){ti(document,"touchend",qi),ti(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),ti(document,"touchend touchcancel contextmenu",this._cancel,this),ti(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new Le(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var _=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});_._simulated=!0,l.target.dispatchEvent(_)}});Xe.addInitHook("addHandler","tapHold",wi),Xe.mergeOptions({touchZoom:ft.touch,bounceAtZoomLimits:!0});var Uo=Bn.extend({addHooks:function(){re(this._map._container,"leaflet-touch-zoom"),De(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ai(this._map._container,"leaflet-touch-zoom"),ti(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var _=l.mouseEventToContainerPoint(r.touches[0]),x=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(_.add(x)._divideBy(2))),this._startDist=_.distanceTo(x),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),De(document,"touchmove",this._onTouchMove,this),De(document,"touchend touchcancel",this._onTouchEnd,this),qi(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,_=l.mouseEventToContainerPoint(r.touches[0]),x=l.mouseEventToContainerPoint(r.touches[1]),E=_.distanceTo(x)/this._startDist;if(this._zoom=l.getScaleZoom(E,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&E<1||this._zoom>l.getMaxZoom()&&E>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,E===1)return}else{var N=_._add(x)._divideBy(2)._subtract(this._centerPoint);if(E===1&&N.x===0&&N.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(N),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),Ii(this._animRequest);var $=bt(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=we($,this,!0),qi(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ii(this._animRequest),ti(document,"touchmove",this._onTouchMove,this),ti(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Xe.addInitHook("addHandler","touchZoom",Uo),Xe.BoxZoom=va,Xe.DoubleClickZoom=ia,Xe.Drag=No,Xe.Keyboard=na,Xe.ScrollWheelZoom=xa,Xe.TapHold=wi,Xe.TouchZoom=Uo,V.Bounds=fi,V.Browser=ft,V.CRS=vn,V.Canvas=Oo,V.Circle=Hs,V.CircleMarker=Gs,V.Class=Vi,V.Control=Yn,V.DivIcon=bo,V.DivOverlay=Ln,V.DomEvent=Wo,V.DomUtil=Ss,V.Draggable=Mn,V.Evented=xi,V.FeatureGroup=xn,V.GeoJSON=_r,V.GridLayer=wo,V.Handler=Bn,V.Icon=is,V.ImageOverlay=As,V.LatLng=_e,V.LatLngBounds=ui,V.Layer=fn,V.LayerGroup=Vr,V.LineUtil=ze,V.Map=Xe,V.Marker=mn,V.Mixin=ts,V.Path=mr,V.Point=Le,V.PolyUtil=ei,V.Polygon=Is,V.Polyline=qr,V.Popup=Ms,V.PosAnimation=Qr,V.Projection=mo,V.Rectangle=zn,V.Renderer=$r,V.SVG=Js,V.SVGOverlay=ka,V.TileLayer=ss,V.Tooltip=ee,V.Transformation=qn,V.Util=Qi,V.VideoOverlay=ns,V.bind=bt,V.bounds=mi,V.canvas=Fo,V.circle=vo,V.circleMarker=Zr,V.control=ao,V.divIcon=rs,V.extend=J,V.featureGroup=Cs,V.geoJSON=Ir,V.geoJson=gr,V.gridLayer=Kt,V.icon=yo,V.imageOverlay=Wi,V.latLng=Pe,V.latLngBounds=Qe,V.layerGroup=zo,V.map=pa,V.marker=Jo,V.point=Ae,V.polygon=Ia,V.polyline=_a,V.popup=jr,V.rectangle=Ls,V.setOptions=Gt,V.stamp=Ot,V.svg=So,V.svgOverlay=Wa,V.tileLayer=ta,V.tooltip=Qo,V.transformation=Bi,V.version=it,V.videoOverlay=Ha;var ba=window.L;V.noConflict=function(){return window.L=ba,this},window.L=V})})(Vc,Vc.exports);var _l=Vc.exports;function Zl(vt,pt,V){return Object.freeze({instance:vt,context:pt,container:V})}function ql(vt,pt){return pt==null?function(it,J){const wt=Fe.useRef();return wt.current||(wt.current=vt(it,J)),wt}:function(it,J){const wt=Fe.useRef();wt.current||(wt.current=vt(it,J));const bt=Fe.useRef(it),{instance:d}=wt.current;return Fe.useEffect(function(){bt.current!==it&&(pt(d,it,bt.current),bt.current=it)},[d,it,J]),wt}}function Bu(vt,pt){Fe.useEffect(function(){return(pt.layerContainer??pt.map).addLayer(vt.instance),function(){var wt;(wt=pt.layerContainer)==null||wt.removeLayer(vt.instance),pt.map.removeLayer(vt.instance)}},[pt,vt])}function Ou(vt){return function(V){const it=Gc(),J=vt(Vl(V,it),it);return Mu(it.map,V.attribution),Hc(J.current,V.eventHandlers),Bu(J.current,it),J}}function Rp(vt,pt){const V=Fe.useRef();Fe.useEffect(function(){if(pt.pathOptions!==V.current){const J=pt.pathOptions??{};vt.instance.setStyle(J),V.current=J}},[vt,pt])}function Bp(vt){return function(V){const it=Gc(),J=vt(Vl(V,it),it);return Hc(J.current,V.eventHandlers),Bu(J.current,it),Rp(J.current,V),J}}function Op(vt,pt){const V=ql(vt,pt),it=Ou(V);return Ru(it)}function Fp(vt,pt){const V=ql(vt),it=Dp(V,pt);return Lp(it)}function Np(vt,pt){const V=ql(vt,pt),it=Bp(V);return Ru(it)}function Up(vt,pt){const V=ql(vt,pt),it=Ou(V);return zp(it)}function Vp(vt,pt,V){const{opacity:it,zIndex:J}=pt;it!=null&&it!==V.opacity&&vt.setOpacity(it),J!=null&&J!==V.zIndex&&vt.setZIndex(J)}const Bc=Np(function({center:pt,children:V,...it},J){const wt=new _l.Circle(pt,it);return Zl(wt,Lu(J,{overlayContainer:wt}))},kp);function Zc(){return Zc=Object.assign||function(vt){for(var pt=1;pt<arguments.length;pt++){var V=arguments[pt];for(var it in V)Object.prototype.hasOwnProperty.call(V,it)&&(vt[it]=V[it])}return vt},Zc.apply(this,arguments)}function Zp({bounds:vt,boundsOptions:pt,center:V,children:it,className:J,id:wt,placeholder:bt,style:d,whenReady:Ot,zoom:yt,...Se},At){const[Ht]=Fe.useState({className:J,id:wt,style:d}),[le,ce]=Fe.useState(null);Fe.useImperativeHandle(At,()=>(le==null?void 0:le.map)??null,[le]);const Gt=Fe.useCallback(Ft=>{if(Ft!==null&&le===null){const de=new _l.Map(Ft,Se);V!=null&&yt!=null?de.setView(V,yt):vt!=null&&de.fitBounds(vt,pt),Ot!=null&&de.whenReady(Ot),ce(Mp(de))}},[]);Fe.useEffect(()=>()=>{le==null||le.map.remove()},[le]);const Nt=le?Uc.createElement(Du,{value:le},it):bt??null;return Uc.createElement("div",Zc({},Ht,{ref:Gt}),Nt)}const qp=Fe.forwardRef(Zp),Oc=Op(function({position:pt,...V},it){const J=new _l.Marker(pt,V);return Zl(J,Lu(it,{overlayContainer:J}))},function(pt,V,it){V.position!==it.position&&pt.setLatLng(V.position),V.icon!=null&&V.icon!==it.icon&&pt.setIcon(V.icon),V.zIndexOffset!=null&&V.zIndexOffset!==it.zIndexOffset&&pt.setZIndexOffset(V.zIndexOffset),V.opacity!=null&&V.opacity!==it.opacity&&pt.setOpacity(V.opacity),pt.dragging!=null&&V.draggable!==it.draggable&&(V.draggable===!0?pt.dragging.enable():pt.dragging.disable())}),Fc=Fp(function(pt,V){const it=new _l.Popup(pt,V.overlayContainer);return Zl(it,V)},function(pt,V,{position:it},J){Fe.useEffect(function(){const{instance:bt}=pt;function d(yt){yt.popup===bt&&(bt.update(),J(!0))}function Ot(yt){yt.popup===bt&&J(!1)}return V.map.on({popupopen:d,popupclose:Ot}),V.overlayContainer==null?(it!=null&&bt.setLatLng(it),bt.openOn(V.map)):V.overlayContainer.bindPopup(bt),function(){var Se;V.map.off({popupopen:d,popupclose:Ot}),(Se=V.overlayContainer)==null||Se.unbindPopup(),V.map.removeLayer(bt)}},[pt,V,J,it])}),jp=Up(function({url:pt,...V},it){const J=new _l.TileLayer(pt,Vl(V,it));return Zl(J,it)},function(pt,V,it){Vp(pt,V,it);const{url:J}=V;J!=null&&J!==it.url&&pt.setUrl(J)});const $p=()=>jt(Ga,{children:jt("div",{className:"container-fluid",children:jt("div",{className:"navbar",children:Si("div",{className:"nav-item",children:[jt("img",{className:"img-logo",src:"/img/logo.png",alt:""}),Si("div",{className:"nav-brand",children:[jt("h1",{children:"Sistem Pemantauan Banjir"}),jt("p",{children:"Kota Putusibau Kab. Kapuas Hulu"})]})]})})})}),Gp=$p,Hp=({layer:vt,handle:pt,area:V,marker:it})=>{const[J,wt]=Fe.useState(vt[0].name),[bt,d]=Fe.useState(!0),[Ot,yt]=Fe.useState(!1),Se=ce=>{wt(ce),pt(ce)},At=()=>{Ot==!0?yt(!1):yt(!0)},Ht=()=>{bt==!0?d(!1):d(!0)};V(Ot),it(bt);const le=[{value:"0 - 10 cm"},{value:"11 - 20 cm"},{value:"> 20 cm"}];return jt(Ga,{children:jt("div",{className:"cardMapLayer",children:Si("div",{className:"card-item",children:[jt("h2",{children:"Layer Peta"}),jt("ul",{children:vt.map((ce,Gt)=>Si("div",{className:"layerRadio",children:[jt("input",{type:"checkbox",className:"checkbox accent-black mt-2",checked:J==ce.name,onChange:()=>Se(ce.name)}),jt("li",{className:"mt-2",children:ce.name},ce.name)]},Gt))}),jt("hr",{className:"mt-3 mb-3"}),jt("h2",{children:"Shape"}),Si("ul",{className:"",children:[Si("div",{className:"layerRadio",children:[jt("input",{type:"checkbox",className:"checkbox accent-black mt-2",checked:bt==!0,onClick:()=>Ht()}),jt("li",{className:"mt-2",children:"Titik"})]}),Si("div",{className:"layerRadio",children:[jt("input",{type:"checkbox",className:"checkbox accent-black mt-2",checked:Ot==!0,onClick:()=>At()}),jt("li",{className:"mt-2",children:"Area"})]})]}),jt("hr",{className:"mt-3 mb-3"}),jt("h2",{children:"Legenda"}),Si("ul",{className:"",children:[Si("div",{className:"flex mt-2 gap-2",children:[jt("div",{className:"cr-green"}),jt("p",{children:le[0].value})]}),Si("div",{className:"flex mt-2 gap-2",children:[jt("div",{className:"cr-yellow"}),Si("p",{children:[le[1].value," "]})]}),Si("div",{className:"flex mt-2 gap-2",children:[jt("div",{className:"cr-red"}),jt("p",{children:le[2].value})]})]})]})})})},Wp=Hp;const Xp=({value:vt})=>Si("div",{className:"card-popUp",children:[vt<=10&&jt("div",{className:"siaga-rendah",children:"Rendah"}),vt>10&&vt<=20&&jt("div",{className:"siaga-sedang",children:"Sedang"}),vt>20&&jt("div",{className:"siaga-tinggi",children:"Tinggi"}),jt("div",{className:"value",children:vt})]}),Nc=Xp,Kp=({sidebar:vt,handle:pt,socket:V,api:it})=>{const[J,wt]=Fe.useState([]),[bt,d]=Fe.useState([]),Ot=()=>{pt(!1),J(),bt()},yt=async()=>{const Ht=await Cu.get(`https://flood-alert-me.com/mindata/${it}`);wt(Ht.data.sensor)},Se=async()=>{const Ht=await Cu.get(`https://flood-alert-me.com/alldata/${it}`);d(Ht.data.sensor)},At=()=>{Se(),window.my_modal_5.showModal()};return Fe.useEffect(()=>{yt()}),jt(Ga,{children:jt("div",{className:"card-side",children:Si("div",{className:vt==!0?"card-item-on":"card-item-off",children:[Si("div",{className:"card-head",children:["Keterangan",jt("button",{className:"btn btn-ghost btn-sm",onClick:()=>Ot(),children:jt("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:jt("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),Si("div",{className:"card-value",children:[jt("div",{className:"value",children:V}),jt("div",{className:"besaran",children:"cm"})]}),Si("div",{className:"card-siaga",children:[jt("p",{children:"Kondisi : "}),V<=10&&jt("div",{className:"cr-green",children:jt("p",{children:"Rendah"})}),V>10&&V<=20&&jt("div",{className:"cr-yellow",children:jt("p",{children:"Sedang"})}),V>20&&jt("div",{className:"cr-red",children:jt("p",{children:"Tinggi"})})]}),Si("div",{className:"card-history",children:[jt("div",{className:"head",children:"Histori"}),jt("div",{className:"body",children:jt("div",{className:"overflow-x-auto",children:Si("table",{className:"table table-sm",children:[jt("thead",{children:Si("tr",{className:`text-center\r
                                        `,children:[jt("th",{}),jt("th",{children:"Tinggi"}),jt("th",{children:"Tanggal"}),jt("th",{children:"Waktu"})]})}),jt("tbody",{children:J&&J.map((Ht,le)=>{const ce=new Date(Ht.created_at),Gt=ce.getDate(),Nt=ce.getMonth()+1,Ft=ce.getFullYear(),de=ce.getHours(),be=ce.getMinutes(),ci=`${de}:${be}`;return Si("tr",{className:"text-xs text-center",children:[jt("th",{children:le+1}),jt("td",{children:jt("div",{className:"w-20",children:`${Ht.value} cm`})}),jt("td",{children:jt("div",{className:"w-32",children:`${Gt} - ${Nt} - ${Ft}`})}),jt("td",{children:ci})]},le)})})]})})}),jt("button",{className:"footer",onClick:At,children:jt("small",{children:"Lihat semua data"})}),jt("dialog",{id:"my_modal_5",className:"modal",children:Si("div",{className:"modal-box w-11/12 max-w-5xl",children:[Si("div",{className:"flex justify-between items-center p-3",children:[jt("h3",{className:"font-bold text-lg",children:it}),jt("form",{method:"dialog",children:jt("button",{className:"btn btn-ghost btn-sm",children:jt("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:jt("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})})]}),bt?jt("div",{className:"overflow-y-scroll",children:jt("div",{className:"overflow-x-auto",children:Si("table",{className:"table table-sm",children:[jt("thead",{children:Si("tr",{className:`text-center\r
                                        `,children:[jt("th",{children:"No"}),jt("th",{children:"Tinggi"}),jt("th",{children:"Tanggal"}),jt("th",{children:"Waktu"})]})}),jt("tbody",{children:bt&&bt.map((Ht,le)=>{const ce=new Date(Ht.created_at),Gt=ce.getDate(),Nt=ce.getMonth()+1,Ft=ce.getFullYear(),de=ce.getHours(),be=ce.getMinutes(),ci=`${de}:${be}`;return Si("tr",{className:"text-xs text-center",children:[jt("th",{children:le+1}),jt("td",{children:`${Ht.value} cm`}),jt("td",{children:`${Gt} - ${Nt} - ${Ft}`}),jt("td",{children:ci})]},le)})})]})})}):jt("div",{className:"p-5",children:jt("span",{className:"loading loading-spinner loading-lg"})})]})})]})]})})})},Jp=Kp;function qc(vt){"@babel/helpers - typeof";return qc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(pt){return typeof pt}:function(pt){return pt&&typeof Symbol=="function"&&pt.constructor===Symbol&&pt!==Symbol.prototype?"symbol":typeof pt},qc(vt)}function or(vt,pt){if(!(vt instanceof pt))throw new TypeError("Cannot call a class as a function")}function Iu(vt,pt){for(var V=0;V<pt.length;V++){var it=pt[V];it.enumerable=it.enumerable||!1,it.configurable=!0,"value"in it&&(it.writable=!0),Object.defineProperty(vt,it.key,it)}}function ar(vt,pt,V){return pt&&Iu(vt.prototype,pt),V&&Iu(vt,V),Object.defineProperty(vt,"prototype",{writable:!1}),vt}function jc(){return jc=Object.assign||function(vt){for(var pt=1;pt<arguments.length;pt++){var V=arguments[pt];for(var it in V)Object.prototype.hasOwnProperty.call(V,it)&&(vt[it]=V[it])}return vt},jc.apply(this,arguments)}function ps(vt,pt){if(typeof pt!="function"&&pt!==null)throw new TypeError("Super expression must either be null or a function");vt.prototype=Object.create(pt&&pt.prototype,{constructor:{value:vt,writable:!0,configurable:!0}}),Object.defineProperty(vt,"prototype",{writable:!1}),pt&&$c(vt,pt)}function Nl(vt){return Nl=Object.setPrototypeOf?Object.getPrototypeOf:function(V){return V.__proto__||Object.getPrototypeOf(V)},Nl(vt)}function $c(vt,pt){return $c=Object.setPrototypeOf||function(it,J){return it.__proto__=J,it},$c(vt,pt)}function Yp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Qp(vt){if(vt===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return vt}function tf(vt,pt){if(pt&&(typeof pt=="object"||typeof pt=="function"))return pt;if(pt!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qp(vt)}function fs(vt){var pt=Yp();return function(){var it=Nl(vt),J;if(pt){var wt=Nl(this).constructor;J=Reflect.construct(it,arguments,wt)}else J=it.apply(this,arguments);return tf(this,J)}}var Wc=function(){function vt(){or(this,vt)}return ar(vt,[{key:"listenForWhisper",value:function(V,it){return this.listen(".client-"+V,it)}},{key:"notification",value:function(V){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",V)}},{key:"stopListeningForWhisper",value:function(V,it){return this.stopListening(".client-"+V,it)}}]),vt}(),Fu=function(){function vt(pt){or(this,vt),this.namespace=pt}return ar(vt,[{key:"format",value:function(V){return V.charAt(0)==="."||V.charAt(0)==="\\"?V.substr(1):(this.namespace&&(V=this.namespace+"."+V),V.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(V){this.namespace=V}}]),vt}(),jl=function(vt){ps(V,vt);var pt=fs(V);function V(it,J,wt){var bt;return or(this,V),bt=pt.call(this),bt.name=J,bt.pusher=it,bt.options=wt,bt.eventFormatter=new Fu(bt.options.namespace),bt.subscribe(),bt}return ar(V,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(J,wt){return this.on(this.eventFormatter.format(J),wt),this}},{key:"listenToAll",value:function(J){var wt=this;return this.subscription.bind_global(function(bt,d){if(!bt.startsWith("pusher:")){var Ot=wt.options.namespace.replace(/\./g,"\\"),yt=bt.startsWith(Ot)?bt.substring(Ot.length+1):"."+bt;J(yt,d)}}),this}},{key:"stopListening",value:function(J,wt){return wt?this.subscription.unbind(this.eventFormatter.format(J),wt):this.subscription.unbind(this.eventFormatter.format(J)),this}},{key:"stopListeningToAll",value:function(J){return J?this.subscription.unbind_global(J):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(J){return this.on("pusher:subscription_succeeded",function(){J()}),this}},{key:"error",value:function(J){return this.on("pusher:subscription_error",function(wt){J(wt)}),this}},{key:"on",value:function(J,wt){return this.subscription.bind(J,wt),this}}]),V}(Wc),ef=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"whisper",value:function(J,wt){return this.pusher.channels.channels[this.name].trigger("client-".concat(J),wt),this}}]),V}(jl),nf=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"whisper",value:function(J,wt){return this.pusher.channels.channels[this.name].trigger("client-".concat(J),wt),this}}]),V}(jl),rf=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"here",value:function(J){return this.on("pusher:subscription_succeeded",function(wt){J(Object.keys(wt.members).map(function(bt){return wt.members[bt]}))}),this}},{key:"joining",value:function(J){return this.on("pusher:member_added",function(wt){J(wt.info)}),this}},{key:"whisper",value:function(J,wt){return this.pusher.channels.channels[this.name].trigger("client-".concat(J),wt),this}},{key:"leaving",value:function(J){return this.on("pusher:member_removed",function(wt){J(wt.info)}),this}}]),V}(jl),Nu=function(vt){ps(V,vt);var pt=fs(V);function V(it,J,wt){var bt;return or(this,V),bt=pt.call(this),bt.events={},bt.listeners={},bt.name=J,bt.socket=it,bt.options=wt,bt.eventFormatter=new Fu(bt.options.namespace),bt.subscribe(),bt}return ar(V,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(J,wt){return this.on(this.eventFormatter.format(J),wt),this}},{key:"stopListening",value:function(J,wt){return this.unbindEvent(this.eventFormatter.format(J),wt),this}},{key:"subscribed",value:function(J){return this.on("connect",function(wt){J(wt)}),this}},{key:"error",value:function(J){return this}},{key:"on",value:function(J,wt){var bt=this;return this.listeners[J]=this.listeners[J]||[],this.events[J]||(this.events[J]=function(d,Ot){bt.name===d&&bt.listeners[J]&&bt.listeners[J].forEach(function(yt){return yt(Ot)})},this.socket.on(J,this.events[J])),this.listeners[J].push(wt),this}},{key:"unbind",value:function(){var J=this;Object.keys(this.events).forEach(function(wt){J.unbindEvent(wt)})}},{key:"unbindEvent",value:function(J,wt){this.listeners[J]=this.listeners[J]||[],wt&&(this.listeners[J]=this.listeners[J].filter(function(bt){return bt!==wt})),(!wt||this.listeners[J].length===0)&&(this.events[J]&&(this.socket.removeListener(J,this.events[J]),delete this.events[J]),delete this.listeners[J])}}]),V}(Wc),Uu=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"whisper",value:function(J,wt){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(J),data:wt}),this}}]),V}(Nu),sf=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"here",value:function(J){return this.on("presence:subscribed",function(wt){J(wt.map(function(bt){return bt.user_info}))}),this}},{key:"joining",value:function(J){return this.on("presence:joining",function(wt){return J(wt.user_info)}),this}},{key:"whisper",value:function(J,wt){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(J),data:wt}),this}},{key:"leaving",value:function(J){return this.on("presence:leaving",function(wt){return J(wt.user_info)}),this}}]),V}(Uu),Ul=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(J,wt){return this}},{key:"listenToAll",value:function(J){return this}},{key:"stopListening",value:function(J,wt){return this}},{key:"subscribed",value:function(J){return this}},{key:"error",value:function(J){return this}},{key:"on",value:function(J,wt){return this}}]),V}(Wc),ku=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"whisper",value:function(J,wt){return this}}]),V}(Ul),of=function(vt){ps(V,vt);var pt=fs(V);function V(){return or(this,V),pt.apply(this,arguments)}return ar(V,[{key:"here",value:function(J){return this}},{key:"joining",value:function(J){return this}},{key:"whisper",value:function(J,wt){return this}},{key:"leaving",value:function(J){return this}}]),V}(Ul),Xc=function(){function vt(pt){or(this,vt),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(pt),this.connect()}return ar(vt,[{key:"setOptions",value:function(V){this.options=jc(this._defaultOptions,V);var it=this.csrfToken();return it&&(this.options.auth.headers["X-CSRF-TOKEN"]=it,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=it),it=this.options.bearerToken,it&&(this.options.auth.headers.Authorization="Bearer "+it,this.options.userAuthentication.headers.Authorization="Bearer "+it),V}},{key:"csrfToken",value:function(){var V;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(V=document.querySelector('meta[name="csrf-token"]'))?V.getAttribute("content"):null}}]),vt}(),af=function(vt){ps(V,vt);var pt=fs(V);function V(){var it;return or(this,V),it=pt.apply(this,arguments),it.channels={},it}return ar(V,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(J,wt,bt){return this.channel(J).listen(wt,bt)}},{key:"channel",value:function(J){return this.channels[J]||(this.channels[J]=new jl(this.pusher,J,this.options)),this.channels[J]}},{key:"privateChannel",value:function(J){return this.channels["private-"+J]||(this.channels["private-"+J]=new ef(this.pusher,"private-"+J,this.options)),this.channels["private-"+J]}},{key:"encryptedPrivateChannel",value:function(J){return this.channels["private-encrypted-"+J]||(this.channels["private-encrypted-"+J]=new nf(this.pusher,"private-encrypted-"+J,this.options)),this.channels["private-encrypted-"+J]}},{key:"presenceChannel",value:function(J){return this.channels["presence-"+J]||(this.channels["presence-"+J]=new rf(this.pusher,"presence-"+J,this.options)),this.channels["presence-"+J]}},{key:"leave",value:function(J){var wt=this,bt=[J,"private-"+J,"private-encrypted-"+J,"presence-"+J];bt.forEach(function(d,Ot){wt.leaveChannel(d)})}},{key:"leaveChannel",value:function(J){this.channels[J]&&(this.channels[J].unsubscribe(),delete this.channels[J])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),V}(Xc),lf=function(vt){ps(V,vt);var pt=fs(V);function V(){var it;return or(this,V),it=pt.apply(this,arguments),it.channels={},it}return ar(V,[{key:"connect",value:function(){var J=this,wt=this.getSocketIO();return this.socket=wt(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(J.channels).forEach(function(bt){bt.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(J,wt,bt){return this.channel(J).listen(wt,bt)}},{key:"channel",value:function(J){return this.channels[J]||(this.channels[J]=new Nu(this.socket,J,this.options)),this.channels[J]}},{key:"privateChannel",value:function(J){return this.channels["private-"+J]||(this.channels["private-"+J]=new Uu(this.socket,"private-"+J,this.options)),this.channels["private-"+J]}},{key:"presenceChannel",value:function(J){return this.channels["presence-"+J]||(this.channels["presence-"+J]=new sf(this.socket,"presence-"+J,this.options)),this.channels["presence-"+J]}},{key:"leave",value:function(J){var wt=this,bt=[J,"private-"+J,"presence-"+J];bt.forEach(function(d){wt.leaveChannel(d)})}},{key:"leaveChannel",value:function(J){this.channels[J]&&(this.channels[J].unsubscribe(),delete this.channels[J])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),V}(Xc),cf=function(vt){ps(V,vt);var pt=fs(V);function V(){var it;return or(this,V),it=pt.apply(this,arguments),it.channels={},it}return ar(V,[{key:"connect",value:function(){}},{key:"listen",value:function(J,wt,bt){return new Ul}},{key:"channel",value:function(J){return new Ul}},{key:"privateChannel",value:function(J){return new ku}},{key:"encryptedPrivateChannel",value:function(J){return new ku}},{key:"presenceChannel",value:function(J){return new of}},{key:"leave",value:function(J){}},{key:"leaveChannel",value:function(J){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),V}(Xc),hf=function(){function vt(pt){or(this,vt),this.options=pt,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return ar(vt,[{key:"channel",value:function(V){return this.connector.channel(V)}},{key:"connect",value:function(){this.options.broadcaster=="pusher"?this.connector=new af(this.options):this.options.broadcaster=="socket.io"?this.connector=new lf(this.options):this.options.broadcaster=="null"?this.connector=new cf(this.options):typeof this.options.broadcaster=="function"&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(V){return this.connector.presenceChannel(V)}},{key:"leave",value:function(V){this.connector.leave(V)}},{key:"leaveChannel",value:function(V){this.connector.leaveChannel(V)}},{key:"leaveAllChannels",value:function(){for(var V in this.connector.channels)this.leaveChannel(V)}},{key:"listen",value:function(V,it,J){return this.connector.listen(V,it,J)}},{key:"private",value:function(V){return this.connector.privateChannel(V)}},{key:"encryptedPrivate",value:function(V){return this.connector.encryptedPrivateChannel(V)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":qc(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var V=this;Vue.http.interceptors.push(function(it,J){V.socketId()&&it.headers.set("X-Socket-ID",V.socketId()),J()})}},{key:"registerAxiosRequestInterceptor",value:function(){var V=this;axios.interceptors.request.use(function(it){return V.socketId()&&(it.headers["X-Socket-Id"]=V.socketId()),it})}},{key:"registerjQueryAjaxSetup",value:function(){var V=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(it,J,wt){V.socketId()&&wt.setRequestHeader("X-Socket-Id",V.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var V=this;document.addEventListener("turbo:before-fetch-request",function(it){it.detail.fetchOptions.headers["X-Socket-Id"]=V.socketId()})}}]),vt}(),Vu={exports:{}};/*!
 * Pusher JavaScript Library v8.3.0
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */(function(vt,pt){(function(it,J){vt.exports=J()})(window,function(){return function(V){var it={};function J(wt){if(it[wt])return it[wt].exports;var bt=it[wt]={i:wt,l:!1,exports:{}};return V[wt].call(bt.exports,bt,bt.exports,J),bt.l=!0,bt.exports}return J.m=V,J.c=it,J.d=function(wt,bt,d){J.o(wt,bt)||Object.defineProperty(wt,bt,{enumerable:!0,get:d})},J.r=function(wt){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(wt,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(wt,"__esModule",{value:!0})},J.t=function(wt,bt){if(bt&1&&(wt=J(wt)),bt&8||bt&4&&typeof wt=="object"&&wt&&wt.__esModule)return wt;var d=Object.create(null);if(J.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:wt}),bt&2&&typeof wt!="string")for(var Ot in wt)J.d(d,Ot,function(yt){return wt[yt]}.bind(null,Ot));return d},J.n=function(wt){var bt=wt&&wt.__esModule?function(){return wt.default}:function(){return wt};return J.d(bt,"a",bt),bt},J.o=function(wt,bt){return Object.prototype.hasOwnProperty.call(wt,bt)},J.p="",J(J.s=2)}([function(V,it,J){var wt=this&&this.__extends||function(){var Gt=function(Nt,Ft){return Gt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(de,be){de.__proto__=be}||function(de,be){for(var ci in be)be.hasOwnProperty(ci)&&(de[ci]=be[ci])},Gt(Nt,Ft)};return function(Nt,Ft){Gt(Nt,Ft);function de(){this.constructor=Nt}Nt.prototype=Ft===null?Object.create(Ft):(de.prototype=Ft.prototype,new de)}}();Object.defineProperty(it,"__esModule",{value:!0});var bt=256,d=function(){function Gt(Nt){Nt===void 0&&(Nt="="),this._paddingCharacter=Nt}return Gt.prototype.encodedLength=function(Nt){return this._paddingCharacter?(Nt+2)/3*4|0:(Nt*8+5)/6|0},Gt.prototype.encode=function(Nt){for(var Ft="",de=0;de<Nt.length-2;de+=3){var be=Nt[de]<<16|Nt[de+1]<<8|Nt[de+2];Ft+=this._encodeByte(be>>>3*6&63),Ft+=this._encodeByte(be>>>2*6&63),Ft+=this._encodeByte(be>>>1*6&63),Ft+=this._encodeByte(be>>>0*6&63)}var ci=Nt.length-de;if(ci>0){var be=Nt[de]<<16|(ci===2?Nt[de+1]<<8:0);Ft+=this._encodeByte(be>>>3*6&63),Ft+=this._encodeByte(be>>>2*6&63),ci===2?Ft+=this._encodeByte(be>>>1*6&63):Ft+=this._paddingCharacter||"",Ft+=this._paddingCharacter||""}return Ft},Gt.prototype.maxDecodedLength=function(Nt){return this._paddingCharacter?Nt/4*3|0:(Nt*6+7)/8|0},Gt.prototype.decodedLength=function(Nt){return this.maxDecodedLength(Nt.length-this._getPaddingLength(Nt))},Gt.prototype.decode=function(Nt){if(Nt.length===0)return new Uint8Array(0);for(var Ft=this._getPaddingLength(Nt),de=Nt.length-Ft,be=new Uint8Array(this.maxDecodedLength(de)),ci=0,yi=0,Ci=0,Yi=0,hi=0,Ui=0,gi=0;yi<de-4;yi+=4)Yi=this._decodeChar(Nt.charCodeAt(yi+0)),hi=this._decodeChar(Nt.charCodeAt(yi+1)),Ui=this._decodeChar(Nt.charCodeAt(yi+2)),gi=this._decodeChar(Nt.charCodeAt(yi+3)),be[ci++]=Yi<<2|hi>>>4,be[ci++]=hi<<4|Ui>>>2,be[ci++]=Ui<<6|gi,Ci|=Yi&bt,Ci|=hi&bt,Ci|=Ui&bt,Ci|=gi&bt;if(yi<de-1&&(Yi=this._decodeChar(Nt.charCodeAt(yi)),hi=this._decodeChar(Nt.charCodeAt(yi+1)),be[ci++]=Yi<<2|hi>>>4,Ci|=Yi&bt,Ci|=hi&bt),yi<de-2&&(Ui=this._decodeChar(Nt.charCodeAt(yi+2)),be[ci++]=hi<<4|Ui>>>2,Ci|=Ui&bt),yi<de-3&&(gi=this._decodeChar(Nt.charCodeAt(yi+3)),be[ci++]=Ui<<6|gi,Ci|=gi&bt),Ci!==0)throw new Error("Base64Coder: incorrect characters for decoding");return be},Gt.prototype._encodeByte=function(Nt){var Ft=Nt;return Ft+=65,Ft+=25-Nt>>>8&0-65-26+97,Ft+=51-Nt>>>8&26-97-52+48,Ft+=61-Nt>>>8&52-48-62+43,Ft+=62-Nt>>>8&62-43-63+47,String.fromCharCode(Ft)},Gt.prototype._decodeChar=function(Nt){var Ft=bt;return Ft+=(42-Nt&Nt-44)>>>8&-bt+Nt-43+62,Ft+=(46-Nt&Nt-48)>>>8&-bt+Nt-47+63,Ft+=(47-Nt&Nt-58)>>>8&-bt+Nt-48+52,Ft+=(64-Nt&Nt-91)>>>8&-bt+Nt-65+0,Ft+=(96-Nt&Nt-123)>>>8&-bt+Nt-97+26,Ft},Gt.prototype._getPaddingLength=function(Nt){var Ft=0;if(this._paddingCharacter){for(var de=Nt.length-1;de>=0&&Nt[de]===this._paddingCharacter;de--)Ft++;if(Nt.length<4||Ft>2)throw new Error("Base64Coder: incorrect padding")}return Ft},Gt}();it.Coder=d;var Ot=new d;function yt(Gt){return Ot.encode(Gt)}it.encode=yt;function Se(Gt){return Ot.decode(Gt)}it.decode=Se;var At=function(Gt){wt(Nt,Gt);function Nt(){return Gt!==null&&Gt.apply(this,arguments)||this}return Nt.prototype._encodeByte=function(Ft){var de=Ft;return de+=65,de+=25-Ft>>>8&0-65-26+97,de+=51-Ft>>>8&26-97-52+48,de+=61-Ft>>>8&52-48-62+45,de+=62-Ft>>>8&62-45-63+95,String.fromCharCode(de)},Nt.prototype._decodeChar=function(Ft){var de=bt;return de+=(44-Ft&Ft-46)>>>8&-bt+Ft-45+62,de+=(94-Ft&Ft-96)>>>8&-bt+Ft-95+63,de+=(47-Ft&Ft-58)>>>8&-bt+Ft-48+52,de+=(64-Ft&Ft-91)>>>8&-bt+Ft-65+0,de+=(96-Ft&Ft-123)>>>8&-bt+Ft-97+26,de},Nt}(d);it.URLSafeCoder=At;var Ht=new At;function le(Gt){return Ht.encode(Gt)}it.encodeURLSafe=le;function ce(Gt){return Ht.decode(Gt)}it.decodeURLSafe=ce,it.encodedLength=function(Gt){return Ot.encodedLength(Gt)},it.maxDecodedLength=function(Gt){return Ot.maxDecodedLength(Gt)},it.decodedLength=function(Gt){return Ot.decodedLength(Gt)}},function(V,it,J){Object.defineProperty(it,"__esModule",{value:!0});var wt="utf8: invalid string",bt="utf8: invalid source encoding";function d(Se){for(var At=new Uint8Array(Ot(Se)),Ht=0,le=0;le<Se.length;le++){var ce=Se.charCodeAt(le);ce<128?At[Ht++]=ce:ce<2048?(At[Ht++]=192|ce>>6,At[Ht++]=128|ce&63):ce<55296?(At[Ht++]=224|ce>>12,At[Ht++]=128|ce>>6&63,At[Ht++]=128|ce&63):(le++,ce=(ce&1023)<<10,ce|=Se.charCodeAt(le)&1023,ce+=65536,At[Ht++]=240|ce>>18,At[Ht++]=128|ce>>12&63,At[Ht++]=128|ce>>6&63,At[Ht++]=128|ce&63)}return At}it.encode=d;function Ot(Se){for(var At=0,Ht=0;Ht<Se.length;Ht++){var le=Se.charCodeAt(Ht);if(le<128)At+=1;else if(le<2048)At+=2;else if(le<55296)At+=3;else if(le<=57343){if(Ht>=Se.length-1)throw new Error(wt);Ht++,At+=4}else throw new Error(wt)}return At}it.encodedLength=Ot;function yt(Se){for(var At=[],Ht=0;Ht<Se.length;Ht++){var le=Se[Ht];if(le&128){var ce=void 0;if(le<224){if(Ht>=Se.length)throw new Error(bt);var Gt=Se[++Ht];if((Gt&192)!==128)throw new Error(bt);le=(le&31)<<6|Gt&63,ce=128}else if(le<240){if(Ht>=Se.length-1)throw new Error(bt);var Gt=Se[++Ht],Nt=Se[++Ht];if((Gt&192)!==128||(Nt&192)!==128)throw new Error(bt);le=(le&15)<<12|(Gt&63)<<6|Nt&63,ce=2048}else if(le<248){if(Ht>=Se.length-2)throw new Error(bt);var Gt=Se[++Ht],Nt=Se[++Ht],Ft=Se[++Ht];if((Gt&192)!==128||(Nt&192)!==128||(Ft&192)!==128)throw new Error(bt);le=(le&15)<<18|(Gt&63)<<12|(Nt&63)<<6|Ft&63,ce=65536}else throw new Error(bt);if(le<ce||le>=55296&&le<=57343)throw new Error(bt);if(le>=65536){if(le>1114111)throw new Error(bt);le-=65536,At.push(String.fromCharCode(55296|le>>10)),le=56320|le&1023}}At.push(String.fromCharCode(le))}return At.join("")}it.decode=yt},function(V,it,J){V.exports=J(3).default},function(V,it,J){J.r(it);class wt{constructor(w,I){this.lastId=0,this.prefix=w,this.name=I}create(w){this.lastId++;var I=this.lastId,q=this.prefix+I,et=this.name+"["+I+"]",Et=!1,Lt=function(){Et||(w.apply(null,arguments),Et=!0)};return this[I]=Lt,{number:I,id:q,name:et,callback:Lt}}remove(w){delete this[w.number]}}var bt=new wt("_pusher_script_","Pusher.ScriptReceivers"),d={VERSION:"8.3.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},Ot=d;class yt{constructor(w){this.options=w,this.receivers=w.receivers||bt,this.loading={}}load(w,I,q){var et=this;if(et.loading[w]&&et.loading[w].length>0)et.loading[w].push(q);else{et.loading[w]=[q];var Et=Ee.createScriptRequest(et.getPath(w,I)),Lt=et.receivers.create(function(he){if(et.receivers.remove(Lt),et.loading[w]){var qt=et.loading[w];delete et.loading[w];for(var Ge=function(ze){ze||Et.cleanup()},xe=0;xe<qt.length;xe++)qt[xe](he,Ge)}});Et.send(Lt)}}getRoot(w){var I,q=Ee.getDocument().location.protocol;return w&&w.useTLS||q==="https:"?I=this.options.cdn_https:I=this.options.cdn_http,I.replace(/\/*$/,"")+"/"+this.options.version}getPath(w,I){return this.getRoot(I)+"/"+w+this.options.suffix+".js"}}var Se=new wt("_pusher_dependencies","Pusher.DependenciesReceivers"),At=new yt({cdn_http:Ot.cdn_http,cdn_https:Ot.cdn_https,version:Ot.VERSION,suffix:Ot.dependency_suffix,receivers:Se});const Ht={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var ce={buildLogSuffix:function(M){const w="See:",I=Ht.urls[M];if(!I)return"";let q;return I.fullUrl?q=I.fullUrl:I.path&&(q=Ht.baseUrl+I.path),q?`${w} ${q}`:""}},Gt;(function(M){M.UserAuthentication="user-authentication",M.ChannelAuthorization="channel-authorization"})(Gt||(Gt={}));class Nt extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class Ft extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class de extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class be extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class ci extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class yi extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class Ci extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class Yi extends Error{constructor(w){super(w),Object.setPrototypeOf(this,new.target.prototype)}}class hi extends Error{constructor(w,I){super(I),this.status=w,Object.setPrototypeOf(this,new.target.prototype)}}var gi=function(M,w,I,q,et){const Et=Ee.createXHR();Et.open("POST",I.endpoint,!0),Et.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var Lt in I.headers)Et.setRequestHeader(Lt,I.headers[Lt]);if(I.headersProvider!=null){let he=I.headersProvider();for(var Lt in he)Et.setRequestHeader(Lt,he[Lt])}return Et.onreadystatechange=function(){if(Et.readyState===4)if(Et.status===200){let he,qt=!1;try{he=JSON.parse(Et.responseText),qt=!0}catch{et(new hi(200,`JSON returned from ${q.toString()} endpoint was invalid, yet status code was 200. Data was: ${Et.responseText}`),null)}qt&&et(null,he)}else{let he="";switch(q){case Gt.UserAuthentication:he=ce.buildLogSuffix("authenticationEndpoint");break;case Gt.ChannelAuthorization:he=`Clients must be authorized to join private or presence channels. ${ce.buildLogSuffix("authorizationEndpoint")}`;break}et(new hi(Et.status,`Unable to retrieve auth string from ${q.toString()} endpoint - received status: ${Et.status} from ${I.endpoint}. ${he}`),null)}},Et.send(w),Et};function we(M){return xi(lr(M))}var Ii=String.fromCharCode,Qi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vi=function(M){var w=M.charCodeAt(0);return w<128?M:w<2048?Ii(192|w>>>6)+Ii(128|w&63):Ii(224|w>>>12&15)+Ii(128|w>>>6&63)+Ii(128|w&63)},lr=function(M){return M.replace(/[^\x00-\x7F]/g,Vi)},Ye=function(M){var w=[0,2,1][M.length%3],I=M.charCodeAt(0)<<16|(M.length>1?M.charCodeAt(1):0)<<8|(M.length>2?M.charCodeAt(2):0),q=[Qi.charAt(I>>>18),Qi.charAt(I>>>12&63),w>=2?"=":Qi.charAt(I>>>6&63),w>=1?"=":Qi.charAt(I&63)];return q.join("")},xi=window.btoa||function(M){return M.replace(/[\s\S]{1,3}/g,Ye)};class Le{constructor(w,I,q,et){this.clear=I,this.timer=w(()=>{this.timer&&(this.timer=et(this.timer))},q)}isRunning(){return this.timer!==null}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}}var br=Le;function Ae(M){window.clearTimeout(M)}function fi(M){window.clearInterval(M)}class mi extends br{constructor(w,I){super(setTimeout,Ae,w,function(q){return I(),null})}}class ui extends br{constructor(w,I){super(setInterval,fi,w,function(q){return I(),q})}}var Qe={now(){return Date.now?Date.now():new Date().valueOf()},defer(M){return new mi(0,M)},method(M,...w){var I=Array.prototype.slice.call(arguments,1);return function(q){return q[M].apply(q,I.concat(arguments))}}},_e=Qe;function Pe(M,...w){for(var I=0;I<w.length;I++){var q=w[I];for(var et in q)q[et]&&q[et].constructor&&q[et].constructor===Object?M[et]=Pe(M[et]||{},q[et]):M[et]=q[et]}return M}function vn(){for(var M=["Pusher"],w=0;w<arguments.length;w++)typeof arguments[w]=="string"?M.push(arguments[w]):M.push(jn(arguments[w]));return M.join(" : ")}function un(M,w){var I=Array.prototype.indexOf;if(M===null)return-1;if(I&&M.indexOf===I)return M.indexOf(w);for(var q=0,et=M.length;q<et;q++)if(M[q]===w)return q;return-1}function tn(M,w){for(var I in M)Object.prototype.hasOwnProperty.call(M,I)&&w(M[I],I,M)}function Dn(M){var w=[];return tn(M,function(I,q){w.push(q)}),w}function qn(M){var w=[];return tn(M,function(I){w.push(I)}),w}function Bi(M,w,I){for(var q=0;q<M.length;q++)w.call(I||window,M[q],q,M)}function wr(M,w){for(var I=[],q=0;q<M.length;q++)I.push(w(M[q],q,M,I));return I}function Pt(M,w){var I={};return tn(M,function(q,et){I[et]=w(q)}),I}function cr(M,w){w=w||function(et){return!!et};for(var I=[],q=0;q<M.length;q++)w(M[q],q,M,I)&&I.push(M[q]);return I}function Wr(M,w){var I={};return tn(M,function(q,et){(w&&w(q,et,M,I)||q)&&(I[et]=q)}),I}function ii(M){var w=[];return tn(M,function(I,q){w.push([q,I])}),w}function Ve(M,w){for(var I=0;I<M.length;I++)if(w(M[I],I,M))return!0;return!1}function Xr(M,w){for(var I=0;I<M.length;I++)if(!w(M[I],I,M))return!1;return!0}function ms(M){return Pt(M,function(w){return typeof w=="object"&&(w=jn(w)),encodeURIComponent(we(w.toString()))})}function _s(M){var w=Wr(M,function(q){return q!==void 0}),I=wr(ii(ms(w)),_e.method("join","=")).join("&");return I}function Di(M){var w=[],I=[];return function q(et,Et){var Lt,he,qt;switch(typeof et){case"object":if(!et)return null;for(Lt=0;Lt<w.length;Lt+=1)if(w[Lt]===et)return{$ref:I[Lt]};if(w.push(et),I.push(Et),Object.prototype.toString.apply(et)==="[object Array]")for(qt=[],Lt=0;Lt<et.length;Lt+=1)qt[Lt]=q(et[Lt],Et+"["+Lt+"]");else{qt={};for(he in et)Object.prototype.hasOwnProperty.call(et,he)&&(qt[he]=q(et[he],Et+"["+JSON.stringify(he)+"]"))}return qt;case"number":case"string":case"boolean":return et}}(M,"$")}function jn(M){try{return JSON.stringify(M)}catch{return JSON.stringify(Di(M))}}class gs{constructor(){this.globalLog=w=>{window.console&&window.console.log&&window.console.log(w)}}debug(...w){this.log(this.globalLog,w)}warn(...w){this.log(this.globalLogWarn,w)}error(...w){this.log(this.globalLogError,w)}globalLogWarn(w){window.console&&window.console.warn?window.console.warn(w):this.globalLog(w)}globalLogError(w){window.console&&window.console.error?window.console.error(w):this.globalLogWarn(w)}log(w,...I){var q=vn.apply(this,arguments);po.log?po.log(q):po.logToConsole&&w.bind(this)(q)}}var oi=new gs,Vt=function(M,w,I,q,et){(I.headers!==void 0||I.headersProvider!=null)&&oi.warn(`To send headers with the ${q.toString()} request, you must use AJAX, rather than JSONP.`);var Et=M.nextAuthCallbackID.toString();M.nextAuthCallbackID++;var Lt=M.getDocument(),he=Lt.createElement("script");M.auth_callbacks[Et]=function(xe){et(null,xe)};var qt="Pusher.auth_callbacks['"+Et+"']";he.src=I.endpoint+"?callback="+encodeURIComponent(qt)+"&"+w;var Ge=Lt.getElementsByTagName("head")[0]||Lt.documentElement;Ge.insertBefore(he,Ge.firstChild)},$n=Vt;class en{constructor(w){this.src=w}send(w){var I=this,q="Error loading "+I.src;I.script=document.createElement("script"),I.script.id=w.id,I.script.src=I.src,I.script.type="text/javascript",I.script.charset="UTF-8",I.script.addEventListener?(I.script.onerror=function(){w.callback(q)},I.script.onload=function(){w.callback(null)}):I.script.onreadystatechange=function(){(I.script.readyState==="loaded"||I.script.readyState==="complete")&&w.callback(null)},I.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(I.errorScript=document.createElement("script"),I.errorScript.id=w.id+"_error",I.errorScript.text=w.name+"('"+q+"');",I.script.async=I.errorScript.async=!1):I.script.async=!0;var et=document.getElementsByTagName("head")[0];et.insertBefore(I.script,et.firstChild),I.errorScript&&et.insertBefore(I.errorScript,I.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class ys{constructor(w,I){this.url=w,this.data=I}send(w){if(!this.request){var I=_s(this.data),q=this.url+"/"+w.number+"?"+I;this.request=Ee.createScriptRequest(q),this.request.send(w)}}cleanup(){this.request&&this.request.cleanup()}}var Tr=function(M,w){return function(I,q){var et="http"+(w?"s":"")+"://",Et=et+(M.host||M.options.host)+M.options.path,Lt=Ee.createJSONPRequest(Et,I),he=Ee.ScriptReceivers.create(function(qt,Ge){bt.remove(he),Lt.cleanup(),Ge&&Ge.host&&(M.host=Ge.host),q&&q(qt,Ge)});Lt.send(he)}},Zt={name:"jsonp",getAgent:Tr},Be=Zt;function Ie(M,w,I){var q=M+(w.useTLS?"s":""),et=w.useTLS?w.hostTLS:w.hostNonTLS;return q+"://"+et+I}function ji(M,w){var I="/app/"+M,q="?protocol="+Ot.PROTOCOL+"&client=js&version="+Ot.VERSION+(w?"&"+w:"");return I+q}var Oi={getInitial:function(M,w){var I=(w.httpPath||"")+ji(M,"flash=false");return Ie("ws",w,I)}},Me={getInitial:function(M,w){var I=(w.httpPath||"/pusher")+ji(M);return Ie("http",w,I)}},En={getInitial:function(M,w){return Ie("http",w,w.httpPath||"/pusher")},getPath:function(M,w){return ji(M)}};class Sr{constructor(){this._callbacks={}}get(w){return this._callbacks[Cn(w)]}add(w,I,q){var et=Cn(w);this._callbacks[et]=this._callbacks[et]||[],this._callbacks[et].push({fn:I,context:q})}remove(w,I,q){if(!w&&!I&&!q){this._callbacks={};return}var et=w?[Cn(w)]:Dn(this._callbacks);I||q?this.removeCallback(et,I,q):this.removeAllCallbacks(et)}removeCallback(w,I,q){Bi(w,function(et){this._callbacks[et]=cr(this._callbacks[et]||[],function(Et){return I&&I!==Et.fn||q&&q!==Et.context}),this._callbacks[et].length===0&&delete this._callbacks[et]},this)}removeAllCallbacks(w){Bi(w,function(I){delete this._callbacks[I]},this)}}function Cn(M){return"_"+M}class $i{constructor(w){this.callbacks=new Sr,this.global_callbacks=[],this.failThrough=w}bind(w,I,q){return this.callbacks.add(w,I,q),this}bind_global(w){return this.global_callbacks.push(w),this}unbind(w,I,q){return this.callbacks.remove(w,I,q),this}unbind_global(w){return w?(this.global_callbacks=cr(this.global_callbacks||[],I=>I!==w),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(w,I,q){for(var et=0;et<this.global_callbacks.length;et++)this.global_callbacks[et](w,I);var Et=this.callbacks.get(w),Lt=[];if(q?Lt.push(I,q):I&&Lt.push(I),Et&&Et.length>0)for(var et=0;et<Et.length;et++)Et[et].fn.apply(Et[et].context||window,Lt);else this.failThrough&&this.failThrough(w,I);return this}}class Gi extends $i{constructor(w,I,q,et,Et){super(),this.initialize=Ee.transportConnectionInitializer,this.hooks=w,this.name=I,this.priority=q,this.key=et,this.options=Et,this.state="new",this.timeline=Et.timeline,this.activityTimeout=Et.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||this.state!=="initialized")return!1;var w=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(w,this.options)}catch(I){return _e.defer(()=>{this.onError(I),this.changeState("closed")}),!1}return this.bindListeners(),oi.debug("Connecting",{transport:this.name,url:w}),this.changeState("connecting"),!0}close(){return this.socket?(this.socket.close(),!0):!1}send(w){return this.state==="open"?(_e.defer(()=>{this.socket&&this.socket.send(w)}),!0):!1}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(w){this.emit("error",{type:"WebSocketError",error:w}),this.timeline.error(this.buildTimelineMessage({error:w.toString()}))}onClose(w){w?this.changeState("closed",{code:w.code,reason:w.reason,wasClean:w.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(w){this.emit("message",w)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=w=>{this.onError(w)},this.socket.onclose=w=>{this.onClose(w)},this.socket.onmessage=w=>{this.onMessage(w)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(w,I){this.state=w,this.timeline.info(this.buildTimelineMessage({state:w,params:I})),this.emit(w,I)}buildTimelineMessage(w){return Pe({cid:this.id},w)}}class Ke{constructor(w){this.hooks=w}isSupported(w){return this.hooks.isSupported(w)}createConnection(w,I,q,et){return new Gi(this.hooks,w,I,q,et)}}var Bs=new Ke({urls:Oi,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!Ee.getWebSocketAPI()},isSupported:function(){return!!Ee.getWebSocketAPI()},getSocket:function(M){return Ee.createWebSocket(M)}}),Gn={urls:Me,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},X=Pe({getSocket:function(M){return Ee.HTTPFactory.createStreamingSocket(M)}},Gn),D=Pe({getSocket:function(M){return Ee.HTTPFactory.createPollingSocket(M)}},Gn),B={isSupported:function(){return Ee.isXHRSupported()}},Z=new Ke(Pe({},X,B)),Q=new Ke(Pe({},D,B)),nt={ws:Bs,xhr_streaming:Z,xhr_polling:Q},ht=nt,st=new Ke({file:"sockjs",urls:En,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(M,w){return new window.SockJS(M,null,{js_path:At.getPath("sockjs",{useTLS:w.useTLS}),ignore_null_origin:w.ignoreNullOrigin})},beforeOpen:function(M,w){M.send(JSON.stringify({path:w}))}}),rt={isSupported:function(M){var w=Ee.isXDRSupported(M.useTLS);return w}},ut=new Ke(Pe({},X,rt)),ft=new Ke(Pe({},D,rt));ht.xdr_streaming=ut,ht.xdr_polling=ft,ht.sockjs=st;var kt=ht;class It extends $i{constructor(){super();var w=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){w.emit("online")},!1),window.addEventListener("offline",function(){w.emit("offline")},!1))}isOnline(){return window.navigator.onLine===void 0?!0:window.navigator.onLine}}var fe=new It;class ke{constructor(w,I,q){this.manager=w,this.transport=I,this.minPingDelay=q.minPingDelay,this.maxPingDelay=q.maxPingDelay,this.pingDelay=void 0}createConnection(w,I,q,et){et=Pe({},et,{activityTimeout:this.pingDelay});var Et=this.transport.createConnection(w,I,q,et),Lt=null,he=function(){Et.unbind("open",he),Et.bind("closed",qt),Lt=_e.now()},qt=Ge=>{if(Et.unbind("closed",qt),Ge.code===1002||Ge.code===1003)this.manager.reportDeath();else if(!Ge.wasClean&&Lt){var xe=_e.now()-Lt;xe<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(xe/2,this.minPingDelay))}};return Et.bind("open",he),Et}isSupported(w){return this.manager.isAlive()&&this.transport.isSupported(w)}}const ie={decodeMessage:function(M){try{var w=JSON.parse(M.data),I=w.data;if(typeof I=="string")try{I=JSON.parse(w.data)}catch{}var q={event:w.event,channel:w.channel,data:I};return w.user_id&&(q.user_id=w.user_id),q}catch(et){throw{type:"MessageParseError",error:et,data:M.data}}},encodeMessage:function(M){return JSON.stringify(M)},processHandshake:function(M){var w=ie.decodeMessage(M);if(w.event==="pusher:connection_established"){if(!w.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:w.data.socket_id,activityTimeout:w.data.activity_timeout*1e3}}else{if(w.event==="pusher:error")return{action:this.getCloseAction(w.data),error:this.getCloseError(w.data)};throw"Invalid handshake"}},getCloseAction:function(M){return M.code<4e3?M.code>=1002&&M.code<=1004?"backoff":null:M.code===4e3?"tls_only":M.code<4100?"refused":M.code<4200?"backoff":M.code<4300?"retry":"refused"},getCloseError:function(M){return M.code!==1e3&&M.code!==1001?{type:"PusherError",data:{code:M.code,message:M.reason||M.message}}:null}};var ae=ie;class ve extends $i{constructor(w,I){super(),this.id=w,this.transport=I,this.activityTimeout=I.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(w){return this.transport.send(w)}send_event(w,I,q){var et={event:w,data:I};return q&&(et.channel=q),oi.debug("Event sent",et),this.send(ae.encodeMessage(et))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var w={message:q=>{var et;try{et=ae.decodeMessage(q)}catch(Et){this.emit("error",{type:"MessageParseError",error:Et,data:q.data})}if(et!==void 0){switch(oi.debug("Event recd",et),et.event){case"pusher:error":this.emit("error",{type:"PusherError",data:et.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",et)}},activity:()=>{this.emit("activity")},error:q=>{this.emit("error",q)},closed:q=>{I(),q&&q.code&&this.handleCloseEvent(q),this.transport=null,this.emit("closed")}},I=()=>{tn(w,(q,et)=>{this.transport.unbind(et,q)})};tn(w,(q,et)=>{this.transport.bind(et,q)})}handleCloseEvent(w){var I=ae.getCloseAction(w),q=ae.getCloseError(w);q&&this.emit("error",q),I&&this.emit(I,{action:I,error:q})}}class Ze{constructor(w,I){this.transport=w,this.callback=I,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=w=>{this.unbindListeners();var I;try{I=ae.processHandshake(w)}catch(q){this.finish("error",{error:q}),this.transport.close();return}I.action==="connected"?this.finish("connected",{connection:new ve(I.id,this.transport),activityTimeout:I.activityTimeout}):(this.finish(I.action,{error:I.error}),this.transport.close())},this.onClosed=w=>{this.unbindListeners();var I=ae.getCloseAction(w)||"backoff",q=ae.getCloseError(w);this.finish(I,{error:q})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(w,I){this.callback(Pe({transport:this.transport,action:w},I))}}class Ne{constructor(w,I){this.timeline=w,this.options=I||{}}send(w,I){this.timeline.isEmpty()||this.timeline.send(Ee.TimelineTransport.getAgent(this,w),I)}}class $e extends $i{constructor(w,I){super(function(q,et){oi.debug("No callbacks on "+w+" for "+q)}),this.name=w,this.pusher=I,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(w,I){return I(null,{auth:""})}trigger(w,I){if(w.indexOf("client-")!==0)throw new Nt("Event '"+w+"' does not start with 'client-'");if(!this.subscribed){var q=ce.buildLogSuffix("triggeringClientEvents");oi.warn(`Client event triggered before channel 'subscription_succeeded' event . ${q}`)}return this.pusher.send_event(w,I,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(w){var I=w.event,q=w.data;if(I==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(w);else if(I==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(w);else if(I.indexOf("pusher_internal:")!==0){var et={};this.emit(I,q,et)}}handleSubscriptionSucceededEvent(w){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",w.data)}handleSubscriptionCountEvent(w){w.data.subscription_count&&(this.subscriptionCount=w.data.subscription_count),this.emit("pusher:subscription_count",w.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(w,I)=>{w?(this.subscriptionPending=!1,oi.error(w.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:w.message},w instanceof hi?{status:w.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:I.auth,channel_data:I.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class ni extends $e{authorize(w,I){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:w},I)}}class Fi{constructor(){this.reset()}get(w){return Object.prototype.hasOwnProperty.call(this.members,w)?{id:w,info:this.members[w]}:null}each(w){tn(this.members,(I,q)=>{w(this.get(q))})}setMyID(w){this.myID=w}onSubscription(w){this.members=w.presence.hash,this.count=w.presence.count,this.me=this.get(this.myID)}addMember(w){return this.get(w.user_id)===null&&this.count++,this.members[w.user_id]=w.user_info,this.get(w.user_id)}removeMember(w){var I=this.get(w.user_id);return I&&(delete this.members[w.user_id],this.count--),I}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var Te=function(M,w,I,q){function et(Et){return Et instanceof I?Et:new I(function(Lt){Lt(Et)})}return new(I||(I=Promise))(function(Et,Lt){function he(xe){try{Ge(q.next(xe))}catch(ze){Lt(ze)}}function qt(xe){try{Ge(q.throw(xe))}catch(ze){Lt(ze)}}function Ge(xe){xe.done?Et(xe.value):et(xe.value).then(he,qt)}Ge((q=q.apply(M,w||[])).next())})};class Pi extends ni{constructor(w,I){super(w,I),this.members=new Fi}authorize(w,I){super.authorize(w,(q,et)=>Te(this,void 0,void 0,function*(){if(!q)if(et=et,et.channel_data!=null){var Et=JSON.parse(et.channel_data);this.members.setMyID(Et.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let Lt=ce.buildLogSuffix("authorizationEndpoint");oi.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${Lt}, or the user should be signed in.`),I("Invalid auth response");return}I(q,et)}))}handleEvent(w){var I=w.event;if(I.indexOf("pusher_internal:")===0)this.handleInternalEvent(w);else{var q=w.data,et={};w.user_id&&(et.user_id=w.user_id),this.emit(I,q,et)}}handleInternalEvent(w){var I=w.event,q=w.data;switch(I){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(w);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(w);break;case"pusher_internal:member_added":var et=this.members.addMember(q);this.emit("pusher:member_added",et);break;case"pusher_internal:member_removed":var Et=this.members.removeMember(q);Et&&this.emit("pusher:member_removed",Et);break}}handleSubscriptionSucceededEvent(w){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(w.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var Hn=J(1),Zi=J(0);class In extends ni{constructor(w,I,q){super(w,I),this.key=null,this.nacl=q}authorize(w,I){super.authorize(w,(q,et)=>{if(q){I(q,et);return}let Et=et.shared_secret;if(!Et){I(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=Object(Zi.decode)(Et),delete et.shared_secret,I(null,et)})}trigger(w,I){throw new yi("Client events are not currently supported for encrypted channels")}handleEvent(w){var I=w.event,q=w.data;if(I.indexOf("pusher_internal:")===0||I.indexOf("pusher:")===0){super.handleEvent(w);return}this.handleEncryptedEvent(I,q)}handleEncryptedEvent(w,I){if(!this.key){oi.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!I.ciphertext||!I.nonce){oi.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+I);return}let q=Object(Zi.decode)(I.ciphertext);if(q.length<this.nacl.secretbox.overheadLength){oi.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${q.length}`);return}let et=Object(Zi.decode)(I.nonce);if(et.length<this.nacl.secretbox.nonceLength){oi.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${et.length}`);return}let Et=this.nacl.secretbox.open(q,et,this.key);if(Et===null){oi.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(Lt,he)=>{if(Lt){oi.error(`Failed to make a request to the authEndpoint: ${he}. Unable to fetch new key, so dropping encrypted event`);return}if(Et=this.nacl.secretbox.open(q,et,this.key),Et===null){oi.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(w,this.getDataToEmit(Et))});return}this.emit(w,this.getDataToEmit(Et))}getDataToEmit(w){let I=Object(Hn.decode)(w);try{return JSON.parse(I)}catch{return I}}}class Rn extends $i{constructor(w,I){super(),this.state="initialized",this.connection=null,this.key=w,this.options=I,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var q=Ee.getNetwork();q.bind("online",()=>{this.timeline.info({netinfo:"online"}),(this.state==="connecting"||this.state==="unavailable")&&this.retryIn(0)}),q.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}connect(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(w){return this.connection?this.connection.send(w):!1}send_event(w,I,q){return this.connection?this.connection.send_event(w,I,q):!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var w=(I,q)=>{I?this.runner=this.strategy.connect(0,w):q.action==="error"?(this.emit("error",{type:"HandshakeError",error:q.error}),this.timeline.error({handshakeError:q.error})):(this.abortConnecting(),this.handshakeCallbacks[q.action](q))};this.runner=this.strategy.connect(0,w)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var w=this.abandonConnection();w.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(w){this.timeline.info({action:"retry",delay:w}),w>0&&this.emit("connecting_in",Math.round(w/1e3)),this.retryTimer=new mi(w||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new mi(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new mi(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new mi(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(w){return Pe({},w,{message:I=>{this.resetActivityCheck(),this.emit("message",I)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:I=>{this.emit("error",I)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(w){return Pe({},w,{connected:I=>{this.activityTimeout=Math.min(this.options.activityTimeout,I.activityTimeout,I.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(I.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let w=I=>q=>{q.error&&this.emit("error",{type:"WebSocketError",error:q.error}),I(q)};return{tls_only:w(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:w(()=>{this.disconnect()}),backoff:w(()=>{this.retryIn(1e3)}),retry:w(()=>{this.retryIn(0)})}}setConnection(w){this.connection=w;for(var I in this.connectionCallbacks)this.connection.bind(I,this.connectionCallbacks[I]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var w in this.connectionCallbacks)this.connection.unbind(w,this.connectionCallbacks[w]);var I=this.connection;return this.connection=null,I}}updateState(w,I){var q=this.state;if(this.state=w,q!==w){var et=w;et==="connected"&&(et+=" with new socket ID "+I.socket_id),oi.debug("State changed",q+" -> "+et),this.timeline.info({state:w,params:I}),this.emit("state_change",{previous:q,current:w}),this.emit(w,I)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class vs{constructor(){this.channels={}}add(w,I){return this.channels[w]||(this.channels[w]=so(w,I)),this.channels[w]}all(){return qn(this.channels)}find(w){return this.channels[w]}remove(w){var I=this.channels[w];return delete this.channels[w],I}disconnect(){tn(this.channels,function(w){w.disconnect()})}}function so(M,w){if(M.indexOf("private-encrypted-")===0){if(w.config.nacl)return nn.createEncryptedChannel(M,w,w.config.nacl);let I="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",q=ce.buildLogSuffix("encryptedChannelSupport");throw new yi(`${I}. ${q}`)}else{if(M.indexOf("private-")===0)return nn.createPrivateChannel(M,w);if(M.indexOf("presence-")===0)return nn.createPresenceChannel(M,w);if(M.indexOf("#")===0)throw new Ft('Cannot create a channel with name "'+M+'".');return nn.createChannel(M,w)}}var ki={createChannels(){return new vs},createConnectionManager(M,w){return new Rn(M,w)},createChannel(M,w){return new $e(M,w)},createPrivateChannel(M,w){return new ni(M,w)},createPresenceChannel(M,w){return new Pi(M,w)},createEncryptedChannel(M,w,I){return new In(M,w,I)},createTimelineSender(M,w){return new Ne(M,w)},createHandshake(M,w){return new Ze(M,w)},createAssistantToTheTransportManager(M,w,I){return new ke(M,w,I)}},nn=ki;class hr{constructor(w){this.options=w||{},this.livesLeft=this.options.lives||1/0}getAssistant(w){return nn.createAssistantToTheTransportManager(this,w,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class di{constructor(w,I){this.strategies=w,this.loop=!!I.loop,this.failFast=!!I.failFast,this.timeout=I.timeout,this.timeoutLimit=I.timeoutLimit}isSupported(){return Ve(this.strategies,_e.method("isSupported"))}connect(w,I){var q=this.strategies,et=0,Et=this.timeout,Lt=null,he=(qt,Ge)=>{Ge?I(null,Ge):(et=et+1,this.loop&&(et=et%q.length),et<q.length?(Et&&(Et=Et*2,this.timeoutLimit&&(Et=Math.min(Et,this.timeoutLimit))),Lt=this.tryStrategy(q[et],w,{timeout:Et,failFast:this.failFast},he)):I(!0))};return Lt=this.tryStrategy(q[et],w,{timeout:Et,failFast:this.failFast},he),{abort:function(){Lt.abort()},forceMinPriority:function(qt){w=qt,Lt&&Lt.forceMinPriority(qt)}}}tryStrategy(w,I,q,et){var Et=null,Lt=null;return q.timeout>0&&(Et=new mi(q.timeout,function(){Lt.abort(),et(!0)})),Lt=w.connect(I,function(he,qt){he&&Et&&Et.isRunning()&&!q.failFast||(Et&&Et.ensureAborted(),et(he,qt))}),{abort:function(){Et&&Et.ensureAborted(),Lt.abort()},forceMinPriority:function(he){Lt.forceMinPriority(he)}}}}class ur{constructor(w){this.strategies=w}isSupported(){return Ve(this.strategies,_e.method("isSupported"))}connect(w,I){return Ue(this.strategies,w,function(q,et){return function(Et,Lt){if(et[q].error=Et,Et){bi(et)&&I(!0);return}Bi(et,function(he){he.forceMinPriority(Lt.transport.priority)}),I(null,Lt)}})}}function Ue(M,w,I){var q=wr(M,function(et,Et,Lt,he){return et.connect(w,I(Et,he))});return{abort:function(){Bi(q,Ni)},forceMinPriority:function(et){Bi(q,function(Et){Et.forceMinPriority(et)})}}}function bi(M){return Xr(M,function(w){return!!w.error})}function Ni(M){!M.error&&!M.aborted&&(M.abort(),M.aborted=!0)}class Or{constructor(w,I,q){this.strategy=w,this.transports=I,this.ttl=q.ttl||1800*1e3,this.usingTLS=q.useTLS,this.timeline=q.timeline}isSupported(){return this.strategy.isSupported()}connect(w,I){var q=this.usingTLS,et=dr(q),Et=et&&et.cacheSkipCount?et.cacheSkipCount:0,Lt=[this.strategy];if(et&&et.timestamp+this.ttl>=_e.now()){var he=this.transports[et.transport];he&&(["ws","wss"].includes(et.transport)||Et>3?(this.timeline.info({cached:!0,transport:et.transport,latency:et.latency}),Lt.push(new di([he],{timeout:et.latency*2+1e3,failFast:!0}))):Et++)}var qt=_e.now(),Ge=Lt.pop().connect(w,function xe(ze,Qn){ze?(ai(q),Lt.length>0?(qt=_e.now(),Ge=Lt.pop().connect(w,xe)):I(ze)):(re(q,Qn.transport.name,_e.now()-qt,Et),I(null,Qn))});return{abort:function(){Ge.abort()},forceMinPriority:function(xe){w=xe,Ge&&Ge.forceMinPriority(xe)}}}}function Wn(M){return"pusherTransport"+(M?"TLS":"NonTLS")}function dr(M){var w=Ee.getLocalStorage();if(w)try{var I=w[Wn(M)];if(I)return JSON.parse(I)}catch{ai(M)}return null}function re(M,w,I,q){var et=Ee.getLocalStorage();if(et)try{et[Wn(M)]=jn({timestamp:_e.now(),transport:w,latency:I,cacheSkipCount:q})}catch{}}function ai(M){var w=Ee.getLocalStorage();if(w)try{delete w[Wn(M)]}catch{}}class pr{constructor(w,{delay:I}){this.strategy=w,this.options={delay:I}}isSupported(){return this.strategy.isSupported()}connect(w,I){var q=this.strategy,et,Et=new mi(this.options.delay,function(){et=q.connect(w,I)});return{abort:function(){Et.ensureAborted(),et&&et.abort()},forceMinPriority:function(Lt){w=Lt,et&&et.forceMinPriority(Lt)}}}}class Xn{constructor(w,I,q){this.test=w,this.trueBranch=I,this.falseBranch=q}isSupported(){var w=this.test()?this.trueBranch:this.falseBranch;return w.isSupported()}connect(w,I){var q=this.test()?this.trueBranch:this.falseBranch;return q.connect(w,I)}}class kn{constructor(w){this.strategy=w}isSupported(){return this.strategy.isSupported()}connect(w,I){var q=this.strategy.connect(w,function(et,Et){Et&&q.abort(),I(et,Et)});return q}}function xs(M){return function(){return M.isSupported()}}var bs=function(M,w,I){var q={};function et(Cr,mn,Jo,mr,Gs){var Zr=I(M,Cr,mn,Jo,mr,Gs);return q[Cr]=Zr,Zr}var Et=Object.assign({},w,{hostNonTLS:M.wsHost+":"+M.wsPort,hostTLS:M.wsHost+":"+M.wssPort,httpPath:M.wsPath}),Lt=Object.assign({},Et,{useTLS:!0}),he=Object.assign({},w,{hostNonTLS:M.httpHost+":"+M.httpPort,hostTLS:M.httpHost+":"+M.httpsPort,httpPath:M.httpPath}),qt={loop:!0,timeout:15e3,timeoutLimit:6e4},Ge=new hr({minPingDelay:1e4,maxPingDelay:M.activityTimeout}),xe=new hr({lives:2,minPingDelay:1e4,maxPingDelay:M.activityTimeout}),ze=et("ws","ws",3,Et,Ge),Qn=et("wss","ws",3,Lt,Ge),fo=et("sockjs","sockjs",1,he),mo=et("xhr_streaming","xhr_streaming",1,he,xe),ma=et("xdr_streaming","xdr_streaming",1,he,xe),_o=et("xhr_polling","xhr_polling",1,he),go=et("xdr_polling","xdr_polling",1,he),fn=new di([ze],qt),Vr=new di([Qn],qt),zo=new di([fo],qt),xn=new di([new Xn(xs(mo),mo,ma)],qt),Cs=new di([new Xn(xs(_o),_o,go)],qt),is=new di([new Xn(xs(xn),new ur([xn,new pr(Cs,{delay:4e3})]),Cs)],qt),yo=new Xn(xs(is),is,zo),_i;return w.useTLS?_i=new ur([fn,new pr(yo,{delay:2e3})]):_i=new ur([fn,new pr(Vr,{delay:2e3}),new pr(yo,{delay:5e3})]),new Or(new kn(new Xn(xs(ze),_i,yo)),q,{ttl:18e5,timeline:w.timeline,useTLS:w.useTLS})},Fr=bs,Ai=function(){var M=this;M.timeline.info(M.buildTimelineMessage({transport:M.name+(M.options.useTLS?"s":"")})),M.hooks.isInitialized()?M.changeState("initialized"):M.hooks.file?(M.changeState("initializing"),At.load(M.hooks.file,{useTLS:M.options.useTLS},function(w,I){M.hooks.isInitialized()?(M.changeState("initialized"),I(!0)):(w&&M.onError(w),M.onClose(),I(!1))})):M.onClose()},Kr={getRequest:function(M){var w=new window.XDomainRequest;return w.ontimeout=function(){M.emit("error",new de),M.close()},w.onerror=function(I){M.emit("error",I),M.close()},w.onprogress=function(){w.responseText&&w.responseText.length>0&&M.onChunk(200,w.responseText)},w.onload=function(){w.responseText&&w.responseText.length>0&&M.onChunk(200,w.responseText),M.emit("finished",200),M.close()},w},abortRequest:function(M){M.ontimeout=M.onerror=M.onprogress=M.onload=null,M.abort()}},ws=Kr;const Os=256*1024;class Fs extends $i{constructor(w,I,q){super(),this.hooks=w,this.method=I,this.url=q}start(w){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},Ee.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(w)}close(){this.unloader&&(Ee.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(w,I){for(;;){var q=this.advanceBuffer(I);if(q)this.emit("chunk",{status:w,data:q});else break}this.isBufferTooLong(I)&&this.emit("buffer_too_long")}advanceBuffer(w){var I=w.slice(this.position),q=I.indexOf(`
`);return q!==-1?(this.position+=q+1,I.slice(0,q)):null}isBufferTooLong(w){return this.position===w.length&&w.length>Os}}var Pr;(function(M){M[M.CONNECTING=0]="CONNECTING",M[M.OPEN=1]="OPEN",M[M.CLOSED=3]="CLOSED"})(Pr||(Pr={}));var Kn=Pr,oo=1;class Ns{constructor(w,I){this.hooks=w,this.session=Nr(1e3)+"/"+Ss(8),this.location=Jn(I),this.readyState=Kn.CONNECTING,this.openStream()}send(w){return this.sendRaw(JSON.stringify([w]))}ping(){this.hooks.sendHeartbeat(this)}close(w,I){this.onClose(w,I,!0)}sendRaw(w){if(this.readyState===Kn.OPEN)try{return Ee.createSocketRequest("POST",an(Ts(this.location,this.session))).start(w),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(w,I,q){this.closeStream(),this.readyState=Kn.CLOSED,this.onclose&&this.onclose({code:w,reason:I,wasClean:q})}onChunk(w){if(w.status===200){this.readyState===Kn.OPEN&&this.onActivity();var I,q=w.data.slice(0,1);switch(q){case"o":I=JSON.parse(w.data.slice(1)||"{}"),this.onOpen(I);break;case"a":I=JSON.parse(w.data.slice(1)||"[]");for(var et=0;et<I.length;et++)this.onEvent(I[et]);break;case"m":I=JSON.parse(w.data.slice(1)||"null"),this.onEvent(I);break;case"h":this.hooks.onHeartbeat(this);break;case"c":I=JSON.parse(w.data.slice(1)||"[]"),this.onClose(I[0],I[1],!0);break}}}onOpen(w){this.readyState===Kn.CONNECTING?(w&&w.hostname&&(this.location.base=Us(this.location.base,w.hostname)),this.readyState=Kn.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(w){this.readyState===Kn.OPEN&&this.onmessage&&this.onmessage({data:w})}onActivity(){this.onactivity&&this.onactivity()}onError(w){this.onerror&&this.onerror(w)}openStream(){this.stream=Ee.createSocketRequest("POST",an(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",w=>{this.onChunk(w)}),this.stream.bind("finished",w=>{this.hooks.onFinished(this,w)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(w){_e.defer(()=>{this.onError(w),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}}function Jn(M){var w=/([^\?]*)\/*(\??.*)/.exec(M);return{base:w[1],queryString:w[2]}}function Ts(M,w){return M.base+"/"+w+"/xhr_send"}function an(M){var w=M.indexOf("?")===-1?"?":"&";return M+w+"t="+ +new Date+"&n="+oo++}function Us(M,w){var I=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(M);return I[1]+w+I[3]}function Nr(M){return Ee.randomInt(M)}function Ss(M){for(var w=[],I=0;I<M;I++)w.push(Nr(32).toString(32));return w.join("")}var De=Ns,An={getReceiveURL:function(M,w){return M.base+"/"+w+"/xhr_streaming"+M.queryString},onHeartbeat:function(M){M.sendRaw("[]")},sendHeartbeat:function(M){M.sendRaw("[]")},onFinished:function(M,w){M.onClose(1006,"Connection interrupted ("+w+")",!1)}},ti=An,Jr={getReceiveURL:function(M,w){return M.base+"/"+w+"/xhr"+M.queryString},onHeartbeat:function(){},sendHeartbeat:function(M){M.sendRaw("[]")},onFinished:function(M,w){w===200?M.reconnect():M.onClose(1006,"Connection interrupted ("+w+")",!1)}},Ps=Jr,dn={getRequest:function(M){var w=Ee.getXHRAPI(),I=new w;return I.onreadystatechange=I.onprogress=function(){switch(I.readyState){case 3:I.responseText&&I.responseText.length>0&&M.onChunk(I.status,I.responseText);break;case 4:I.responseText&&I.responseText.length>0&&M.onChunk(I.status,I.responseText),M.emit("finished",I.status),M.close();break}},I},abortRequest:function(M){M.onreadystatechange=null,M.abort()}},pn=dn,Er={createStreamingSocket(M){return this.createSocket(ti,M)},createPollingSocket(M){return this.createSocket(Ps,M)},createSocket(M,w){return new De(M,w)},createXHR(M,w){return this.createRequest(pn,M,w)},createRequest(M,w,I){return new Fs(M,w,I)}},Yr=Er;Yr.createXDR=function(M,w){return this.createRequest(ws,M,w)};var Ur=Yr,qi={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:bt,DependenciesReceivers:Se,getDefaultStrategy:Fr,Transports:kt,transportConnectionInitializer:Ai,HTTPFactory:Ur,TimelineTransport:Be,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(M){window.Pusher=M;var w=()=>{this.onDocumentBody(M.ready)};window.JSON?w():At.load("json2",{},w)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:gi,jsonp:$n}},onDocumentBody(M){document.body?M():setTimeout(()=>{this.onDocumentBody(M)},0)},createJSONPRequest(M,w){return new ys(M,w)},createScriptRequest(M){return new en(M)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var M=this.getXHRAPI();return new M},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return fe},createWebSocket(M){var w=this.getWebSocketAPI();return new w(M)},createSocketRequest(M,w){if(this.isXHRSupported())return this.HTTPFactory.createXHR(M,w);if(this.isXDRSupported(w.indexOf("https:")===0))return this.HTTPFactory.createXDR(M,w);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var M=this.getXHRAPI();return!!M&&new M().withCredentials!==void 0},isXDRSupported(M){var w=M?"https:":"http:",I=this.getProtocol();return!!window.XDomainRequest&&I===w},addUnloadListener(M){window.addEventListener!==void 0?window.addEventListener("unload",M,!1):window.attachEvent!==void 0&&window.attachEvent("onunload",M)},removeUnloadListener(M){window.addEventListener!==void 0?window.removeEventListener("unload",M,!1):window.detachEvent!==void 0&&window.detachEvent("onunload",M)},randomInt(M){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*M)}},Ee=qi,fr;(function(M){M[M.ERROR=3]="ERROR",M[M.INFO=6]="INFO",M[M.DEBUG=7]="DEBUG"})(fr||(fr={}));var qe=fr;class ko{constructor(w,I,q){this.key=w,this.session=I,this.events=[],this.options=q||{},this.sent=0,this.uniqueID=0}log(w,I){w<=this.options.level&&(this.events.push(Pe({},I,{timestamp:_e.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(w){this.log(qe.ERROR,w)}info(w){this.log(qe.INFO,w)}debug(w){this.log(qe.DEBUG,w)}isEmpty(){return this.events.length===0}send(w,I){var q=Pe({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],w(q,(et,Et)=>{et||this.sent++,I&&I(et,Et)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class Vs{constructor(w,I,q,et){this.name=w,this.priority=I,this.transport=q,this.options=et||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(w,I){if(this.isSupported()){if(this.priority<w)return Zs(new be,I)}else return Zs(new Yi,I);var q=!1,et=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),Et=null,Lt=function(){et.unbind("initialized",Lt),et.connect()},he=function(){Et=nn.createHandshake(et,function(ze){q=!0,xe(),I(null,ze)})},qt=function(ze){xe(),I(ze)},Ge=function(){xe();var ze;ze=jn(et),I(new ci(ze))},xe=function(){et.unbind("initialized",Lt),et.unbind("open",he),et.unbind("error",qt),et.unbind("closed",Ge)};return et.bind("initialized",Lt),et.bind("open",he),et.bind("error",qt),et.bind("closed",Ge),et.initialize(),{abort:()=>{q||(xe(),Et?Et.close():et.close())},forceMinPriority:ze=>{q||this.priority<ze&&(Et?Et.close():et.close())}}}}function Zs(M,w){return _e.defer(function(){w(M)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Wo}=Ee;var Qr=function(M,w,I,q,et,Et){var Lt=Wo[I];if(!Lt)throw new Ci(I);var he=(!M.enabledTransports||un(M.enabledTransports,w)!==-1)&&(!M.disabledTransports||un(M.disabledTransports,w)===-1),qt;return he?(et=Object.assign({ignoreNullOrigin:M.ignoreNullOrigin},et),qt=new Vs(w,q,Et?Et.getAssistant(Lt):Lt,et)):qt=Xe,qt},Xe={isSupported:function(){return!1},connect:function(M,w){var I=_e.defer(function(){w(new Yi)});return{abort:function(){I.ensureAborted()},forceMinPriority:function(){}}}};function pa(M){if(M==null)throw"You must pass an options object";if(M.cluster==null)throw"Options object must provide a cluster";"disableStats"in M&&oi.warn("The disableStats option is deprecated in favor of enableStats")}const Yn=(M,w)=>{var I="socket_id="+encodeURIComponent(M.socketId);for(var q in w.params)I+="&"+encodeURIComponent(q)+"="+encodeURIComponent(w.params[q]);if(w.paramsProvider!=null){let et=w.paramsProvider();for(var q in et)I+="&"+encodeURIComponent(q)+"="+encodeURIComponent(et[q])}return I};var Xo=M=>{if(typeof Ee.getAuthorizers()[M.transport]>"u")throw`'${M.transport}' is not a recognized auth transport`;return(w,I)=>{const q=Yn(w,M);Ee.getAuthorizers()[M.transport](Ee,q,M,Gt.UserAuthentication,I)}};const fa=(M,w)=>{var I="socket_id="+encodeURIComponent(M.socketId);I+="&channel_name="+encodeURIComponent(M.channelName);for(var q in w.params)I+="&"+encodeURIComponent(q)+"="+encodeURIComponent(w.params[q]);if(w.paramsProvider!=null){let et=w.paramsProvider();for(var q in et)I+="&"+encodeURIComponent(q)+"="+encodeURIComponent(et[q])}return I};var co=M=>{if(typeof Ee.getAuthorizers()[M.transport]>"u")throw`'${M.transport}' is not a recognized auth transport`;return(w,I)=>{const q=fa(w,M);Ee.getAuthorizers()[M.transport](Ee,q,M,Gt.ChannelAuthorization,I)}};const ho=(M,w,I)=>{const q={authTransport:w.transport,authEndpoint:w.endpoint,auth:{params:w.params,headers:w.headers}};return(et,Et)=>{const Lt=M.channel(et.channelName);I(Lt,q).authorize(et.socketId,Et)}};function Ao(M,w){let I={activityTimeout:M.activityTimeout||Ot.activityTimeout,cluster:M.cluster,httpPath:M.httpPath||Ot.httpPath,httpPort:M.httpPort||Ot.httpPort,httpsPort:M.httpsPort||Ot.httpsPort,pongTimeout:M.pongTimeout||Ot.pongTimeout,statsHost:M.statsHost||Ot.stats_host,unavailableTimeout:M.unavailableTimeout||Ot.unavailableTimeout,wsPath:M.wsPath||Ot.wsPath,wsPort:M.wsPort||Ot.wsPort,wssPort:M.wssPort||Ot.wssPort,enableStats:ts(M),httpHost:Es(M),useTLS:Bn(M),wsHost:uo(M),userAuthenticator:Mo(M),channelAuthorizer:es(M,w)};return"disabledTransports"in M&&(I.disabledTransports=M.disabledTransports),"enabledTransports"in M&&(I.enabledTransports=M.enabledTransports),"ignoreNullOrigin"in M&&(I.ignoreNullOrigin=M.ignoreNullOrigin),"timelineParams"in M&&(I.timelineParams=M.timelineParams),"nacl"in M&&(I.nacl=M.nacl),I}function Es(M){return M.httpHost?M.httpHost:M.cluster?`sockjs-${M.cluster}.pusher.com`:Ot.httpHost}function uo(M){return M.wsHost?M.wsHost:Ko(M.cluster)}function Ko(M){return`ws-${M}.pusher.com`}function Bn(M){return Ee.getProtocol()==="https:"?!0:M.forceTLS!==!1}function ts(M){return"enableStats"in M?M.enableStats:"disableStats"in M?!M.disableStats:!1}function Mo(M){const w=Object.assign(Object.assign({},Ot.userAuthentication),M.userAuthentication);return"customHandler"in w&&w.customHandler!=null?w.customHandler:Xo(w)}function Mn(M,w){let I;return"channelAuthorization"in M?I=Object.assign(Object.assign({},Ot.channelAuthorization),M.channelAuthorization):(I={transport:M.authTransport||Ot.authTransport,endpoint:M.authEndpoint||Ot.authEndpoint},"auth"in M&&("params"in M.auth&&(I.params=M.auth.params),"headers"in M.auth&&(I.headers=M.auth.headers)),"authorizer"in M&&(I.customHandler=ho(w,I,M.authorizer))),I}function es(M,w){const I=Mn(M,w);return"customHandler"in I&&I.customHandler!=null?I.customHandler:co(I)}class Lo extends $i{constructor(w){super(function(I,q){oi.debug(`No callbacks on watchlist events for ${I}`)}),this.pusher=w,this.bindWatchlistInternalEvent()}handleEvent(w){w.data.events.forEach(I=>{this.emit(I.name,I)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",w=>{var I=w.event;I==="pusher_internal:watchlist_events"&&this.handleEvent(w)})}}function qs(){let M,w;return{promise:new Promise((q,et)=>{M=q,w=et}),resolve:M,reject:w}}var ei=qs;class js extends $i{constructor(w){super(function(I,q){oi.debug("No callbacks on user for "+I)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(I,q)=>{if(I){oi.warn(`Error during signin: ${I}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:q.auth,user_data:q.user_data})},this.pusher=w,this.pusher.connection.bind("state_change",({previous:I,current:q})=>{I!=="connected"&&q==="connected"&&this._signin(),I==="connected"&&q!=="connected"&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new Lo(w),this.pusher.connection.bind("message",I=>{var q=I.event;q==="pusher:signin_success"&&this._onSigninSuccess(I.data),this.serverToUserChannel&&this.serverToUserChannel.name===I.channel&&this.serverToUserChannel.handleEvent(I)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(w){try{this.user_data=JSON.parse(w.user_data)}catch{oi.error(`Failed parsing user data after signin: ${w.user_data}`),this._cleanup();return}if(typeof this.user_data.id!="string"||this.user_data.id===""){oi.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){const w=I=>{I.subscriptionPending&&I.subscriptionCancelled?I.reinstateSubscription():!I.subscriptionPending&&this.pusher.connection.state==="connected"&&I.subscribe()};this.serverToUserChannel=new $e(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((I,q)=>{I.indexOf("pusher_internal:")===0||I.indexOf("pusher:")===0||this.emit(I,q)}),w(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:w,resolve:I,reject:q}=ei();w.done=!1;const et=()=>{w.done=!0};w.then(et).catch(et),this.signinDonePromise=w,this._signinDoneResolve=I}}class Hi{static ready(){Hi.isReady=!0;for(var w=0,I=Hi.instances.length;w<I;w++)Hi.instances[w].connect()}static getClientFeatures(){return Dn(Wr({ws:Ee.Transports.ws},function(w){return w.isSupported({})}))}constructor(w,I){$s(w),pa(I),this.key=w,this.config=Ao(I,this),this.channels=nn.createChannels(),this.global_emitter=new $i,this.sessionID=Ee.randomInt(1e9),this.timeline=new ko(this.key,this.sessionID,{cluster:this.config.cluster,features:Hi.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:qe.INFO,version:Ot.VERSION}),this.config.enableStats&&(this.timelineSender=nn.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+Ee.TimelineTransport.name}));var q=et=>Ee.getDefaultStrategy(this.config,et,Qr);this.connection=nn.createConnectionManager(this.key,{getStrategy:q,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",et=>{var Et=et.event,Lt=Et.indexOf("pusher_internal:")===0;if(et.channel){var he=this.channel(et.channel);he&&he.handleEvent(et)}Lt||this.global_emitter.emit(et.event,et.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",et=>{oi.warn(et)}),Hi.instances.push(this),this.timeline.info({instances:Hi.instances.length}),this.user=new js(this),Hi.isReady&&this.connect()}channel(w){return this.channels.find(w)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var w=this.connection.isUsingTLS(),I=this.timelineSender;this.timelineSenderTimer=new ui(6e4,function(){I.send(w)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(w,I,q){return this.global_emitter.bind(w,I,q),this}unbind(w,I,q){return this.global_emitter.unbind(w,I,q),this}bind_global(w){return this.global_emitter.bind_global(w),this}unbind_global(w){return this.global_emitter.unbind_global(w),this}unbind_all(w){return this.global_emitter.unbind_all(),this}subscribeAll(){var w;for(w in this.channels.channels)this.channels.channels.hasOwnProperty(w)&&this.subscribe(w)}subscribe(w){var I=this.channels.add(w,this);return I.subscriptionPending&&I.subscriptionCancelled?I.reinstateSubscription():!I.subscriptionPending&&this.connection.state==="connected"&&I.subscribe(),I}unsubscribe(w){var I=this.channels.find(w);I&&I.subscriptionPending?I.cancelSubscription():(I=this.channels.remove(w),I&&I.subscribed&&I.unsubscribe())}send_event(w,I,q){return this.connection.send_event(w,I,q)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}Hi.instances=[],Hi.isReady=!1,Hi.logToConsole=!1,Hi.Runtime=Ee,Hi.ScriptReceivers=Ee.ScriptReceivers,Hi.DependenciesReceivers=Ee.DependenciesReceivers,Hi.auth_callbacks=Ee.auth_callbacks;var po=it.default=Hi;function $s(M){if(M==null)throw"You must pass your app key when you instantiate Pusher."}Ee.setup(Hi)}])})})(Vu);var uf=Vu.exports;const df=Cp(uf);var pf={exports:{}};(function(vt,pt){(function(V,it){vt.exports=it()})(Au,function(){var V,it,J;function wt(d,Ot){if(!V)V=Ot;else if(!it)it=Ot;else{var yt="var sharedChunk = {}; ("+V+")(sharedChunk); ("+it+")(sharedChunk);",Se={};V(Se),J=Ot(Se),typeof window<"u"&&(J.workerUrl=window.URL.createObjectURL(new Blob([yt],{type:"text/javascript"})))}}wt(["exports"],function(d){function Ot(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var yt=Se;function Se(i,t){this.x=i,this.y=t}Se.prototype={clone:function(){return new Se(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),h=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Se.convert=function(i){return i instanceof Se?i:Array.isArray(i)?new Se(i[0],i[1]):i};var At=Ot(yt),Ht=le;function le(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}le.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<t)return n;var p=this.sampleCurveDerivativeX(n);if(Math.abs(p)<1e-6)break;n-=h/p}var f=0,g=1;for(n=i,o=0;o<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<t));o++)i>h?f=n:g=n,n=.5*(g-f)+f;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ce=Ot(Ht);function Gt(i,t,n,o){const h=new ce(i,t,n,o);return function(p){return h.solve(p)}}const Nt=Gt(.25,.1,.25,1);function Ft(i,t,n){return Math.min(n,Math.max(t,i))}function de(i,t,n){const o=n-t,h=((i-t)%o+o)%o+t;return h===t?n:h}function be(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let ci=1;function yi(i,t){i.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Ci(i,t,n){const o={};for(const h in i)o[h]=t.call(n||this,i[h],h,i);return o}function Yi(i,t,n){const o={};for(const h in i)t.call(n||this,i[h],h,i)&&(o[h]=i[h]);return o}function hi(i){return Array.isArray(i)?i.map(hi):typeof i=="object"&&i?Ci(i,hi):i}const Ui={};function gi(i){Ui[i]||(typeof console<"u"&&console.warn(i),Ui[i]=!0)}function we(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Ii(i){let t=0;for(let n,o,h=0,p=i.length,f=p-1;h<p;f=h++)n=i[h],o=i[f],t+=(o.x-n.x)*(n.y+o.y);return t}function Qi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Vi=null;function lr(i){if(Vi==null){const t=i.navigator?i.navigator.userAgent:null;Vi=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Vi}function Ye(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const xi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Le,br;const Ae={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){return this.getImageCanvasContext(i).getImageData(-t,-t,i.width+2*t,i.height+2*t)},getImageCanvasContext(i){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=i.width,t.height=i.height,n.drawImage(i,0,0,i.width,i.height),n},resolveURL:i=>(Le||(Le=document.createElement("a")),Le.href=i,Le.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(br==null&&(br=matchMedia("(prefers-reduced-motion: reduce)")),br.matches)}},fi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class mi extends Error{constructor(t,n,o,h){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=h}}const ui=Qi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=i=>fi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function _e(i,t){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:ui(),signal:n.signal});let h=!1,p=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),p||fetch(o).then(f=>f.ok?(g=>{(i.type==="arrayBuffer"||i.type==="image"?g.arrayBuffer():i.type==="json"?g.json():g.text()).then(v=>{p||(h=!0,t(null,v,g.headers.get("Cache-Control"),g.headers.get("Expires")))}).catch(v=>{p||t(new Error(v.message))})})(f):f.blob().then(g=>t(new mi(f.status,f.statusText,i.url,g)))).catch(f=>{f.code!==20&&t(new Error(f.message))}),{cancel:()=>{p=!0,h||n.abort()}}}const Pe=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Qi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!Qi())return(Qe(i.url)||_e)(i,t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(ui())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return _e(i,t);if(Qi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var n;return function(o,h){const p=new XMLHttpRequest;p.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(p.responseType="arraybuffer");for(const f in o.headers)p.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=o.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let f=p.response;if(o.type==="json")try{f=JSON.parse(p.response)}catch(g){return h(g)}h(null,f,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const f=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});h(new mi(p.status,p.statusText,o.url,f))}},p.send(o.body),{cancel:()=>p.abort()}}(i,t)},vn=function(i,t){return Pe(be(i,{type:"arrayBuffer"}),t)};function un(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function tn(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function Dn(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class qn{constructor(t,n={}){be(this,n),this.type=t}}class Bi extends qn{constructor(t,n={}){super("error",be({error:t},n))}}class wr{on(t,n){return this._listeners=this._listeners||{},tn(t,n,this._listeners),this}off(t,n){return Dn(t,n,this._listeners),Dn(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},tn(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new qn(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const g of h)g.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const g of p)Dn(o,g,this._oneTimeListeners),g.call(this,t);const f=this._eventedParent;f&&(be(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof Bi&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Wr(i,t){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return cr.forEach(o=>{o in t&&(n[o]=t[o])}),n}function ii(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!ii(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!ii(i[n],t[n]))return!1;return!0}return i===t}const Ve={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Xr(i,t,n){n.push({command:Ve.addSource,args:[i,t[i]]})}function ms(i,t,n){t.push({command:Ve.removeSource,args:[i]}),n[i]=!0}function _s(i,t,n,o){ms(i,n,o),Xr(i,t,n)}function Di(i,t,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!ii(i[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!ii(i[n][o],t[n][o]))return!1;return!0}function jn(i,t,n,o,h,p){let f;for(f in t=t||{},i=i||{})Object.prototype.hasOwnProperty.call(i,f)&&(ii(i[f],t[f])||n.push({command:p,args:[o,f,t[f],h]}));for(f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(ii(i[f],t[f])||n.push({command:p,args:[o,f,t[f],h]}))}function gs(i){return i.id}function oi(i,t){return i[t.id]=t,i}class Vt{constructor(t,n,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function $n(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}class en extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class ys{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,h]of n)this.bindings[o]=h}concat(t){return new ys(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Tr={kind:"null"},Zt={kind:"number"},Be={kind:"string"},Ie={kind:"boolean"},ji={kind:"color"},Oi={kind:"object"},Me={kind:"value"},En={kind:"collator"},Sr={kind:"formatted"},Cn={kind:"padding"},$i={kind:"resolvedImage"};function Gi(i,t){return{kind:"array",itemType:i,N:t}}function Ke(i){if(i.kind==="array"){const t=Ke(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Bs=[Tr,Zt,Be,Ie,ji,Sr,Oi,Gi(Me),Cn,$i];function Gn(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Gn(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of Bs)if(!Gn(n,t))return null}}return`Expected ${Ke(i)} but found ${Ke(t)} instead.`}function X(i,t){return t.some(n=>n.kind===i.kind)}function D(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function B(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const Z=.96422,Q=.82521,nt=4/29,ht=6/29,st=3*ht*ht,rt=ht*ht*ht,ut=Math.PI/180,ft=180/Math.PI;function kt(i){return(i%=360)<0&&(i+=360),i}function It([i,t,n,o]){let h,p;const f=ke((.2225045*(i=fe(i))+.7168786*(t=fe(t))+.0606169*(n=fe(n)))/1);i===t&&t===n?h=p=f:(h=ke((.4360747*i+.3850649*t+.1430804*n)/Z),p=ke((.0139322*i+.0971045*t+.7141733*n)/Q));const g=116*f-16;return[g<0?0:g,500*(h-f),200*(f-p),o]}function fe(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ke(i){return i>rt?Math.pow(i,1/3):i/st+nt}function ie([i,t,n,o]){let h=(i+16)/116,p=isNaN(t)?h:h+t/500,f=isNaN(n)?h:h-n/200;return h=1*ve(h),p=Z*ve(p),f=Q*ve(f),[ae(3.1338561*p-1.6168667*h-.4906146*f),ae(-.9787684*p+1.9161415*h+.033454*f),ae(.0719453*p-.2289914*h+1.4052427*f),o]}function ae(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function ve(i){return i>ht?i*i*i:st*(i-nt)}function Ze(i){return parseInt(i.padEnd(2,i),16)/255}function Ne(i,t){return $e(t?i/100:i,0,1)}function $e(i,t,n){return Math.min(Math.max(t,i),n)}function ni(i){return!i.some(Number.isNaN)}const Fi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Te{constructor(t,n,o,h=1,p=!0){this.r=t,this.g=n,this.b=o,this.a=h,p||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,o,h]))}static parse(t){if(t instanceof Te)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase())==="transparent")return[0,0,0,0];const h=Fi[o];if(h){const[f,g,v]=h;return[f/255,g/255,v/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const f=o.length<6?1:2;let g=1;return[Ze(o.slice(g,g+=f)),Ze(o.slice(g,g+=f)),Ze(o.slice(g,g+=f)),Ze(o.slice(g,g+f)||"ff")]}if(o.startsWith("rgb")){const f=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,v,P,C,z,R,O,U,K,H,ct,dt]=f,ot=[C||" ",O||" ",H].join("");if(ot==="  "||ot==="  /"||ot===",,"||ot===",,,"){const _t=[P,R,K].join(""),xt=_t==="%%%"?100:_t===""?255:0;if(xt){const Ct=[$e(+v/xt,0,1),$e(+z/xt,0,1),$e(+U/xt,0,1),ct?Ne(+ct,dt):1];if(ni(Ct))return Ct}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,g,v,P,C,z,R,O,U]=p,K=[v||" ",C||" ",R].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const H=[+g,$e(+P,0,100),$e(+z,0,100),O?Ne(+O,U):1];if(ni(H))return function([ct,dt,ot,_t]){function xt(Ct){const se=(Ct+ct/30)%12,ue=dt*Math.min(ot,1-ot);return ot-ue*Math.max(-1,Math.min(se-3,9-se,1))}return ct=kt(ct),dt/=100,ot/=100,[xt(0),xt(8),xt(4),_t]}(H)}}}(t);return n?new Te(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:h}=this,p=h||1/0;return this.overwriteGetter("rgb",[t/p,n/p,o/p,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,h,p]=It(t),f=Math.sqrt(o*o+h*h);return[Math.round(1e4*f)?kt(Math.atan2(h,o)*ft):NaN,f,n,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",It(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,h]=this.rgb;return`rgba(${[t,n,o].map(p=>Math.round(255*p)).join(",")},${h})`}}Te.black=new Te(0,0,0,1),Te.white=new Te(1,1,1,1),Te.transparent=new Te(0,0,0,0),Te.red=new Te(1,0,0,1);class Pi{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hn{constructor(t,n,o,h,p){this.text=t,this.image=n,this.scale=o,this.fontStack=h,this.textColor=p}}class Zi{constructor(t){this.sections=t}static fromString(t){return new Zi([new Hn(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Zi?t:Zi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class In{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof In)return t;if(typeof t=="number")return new In([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new In(t)}}toString(){return JSON.stringify(this.values)}}class Rn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Rn({name:t,available:!1}):null}}function vs(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function so(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Te||i instanceof Pi||i instanceof Zi||i instanceof In||i instanceof Rn)return!0;if(Array.isArray(i)){for(const t of i)if(!so(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!so(i[t]))return!1;return!0}return!1}function ki(i){if(i===null)return Tr;if(typeof i=="string")return Be;if(typeof i=="boolean")return Ie;if(typeof i=="number")return Zt;if(i instanceof Te)return ji;if(i instanceof Pi)return En;if(i instanceof Zi)return Sr;if(i instanceof In)return Cn;if(i instanceof Rn)return $i;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const h=ki(o);if(n){if(n===h)continue;n=Me;break}n=h}return Gi(n||Me,t)}return Oi}function nn(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Te||i instanceof Zi||i instanceof In||i instanceof Rn?i.toString():JSON.stringify(i)}class hr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!so(t[1]))return n.error("invalid value");const o=t[1];let h=ki(o);const p=n.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new hr(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class di{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ur={string:Be,number:Zt,boolean:Ie,object:Oi};class Ue{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,h=1;const p=t[0];if(p==="array"){let g,v;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in ur)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=ur[P],h++}else g=Me;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);v=t[2],h++}o=Gi(g,v)}else{if(!ur[p])throw new Error(`Types doesn't contain name = ${p}`);o=ur[p]}const f=[];for(;h<t.length;h++){const g=n.parse(t[h],h,Me);if(!g)return null;f.push(g)}return new Ue(o,f)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Gn(this.type,ki(o)))return o;if(n===this.args.length-1)throw new di(`Expected value to be of type ${Ke(this.type)}, but found ${Ke(ki(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const bi={"to-boolean":Ie,"to-color":ji,"to-number":Zt,"to-string":Be};class Ni{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!bi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const h=bi[o],p=[];for(let f=1;f<t.length;f++){const g=n.parse(t[f],f,Me);if(!g)return null;p.push(g)}return new Ni(h,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let n,o;for(const h of this.args){if(n=h.evaluate(t),o=null,n instanceof Te)return n;if(typeof n=="string"){const p=t.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:vs(n[0],n[1],n[2],n[3]),!o))return new Te(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new di(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="padding"){let n;for(const o of this.args){n=o.evaluate(t);const h=In.parse(n);if(h)return h}throw new di(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new di(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Zi.fromString(nn(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Rn.fromString(nn(this.args[0].evaluate(t))):nn(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Or=["Unknown","Point","LineString","Polygon"];class Wn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Or[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Te.parse(t)),n}}class dr{constructor(t,n,o=[],h,p=new ys,f=[]){this.registry=t,this.path=o,this.key=o.map(g=>`[${g}]`).join(""),this.scope=p,this.errors=f,this.expectedType=h,this._isConstant=n}parse(t,n,o,h,p={}){return n?this.concat(n,o,h)._parse(t,p):this._parse(t,p)}_parse(t,n){function o(h,p,f){return f==="assert"?new Ue(p,[h]):f==="coerce"?new Ni(p,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let f=p.parse(t,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,v=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string")if(g.kind!=="padding"||v.kind!=="value"&&v.kind!=="number"&&v.kind!=="array"){if(this.checkSubtype(g,v))return null}else f=o(f,g,n.typeAnnotation||"coerce");else f=o(f,g,n.typeAnnotation||"coerce");else f=o(f,g,n.typeAnnotation||"assert")}if(!(f instanceof hr)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const g=new Wn;try{f=new hr(f.type,f.evaluate(g))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const h=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new dr(this.registry,this._isConstant,h,n||null,p,this.errors)}error(t,...n){const o=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new en(o,t))}checkSubtype(t,n){const o=Gn(t,n);return o&&this.error(o),o}}class re{constructor(t,n,o){this.type=En,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const h=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ie);if(!h)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ie);if(!p)return null;let f=null;return o.locale&&(f=n.parse(o.locale,1,Be),!f)?null:new re(h,p,f)}evaluate(t){return new Pi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const ai=8192;function pr(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Xn(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function kn(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*ai),Math.round(o*h*ai)]}function xs(i,t,n){const o=i[0]-t[0],h=i[1]-t[1],p=i[0]-n[0],f=i[1]-n[1];return o*f-p*h==0&&o*p<=0&&h*f<=0}function bs(i,t){let n=!1;for(let f=0,g=t.length;f<g;f++){const v=t[f];for(let P=0,C=v.length;P<C-1;P++){if(xs(i,v[P],v[P+1]))return!1;(h=v[P])[1]>(o=i)[1]!=(p=v[P+1])[1]>o[1]&&o[0]<(p[0]-h[0])*(o[1]-h[1])/(p[1]-h[1])+h[0]&&(n=!n)}}var o,h,p;return n}function Fr(i,t){for(let n=0;n<t.length;n++)if(bs(i,t[n]))return!0;return!1}function Ai(i,t,n,o){const h=o[0]-n[0],p=o[1]-n[1],f=(i[0]-n[0])*p-h*(i[1]-n[1]),g=(t[0]-n[0])*p-h*(t[1]-n[1]);return f>0&&g<0||f<0&&g>0}function Kr(i,t,n){for(const P of n)for(let C=0;C<P.length-1;++C)if((g=[(f=P[C+1])[0]-(p=P[C])[0],f[1]-p[1]])[0]*(v=[(h=t)[0]-(o=i)[0],h[1]-o[1]])[1]-g[1]*v[0]!=0&&Ai(o,h,p,f)&&Ai(p,f,o,h))return!0;var o,h,p,f,g,v;return!1}function ws(i,t){for(let n=0;n<i.length;++n)if(!bs(i[n],t))return!1;for(let n=0;n<i.length-1;++n)if(Kr(i[n],i[n+1],t))return!1;return!0}function Os(i,t){for(let n=0;n<t.length;n++)if(ws(i,t[n]))return!0;return!1}function Fs(i,t,n){const o=[];for(let h=0;h<i.length;h++){const p=[];for(let f=0;f<i[h].length;f++){const g=kn(i[h][f],n);pr(t,g),p.push(g)}o.push(p)}return o}function Pr(i,t,n){const o=[];for(let h=0;h<i.length;h++){const p=Fs(i[h],t,n);o.push(p)}return o}function Kn(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const h=.5*o;let p=i[0]-n[0]>h?-o:n[0]-i[0]>h?o:0;p===0&&(p=i[0]-n[2]>h?-o:n[2]-i[0]>h?o:0),i[0]+=p}pr(t,i)}function oo(i,t,n,o){const h=Math.pow(2,o.z)*ai,p=[o.x*ai,o.y*ai],f=[];for(const g of i)for(const v of g){const P=[v.x+p[0],v.y+p[1]];Kn(P,t,n,h),f.push(P)}return f}function Ns(i,t,n,o){const h=Math.pow(2,o.z)*ai,p=[o.x*ai,o.y*ai],f=[];for(const v of i){const P=[];for(const C of v){const z=[C.x+p[0],C.y+p[1]];pr(t,z),P.push(z)}f.push(P)}if(t[2]-t[0]<=h/2){(g=t)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of f)for(const P of v)Kn(P,t,n,h)}var g;return f}class Jn{constructor(t,n){this.type=Ie,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(so(t[1])){const o=t[1];if(o.type==="FeatureCollection")for(let h=0;h<o.features.length;++h){const p=o.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Jn(o,o.features[h].geometry)}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Jn(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Jn(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(o.type==="Polygon"){const g=Fs(o.coordinates,p,f),v=oo(n.geometry(),h,p,f);if(!Xn(h,p))return!1;for(const P of v)if(!bs(P,g))return!1}if(o.type==="MultiPolygon"){const g=Pr(o.coordinates,p,f),v=oo(n.geometry(),h,p,f);if(!Xn(h,p))return!1;for(const P of v)if(!Fr(P,g))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(o.type==="Polygon"){const g=Fs(o.coordinates,p,f),v=Ns(n.geometry(),h,p,f);if(!Xn(h,p))return!1;for(const P of v)if(!ws(P,g))return!1}if(o.type==="MultiPolygon"){const g=Pr(o.coordinates,p,f),v=Ns(n.geometry(),h,p,f);if(!Xn(h,p))return!1;for(const P of v)if(!Os(P,g))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ts{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new Ts(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class an{constructor(t,n,o,h){this.name=t,this.type=n,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],h=an.definitions[o];if(!h)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,f=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,g=f.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let v=null;for(const[P,C]of g){v=new dr(n.registry,Us,n.path,null,n.scope);const z=[];let R=!1;for(let O=1;O<t.length;O++){const U=t[O],K=Array.isArray(P)?P[O-1]:P.type,H=v.parse(U,1+z.length,K);if(!H){R=!0;break}z.push(H)}if(!R)if(Array.isArray(P)&&P.length!==z.length)v.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let O=0;O<z.length;O++){const U=Array.isArray(P)?P[O]:P.type,K=z[O];v.concat(O+1).checkSubtype(U,K.type)}if(v.errors.length===0)return new an(o,p,C,z)}}if(g.length===1)n.errors.push(...v.errors);else{const P=(g.length?g:f).map(([z])=>{return R=z,Array.isArray(R)?`(${R.map(Ke).join(", ")})`:`(${Ke(R.type)}...)`;var R}).join(" | "),C=[];for(let z=1;z<t.length;z++){const R=n.parse(t[z],1+C.length);if(!R)return null;C.push(Ke(R.type))}n.error(`Expected arguments of type ${P}, but found (${C.join(", ")}) instead.`)}return null}static register(t,n){an.definitions=n;for(const o in n)t[o]=an}}function Us(i){if(i instanceof Ts)return Us(i.boundExpression);if(i instanceof an&&i.name==="error"||i instanceof re||i instanceof Jn)return!1;const t=i instanceof Ni||i instanceof Ue;let n=!0;return i.eachChild(o=>{n=t?n&&Us(o):n&&o instanceof hr}),!!n&&Nr(i)&&De(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Nr(i){if(i instanceof an&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Jn)return!1;let t=!0;return i.eachChild(n=>{t&&!Nr(n)&&(t=!1)}),t}function Ss(i){if(i instanceof an&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!Ss(n)&&(t=!1)}),t}function De(i,t){if(i instanceof an&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!De(o,t)&&(n=!1)}),n}function An(i,t){const n=i.length-1;let o,h,p=0,f=n,g=0;for(;p<=f;)if(g=Math.floor((p+f)/2),o=i[g],h=i[g+1],o<=t){if(g===n||t<h)return g;p=g+1}else{if(!(o>t))throw new di("Input is not a number.");f=g-1}return 0}class ti{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,p]of o)this.labels.push(h),this.outputs.push(p)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Zt);if(!o)return null;const h=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let f=1;f<t.length;f+=2){const g=f===1?-1/0:t[f],v=t[f+1],P=f,C=f+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(h.length&&h[h.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=n.parse(v,C,p);if(!z)return null;p=p||z.type,h.push([g,z])}return new ti(p,o,h)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const p=n.length;return h>=n[p-1]?o[p-1].evaluate(t):o[An(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jr(i,t,n){return i+n*(t-i)}function Ps(i,t,n){return i.map((o,h)=>Jr(o,t[h],n))}const dn={number:Jr,color:function(i,t,n,o="rgb"){switch(o){case"rgb":{const[h,p,f,g]=Ps(i.rgb,t.rgb,n);return new Te(h,p,f,g,!1)}case"hcl":{const[h,p,f,g]=i.hcl,[v,P,C,z]=t.hcl;let R,O;if(isNaN(h)||isNaN(v))isNaN(h)?isNaN(v)?R=NaN:(R=v,f!==1&&f!==0||(O=P)):(R=h,C!==1&&C!==0||(O=p));else{let dt=v-h;v>h&&dt>180?dt-=360:v<h&&h-v>180&&(dt+=360),R=h+n*dt}const[U,K,H,ct]=function([dt,ot,_t,xt]){return dt=isNaN(dt)?0:dt*ut,ie([_t,Math.cos(dt)*ot,Math.sin(dt)*ot,xt])}([R,O??Jr(p,P,n),Jr(f,C,n),Jr(g,z,n)]);return new Te(U,K,H,ct,!1)}case"lab":{const[h,p,f,g]=ie(Ps(i.lab,t.lab,n));return new Te(h,p,f,g,!1)}}},array:Ps,padding:function(i,t,n){return new In(Ps(i.values,t.values,n))}};class pn{constructor(t,n,o,h,p){this.type=t,this.operator=n,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[f,g]of p)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(t,n,o,h){let p=0;if(t.name==="exponential")p=Er(n,t.base,o,h);else if(t.name==="linear")p=Er(n,1,o,h);else if(t.name==="cubic-bezier"){const f=t.controlPoints;p=new ce(f[0],f[1],f[2],f[3]).solve(Er(n,1,o,h))}return p}static parse(t,n){let[o,h,p,...f]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const P=h[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:P}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const P=h.slice(1);if(P.length!==4||P.some(C=>typeof C!="number"||C<0||C>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Zt),!p)return null;const g=[];let v=null;o==="interpolate-hcl"||o==="interpolate-lab"?v=ji:n.expectedType&&n.expectedType.kind!=="value"&&(v=n.expectedType);for(let P=0;P<f.length;P+=2){const C=f[P],z=f[P+1],R=P+3,O=P+4;if(typeof C!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(g.length&&g[g.length-1][0]>=C)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const U=n.parse(z,O,v);if(!U)return null;v=v||U.type,g.push([C,U])}return B(v,Zt)||B(v,ji)||B(v,Cn)||B(v,Gi(Zt))?new pn(v,o,h,p,g):n.error(`Type ${Ke(v)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const p=n.length;if(h>=n[p-1])return o[p-1].evaluate(t);const f=An(n,h),g=pn.interpolationFactor(this.interpolation,h,n[f],n[f+1]),v=o[f].evaluate(t),P=o[f+1].evaluate(t);switch(this.operator){case"interpolate":return dn[this.type.kind](v,P,g);case"interpolate-hcl":return dn.color(v,P,g,"hcl");case"interpolate-lab":return dn.color(v,P,g,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Er(i,t,n,o){const h=o-n,p=i-n;return h===0?0:t===1?p/h:(Math.pow(t,p)-1)/(Math.pow(t,h)-1)}class Yr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const h=n.expectedType;h&&h.kind!=="value"&&(o=h);const p=[];for(const g of t.slice(1)){const v=n.parse(g,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!v)return null;o=o||v.type,p.push(v)}if(!o)throw new Error("No output type");const f=h&&p.some(g=>Gn(h,g.type));return new Yr(f?Me:o,p)}evaluate(t){let n,o=null,h=0;for(const p of this.args)if(h++,o=p.evaluate(t),o&&o instanceof Rn&&!o.available&&(n||(n=o.name),o=null,h===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class Ur{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const f=t[p];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const g=n.parse(t[p+1],p+1);if(!g)return null;o.push([f,g])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return h?new Ur(o,h):null}outputDefined(){return this.result.outputDefined()}}class qi{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Zt),h=n.parse(t[2],2,Gi(n.expectedType||Me));return o&&h?new qi(h.type.itemType,o,h):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new di(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new di(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new di(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ee{constructor(t,n){this.type=Ie,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Me),h=n.parse(t[2],2,Me);return o&&h?X(o.type,[Ie,Be,Zt,Tr,Me])?new Ee(o,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ke(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!D(n,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${Ke(ki(n))} instead.`);if(!D(o,["string","array"]))throw new di(`Expected second argument to be of type array or string, but found ${Ke(ki(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fr{constructor(t,n,o){this.type=Zt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Me),h=n.parse(t[2],2,Me);if(!o||!h)return null;if(!X(o.type,[Ie,Be,Zt,Tr,Me]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ke(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Zt);return p?new fr(o,h,p):null}return new fr(o,h)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!D(n,["boolean","string","number","null"]))throw new di(`Expected first argument to be of type boolean, string, number or null, but found ${Ke(ki(n))} instead.`);if(!D(o,["string","array"]))throw new di(`Expected second argument to be of type array or string, but found ${Ke(ki(o))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return o.indexOf(n,h)}return o.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class qe{constructor(t,n,o,h,p,f){this.inputType=t,this.type=n,this.input=o,this.cases=h,this.outputs=p,this.otherwise=f}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const p={},f=[];for(let P=2;P<t.length-1;P+=2){let C=t[P];const z=t[P+1];Array.isArray(C)||(C=[C]);const R=n.concat(P);if(C.length===0)return R.error("Expected at least one branch label.");for(const U of C){if(typeof U!="number"&&typeof U!="string")return R.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return R.error("Numeric branch labels must be integer values.");if(o){if(R.checkSubtype(o,ki(U)))return null}else o=ki(U);if(p[String(U)]!==void 0)return R.error("Branch labels must be unique.");p[String(U)]=f.length}const O=n.parse(z,P,h);if(!O)return null;h=h||O.type,f.push(O)}const g=n.parse(t[1],1,Me);if(!g)return null;const v=n.parse(t[t.length-1],t.length-1,h);return v?g.type.kind!=="value"&&n.concat(1).checkSubtype(o,g.type)?null:new qe(o,h,g,p,f,v):null}evaluate(t){const n=this.input.evaluate(t);return(ki(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ko{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const h=[];for(let f=1;f<t.length-1;f+=2){const g=n.parse(t[f],f,Ie);if(!g)return null;const v=n.parse(t[f+1],f+1,o);if(!v)return null;h.push([g,v]),o=o||v.type}const p=n.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new ko(o,h,p)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Vs{constructor(t,n,o,h){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Me),h=n.parse(t[2],2,Zt);if(!o||!h)return null;if(!X(o.type,[Gi(Me),Be,Me]))return n.error(`Expected first argument to be of type array or string, but found ${Ke(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Zt);return p?new Vs(o.type,o,h,p):null}return new Vs(o.type,o,h)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);if(!D(n,["string","array"]))throw new di(`Expected first argument to be of type array or string, but found ${Ke(ki(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return n.slice(o,h)}return n.slice(o)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Zs(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Wo(i,t,n,o){return o.compare(t,n)===0}function Qr(i,t,n){const o=i!=="=="&&i!=="!=";return class Zu{constructor(p,f,g){this.type=Ie,this.lhs=p,this.rhs=f,this.collator=g,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const g=p[0];let v=f.parse(p[1],1,Me);if(!v)return null;if(!Zs(g,v.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Ke(v.type)}'.`);let P=f.parse(p[2],2,Me);if(!P)return null;if(!Zs(g,P.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Ke(P.type)}'.`);if(v.type.kind!==P.type.kind&&v.type.kind!=="value"&&P.type.kind!=="value")return f.error(`Cannot compare types '${Ke(v.type)}' and '${Ke(P.type)}'.`);o&&(v.type.kind==="value"&&P.type.kind!=="value"?v=new Ue(P.type,[v]):v.type.kind!=="value"&&P.type.kind==="value"&&(P=new Ue(v.type,[P])));let C=null;if(p.length===4){if(v.type.kind!=="string"&&P.type.kind!=="string"&&v.type.kind!=="value"&&P.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(C=f.parse(p[3],3,En),!C)return null}return new Zu(v,P,C)}evaluate(p){const f=this.lhs.evaluate(p),g=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const v=ki(f),P=ki(g);if(v.kind!==P.kind||v.kind!=="string"&&v.kind!=="number")throw new di(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const v=ki(f),P=ki(g);if(v.kind!=="string"||P.kind!=="string")return t(p,f,g)}return this.collator?n(p,f,g,this.collator.evaluate(p)):t(p,f,g)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Xe=Qr("==",function(i,t,n){return t===n},Wo),pa=Qr("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!Wo(0,t,n,o)}),Yn=Qr("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),ao=Qr(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),Xo=Qr("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),fa=Qr(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class lo{constructor(t,n,o,h,p){this.type=Be,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=p}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Zt);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=n.parse(h.locale,1,Be),!p))return null;let f=null;if(h.currency&&(f=n.parse(h.currency,1,Be),!f))return null;let g=null;if(h["min-fraction-digits"]&&(g=n.parse(h["min-fraction-digits"],1,Zt),!g))return null;let v=null;return h["max-fraction-digits"]&&(v=n.parse(h["max-fraction-digits"],1,Zt),!v)?null:new lo(o,p,f,g,v)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class co{constructor(t){this.type=Sr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const h=[];let p=!1;for(let f=1;f<=t.length-1;++f){const g=t[f];if(p&&typeof g=="object"&&!Array.isArray(g)){p=!1;let v=null;if(g["font-scale"]&&(v=n.parse(g["font-scale"],1,Zt),!v))return null;let P=null;if(g["text-font"]&&(P=n.parse(g["text-font"],1,Gi(Be)),!P))return null;let C=null;if(g["text-color"]&&(C=n.parse(g["text-color"],1,ji),!C))return null;const z=h[h.length-1];z.scale=v,z.font=P,z.textColor=C}else{const v=n.parse(t[f],1,Me);if(!v)return null;const P=v.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:v,scale:null,font:null,textColor:null})}}return new co(h)}evaluate(t){return new Zi(this.sections.map(n=>{const o=n.content.evaluate(t);return ki(o)===$i?new Hn("",o,null,null,null):new Hn(nn(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class ho{constructor(t){this.type=$i,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Be);return o?new ho(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Rn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ao{constructor(t){this.type=Zt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ke(o.type)} instead.`):new Ao(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new di(`Expected value to be of type string or array, but found ${Ke(ki(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Es={"==":Xe,"!=":pa,">":ao,"<":Yn,">=":fa,"<=":Xo,array:Ue,at:qi,boolean:Ue,case:ko,coalesce:Yr,collator:re,format:co,image:ho,in:Ee,"index-of":fr,interpolate:pn,"interpolate-hcl":pn,"interpolate-lab":pn,length:Ao,let:Ur,literal:hr,match:qe,number:Ue,"number-format":lo,object:Ue,slice:Vs,step:ti,string:Ue,"to-boolean":Ni,"to-color":Ni,"to-number":Ni,"to-string":Ni,var:Ts,within:Jn};function uo(i,[t,n,o,h]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=h?h.evaluate(i):1,f=vs(t,n,o,p);if(f)throw new di(f);return new Te(t/255,n/255,o/255,p,!1)}function Ko(i,t){return i in t}function Bn(i,t){const n=t[i];return n===void 0?null:n}function ts(i){return{type:i}}function Mo(i){return{result:"success",value:i}}function Mn(i){return{result:"error",value:i}}function es(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Lo(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function qs(i){return!!i.expression&&i.expression.interpolated}function ei(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function js(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Hi(i){return i}function po(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",h=o||!(o||i.property!==void 0),p=i.type||(qs(t)?"exponential":"interval");if(n||t.type==="padding"){const C=n?Te.parse:In.parse;(i=$n({},i)).stops&&(i.stops=i.stops.map(z=>[z[0],C(z[1])])),i.default=C(i.default?i.default:t.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let g,v,P;if(p==="exponential")g=I;else if(p==="interval")g=w;else if(p==="categorical"){g=M,v=Object.create(null);for(const C of i.stops)v[C[0]]=C[1];P=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=q}if(o){const C={},z=[];for(let U=0;U<i.stops.length;U++){const K=i.stops[U],H=K[0].zoom;C[H]===void 0&&(C[H]={zoom:H,type:i.type,property:i.property,default:i.default,stops:[]},z.push(H)),C[H].stops.push([K[0].value,K[1]])}const R=[];for(const U of z)R.push([C[U].zoom,po(C[U],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:pn.interpolationFactor.bind(void 0,O),zoomStops:R.map(U=>U[0]),evaluate:({zoom:U},K)=>I({stops:R,base:i.base},t,U).evaluate(U,K)}}if(h){const C=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:pn.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(z=>z[0]),evaluate:({zoom:z})=>g(i,t,z,v,P)}}return{kind:"source",evaluate(C,z){const R=z&&z.properties?z.properties[i.property]:void 0;return R===void 0?$s(i.default,t.default):g(i,t,R,v,P)}}}function $s(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function M(i,t,n,o,h){return $s(typeof n===h?o[n]:void 0,i.default,t.default)}function w(i,t,n){if(ei(n)!=="number")return $s(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const h=An(i.stops.map(p=>p[0]),n);return i.stops[h][1]}function I(i,t,n){const o=i.base!==void 0?i.base:1;if(ei(n)!=="number")return $s(i.default,t.default);const h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const p=An(i.stops.map(C=>C[0]),n),f=function(C,z,R,O){const U=O-R,K=C-R;return U===0?0:z===1?K/U:(Math.pow(z,K)-1)/(Math.pow(z,U)-1)}(n,o,i.stops[p][0],i.stops[p+1][0]),g=i.stops[p][1],v=i.stops[p+1][1],P=dn[t.type]||Hi;return typeof g.evaluate=="function"?{evaluate(...C){const z=g.evaluate.apply(void 0,C),R=v.evaluate.apply(void 0,C);if(z!==void 0&&R!==void 0)return P(z,R,f,i.colorSpace)}}:P(g,v,f,i.colorSpace)}function q(i,t,n){switch(t.type){case"color":n=Te.parse(n);break;case"formatted":n=Zi.fromString(n.toString());break;case"resolvedImage":n=Rn.fromString(n.toString());break;case"padding":n=In.parse(n);break;default:ei(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return $s(n,i.default,t.default)}an.register(Es,{error:[{kind:"error"},[Be],(i,[t])=>{throw new di(t.evaluate(i))}],typeof:[Be,[Me],(i,[t])=>Ke(ki(t.evaluate(i)))],"to-rgba":[Gi(Zt,4),[ji],(i,[t])=>{const[n,o,h,p]=t.evaluate(i).rgb;return[255*n,255*o,255*h,p]}],rgb:[ji,[Zt,Zt,Zt],uo],rgba:[ji,[Zt,Zt,Zt,Zt],uo],has:{type:Ie,overloads:[[[Be],(i,[t])=>Ko(t.evaluate(i),i.properties())],[[Be,Oi],(i,[t,n])=>Ko(t.evaluate(i),n.evaluate(i))]]},get:{type:Me,overloads:[[[Be],(i,[t])=>Bn(t.evaluate(i),i.properties())],[[Be,Oi],(i,[t,n])=>Bn(t.evaluate(i),n.evaluate(i))]]},"feature-state":[Me,[Be],(i,[t])=>Bn(t.evaluate(i),i.featureState||{})],properties:[Oi,[],i=>i.properties()],"geometry-type":[Be,[],i=>i.geometryType()],id:[Me,[],i=>i.id()],zoom:[Zt,[],i=>i.globals.zoom],"heatmap-density":[Zt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Zt,[],i=>i.globals.lineProgress||0],accumulated:[Me,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Zt,ts(Zt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[Zt,ts(Zt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:Zt,overloads:[[[Zt,Zt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[Zt],(i,[t])=>-t.evaluate(i)]]},"/":[Zt,[Zt,Zt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[Zt,[Zt,Zt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[Zt,[Zt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Zt,[Zt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Zt,[Zt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Zt,[Zt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Zt,[Zt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Zt,[Zt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Zt,[Zt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Zt,[Zt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Zt,[Zt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Zt,[Zt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Zt,ts(Zt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[Zt,ts(Zt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[Zt,[Zt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Zt,[Zt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Zt,[Zt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Zt,[Zt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ie,[Be,Me],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Ie,[Me],(i,[t])=>i.id()===t.value],"filter-type-==":[Ie,[Be],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ie,[Be,Me],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o<h}],"filter-id-<":[Ie,[Me],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Ie,[Be,Me],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o>h}],"filter-id->":[Ie,[Me],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Ie,[Be,Me],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[Ie,[Me],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Ie,[Be,Me],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[Ie,[Me],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Ie,[Me],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ie,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ie,[Gi(Be)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ie,[Gi(Me)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ie,[Be,Gi(Me)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ie,[Be,Gi(Me)],(i,[t,n])=>function(o,h,p,f){for(;p<=f;){const g=p+f>>1;if(h[g]===o)return!0;h[g]>o?f=g-1:p=g+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ie,overloads:[[[Ie,Ie],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[ts(Ie),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Ie,overloads:[[[Ie,Ie],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[ts(Ie),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Ie,[Ie],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ie,[Be],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[Be,[Be],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Be,[Be],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Be,ts(Me),(i,t)=>t.map(n=>nn(n.evaluate(i))).join("")],"resolved-locale":[Be,[En],(i,[t])=>t.evaluate(i).resolvedLocale()]});class et{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Wn,this._defaultValue=n?(o=n).type==="color"&&js(o.default)?new Te(0,0,0,0):o.type==="color"?Te.parse(o.default)||null:o.type==="padding"?In.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,h,p,f){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,h,p,f){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new di(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function Et(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Es}function Lt(i,t){const n=new dr(Es,Us,[],t?function(h){const p={color:ji,string:Be,number:Zt,enum:Be,boolean:Ie,formatted:Sr,padding:Cn,resolvedImage:$i};return h.type==="array"?Gi(p[h.value]||Me,h.length):p[h.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Mo(new et(o,t)):Mn(n.errors)}class he{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Ss(n.expression)}evaluateWithoutErrorHandling(t,n,o,h,p,f){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,p,f)}evaluate(t,n,o,h,p,f){return this._styleExpression.evaluate(t,n,o,h,p,f)}}class qt{constructor(t,n,o,h){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ss(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,o,h,p,f){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,p,f)}evaluate(t,n,o,h,p,f){return this._styleExpression.evaluate(t,n,o,h,p,f)}interpolationFactor(t,n,o){return this.interpolationType?pn.interpolationFactor(this.interpolationType,t,n,o):0}}function Ge(i,t){const n=Lt(i,t);if(n.result==="error")return n;const o=n.value.expression,h=Nr(o);if(!h&&!es(t))return Mn([new en("","data expressions not supported")]);const p=De(o,["zoom"]);if(!p&&!Lo(t))return Mn([new en("","zoom expressions not supported")]);const f=ze(o);return f||p?f instanceof en?Mn([f]):f instanceof pn&&!qs(t)?Mn([new en("",'"interpolate" expressions cannot be used with this property')]):Mo(f?new qt(h?"camera":"composite",n.value,f.labels,f instanceof pn?f.interpolation:void 0):new he(h?"constant":"source",n.value)):Mn([new en("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xe{constructor(t,n){this._parameters=t,this._specification=n,$n(this,po(this._parameters,this._specification))}static deserialize(t){return new xe(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ze(i){let t=null;if(i instanceof Ur)t=ze(i.result);else if(i instanceof Yr){for(const n of i.args)if(t=ze(n),t)break}else(i instanceof ti||i instanceof pn)&&i.input instanceof an&&i.input.name==="zoom"&&(t=i);return t instanceof en||i.eachChild(n=>{const o=ze(n);o instanceof en?t=o:!t&&o?t=new en("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new en("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Qn(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Qn(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const fo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mo(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Qn(i)||(i=go(i));const t=Lt(i,fo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,h)=>t.value.evaluate(n,o,{},h),needGeometry:_o(i)}}function ma(i,t){return i<t?-1:i>t?1:0}function _o(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(_o(i[t]))return!0;return!1}function go(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?fn(i[1],i[2],"=="):t==="!="?xn(fn(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?fn(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(go))):t==="all"?["all"].concat(i.slice(1).map(go)):t==="none"?["all"].concat(i.slice(1).map(go).map(xn)):t==="in"?Vr(i[1],i.slice(2)):t==="!in"?xn(Vr(i[1],i.slice(2))):t==="has"?zo(i[1]):t==="!has"?xn(zo(i[1])):t!=="within"||i;var n}function fn(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function Vr(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(ma)]]:["filter-in-small",i,["literal",t]]}}function zo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function xn(i){return["!",i]}function Cs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const p of i)h+=`${Cs(p)},`;return`${h}]`}const n=Object.keys(i).sort();let o="{";for(let h=0;h<n.length;h++)o+=`${JSON.stringify(n[h])}:${Cs(i[n[h]])},`;return`${o}}`}function is(i){let t="";for(const n of cr)t+=`/${Cs(i[n])}`;return t}function yo(i){const t=i.value;return t?[new Vt(i.key,t,"constants have been deprecated as of v8")]:[]}function _i(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Cr(i){if(Array.isArray(i))return i.map(Cr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=Cr(i[n]);return t}return _i(i)}function mn(i){const t=i.key,n=i.value,o=i.valueSpec||{},h=i.objectElementValidators||{},p=i.style,f=i.styleSpec,g=i.validateSpec;let v=[];const P=ei(n);if(P!=="object")return[new Vt(t,n,`object expected, ${P} found`)];for(const C in n){const z=C.split(".")[0],R=o[z]||o["*"];let O;if(h[z])O=h[z];else if(o[z])O=g;else if(h["*"])O=h["*"];else{if(!o["*"]){v.push(new Vt(t,n[C],`unknown property "${C}"`));continue}O=g}v=v.concat(O({key:(t&&`${t}.`)+C,value:n[C],valueSpec:R,style:p,styleSpec:f,object:n,objectKey:C,validateSpec:g},n))}for(const C in o)h[C]||o[C].required&&o[C].default===void 0&&n[C]===void 0&&v.push(new Vt(t,n,`missing required property "${C}"`));return v}function Jo(i){const t=i.value,n=i.valueSpec,o=i.style,h=i.styleSpec,p=i.key,f=i.arrayElementValidator||i.validateSpec;if(ei(t)!=="array")return[new Vt(p,t,`array expected, ${ei(t)} found`)];if(n.length&&t.length!==n.length)return[new Vt(p,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Vt(p,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let g={type:n.value,values:n.values};h.$version<7&&(g.function=n.function),ei(n.value)==="object"&&(g=n.value);let v=[];for(let P=0;P<t.length;P++)v=v.concat(f({array:t,arrayIndex:P,value:t[P],valueSpec:g,validateSpec:i.validateSpec,style:o,styleSpec:h,key:`${p}[${P}]`}));return v}function mr(i){const t=i.key,n=i.value,o=i.valueSpec;let h=ei(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Vt(t,n,`number expected, ${h} found`)]:"minimum"in o&&n<o.minimum?[new Vt(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Vt(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Gs(i){const t=i.valueSpec,n=_i(i.value.type);let o,h,p,f={};const g=n!=="categorical"&&i.value.property===void 0,v=!g,P=ei(i.value.stops)==="array"&&ei(i.value.stops[0])==="array"&&ei(i.value.stops[0][0])==="object",C=mn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(n==="identity")return[new Vt(O.key,O.value,'identity function may not have a "stops" property')];let U=[];const K=O.value;return U=U.concat(Jo({key:O.key,value:K,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:z})),ei(K)==="array"&&K.length===0&&U.push(new Vt(O.key,K,"array must have at least one stop")),U},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return n==="identity"&&g&&C.push(new Vt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||C.push(new Vt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!qs(i.valueSpec)&&C.push(new Vt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!es(i.valueSpec)?C.push(new Vt(i.key,i.value,"property functions not supported")):g&&!Lo(i.valueSpec)&&C.push(new Vt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!P||i.value.property!==void 0||C.push(new Vt(i.key,i.value,'"property" property is required')),C;function z(O){let U=[];const K=O.value,H=O.key;if(ei(K)!=="array")return[new Vt(H,K,`array expected, ${ei(K)} found`)];if(K.length!==2)return[new Vt(H,K,`array length 2 expected, length ${K.length} found`)];if(P){if(ei(K[0])!=="object")return[new Vt(H,K,`object expected, ${ei(K[0])} found`)];if(K[0].zoom===void 0)return[new Vt(H,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Vt(H,K,"object stop key must have value")];if(p&&p>_i(K[0].zoom))return[new Vt(H,K[0].zoom,"stop zoom values must appear in ascending order")];_i(K[0].zoom)!==p&&(p=_i(K[0].zoom),h=void 0,f={}),U=U.concat(mn({key:`${H}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:mr,value:R}}))}else U=U.concat(R({key:`${H}[0]`,value:K[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},K));return Et(Cr(K[1]))?U.concat([new Vt(`${H}[1]`,K[1],"expressions are not allowed in function stops.")]):U.concat(O.validateSpec({key:`${H}[1]`,value:K[1],valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function R(O,U){const K=ei(O.value),H=_i(O.value),ct=O.value!==null?O.value:U;if(o){if(K!==o)return[new Vt(O.key,ct,`${K} stop domain type must match previous stop domain type ${o}`)]}else o=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new Vt(O.key,ct,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&n!=="categorical"){let dt=`number expected, ${K} found`;return es(t)&&n===void 0&&(dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Vt(O.key,ct,dt)]}return n!=="categorical"||K!=="number"||isFinite(H)&&Math.floor(H)===H?n!=="categorical"&&K==="number"&&h!==void 0&&H<h?[new Vt(O.key,ct,"stop domain values must appear in ascending order")]:(h=H,n==="categorical"&&H in f?[new Vt(O.key,ct,"stop domain values must be unique")]:(f[H]=!0,[])):[new Vt(O.key,ct,`integer expected, found ${H}`)]}}function Zr(i){const t=(i.expressionContext==="property"?Ge:Lt)(Cr(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Vt(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Vt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Ss(n))return[new Vt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Ss(n))return[new Vt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!De(n,["zoom","feature-state"]))return[new Vt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Nr(n))return[new Vt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(i){const t=i.key,n=i.value,o=i.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(_i(n))===-1&&h.push(new Vt(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(_i(n))===-1&&h.push(new Vt(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function vo(i){return Qn(Cr(i.value))?Zr($n({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qr(i)}function qr(i){const t=i.value,n=i.key;if(ei(t)!=="array")return[new Vt(n,t,`array expected, ${ei(t)} found`)];const o=i.styleSpec;let h,p=[];if(t.length<1)return[new Vt(n,t,"filter array must have at least 1 element")];switch(p=p.concat(Hs({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),_i(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&_i(t[1])==="$type"&&p.push(new Vt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Vt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=ei(t[1]),h!=="string"&&p.push(new Vt(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let f=2;f<t.length;f++)h=ei(t[f]),_i(t[1])==="$type"?p=p.concat(Hs({key:`${n}[${f}]`,value:t[f],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new Vt(`${n}[${f}]`,t[f],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)p=p.concat(qr({key:`${n}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=ei(t[1]),t.length!==2?p.push(new Vt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new Vt(`${n}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=ei(t[1]),t.length!==2?p.push(new Vt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new Vt(`${n}[1]`,t[1],`object expected, ${h} found`))}return p}function _a(i,t){const n=i.key,o=i.validateSpec,h=i.style,p=i.styleSpec,f=i.value,g=i.objectKey,v=p[`${t}_${i.layerType}`];if(!v)return[];const P=g.match(/^(.*)-transition$/);if(t==="paint"&&P&&v[P[1]]&&v[P[1]].transition)return o({key:n,value:f,valueSpec:p.transition,style:h,styleSpec:p});const C=i.valueSpec||v[g];if(!C)return[new Vt(n,f,`unknown property "${g}"`)];let z;if(ei(f)==="string"&&es(C)&&!C.tokens&&(z=/^{([^}]+)}$/.exec(f)))return[new Vt(n,f,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const R=[];return i.layerType==="symbol"&&(g==="text-field"&&h&&!h.glyphs&&R.push(new Vt(n,f,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&js(Cr(f))&&_i(f.type)==="identity"&&R.push(new Vt(n,f,'"text-font" does not support identity functions'))),R.concat(o({key:i.key,value:f,valueSpec:C,style:h,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:g}))}function Is(i){return _a(i,"paint")}function Ia(i){return _a(i,"layout")}function _r(i){let t=[];const n=i.value,o=i.key,h=i.style,p=i.styleSpec;n.type||n.ref||t.push(new Vt(o,n,'either "type" or "ref" is required'));let f=_i(n.type);const g=_i(n.ref);if(n.id){const v=_i(n.id);for(let P=0;P<i.arrayIndex;P++){const C=h.layers[P];_i(C.id)===v&&t.push(new Vt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${C.id.__line__}`))}}if("ref"in n){let v;["type","source","source-layer","filter","layout"].forEach(P=>{P in n&&t.push(new Vt(o,n[P],`"${P}" is prohibited for ref layers`))}),h.layers.forEach(P=>{_i(P.id)===g&&(v=P)}),v?v.ref?t.push(new Vt(o,n.ref,"ref cannot reference another ref layer")):f=_i(v.type):t.push(new Vt(o,n.ref,`ref layer "${g}" not found`))}else if(f!=="background")if(n.source){const v=h.sources&&h.sources[n.source],P=v&&_i(v.type);v?P==="vector"&&f==="raster"?t.push(new Vt(o,n.source,`layer "${n.id}" requires a raster source`)):P==="raster"&&f!=="raster"?t.push(new Vt(o,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&f!=="hillshade"?t.push(new Vt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&v.lineMetrics||t.push(new Vt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Vt(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Vt(o,n.source,`source "${n.source}" not found`))}else t.push(new Vt(o,n,'missing required property "source"'));return t=t.concat(mn({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:vo,layout:v=>mn({layer:n,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":P=>Ia($n({layerType:f},P))}}),paint:v=>mn({layer:n,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":P=>Is($n({layerType:f},P))}})}})),t}function tr(i){const t=i.value,n=i.key,o=ei(t);return o!=="string"?[new Vt(n,t,`string expected, ${o} found`)]:[]}const Do={promoteId:function({key:i,value:t}){if(ei(t)==="string")return tr({key:i,value:t});{const n=[];for(const o in t)n.push(...tr({key:`${i}.${o}`,value:t[o]}));return n}}};function xo(i){const t=i.value,n=i.key,o=i.styleSpec,h=i.style,p=i.validateSpec;if(!t.type)return[new Vt(n,t,'"type" is required')];const f=_i(t.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=mn({key:n,value:t,valueSpec:o[`source_${f.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Do,validateSpec:p}),g;case"geojson":if(g=mn({key:n,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:p,objectElementValidators:Do}),t.cluster)for(const v in t.clusterProperties){const[P,C]=t.clusterProperties[v],z=typeof P=="string"?[P,["accumulated"],["get",v]]:P;g.push(...Zr({key:`${n}.${v}.map`,value:C,validateSpec:p,expressionContext:"cluster-map"})),g.push(...Zr({key:`${n}.${v}.reduce`,value:z,validateSpec:p,expressionContext:"cluster-reduce"}))}return g;case"video":return mn({key:n,value:t,valueSpec:o.source_video,style:h,validateSpec:p,styleSpec:o});case"image":return mn({key:n,value:t,valueSpec:o.source_image,style:h,validateSpec:p,styleSpec:o});case"canvas":return[new Vt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hs({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:p,styleSpec:o})}}function Ro(i){const t=i.value,n=i.styleSpec,o=n.light,h=i.style;let p=[];const f=ei(t);if(t===void 0)return p;if(f!=="object")return p=p.concat([new Vt("light",t,`object expected, ${f} found`)]),p;for(const g in t){const v=g.match(/^(.*)-transition$/);p=p.concat(v&&o[v[1]]&&o[v[1]].transition?i.validateSpec({key:g,value:t[g],valueSpec:n.transition,validateSpec:i.validateSpec,style:h,styleSpec:n}):o[g]?i.validateSpec({key:g,value:t[g],valueSpec:o[g],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Vt(g,t[g],`unknown property "${g}"`)])}return p}function Ws(i){const t=i.value,n=i.styleSpec,o=n.terrain,h=i.style;let p=[];const f=ei(t);if(t===void 0)return p;if(f!=="object")return p=p.concat([new Vt("terrain",t,`object expected, ${f} found`)]),p;for(const g in t)p=p.concat(o[g]?i.validateSpec({key:g,value:t[g],valueSpec:o[g],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Vt(g,t[g],`unknown property "${g}"`)]);return p}function Bo(i){let t=[];const n=i.value,o=i.key;if(Array.isArray(n)){const h=[],p=[];for(const f in n)n[f].id&&h.includes(n[f].id)&&t.push(new Vt(o,n,`all the sprites' ids must be unique, but ${n[f].id} is duplicated`)),h.push(n[f].id),n[f].url&&p.includes(n[f].url)&&t.push(new Vt(o,n,`all the sprites' URLs must be unique, but ${n[f].url} is duplicated`)),p.push(n[f].url),t=t.concat(mn({key:`${o}[${f}]`,value:n[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return tr({key:o,value:n})}const Xs={"*":()=>[],array:Jo,boolean:function(i){const t=i.value,n=i.key,o=ei(t);return o!=="boolean"?[new Vt(n,t,`boolean expected, ${o} found`)]:[]},number:mr,color:function(i){const t=i.key,n=i.value,o=ei(n);return o!=="string"?[new Vt(t,n,`color expected, ${o} found`)]:Te.parse(String(n))?[]:[new Vt(t,n,`color expected, "${n}" found`)]},constants:yo,enum:Hs,filter:vo,function:Gs,layer:_r,object:mn,source:xo,light:Ro,terrain:Ws,string:tr,formatted:function(i){return tr(i).length===0?[]:Zr(i)},resolvedImage:function(i){return tr(i).length===0?[]:Zr(i)},padding:function(i){const t=i.key,n=i.value;if(ei(n)==="array"){if(n.length<1||n.length>4)return[new Vt(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let h=[];for(let p=0;p<n.length;p++)h=h.concat(i.validateSpec({key:`${t}[${p}]`,value:n[p],validateSpec:i.validateSpec,valueSpec:o}));return h}return mr({key:t,value:n,valueSpec:{}})},sprite:Bo};function ks(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=ks,n.expression&&js(_i(t))?Gs(i):n.expression&&Et(Cr(t))?Zr(i):n.type&&Xs[n.type]?Xs[n.type](i):mn($n({},i,{valueSpec:n.type?o[n.type]:n}))}function Yo(i){const t=i.value,n=i.key,o=tr(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Vt(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Vt(n,t,'"glyphs" url must include a "{range}" token'))),o}function Ir(i,t=Pt){let n=[];return n=n.concat(ks({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ks,objectElementValidators:{glyphs:Yo,"*":()=>[]}})),i.constants&&(n=n.concat(yo({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:ks}))),As(n)}function gr(i){return function(t){return i({...t,validateSpec:ks})}}function As(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Wi(i){return function(...t){return As(i.apply(this,t))}}Ir.source=Wi(gr(xo)),Ir.sprite=Wi(gr(Bo)),Ir.glyphs=Wi(gr(Yo)),Ir.light=Wi(gr(Ro)),Ir.terrain=Wi(gr(Ws)),Ir.layer=Wi(gr(_r)),Ir.filter=Wi(gr(vo)),Ir.paintProperty=Wi(gr(Is)),Ir.layoutProperty=Wi(gr(Ia));const ns=Ir,Ha=ns.light,ka=ns.paintProperty,Wa=ns.layoutProperty;function Ln(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new Bi(new Error(o.message))),n=!0;return n}class Ms{constructor(t,n,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(n=f[1])+2*(o=f[2]);for(let v=0;v<this.d*this.d;v++){const P=f[3+v],C=f[3+v+1];h.push(P===C?null:f.subarray(P,C))}const g=f[3+h.length+1];this.keys=f.subarray(f[3+h.length],g),this.bboxes=f.subarray(g),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let f=0;f<this.d*this.d;f++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const p=o/n*t;this.min=-p,this.max=t+p}insert(t,n,o,h,p){this._forEachCell(n,o,h,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,h,p,f){this.cells[p].push(f)}query(t,n,o,h,p){const f=this.min,g=this.max;if(t<=f&&n<=f&&g<=o&&g<=h&&!p)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(t,n,o,h,this._queryCell,v,{},p),v}}_queryCell(t,n,o,h,p,f,g,v){const P=this.cells[p];if(P!==null){const C=this.keys,z=this.bboxes;for(let R=0;R<P.length;R++){const O=P[R];if(g[O]===void 0){const U=4*O;(v?v(z[U+0],z[U+1],z[U+2],z[U+3]):t<=z[U+2]&&n<=z[U+3]&&o>=z[U+0]&&h>=z[U+1])?(g[O]=!0,f.push(C[O])):g[O]=!1}}}}_forEachCell(t,n,o,h,p,f,g,v){const P=this._convertToCellCoord(t),C=this._convertToCellCoord(n),z=this._convertToCellCoord(o),R=this._convertToCellCoord(h);for(let O=P;O<=z;O++)for(let U=C;U<=R;U++){const K=this.d*U+O;if((!v||v(this._convertFromCellCoord(O),this._convertFromCellCoord(U),this._convertFromCellCoord(O+1),this._convertFromCellCoord(U+1)))&&p.call(this,t,n,o,h,K,f,g,v))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let f=0;f<this.cells.length;f++)o+=this.cells[f].length;const h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let p=n;for(let f=0;f<t.length;f++){const g=t[f];h[3+f]=p,h.set(g,p),p+=g.length}return h[3+t.length]=p,h.set(this.keys,p),p+=this.keys.length,h[3+t.length+1]=p,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Ms(t.buffer)}}const jr={};function ee(i,t,n={}){if(jr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),jr[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}ee("Object",Object),ee("TransferableGridIndex",Ms),ee("Color",Te),ee("Error",Error),ee("AJAXError",mi),ee("ResolvedImage",Rn),ee("StylePropertyFunction",xe),ee("StyleExpression",et,{omit:["_evaluator"]}),ee("ZoomDependentExpression",qt),ee("ZoomConstantExpression",he),ee("CompoundExpression",an,{omit:["_evaluate"]});for(const i in Es)Es[i]._classRegistryKey||ee(`Expression_${i}`,Es[i]);function Qo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function bo(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Qo(i)||Ye(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return t&&t.push(n.buffer),n}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(bo(o,t));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!jr[o])throw new Error(`${o} is not registered.`);const h=n.serialize?n.serialize(i,t):{};if(n.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||jr[o].omit.indexOf(p)>=0)continue;const f=i[p];h[p]=jr[o].shallow.indexOf(p)>=0?f:bo(f,t)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(h.$name=o),h}throw new Error("can't serialize object of type "+typeof i)}function rs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Qo(i)||Ye(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(rs);if(typeof i=="object"){const t=i.$name||"Object";if(!jr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=jr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const p=i[h];o[h]=jr[t].shallow.indexOf(h)>=0?p:rs(p)}return o}throw new Error("can't deserialize object of type "+typeof i)}class wo{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Kt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function ss(i){for(const t of i)if(ea(t.charCodeAt(0)))return!0;return!1}function ta(i){for(const t of i)if(!ga(t.charCodeAt(0)))return!1;return!0}function ga(i){return!(Kt.Arabic(i)||Kt["Arabic Supplement"](i)||Kt["Arabic Extended-A"](i)||Kt["Arabic Presentation Forms-A"](i)||Kt["Arabic Presentation Forms-B"](i))}function ea(i){return!(i!==746&&i!==747&&(i<4352||!(Kt["Bopomofo Extended"](i)||Kt.Bopomofo(i)||Kt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Kt["CJK Compatibility Ideographs"](i)||Kt["CJK Compatibility"](i)||Kt["CJK Radicals Supplement"](i)||Kt["CJK Strokes"](i)||!(!Kt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Kt["CJK Unified Ideographs Extension A"](i)||Kt["CJK Unified Ideographs"](i)||Kt["Enclosed CJK Letters and Months"](i)||Kt["Hangul Compatibility Jamo"](i)||Kt["Hangul Jamo Extended-A"](i)||Kt["Hangul Jamo Extended-B"](i)||Kt["Hangul Jamo"](i)||Kt["Hangul Syllables"](i)||Kt.Hiragana(i)||Kt["Ideographic Description Characters"](i)||Kt.Kanbun(i)||Kt["Kangxi Radicals"](i)||Kt["Katakana Phonetic Extensions"](i)||Kt.Katakana(i)&&i!==12540||!(!Kt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Kt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Kt["Unified Canadian Aboriginal Syllabics"](i)||Kt["Unified Canadian Aboriginal Syllabics Extended"](i)||Kt["Vertical Forms"](i)||Kt["Yijing Hexagram Symbols"](i)||Kt["Yi Syllables"](i)||Kt["Yi Radicals"](i))))}function $r(i){return!(ea(i)||function(t){return!!(Kt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Kt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Kt["Letterlike Symbols"](t)||Kt["Number Forms"](t)||Kt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Kt["Control Pictures"](t)&&t!==9251||Kt["Optical Character Recognition"](t)||Kt["Enclosed Alphanumerics"](t)||Kt["Geometric Shapes"](t)||Kt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Kt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Kt["CJK Symbols and Punctuation"](t)||Kt.Katakana(t)||Kt["Private Use Area"](t)||Kt["CJK Compatibility Forms"](t)||Kt["Small Form Variants"](t)||Kt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Oo(i){return i>=1424&&i<=2303||Kt["Arabic Presentation Forms-A"](i)||Kt["Arabic Presentation Forms-B"](i)}function Fo(i,t){return!(!t&&Oo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Kt.Khmer(i))}function To(i){for(const t of i)if(Oo(t.charCodeAt(0)))return!0;return!1}const ya="deferred",Ks="loading",Js="loaded";let So=null,zn="unavailable",Ls=null;const va=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(zn="error"),So&&So(i)};function ia(){No.fire(new qn("pluginStateChange",{pluginStatus:zn,pluginURL:Ls}))}const No=new wr,na=function(){return zn},xa=function(){if(zn!==ya||!Ls)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zn=Ks,ia(),Ls&&vn({url:Ls},i=>{i?va(i):(zn=Js,ia())})},yr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>zn===Js||yr.applyArabicShaping!=null,isLoading:()=>zn===Ks,setState(i){if(!Qi())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");zn=i.pluginStatus,Ls=i.pluginURL},isParsed(){if(!Qi())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return yr.applyArabicShaping!=null&&yr.processBidirectionalText!=null&&yr.processStyledBidirectionalText!=null},getPluginURL(){if(!Qi())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ls}};class wi{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wo,this.transition={})}isSupportedScript(t){return function(n,o){for(const h of n)if(!Fo(h.charCodeAt(0),o))return!1;return!0}(t,yr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Uo{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,h){if(js(o))return new xe(o,h);if(Et(o)){const p=Ge(o,h);if(p.result==="error")throw new Error(p.value.map(f=>`${f.key}: ${f.message}`).join(", "));return p.value}{let p=o;return h.type==="color"&&typeof o=="string"?p=Te.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(p=In.parse(o)),{kind:"constant",evaluate:()=>p}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class ba{constructor(t){this.property=t,this.value=new Uo(t,void 0)}transitioned(t,n){return new l(this.property,this.value,n,be({},t.transition,this.transition),t.now)}untransitioned(){return new l(this.property,this.value,null,{},0)}}class r{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return hi(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ba(this._values[t].property)),this._values[t].value=new Uo(this._values[t].property,n===null?void 0:hi(n))}getTransition(t){return hi(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ba(this._values[t].property)),this._values[t].transition=hi(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const o=new _(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,n._values[h]);return o}untransitioned(){const t=new _(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class l{constructor(t,n,o,h,p){this.property=t,this.value=n,this.begin=p+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const h=t.now||0,p=this.value.possiblyEvaluate(t,n,o),f=this.prior;if(f){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return f.possiblyEvaluate(t,n,o);{const g=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,n,o),p,function(v){if(v<=0)return 0;if(v>=1)return 1;const P=v*v,C=P*v;return 4*(v<.5?C:3*(v-P)+C-.75)}(g))}}return p}}class _{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const h=new N(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,n,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class x{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return hi(this._values[t].value)}setValue(t,n){this._values[t]=new Uo(this._values[t].property,n===null?void 0:hi(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const h=new N(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(t,n,o);return h}}class E{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,h){return this.property.evaluate(this.value,this.parameters,t,n,o,h)}}class N{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ${constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const h=dn[this.specification.type];return h?h(t,n,o):t}}class at{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,h){return new E(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,h)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new E(this,{kind:"constant",value:void 0},t.parameters);const h=dn[this.specification.type];if(h){const p=h(t.value.value,n.value.value,o);return new E(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,n,o,h,p,f){return t.kind==="constant"?t.value:t.evaluate(n,o,h,p,f)}}class Tt extends at{possiblyEvaluate(t,n,o,h){if(t.value===void 0)return new E(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,h),f=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,g=this._calculate(f,f,f,n);return new E(this,{kind:"constant",value:g},n)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new E(this,{kind:"constant",value:p},n)}return new E(this,t.expression,n)}evaluate(t,n,o,h,p,f){if(t.kind==="source"){const g=t.evaluate(n,o,h,p,f);return this._calculate(g,g,g,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,h),t.evaluate({zoom:Math.floor(n.zoom)},o,h),t.evaluate({zoom:Math.floor(n.zoom)+1},o,h),n):t.value}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Dt{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,h);return this._calculate(p,p,p,n)}return this._calculate(t.expression.evaluate(new wi(Math.floor(n.zoom-1),n)),t.expression.evaluate(new wi(Math.floor(n.zoom),n)),t.expression.evaluate(new wi(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class oe{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){return!!t.expression.evaluate(n,null,{},o,h)}interpolate(){return!1}}class me{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new Uo(o,void 0),p=this.defaultTransitionablePropertyValues[n]=new ba(o);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}ee("DataDrivenProperty",at),ee("DataConstantProperty",$),ee("CrossFadedDataDrivenProperty",Tt),ee("CrossFadedProperty",Dt),ee("ColorRampProperty",oe);const je="-transition";class Mi extends wr{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new x(n.layout)),n.paint)){this._transitionablePaint=new r(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new N(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Wa,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(je)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(ka,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(je))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[t],p=h.property.specification["property-type"]==="cross-faded-data-driven",f=h.value.isDataDriven(),g=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value;return v.isDataDriven()||f||p||this._handleOverridablePaintPropertyUpdate(t,g,v)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Yi(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,h,p={}){return(!p||p.validate!==!1)&&Ln(this,t.call(ns,{key:n,layerType:this.type,objectKey:o,value:h,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof E&&es(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const ln={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xi{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Je{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ei(i,t=1){let n=0,o=0;return{members:i.map(h=>{const p=ln[h.type].BYTES_PER_ELEMENT,f=n=Aa(n,Math.max(t,p)),g=h.components||1;return o=Math.max(o,p),n+=p*g,{name:h.name,type:h.type,components:g,offset:f}}),size:Aa(n,Math.max(o,t)),alignment:t}}function Aa(i,t){return Math.ceil(i/t)*t}class Po extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=o,t}}Po.prototype.bytesPerElement=4,ee("StructArrayLayout2i4",Po);class ra extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const p=3*t;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=h,t}}ra.prototype.bytesPerElement=6,ee("StructArrayLayout3i6",ra);class sa extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,h)}emplace(t,n,o,h,p){const f=4*t;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=h,this.int16[f+3]=p,t}}sa.prototype.bytesPerElement=8,ee("StructArrayLayout4i8",sa);class Gr extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h,p,f)}emplace(t,n,o,h,p,f,g){const v=6*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=g,t}}Gr.prototype.bytesPerElement=12,ee("StructArrayLayout2i4i12",Gr);class Vo extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h,p,f)}emplace(t,n,o,h,p,f,g){const v=4*t,P=8*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.uint8[P+4]=h,this.uint8[P+5]=p,this.uint8[P+6]=f,this.uint8[P+7]=g,t}}Vo.prototype.bytesPerElement=8,ee("StructArrayLayout2i4ub8",Vo);class Ti extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=o,t}}Ti.prototype.bytesPerElement=8,ee("StructArrayLayout2f8",Ti);class Ys extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f,g,v,P,C){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,h,p,f,g,v,P,C)}emplace(t,n,o,h,p,f,g,v,P,C,z){const R=10*t;return this.uint16[R+0]=n,this.uint16[R+1]=o,this.uint16[R+2]=h,this.uint16[R+3]=p,this.uint16[R+4]=f,this.uint16[R+5]=g,this.uint16[R+6]=v,this.uint16[R+7]=P,this.uint16[R+8]=C,this.uint16[R+9]=z,t}}Ys.prototype.bytesPerElement=20,ee("StructArrayLayout10ui20",Ys);class Zo extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f,g,v,P,C,z,R){const O=this.length;return this.resize(O+1),this.emplace(O,t,n,o,h,p,f,g,v,P,C,z,R)}emplace(t,n,o,h,p,f,g,v,P,C,z,R,O){const U=12*t;return this.int16[U+0]=n,this.int16[U+1]=o,this.int16[U+2]=h,this.int16[U+3]=p,this.uint16[U+4]=f,this.uint16[U+5]=g,this.uint16[U+6]=v,this.uint16[U+7]=P,this.int16[U+8]=C,this.int16[U+9]=z,this.int16[U+10]=R,this.int16[U+11]=O,t}}Zo.prototype.bytesPerElement=24,ee("StructArrayLayout4i4ui4i24",Zo);class wa extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const p=3*t;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=h,t}}wa.prototype.bytesPerElement=12,ee("StructArrayLayout3f12",wa);class Eo extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Eo.prototype.bytesPerElement=4,ee("StructArrayLayout1ul4",Eo);class os extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f,g,v,P){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,o,h,p,f,g,v,P)}emplace(t,n,o,h,p,f,g,v,P,C){const z=10*t,R=5*t;return this.int16[z+0]=n,this.int16[z+1]=o,this.int16[z+2]=h,this.int16[z+3]=p,this.int16[z+4]=f,this.int16[z+5]=g,this.uint32[R+3]=v,this.uint16[z+8]=P,this.uint16[z+9]=C,t}}os.prototype.bytesPerElement=20,ee("StructArrayLayout6i1ul2ui20",os);class oa extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h,p,f)}emplace(t,n,o,h,p,f,g){const v=6*t;return this.int16[v+0]=n,this.int16[v+1]=o,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=g,t}}oa.prototype.bytesPerElement=12,ee("StructArrayLayout2i2i2i12",oa);class aa extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o,h,p)}emplace(t,n,o,h,p,f){const g=4*t,v=8*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,this.int16[v+6]=p,this.int16[v+7]=f,t}}aa.prototype.bytesPerElement=16,ee("StructArrayLayout2f1f2i16",aa);class qo extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,h)}emplace(t,n,o,h,p){const f=12*t,g=3*t;return this.uint8[f+0]=n,this.uint8[f+1]=o,this.float32[g+1]=h,this.float32[g+2]=p,t}}qo.prototype.bytesPerElement=12,ee("StructArrayLayout2ub2f12",qo);class Ma extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const p=3*t;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=h,t}}Ma.prototype.bytesPerElement=6,ee("StructArrayLayout3ui6",Ma);class Xa extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct){const dt=this.length;return this.resize(dt+1),this.emplace(dt,t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct)}emplace(t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct,dt){const ot=24*t,_t=12*t,xt=48*t;return this.int16[ot+0]=n,this.int16[ot+1]=o,this.uint16[ot+2]=h,this.uint16[ot+3]=p,this.uint32[_t+2]=f,this.uint32[_t+3]=g,this.uint32[_t+4]=v,this.uint16[ot+10]=P,this.uint16[ot+11]=C,this.uint16[ot+12]=z,this.float32[_t+7]=R,this.float32[_t+8]=O,this.uint8[xt+36]=U,this.uint8[xt+37]=K,this.uint8[xt+38]=H,this.uint32[_t+10]=ct,this.int16[ot+22]=dt,t}}Xa.prototype.bytesPerElement=48,ee("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xa);class La extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct,dt,ot,_t,xt,Ct,se,ue,Yt,Xt,$t,Qt){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct,dt,ot,_t,xt,Ct,se,ue,Yt,Xt,$t,Qt)}emplace(t,n,o,h,p,f,g,v,P,C,z,R,O,U,K,H,ct,dt,ot,_t,xt,Ct,se,ue,Yt,Xt,$t,Qt,Jt){const Bt=34*t,ye=17*t;return this.int16[Bt+0]=n,this.int16[Bt+1]=o,this.int16[Bt+2]=h,this.int16[Bt+3]=p,this.int16[Bt+4]=f,this.int16[Bt+5]=g,this.int16[Bt+6]=v,this.int16[Bt+7]=P,this.uint16[Bt+8]=C,this.uint16[Bt+9]=z,this.uint16[Bt+10]=R,this.uint16[Bt+11]=O,this.uint16[Bt+12]=U,this.uint16[Bt+13]=K,this.uint16[Bt+14]=H,this.uint16[Bt+15]=ct,this.uint16[Bt+16]=dt,this.uint16[Bt+17]=ot,this.uint16[Bt+18]=_t,this.uint16[Bt+19]=xt,this.uint16[Bt+20]=Ct,this.uint16[Bt+21]=se,this.uint16[Bt+22]=ue,this.uint32[ye+12]=Yt,this.float32[ye+13]=Xt,this.float32[ye+14]=$t,this.float32[ye+15]=Qt,this.float32[ye+16]=Jt,t}}La.prototype.bytesPerElement=68,ee("StructArrayLayout8i15ui1ul4f68",La);class za extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}za.prototype.bytesPerElement=4,ee("StructArrayLayout1f4",za);class Da extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const p=4*t;return this.uint32[2*t+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=h,t}}Da.prototype.bytesPerElement=8,ee("StructArrayLayout1ul2ui8",Da);class c extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=o,t}}c.prototype.bytesPerElement=4,ee("StructArrayLayout2ui4",c);class e extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}e.prototype.bytesPerElement=2,ee("StructArrayLayout1ui2",e);class s extends Je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,h)}emplace(t,n,o,h,p){const f=4*t;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=h,this.float32[f+3]=p,t}}s.prototype.bytesPerElement=16,ee("StructArrayLayout4f16",s);class a extends Xi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new At(this.anchorPointX,this.anchorPointY)}}a.prototype.size=20;class u extends os{get(t){return new a(this,t)}}ee("CollisionBoxArray",u);class m extends Xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}m.prototype.size=48;class y extends Xa{get(t){return new m(this,t)}}ee("PlacedSymbolArray",y);class T extends Xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}T.prototype.size=68;class b extends La{get(t){return new T(this,t)}}ee("SymbolInstanceArray",b);class S extends za{getoffsetX(t){return this.float32[1*t+0]}}ee("GlyphOffsetArray",S);class A extends ra{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ee("SymbolLineVertexArray",A);class k extends Xi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}k.prototype.size=8;class F extends Da{get(t){return new k(this,t)}}ee("FeatureIndexArray",F);class W extends Po{}class j extends Po{}class G extends Po{}class tt extends Gr{}class lt extends Vo{}class gt extends Ti{}class Y extends Ys{}class mt extends Zo{}class St extends wa{}class Mt extends Eo{}class Rt extends oa{}class Ut extends qo{}class zt extends Ma{}class te extends c{}const ge=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:Re}=ge;class Wt{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,h){let p=this.segments[this.segments.length-1];return t>Wt.MAX_VERTEX_ARRAY_LENGTH&&gi(`Max vertices per segment is ${Wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>Wt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,h){return new Wt([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function Ce(i,t){return 256*(i=Ft(Math.floor(i),0,255))+Ft(Math.floor(t),0,255)}Wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ee("SegmentVector",Wt);const ne=Ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ri={exports:{}},rn={exports:{}};rn.exports=function(i,t){var n,o,h,p,f,g,v,P;for(o=i.length-(n=3&i.length),h=t,f=3432918353,g=461845907,P=0;P<o;)v=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,h=27492+(65535&(p=5*(65535&(h=(h^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,n){case 3:v^=(255&i.charCodeAt(P+2))<<16;case 2:v^=(255&i.charCodeAt(P+1))<<8;case 1:h^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(P)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var si=rn.exports,Oe={exports:{}};Oe.exports=function(i,t){for(var n,o=i.length,h=t^o,p=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++p;switch(o){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Ki=si,er=Oe.exports;ri.exports=Ki,ri.exports.murmur3=Ki,ri.exports.murmur2=er;var sn=Ot(ri.exports);class bn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,h){this.ids.push(kr(t)),this.positions.push(n,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=kr(t);let o=0,h=this.ids.length-1;for(;o<h;){const f=o+h>>1;this.ids[f]>=n?h=f:o=f+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,n){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return as(o,h,0,o.length-1),n&&n.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const n=new bn;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function kr(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:sn(String(i))}function as(i,t,n,o){for(;n<o;){const h=i[n+o>>1];let p=n-1,f=o+1;for(;;){do p++;while(i[p]<h);do f--;while(i[f]>h);if(p>=f)break;ls(i,p,f),ls(t,3*p,3*f),ls(t,3*p+1,3*f+1),ls(t,3*p+2,3*f+2)}f-n<o-f?(as(i,t,n,f),n=f+1):(as(i,t,f+1,o),o=f)}}function ls(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}ee("FeaturePositionMap",bn);class ir{constructor(t,n){this.gl=t.gl,this.location=n}}class zs extends ir{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ta extends ir{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class On extends ir{constructor(t,n){super(t,n),this.current=Te.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const wn=new Float32Array(16);function li(i){return[Ce(255*i.r,255*i.g),Ce(255*i.b,255*i.a)]}class _n{constructor(t,n,o){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new On(t,n):new zs(t,n)}}class Tn{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,h){const p=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Ta(t,n):new zs(t,n)}}class pi{constructor(t,n,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,o,h,p){const f=this.paintVertexArray.length,g=this.expression.evaluate(new wi(0),n,{},h,[],p);this.paintVertexArray.resize(t),this._setPaintValue(f,t,g)}updatePaintArray(t,n,o,h){const p=this.expression.evaluate({zoom:0},o,h);this._setPaintValue(t,n,p)}_setPaintValue(t,n,o){if(this.type==="color"){const h=li(o);for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gn{constructor(t,n,o,h,p,f){this.expression=t,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,n,o,h,p){const f=this.expression.evaluate(new wi(this.zoom),n,{},h,[],p),g=this.expression.evaluate(new wi(this.zoom+1),n,{},h,[],p),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,f,g)}updatePaintArray(t,n,o,h){const p=this.expression.evaluate({zoom:this.zoom},o,h),f=this.expression.evaluate({zoom:this.zoom+1},o,h);this._setPaintValue(t,n,p,f)}_setPaintValue(t,n,o,h){if(this.type==="color"){const p=li(o),f=li(h);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,p[0],p[1],f[0],f[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=Ft(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,o){return new zs(t,n)}}class Ar{constructor(t,n,o,h,p,f){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=h,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,n,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,h,p){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(t,n,o,h){if(!h||!o)return;const{min:p,mid:f,max:g}=o,v=h[p],P=h[f],C=h[g];if(v&&P&&C)for(let z=t;z<n;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],P.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ne.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ne.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ra{constructor(t,n,o){this.binders={},this._buffers=[];const h=[];for(const p in t.paint._values){if(!o(p))continue;const f=t.paint.get(p);if(!(f instanceof E&&es(f.property.specification)))continue;const g=$l(p,t.type),v=f.value,P=f.property.specification.type,C=f.property.useIntegerZoom,z=f.property.specification["property-type"],R=z==="cross-faded"||z==="cross-faded-data-driven";if(v.kind==="constant")this.binders[p]=R?new Tn(v.value,g):new _n(v.value,g,P),h.push(`/u_${p}`);else if(v.kind==="source"||R){const O=gl(p,P,"source");this.binders[p]=R?new Ar(v,P,C,n,O,t.id):new pi(v,g,P,O),h.push(`/a_${p}`)}else{const O=gl(p,P,"composite");this.binders[p]=new gn(v,g,P,C,n,O),h.push(`/z_${p}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof pi||n instanceof gn?n.maxValue:0}populatePaintArrays(t,n,o,h,p){for(const f in this.binders){const g=this.binders[f];(g instanceof pi||g instanceof gn||g instanceof Ar)&&g.populatePaintArray(t,n,o,h,p)}}setConstantPatternPositions(t,n){for(const o in this.binders){const h=this.binders[o];h instanceof Tn&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,h,p){let f=!1;for(const g in t){const v=n.getPositions(g);for(const P of v){const C=o.feature(P.index);for(const z in this.binders){const R=this.binders[z];if((R instanceof pi||R instanceof gn||R instanceof Ar)&&R.expression.isStateDependent===!0){const O=h.paint.get(z);R.expression=O.value,R.updatePaintArray(P.start,P.end,C,t[g],p),f=!0}}}}return f}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof _n||o instanceof Tn)&&t.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof pi||o instanceof gn)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof Ar)for(let h=0;h<ne.members.length;h++)t.push(ne.members[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof _n||o instanceof Tn||o instanceof gn)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof _n||p instanceof Tn||p instanceof gn){for(const f of p.uniformNames)if(n[f]){const g=p.getBinding(t,n[f],f);o.push({name:f,property:h,binding:g})}}}return o}setUniforms(t,n,o,h){for(const{name:p,property:f,binding:g}of n)this.binders[f].setUniform(g,h,o.get(f),p)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Ar){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof pi||o instanceof gn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof pi||o instanceof gn||o instanceof Ar)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof pi||n instanceof gn||n instanceof Ar)&&n.destroy()}}}class Qs{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ra(h,n,o);this.needsUpload=!1,this._featureMap=new bn,this._bufferOffset=0}populatePaintArrays(t,n,o,h,p,f){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,n,h,p,f);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,h){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,n,p,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function $l(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function gl(i,t,n){const o={color:{source:Ti,composite:s},number:{source:za,composite:Ti}},h=function(p){return{"line-pattern":{source:Y,composite:Y},"fill-pattern":{source:Y,composite:Y},"fill-extrusion-pattern":{source:Y,composite:Y}}[p]}(i);return h&&h[n]||o[t][n]}ee("ConstantBinder",_n),ee("CrossFadedConstantBinder",Tn),ee("SourceExpressionBinder",pi),ee("CrossFadedCompositeBinder",Ar),ee("CompositeExpressionBinder",gn),ee("ProgramConfiguration",Ra,{omit:["_buffers"]}),ee("ProgramConfigurationSet",Qs);var Li=8192;const Ka=Math.pow(2,14)-1,Sa=-Ka-1;function to(i){const t=Li/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const h=n[o];for(let p=0;p<h.length;p++){const f=h[p],g=Math.round(f.x*t),v=Math.round(f.y*t);f.x=Ft(g,Sa,Ka),f.y=Ft(v,Sa,Ka),(g<f.x||g>f.x+1||v<f.y||v>f.y+1)&&gi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Pa(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?to(i):[]}}function yl(i,t,n,o,h){i.emplaceBack(2*t+(o+1)/2,2*n+(h+1)/2)}class Gl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new j,this.indexArray=new zt,this.segments=new Wt,this.programConfigurations=new Qs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const h=this.layers[0],p=[];let f=null,g=!1;h.type==="circle"&&(f=h.layout.get("circle-sort-key"),g=!f.isConstant());for(const{feature:v,id:P,index:C,sourceLayerIndex:z}of t){const R=this.layers[0]._featureFilter.needGeometry,O=Pa(v,R);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),O,o))continue;const U=g?f.evaluate(O,{},o):void 0,K={id:P,properties:v.properties,type:v.type,sourceLayerIndex:z,index:C,geometry:R?O.geometry:to(v),patterns:{},sortKey:U};p.push(K)}g&&p.sort((v,P)=>v.sortKey-P.sortKey);for(const v of p){const{geometry:P,index:C,sourceLayerIndex:z}=v,R=t[C].feature;this.addFeature(v,P,C,o),n.featureIndex.insert(R,P,C,z,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Re),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,h){for(const p of n)for(const f of p){const g=f.x,v=f.y;if(g<0||g>=Li||v<0||v>=Li)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=P.vertexLength;yl(this.layoutVertexArray,g,v,-1,-1),yl(this.layoutVertexArray,g,v,1,-1),yl(this.layoutVertexArray,g,v,1,1),yl(this.layoutVertexArray,g,v,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},h)}}function Kc(i,t){for(let n=0;n<i.length;n++)if(Ba(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Ba(i,t[n]))return!0;return!!Hl(i,t)}function qu(i,t,n){return!!Ba(i,t)||!!Wl(t,i,n)}function Jc(i,t){if(i.length===1)return Qc(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let h=0;h<o.length;h++)if(Ba(i,o[h]))return!0}for(let n=0;n<i.length;n++)if(Qc(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Hl(i,t[n]))return!0;return!1}function ju(i,t,n){if(i.length>1){if(Hl(i,t))return!0;for(let o=0;o<t.length;o++)if(Wl(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Wl(i[o],t,n))return!0;return!1}function Hl(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],h=i[n+1];for(let p=0;p<t.length-1;p++)if($u(o,h,t[p],t[p+1]))return!0}return!1}function $u(i,t,n,o){return we(i,n,o)!==we(t,n,o)&&we(i,t,n)!==we(i,t,o)}function Wl(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(Yc(i,t[h-1],t[h])<o)return!0;return!1}function Yc(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const h=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function Qc(i,t){let n,o,h,p=!1;for(let f=0;f<i.length;f++){n=i[f];for(let g=0,v=n.length-1;g<n.length;v=g++)o=n[g],h=n[v],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(p=!p)}return p}function Ba(i,t){let n=!1;for(let o=0,h=i.length-1;o<i.length;h=o++){const p=i[o],f=i[h];p.y>t.y!=f.y>t.y&&t.x<(f.x-p.x)*(t.y-p.y)/(f.y-p.y)+p.x&&(n=!n)}return n}function Gu(i,t,n){const o=n[0],h=n[2];if(i.x<o.x&&t.x<o.x||i.x>h.x&&t.x>h.x||i.y<o.y&&t.y<o.y||i.y>h.y&&t.y>h.y)return!1;const p=we(i,t,n[0]);return p!==we(i,t,n[1])||p!==we(i,t,n[2])||p!==we(i,t,n[3])}function Ja(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function vl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function xl(i,t,n,o,h){if(!t[0]&&!t[1])return i;const p=At.convert(t)._mult(h);n==="viewport"&&p._rotate(-o);const f=[];for(let g=0;g<i.length;g++)f.push(i[g].sub(p));return f}let th,eh;ee("CircleBucket",Gl,{omit:["layers"]});var Hu={get paint(){return eh=eh||new me({"circle-radius":new at(Pt.paint_circle["circle-radius"]),"circle-color":new at(Pt.paint_circle["circle-color"]),"circle-blur":new at(Pt.paint_circle["circle-blur"]),"circle-opacity":new at(Pt.paint_circle["circle-opacity"]),"circle-translate":new $(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new $(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(Pt.paint_circle["circle-stroke-opacity"])})},get layout(){return th=th||new me({"circle-sort-key":new at(Pt.layout_circle["circle-sort-key"])})}},vr=1e-6,Oa=typeof Float32Array<"u"?Float32Array:Array;function Xl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ih(i,t,n){var o=t[0],h=t[1],p=t[2],f=t[3],g=t[4],v=t[5],P=t[6],C=t[7],z=t[8],R=t[9],O=t[10],U=t[11],K=t[12],H=t[13],ct=t[14],dt=t[15],ot=n[0],_t=n[1],xt=n[2],Ct=n[3];return i[0]=ot*o+_t*g+xt*z+Ct*K,i[1]=ot*h+_t*v+xt*R+Ct*H,i[2]=ot*p+_t*P+xt*O+Ct*ct,i[3]=ot*f+_t*C+xt*U+Ct*dt,i[4]=(ot=n[4])*o+(_t=n[5])*g+(xt=n[6])*z+(Ct=n[7])*K,i[5]=ot*h+_t*v+xt*R+Ct*H,i[6]=ot*p+_t*P+xt*O+Ct*ct,i[7]=ot*f+_t*C+xt*U+Ct*dt,i[8]=(ot=n[8])*o+(_t=n[9])*g+(xt=n[10])*z+(Ct=n[11])*K,i[9]=ot*h+_t*v+xt*R+Ct*H,i[10]=ot*p+_t*P+xt*O+Ct*ct,i[11]=ot*f+_t*C+xt*U+Ct*dt,i[12]=(ot=n[12])*o+(_t=n[13])*g+(xt=n[14])*z+(Ct=n[15])*K,i[13]=ot*h+_t*v+xt*R+Ct*H,i[14]=ot*p+_t*P+xt*O+Ct*ct,i[15]=ot*f+_t*C+xt*U+Ct*dt,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ya,Wu=ih;function bl(i,t,n){var o=t[0],h=t[1],p=t[2],f=t[3];return i[0]=n[0]*o+n[4]*h+n[8]*p+n[12]*f,i[1]=n[1]*o+n[5]*h+n[9]*p+n[13]*f,i[2]=n[2]*o+n[6]*h+n[10]*p+n[14]*f,i[3]=n[3]*o+n[7]*h+n[11]*p+n[15]*f,i}function nh(i,t){const n=bl([],[i.x,i.y,0,1],t);return new At(n[0]/n[3],n[1]/n[3])}Ya=new Oa(4),Oa!=Float32Array&&(Ya[0]=0,Ya[1]=0,Ya[2]=0,Ya[3]=0);class rh extends Gl{}let sh;ee("HeatmapBucket",rh,{omit:["layers"]});var Xu={get paint(){return sh=sh||new me({"heatmap-radius":new at(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oe(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $(Pt.paint_heatmap["heatmap-opacity"])})}};function Kl(i,{width:t,height:n},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*o}`)}else h=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=h,i}function oh(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const h=Kl({},{width:t,height:n},o);Jl(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=h.data}function Jl(i,t,n,o,h,p){if(h.width===0||h.height===0)return t;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,g=t.data;if(f===g)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<h.height;v++){const P=((n.y+v)*i.width+n.x)*p,C=((o.y+v)*t.width+o.x)*p;for(let z=0;z<h.width*p;z++)g[C+z]=f[P+z]}return t}class Qa{constructor(t,n){Kl(this,t,1,n)}resize(t){oh(this,t,1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,p){Jl(t,n,o,h,p,1)}}class cs{constructor(t,n){Kl(this,t,4,n)}resize(t){oh(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,p){Jl(t,n,o,h,p,4)}}function ah(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,h=i.image||new cs({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(f,g,v)=>{t[i.evaluationKey]=v;const P=i.expression.evaluate(t);h.data[f+g+0]=Math.floor(255*P.r/P.a),h.data[f+g+1]=Math.floor(255*P.g/P.a),h.data[f+g+2]=Math.floor(255*P.b/P.a),h.data[f+g+3]=Math.floor(255*P.a)};if(i.clips)for(let f=0,g=0;f<o;++f,g+=4*n)for(let v=0,P=0;v<n;v++,P+=4){const C=v/(n-1),{start:z,end:R}=i.clips[f];p(g,P,z*(1-C)+R*C)}else for(let f=0,g=0;f<n;f++,g+=4)p(0,g,f/(n-1));return h}let lh;ee("AlphaImage",Qa),ee("RGBAImage",cs);var Ku={get paint(){return lh=lh||new me({"hillshade-illumination-direction":new $(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $(Pt.paint_hillshade["hillshade-accent-color"])})}};const Ju=Ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yu}=Ju;var Yl={exports:{}};function wl(i,t,n){n=n||2;var o,h,p,f,g,v,P,C=t&&t.length,z=C?t[0]*n:i.length,R=ch(i,0,z,n,!0),O=[];if(!R||R.next===R.prev)return O;if(C&&(R=function(K,H,ct,dt){var ot,_t,xt,Ct=[];for(ot=0,_t=H.length;ot<_t;ot++)(xt=ch(K,H[ot]*dt,ot<_t-1?H[ot+1]*dt:K.length,dt,!1))===xt.next&&(xt.steiner=!0),Ct.push(od(xt));for(Ct.sort(nd),ot=0;ot<Ct.length;ot++)ct=rd(Ct[ot],ct);return ct}(i,t,R,n)),i.length>80*n){o=p=i[0],h=f=i[1];for(var U=n;U<z;U+=n)(g=i[U])<o&&(o=g),(v=i[U+1])<h&&(h=v),g>p&&(p=g),v>f&&(f=v);P=(P=Math.max(p-o,f-h))!==0?32767/P:0}return tl(R,O,n,o,h,P,0),O}function ch(i,t,n,o,h){var p,f;if(h===ec(i,t,n,o)>0)for(p=t;p<n;p+=o)f=dh(p,i[p],i[p+1],f);else for(p=n-o;p>=t;p-=o)f=dh(p,i[p],i[p+1],f);return f&&Tl(f,f.next)&&(il(f),f=f.next),f}function Ea(i,t){if(!i)return i;t||(t=i);var n,o=i;do if(n=!1,o.steiner||!Tl(o,o.next)&&on(o.prev,o,o.next)!==0)o=o.next;else{if(il(o),(o=t=o.prev)===o.next)break;n=!0}while(n||o!==t);return t}function tl(i,t,n,o,h,p,f){if(i){!f&&p&&function(C,z,R,O){var U=C;do U.z===0&&(U.z=Ql(U.x,U.y,z,R,O)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(K){var H,ct,dt,ot,_t,xt,Ct,se,ue=1;do{for(ct=K,K=null,_t=null,xt=0;ct;){for(xt++,dt=ct,Ct=0,H=0;H<ue&&(Ct++,dt=dt.nextZ);H++);for(se=ue;Ct>0||se>0&&dt;)Ct!==0&&(se===0||!dt||ct.z<=dt.z)?(ot=ct,ct=ct.nextZ,Ct--):(ot=dt,dt=dt.nextZ,se--),_t?_t.nextZ=ot:K=ot,ot.prevZ=_t,_t=ot;ct=dt}_t.nextZ=null,ue*=2}while(xt>1)}(U)}(i,o,h,p);for(var g,v,P=i;i.prev!==i.next;)if(g=i.prev,v=i.next,p?td(i,o,h,p):Qu(i))t.push(g.i/n|0),t.push(i.i/n|0),t.push(v.i/n|0),il(i),i=v.next,P=v.next;else if((i=v)===P){f?f===1?tl(i=ed(Ea(i),t,n),t,n,o,h,p,2):f===2&&id(i,t,n,o,h,p):tl(Ea(i),t,n,o,h,p,1);break}}}function Qu(i){var t=i.prev,n=i,o=i.next;if(on(t,n,o)>=0)return!1;for(var h=t.x,p=n.x,f=o.x,g=t.y,v=n.y,P=o.y,C=h<p?h<f?h:f:p<f?p:f,z=g<v?g<P?g:P:v<P?v:P,R=h>p?h>f?h:f:p>f?p:f,O=g>v?g>P?g:P:v>P?v:P,U=o.next;U!==t;){if(U.x>=C&&U.x<=R&&U.y>=z&&U.y<=O&&Fa(h,g,p,v,f,P,U.x,U.y)&&on(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function td(i,t,n,o){var h=i.prev,p=i,f=i.next;if(on(h,p,f)>=0)return!1;for(var g=h.x,v=p.x,P=f.x,C=h.y,z=p.y,R=f.y,O=g<v?g<P?g:P:v<P?v:P,U=C<z?C<R?C:R:z<R?z:R,K=g>v?g>P?g:P:v>P?v:P,H=C>z?C>R?C:R:z>R?z:R,ct=Ql(O,U,t,n,o),dt=Ql(K,H,t,n,o),ot=i.prevZ,_t=i.nextZ;ot&&ot.z>=ct&&_t&&_t.z<=dt;){if(ot.x>=O&&ot.x<=K&&ot.y>=U&&ot.y<=H&&ot!==h&&ot!==f&&Fa(g,C,v,z,P,R,ot.x,ot.y)&&on(ot.prev,ot,ot.next)>=0||(ot=ot.prevZ,_t.x>=O&&_t.x<=K&&_t.y>=U&&_t.y<=H&&_t!==h&&_t!==f&&Fa(g,C,v,z,P,R,_t.x,_t.y)&&on(_t.prev,_t,_t.next)>=0))return!1;_t=_t.nextZ}for(;ot&&ot.z>=ct;){if(ot.x>=O&&ot.x<=K&&ot.y>=U&&ot.y<=H&&ot!==h&&ot!==f&&Fa(g,C,v,z,P,R,ot.x,ot.y)&&on(ot.prev,ot,ot.next)>=0)return!1;ot=ot.prevZ}for(;_t&&_t.z<=dt;){if(_t.x>=O&&_t.x<=K&&_t.y>=U&&_t.y<=H&&_t!==h&&_t!==f&&Fa(g,C,v,z,P,R,_t.x,_t.y)&&on(_t.prev,_t,_t.next)>=0)return!1;_t=_t.nextZ}return!0}function ed(i,t,n){var o=i;do{var h=o.prev,p=o.next.next;!Tl(h,p)&&hh(h,o,o.next,p)&&el(h,p)&&el(p,h)&&(t.push(h.i/n|0),t.push(o.i/n|0),t.push(p.i/n|0),il(o),il(o.next),o=i=p),o=o.next}while(o!==i);return Ea(o)}function id(i,t,n,o,h,p){var f=i;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&ad(f,g)){var v=uh(f,g);return f=Ea(f,f.next),v=Ea(v,v.next),tl(f,t,n,o,h,p,0),void tl(v,t,n,o,h,p,0)}g=g.next}f=f.next}while(f!==i)}function nd(i,t){return i.x-t.x}function rd(i,t){var n=function(h,p){var f,g=p,v=h.x,P=h.y,C=-1/0;do{if(P<=g.y&&P>=g.next.y&&g.next.y!==g.y){var z=g.x+(P-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(z<=v&&z>C&&(C=z,f=g.x<g.next.x?g:g.next,z===v))return f}g=g.next}while(g!==p);if(!f)return null;var R,O=f,U=f.x,K=f.y,H=1/0;g=f;do v>=g.x&&g.x>=U&&v!==g.x&&Fa(P<K?v:C,P,U,K,P<K?C:v,P,g.x,g.y)&&(R=Math.abs(P-g.y)/(v-g.x),el(g,h)&&(R<H||R===H&&(g.x>f.x||g.x===f.x&&sd(f,g)))&&(f=g,H=R)),g=g.next;while(g!==O);return f}(i,t);if(!n)return t;var o=uh(n,i);return Ea(o,o.next),Ea(n,n.next)}function sd(i,t){return on(i.prev,i,t.prev)<0&&on(t.next,i,i.next)<0}function Ql(i,t,n,o,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function od(i){var t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Fa(i,t,n,o,h,p,f,g){return(h-f)*(t-g)>=(i-f)*(p-g)&&(i-f)*(o-g)>=(n-f)*(t-g)&&(n-f)*(p-g)>=(h-f)*(o-g)}function ad(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==o.i&&h.next.i!==o.i&&hh(h,h.next,n,o))return!0;h=h.next}while(h!==n);return!1}(i,t)&&(el(i,t)&&el(t,i)&&function(n,o){var h=n,p=!1,f=(n.x+o.x)/2,g=(n.y+o.y)/2;do h.y>g!=h.next.y>g&&h.next.y!==h.y&&f<(h.next.x-h.x)*(g-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==n);return p}(i,t)&&(on(i.prev,i,t.prev)||on(i,t.prev,t))||Tl(i,t)&&on(i.prev,i,i.next)>0&&on(t.prev,t,t.next)>0)}function on(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function Tl(i,t){return i.x===t.x&&i.y===t.y}function hh(i,t,n,o){var h=Pl(on(i,t,n)),p=Pl(on(i,t,o)),f=Pl(on(n,o,i)),g=Pl(on(n,o,t));return h!==p&&f!==g||!(h!==0||!Sl(i,n,t))||!(p!==0||!Sl(i,o,t))||!(f!==0||!Sl(n,i,o))||!(g!==0||!Sl(n,t,o))}function Sl(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Pl(i){return i>0?1:i<0?-1:0}function el(i,t){return on(i.prev,i,i.next)<0?on(i,t,i.next)>=0&&on(i,i.prev,t)>=0:on(i,t,i.prev)<0||on(i,i.next,t)<0}function uh(i,t){var n=new tc(i.i,i.x,i.y),o=new tc(t.i,t.x,t.y),h=i.next,p=t.prev;return i.next=t,t.prev=i,n.next=h,h.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function dh(i,t,n,o){var h=new tc(i,t,n);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function il(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function tc(i,t,n){this.i=i,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ec(i,t,n,o){for(var h=0,p=t,f=n-o;p<n;p+=o)h+=(i[f]-i[p])*(i[p+1]+i[f+1]),f=p;return h}Yl.exports=wl,Yl.exports.default=wl,wl.deviation=function(i,t,n,o){var h=t&&t.length,p=Math.abs(ec(i,0,h?t[0]*n:i.length,n));if(h)for(var f=0,g=t.length;f<g;f++)p-=Math.abs(ec(i,t[f]*n,f<g-1?t[f+1]*n:i.length,n));var v=0;for(f=0;f<o.length;f+=3){var P=o[f]*n,C=o[f+1]*n,z=o[f+2]*n;v+=Math.abs((i[P]-i[z])*(i[C+1]-i[P+1])-(i[P]-i[C])*(i[z+1]-i[P+1]))}return p===0&&v===0?0:Math.abs((v-p)/p)},wl.flatten=function(i){for(var t=i[0][0].length,n={vertices:[],holes:[],dimensions:t},o=0,h=0;h<i.length;h++){for(var p=0;p<i[h].length;p++)for(var f=0;f<t;f++)n.vertices.push(i[h][p][f]);h>0&&n.holes.push(o+=i[h-1].length)}return n};var ph=Ot(Yl.exports);function ld(i,t,n,o,h){fh(i,t,n||0,o||i.length-1,h||cd)}function fh(i,t,n,o,h){for(;o>n;){if(o-n>600){var p=o-n+1,f=t-n+1,g=Math.log(p),v=.5*Math.exp(2*g/3),P=.5*Math.sqrt(g*v*(p-v)/p)*(f-p/2<0?-1:1);fh(i,t,Math.max(n,Math.floor(t-f*v/p+P)),Math.min(o,Math.floor(t+(p-f)*v/p+P)),h)}var C=i[t],z=n,R=o;for(nl(i,n,t),h(i[o],C)>0&&nl(i,n,o);z<R;){for(nl(i,z,R),z++,R--;h(i[z],C)<0;)z++;for(;h(i[R],C)>0;)R--}h(i[n],C)===0?nl(i,n,R):nl(i,++R,o),R<=t&&(n=R+1),t<=R&&(o=R-1)}}function nl(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function cd(i,t){return i<t?-1:i>t?1:0}function ic(i,t){const n=i.length;if(n<=1)return[i];const o=[];let h,p;for(let f=0;f<n;f++){const g=Ii(i[f]);g!==0&&(i[f].area=Math.abs(g),p===void 0&&(p=g<0),p===g<0?(h&&o.push(h),h=[i[f]]):h.push(i[f]))}if(h&&o.push(h),t>1)for(let f=0;f<o.length;f++)o[f].length<=t||(ld(o[f],t,1,o[f].length-1,hd),o[f]=o[f].slice(0,t));return o}function hd(i,t){return t.area-i.area}function nc(i,t,n){const o=n.patternDependencies;let h=!1;for(const p of t){const f=p.paint.get(`${i}-pattern`);f.isConstant()||(h=!0);const g=f.constantOr(null);g&&(h=!0,o[g.to]=!0,o[g.from]=!0)}return h}function rc(i,t,n,o,h){const p=h.patternDependencies;for(const f of t){const g=f.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:o-1},n,{},h.availableImages),P=g.evaluate({zoom:o},n,{},h.availableImages),C=g.evaluate({zoom:o+1},n,{},h.availableImages);v=v&&v.name?v.name:v,P=P&&P.name?P.name:P,C=C&&C.name?C.name:C,p[v]=!0,p[P]=!0,p[C]=!0,n.patterns[f.id]={min:v,mid:P,max:C}}}return n}class sc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new G,this.indexArray=new zt,this.indexArray2=new te,this.programConfigurations=new Qs(t.layers,t.zoom),this.segments=new Wt,this.segments2=new Wt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=nc("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),p=!h.isConstant(),f=[];for(const{feature:g,id:v,index:P,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Pa(g,z);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),R,o))continue;const O=p?h.evaluate(R,{},o,n.availableImages):void 0,U={id:v,properties:g.properties,type:g.type,sourceLayerIndex:C,index:P,geometry:z?R.geometry:to(g),patterns:{},sortKey:O};f.push(U)}p&&f.sort((g,v)=>g.sortKey-v.sortKey);for(const g of f){const{geometry:v,index:P,sourceLayerIndex:C}=g;if(this.hasPattern){const z=rc("fill",this.layers,g,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(g,v,P,o,{});n.featureIndex.insert(t[P].feature,v,P,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,h,p){for(const f of ic(n,500)){let g=0;for(const O of f)g+=O.length;const v=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),P=v.vertexLength,C=[],z=[];for(const O of f){if(O.length===0)continue;O!==f[0]&&z.push(C.length/2);const U=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),K=U.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(K+O.length-1,K),C.push(O[0].x),C.push(O[0].y);for(let H=1;H<O.length;H++)this.layoutVertexArray.emplaceBack(O[H].x,O[H].y),this.indexArray2.emplaceBack(K+H-1,K+H),C.push(O[H].x),C.push(O[H].y);U.vertexLength+=O.length,U.primitiveLength+=O.length}const R=ph(C,z);for(let O=0;O<R.length;O+=3)this.indexArray.emplaceBack(P+R[O],P+R[O+1],P+R[O+2]);v.vertexLength+=g,v.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,h)}}let mh,_h;ee("FillBucket",sc,{omit:["layers","patternFeatures"]});var ud={get paint(){return _h=_h||new me({"fill-antialias":new $(Pt.paint_fill["fill-antialias"]),"fill-opacity":new at(Pt.paint_fill["fill-opacity"]),"fill-color":new at(Pt.paint_fill["fill-color"]),"fill-outline-color":new at(Pt.paint_fill["fill-outline-color"]),"fill-translate":new $(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new $(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tt(Pt.paint_fill["fill-pattern"])})},get layout(){return mh=mh||new me({"fill-sort-key":new at(Pt.layout_fill["fill-sort-key"])})}};const dd=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),pd=Ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:fd}=dd;var la={},md=yt,gh=Na;function Na(i,t,n,o,h){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=h,i.readFields(_d,this,t)}function _d(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,h){for(var p=o.readVarint()+o.pos;o.pos<p;){var f=h._keys[o.readVarint()],g=h._values[o.readVarint()];h.properties[f]=g}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function gd(i){for(var t,n,o=0,h=0,p=i.length,f=p-1;h<p;f=h++)o+=((n=i[f]).x-(t=i[h]).x)*(t.y+n.y);return o}Na.types=["Unknown","Point","LineString","Polygon"],Na.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,h=0,p=0,f=0,g=[];i.pos<n;){if(h<=0){var v=i.readVarint();o=7&v,h=v>>3}if(h--,o===1||o===2)p+=i.readSVarint(),f+=i.readSVarint(),o===1&&(t&&g.push(t),t=[]),t.push(new md(p,f));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&g.push(t),g},Na.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,h=0,p=0,f=1/0,g=-1/0,v=1/0,P=-1/0;i.pos<t;){if(o<=0){var C=i.readVarint();n=7&C,o=C>>3}if(o--,n===1||n===2)(h+=i.readSVarint())<f&&(f=h),h>g&&(g=h),(p+=i.readSVarint())<v&&(v=p),p>P&&(P=p);else if(n!==7)throw new Error("unknown command "+n)}return[f,v,g,P]},Na.prototype.toGeoJSON=function(i,t,n){var o,h,p=this.extent*Math.pow(2,n),f=this.extent*i,g=this.extent*t,v=this.loadGeometry(),P=Na.types[this.type];function C(O){for(var U=0;U<O.length;U++){var K=O[U];O[U]=[360*(K.x+f)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+g)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(o=0;o<v.length;o++)z[o]=v[o][0];C(v=z);break;case 2:for(o=0;o<v.length;o++)C(v[o]);break;case 3:for(v=function(O){var U=O.length;if(U<=1)return[O];for(var K,H,ct=[],dt=0;dt<U;dt++){var ot=gd(O[dt]);ot!==0&&(H===void 0&&(H=ot<0),H===ot<0?(K&&ct.push(K),K=[O[dt]]):K.push(O[dt]))}return K&&ct.push(K),ct}(v),o=0;o<v.length;o++)for(h=0;h<v[o].length;h++)C(v[o][h])}v.length===1?v=v[0]:P="Multi"+P;var R={type:"Feature",geometry:{type:P,coordinates:v},properties:this.properties};return"id"in this&&(R.id=this.id),R};var yd=gh,yh=vh;function vh(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(vd,this,t),this.length=this._features.length}function vd(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var h=null,p=o.readVarint()+o.pos;o.pos<p;){var f=o.readVarint()>>3;h=f===1?o.readString():f===2?o.readFloat():f===3?o.readDouble():f===4?o.readVarint64():f===5?o.readVarint():f===6?o.readSVarint():f===7?o.readBoolean():null}return h}(n))}vh.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new yd(this._pbf,t,this.extent,this._keys,this._values)};var xd=yh;function bd(i,t,n){if(i===3){var o=new xd(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}la.VectorTile=function(i,t){this.layers=i.readFields(bd,{},t)},la.VectorTileFeature=gh,la.VectorTileLayer=yh;const wd=la.VectorTileFeature.types,oc=Math.pow(2,13);function rl(i,t,n,o,h,p,f,g){i.emplaceBack(t,n,2*Math.floor(o*oc)+f,h*oc*2,p*oc*2,Math.round(g))}class ac{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new tt,this.centroidVertexArray=new W,this.indexArray=new zt,this.programConfigurations=new Qs(t.layers,t.zoom),this.segments=new Wt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=nc("fill-extrusion",this.layers,n);for(const{feature:h,id:p,index:f,sourceLayerIndex:g}of t){const v=this.layers[0]._featureFilter.needGeometry,P=Pa(h,v);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),P,o))continue;const C={id:p,sourceLayerIndex:g,index:f,geometry:v?P.geometry:to(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(rc("fill-extrusion",this.layers,C,this.zoom,n)):this.addFeature(C,C.geometry,f,o,{}),n.featureIndex.insert(h,C.geometry,f,g,this.index,!0)}}addFeatures(t,n,o){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fd),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pd.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,h,p){const f={x:0,y:0,vertexCount:0};for(const g of ic(n,500)){let v=0;for(const U of g)v+=U.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of g){if(U.length===0||Sd(U))continue;let K=0;for(let H=0;H<U.length;H++){const ct=U[H];if(H>=1){const dt=U[H-1];if(!Td(ct,dt)){P.vertexLength+4>Wt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ot=ct.sub(dt)._perp()._unit(),_t=dt.dist(ct);K+_t>32768&&(K=0),rl(this.layoutVertexArray,ct.x,ct.y,ot.x,ot.y,0,0,K),rl(this.layoutVertexArray,ct.x,ct.y,ot.x,ot.y,0,1,K),f.x+=2*ct.x,f.y+=2*ct.y,f.vertexCount+=2,K+=_t,rl(this.layoutVertexArray,dt.x,dt.y,ot.x,ot.y,0,0,K),rl(this.layoutVertexArray,dt.x,dt.y,ot.x,ot.y,0,1,K),f.x+=2*dt.x,f.y+=2*dt.y,f.vertexCount+=2;const xt=P.vertexLength;this.indexArray.emplaceBack(xt,xt+2,xt+1),this.indexArray.emplaceBack(xt+1,xt+2,xt+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+v>Wt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray)),wd[t.type]!=="Polygon")continue;const C=[],z=[],R=P.vertexLength;for(const U of g)if(U.length!==0){U!==g[0]&&z.push(C.length/2);for(let K=0;K<U.length;K++){const H=U[K];rl(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),f.x+=H.x,f.y+=H.y,f.vertexCount+=1,C.push(H.x),C.push(H.y)}}const O=ph(C,z);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(R+O[U],R+O[U+2],R+O[U+1]);P.primitiveLength+=O.length/3,P.vertexLength+=v}for(let g=0;g<f.vertexCount;g++)this.centroidVertexArray.emplaceBack(Math.floor(f.x/f.vertexCount),Math.floor(f.y/f.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,h)}}function Td(i,t){return i.x===t.x&&(i.x<0||i.x>Li)||i.y===t.y&&(i.y<0||i.y>Li)}function Sd(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Li)||i.every(t=>t.y<0)||i.every(t=>t.y>Li)}let xh;ee("FillExtrusionBucket",ac,{omit:["layers","features"]});var Pd={get paint(){return xh=xh||new me({"fill-extrusion-opacity":new $(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tt(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};function sl(i,t){return i.x*t.x+i.y*t.y}function bh(i,t){if(i.length===1){let n=0;const o=t[n++];let h;for(;!h||o.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const p=t[n],f=i[0],g=h.sub(o),v=p.sub(o),P=f.sub(o),C=sl(g,g),z=sl(g,v),R=sl(v,v),O=sl(P,g),U=sl(P,v),K=C*R-z*z,H=(R*O-z*U)/K,ct=(C*U-z*O)/K,dt=o.z*(1-H-ct)+h.z*H+p.z*ct;if(isFinite(dt))return dt}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Ed=Ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cd}=Ed,Id=Ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kd}=Id,Ad=la.VectorTileFeature.types,Md=Math.cos(Math.PI/180*37.5),wh=Math.pow(2,14)/.5;class lc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new lt,this.layoutVertexArray2=new gt,this.indexArray=new zt,this.programConfigurations=new Qs(t.layers,t.zoom),this.segments=new Wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=nc("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),p=!h.isConstant(),f=[];for(const{feature:g,id:v,index:P,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Pa(g,z);if(!this.layers[0]._featureFilter.filter(new wi(this.zoom),R,o))continue;const O=p?h.evaluate(R,{},o):void 0,U={id:v,properties:g.properties,type:g.type,sourceLayerIndex:C,index:P,geometry:z?R.geometry:to(g),patterns:{},sortKey:O};f.push(U)}p&&f.sort((g,v)=>g.sortKey-v.sortKey);for(const g of f){const{geometry:v,index:P,sourceLayerIndex:C}=g;if(this.hasPattern){const z=rc("line",this.layers,g,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(g,v,P,o,{});n.featureIndex.insert(t[P].feature,v,P,C,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,kd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,h,p){const f=this.layers[0].layout,g=f.get("line-join").evaluate(t,{}),v=f.get("line-cap"),P=f.get("line-miter-limit"),C=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of n)this.addLine(z,t,g,v,P,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,h)}addLine(t,n,o,h,p,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ct=0;ct<t.length-1;ct++)this.totalDistance+=t[ct].dist(t[ct+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=Ad[n.type]==="Polygon";let v=t.length;for(;v>=2&&t[v-1].equals(t[v-2]);)v--;let P=0;for(;P<v-1&&t[P].equals(t[P+1]);)P++;if(v<(g?3:2))return;o==="bevel"&&(p=1.05);const C=this.overscaling<=16?15*Li/(512*this.overscaling):0,z=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let R,O,U,K,H;this.e1=this.e2=-1,g&&(R=t[v-2],H=t[P].sub(R)._unit()._perp());for(let ct=P;ct<v;ct++){if(U=ct===v-1?g?t[P+1]:void 0:t[ct+1],U&&t[ct].equals(U))continue;H&&(K=H),R&&(O=R),R=t[ct],H=U?U.sub(R)._unit()._perp():K,K=K||H;let dt=K.add(H);dt.x===0&&dt.y===0||dt._unit();const ot=K.x*H.x+K.y*H.y,_t=dt.x*H.x+dt.y*H.y,xt=_t!==0?1/_t:1/0,Ct=2*Math.sqrt(2-2*_t),se=_t<Md&&O&&U,ue=K.x*H.y-K.y*H.x>0;if(se&&ct>P){const $t=R.dist(O);if($t>2*C){const Qt=R.sub(R.sub(O)._mult(C/$t)._round());this.updateDistance(O,Qt),this.addCurrentVertex(Qt,K,0,0,z),O=Qt}}const Yt=O&&U;let Xt=Yt?o:g?"butt":h;if(Yt&&Xt==="round"&&(xt<f?Xt="miter":xt<=2&&(Xt="fakeround")),Xt==="miter"&&xt>p&&(Xt="bevel"),Xt==="bevel"&&(xt>2&&(Xt="flipbevel"),xt<p&&(Xt="miter")),O&&this.updateDistance(O,R),Xt==="miter")dt._mult(xt),this.addCurrentVertex(R,dt,0,0,z);else if(Xt==="flipbevel"){if(xt>100)dt=H.mult(-1);else{const $t=xt*K.add(H).mag()/K.sub(H).mag();dt._perp()._mult($t*(ue?-1:1))}this.addCurrentVertex(R,dt,0,0,z),this.addCurrentVertex(R,dt.mult(-1),0,0,z)}else if(Xt==="bevel"||Xt==="fakeround"){const $t=-Math.sqrt(xt*xt-1),Qt=ue?$t:0,Jt=ue?0:$t;if(O&&this.addCurrentVertex(R,K,Qt,Jt,z),Xt==="fakeround"){const Bt=Math.round(180*Ct/Math.PI/20);for(let ye=1;ye<Bt;ye++){let pe=ye/Bt;if(pe!==.5){const zi=pe-.5;pe+=pe*zi*(pe-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*zi*zi+(.848013+ot*(.215638*ot-1.06021)))}const He=H.sub(K)._mult(pe)._add(K)._unit()._mult(ue?-1:1);this.addHalfVertex(R,He.x,He.y,!1,ue,0,z)}}U&&this.addCurrentVertex(R,H,-Qt,-Jt,z)}else if(Xt==="butt")this.addCurrentVertex(R,dt,0,0,z);else if(Xt==="square"){const $t=O?1:-1;this.addCurrentVertex(R,dt,$t,$t,z)}else Xt==="round"&&(O&&(this.addCurrentVertex(R,K,0,0,z),this.addCurrentVertex(R,K,1,1,z,!0)),U&&(this.addCurrentVertex(R,H,-1,-1,z,!0),this.addCurrentVertex(R,H,0,0,z)));if(se&&ct<v-1){const $t=R.dist(U);if($t>2*C){const Qt=R.add(U.sub(R)._mult(C/$t)._round());this.updateDistance(R,Qt),this.addCurrentVertex(Qt,H,0,0,z),R=Qt}}}}addCurrentVertex(t,n,o,h,p,f=!1){const g=n.y*h-n.x,v=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,f,!1,o,p),this.addHalfVertex(t,g,v,f,!0,-h,p),this.distance>wh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,h,p,f))}addHalfVertex({x:t,y:n},o,h,p,f,g,v){const P=.5*(this.lineClips?this.scaledDistance*(wh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(n<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(g===0?0:g<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),v.primitiveLength++),f?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Th,Sh;ee("LineBucket",lc,{omit:["layers","patternFeatures"]});var Ph={get paint(){return Sh=Sh||new me({"line-opacity":new at(Pt.paint_line["line-opacity"]),"line-color":new at(Pt.paint_line["line-color"]),"line-translate":new $(Pt.paint_line["line-translate"]),"line-translate-anchor":new $(Pt.paint_line["line-translate-anchor"]),"line-width":new at(Pt.paint_line["line-width"]),"line-gap-width":new at(Pt.paint_line["line-gap-width"]),"line-offset":new at(Pt.paint_line["line-offset"]),"line-blur":new at(Pt.paint_line["line-blur"]),"line-dasharray":new Dt(Pt.paint_line["line-dasharray"]),"line-pattern":new Tt(Pt.paint_line["line-pattern"]),"line-gradient":new oe(Pt.paint_line["line-gradient"])})},get layout(){return Th=Th||new me({"line-cap":new $(Pt.layout_line["line-cap"]),"line-join":new at(Pt.layout_line["line-join"]),"line-miter-limit":new $(Pt.layout_line["line-miter-limit"]),"line-round-limit":new $(Pt.layout_line["line-round-limit"]),"line-sort-key":new at(Pt.layout_line["line-sort-key"])})}};class Ld extends at{possiblyEvaluate(t,n){return n=new wi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,h){return n=be({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,h)}}let El;function Eh(i,t){return t>0?t+2*i:i}const zd=Ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dd=Ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Rd=Ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ch=Ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bd=Ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Od(i,t,n){return i.sections.forEach(o=>{o.text=function(h,p,f){const g=p.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?h=h.toLocaleUpperCase():g==="lowercase"&&(h=h.toLocaleLowerCase()),yr.applyArabicShaping&&(h=yr.applyArabicShaping(h)),h}(o.text,t,n)}),i}Ei([{name:"triangle",components:3,type:"Uint16"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ei([{type:"Float32",name:"offsetX"}]),Ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ol={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Sn=24,Ih=vi,kh=function(i,t,n,o,h){var p,f,g=8*h-o-1,v=(1<<g)-1,P=v>>1,C=-7,z=n?h-1:0,R=n?-1:1,O=i[t+z];for(z+=R,p=O&(1<<-C)-1,O>>=-C,C+=g;C>0;p=256*p+i[t+z],z+=R,C-=8);for(f=p&(1<<-C)-1,p>>=-C,C+=o;C>0;f=256*f+i[t+z],z+=R,C-=8);if(p===0)p=1-P;else{if(p===v)return f?NaN:1/0*(O?-1:1);f+=Math.pow(2,o),p-=P}return(O?-1:1)*f*Math.pow(2,p-o)},Ah=function(i,t,n,o,h,p){var f,g,v,P=8*p-h-1,C=(1<<P)-1,z=C>>1,R=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=o?0:p-1,U=o?1:-1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(g=isNaN(t)?1:0,f=C):(f=Math.floor(Math.log(t)/Math.LN2),t*(v=Math.pow(2,-f))<1&&(f--,v*=2),(t+=f+z>=1?R/v:R*Math.pow(2,1-z))*v>=2&&(f++,v/=2),f+z>=C?(g=0,f=C):f+z>=1?(g=(t*v-1)*Math.pow(2,h),f+=z):(g=t*Math.pow(2,z-1)*Math.pow(2,h),f=0));h>=8;i[n+O]=255&g,O+=U,g/=256,h-=8);for(f=f<<h|g,P+=h;P>0;i[n+O]=255&f,O+=U,f/=256,P-=8);i[n+O-U]|=128*K};function vi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}vi.Varint=0,vi.Fixed64=1,vi.Bytes=2,vi.Fixed32=5;var cc=4294967296,Mh=1/cc,Lh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function jo(i){return i.type===vi.Bytes?i.readVarint()+i.pos:i.pos+1}function Ua(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function zh(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var h=n.pos-1;h>=i;h--)n.buf[h+o]=n.buf[h]}function Fd(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function Nd(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function Ud(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function Vd(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function Zd(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function qd(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function jd(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function $d(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function Gd(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function Cl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Va(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function Dh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}vi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),h=o>>3,p=this.pos;this.type=7&o,i(h,t,this),this.pos===p&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Cl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Dh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cl(this.buf,this.pos)+Cl(this.buf,this.pos+4)*cc;return this.pos+=8,i},readSFixed64:function(){var i=Cl(this.buf,this.pos)+Dh(this.buf,this.pos+4)*cc;return this.pos+=8,i},readFloat:function(){var i=kh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=kh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(h,p,f){var g,v,P=f.buf;if(g=(112&(v=P[f.pos++]))>>4,v<128||(g|=(127&(v=P[f.pos++]))<<3,v<128)||(g|=(127&(v=P[f.pos++]))<<10,v<128)||(g|=(127&(v=P[f.pos++]))<<17,v<128)||(g|=(127&(v=P[f.pos++]))<<24,v<128)||(g|=(1&(v=P[f.pos++]))<<31,v<128))return Ua(h,g,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Lh?function(n,o,h){return Lh.decode(n.subarray(o,h))}(this.buf,t,i):function(n,o,h){for(var p="",f=o;f<h;){var g,v,P,C=n[f],z=null,R=C>239?4:C>223?3:C>191?2:1;if(f+R>h)break;R===1?C<128&&(z=C):R===2?(192&(g=n[f+1]))==128&&(z=(31&C)<<6|63&g)<=127&&(z=null):R===3?(v=n[f+2],(192&(g=n[f+1]))==128&&(192&v)==128&&((z=(15&C)<<12|(63&g)<<6|63&v)<=2047||z>=55296&&z<=57343)&&(z=null)):R===4&&(v=n[f+2],P=n[f+3],(192&(g=n[f+1]))==128&&(192&v)==128&&(192&P)==128&&((z=(15&C)<<18|(63&g)<<12|(63&v)<<6|63&P)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,R=1):z>65535&&(z-=65536,p+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),p+=String.fromCharCode(z),f+=R}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==vi.Bytes)return i.push(this.readVarint(t));var n=jo(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==vi.Bytes)return i.push(this.readSVarint());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==vi.Bytes)return i.push(this.readBoolean());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==vi.Bytes)return i.push(this.readFloat());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==vi.Bytes)return i.push(this.readDouble());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==vi.Bytes)return i.push(this.readFixed32());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==vi.Bytes)return i.push(this.readSFixed32());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==vi.Bytes)return i.push(this.readFixed64());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==vi.Bytes)return i.push(this.readSFixed64());var t=jo(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===vi.Varint)for(;this.buf[this.pos++]>127;);else if(t===vi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===vi.Fixed32)this.pos+=4;else{if(t!==vi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Va(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Mh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Va(this.buf,-1&i,this.pos),Va(this.buf,Math.floor(i*Mh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,h;if(t>=0?(o=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,f,g){g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,p>>>=7,g.buf[g.pos++]=127&p|128,g.buf[g.pos]=127&(p>>>=7)}(o,0,n),function(p,f){var g=(7&p)<<4;f.buf[f.pos++]|=g|((p>>>=3)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p)))))}(h,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,h,p){for(var f,g,v=0;v<h.length;v++){if((f=h.charCodeAt(v))>55295&&f<57344){if(!g){f>56319||v+1===h.length?(o[p++]=239,o[p++]=191,o[p++]=189):g=f;continue}if(f<56320){o[p++]=239,o[p++]=191,o[p++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(o[p++]=239,o[p++]=191,o[p++]=189,g=null);f<128?o[p++]=f:(f<2048?o[p++]=f>>6|192:(f<65536?o[p++]=f>>12|224:(o[p++]=f>>18|240,o[p++]=f>>12&63|128),o[p++]=f>>6&63|128),o[p++]=63&f|128)}return p}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&zh(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Ah(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ah(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&zh(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,vi.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Fd,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Nd,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Zd,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Ud,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Vd,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,qd,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,jd,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,$d,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Gd,t)},writeBytesField:function(i,t){this.writeTag(i,vi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,vi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,vi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,vi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,vi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,vi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,vi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,vi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,vi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,vi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var hc=Ot(Ih);const uc=3;function Hd(i,t,n){i===1&&n.readMessage(Wd,t)}function Wd(i,t,n){if(i===3){const{id:o,bitmap:h,width:p,height:f,left:g,top:v,advance:P}=n.readMessage(Xd,{});t.push({id:o,bitmap:new Qa({width:p+2*uc,height:f+2*uc},h),metrics:{width:p,height:f,left:g,top:v,advance:P}})}}function Xd(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const Rh=uc;function Bh(i){let t=0,n=0;for(const f of i)t+=f.w*f.h,n=Math.max(n,f.w);i.sort((f,g)=>g.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,p=0;for(const f of i)for(let g=o.length-1;g>=0;g--){const v=o[g];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,p=Math.max(p,f.y+f.h),h=Math.max(h,f.x+f.w),f.w===v.w&&f.h===v.h){const P=o.pop();g<o.length&&(o[g]=P)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(o.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:h,h:p,fill:t/(h*p)||0}}const Mr=1;class dc{constructor(t,{pixelRatio:n,version:o,stretchX:h,stretchY:p,content:f}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=p,this.content=f,this.version=o}get tl(){return[this.paddedRect.x+Mr,this.paddedRect.y+Mr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Mr,this.paddedRect.y+this.paddedRect.h-Mr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Mr)/this.pixelRatio,(this.paddedRect.h-2*Mr)/this.pixelRatio]}}class Oh{constructor(t,n){const o={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(n,h,p);const{w:f,h:g}=Bh(p),v=new cs({width:f||1,height:g||1});for(const P in t){const C=t[P],z=o[P].paddedRect;cs.copy(C.data,v,{x:0,y:0},{x:z.x+Mr,y:z.y+Mr},C.data)}for(const P in n){const C=n[P],z=h[P].paddedRect,R=z.x+Mr,O=z.y+Mr,U=C.data.width,K=C.data.height;cs.copy(C.data,v,{x:0,y:0},{x:R,y:O},C.data),cs.copy(C.data,v,{x:0,y:K-1},{x:R,y:O-1},{width:U,height:1}),cs.copy(C.data,v,{x:0,y:0},{x:R,y:O+K},{width:U,height:1}),cs.copy(C.data,v,{x:U-1,y:0},{x:R-1,y:O},{width:1,height:K}),cs.copy(C.data,v,{x:0,y:0},{x:R+U,y:O},{width:1,height:K})}this.image=v,this.iconPositions=o,this.patternPositions=h}addImages(t,n,o){for(const h in t){const p=t[h],f={x:0,y:0,w:p.data.width+2*Mr,h:p.data.height+2*Mr};o.push(f),n[h]=new dc(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,p]=t.tl;o.update(n.data,void 0,{x:h,y:p})}}var ca;ee("ImagePosition",dc),ee("ImageAtlas",Oh),d.WritingMode=void 0,(ca=d.WritingMode||(d.WritingMode={}))[ca.none=0]="none",ca[ca.horizontal=1]="horizontal",ca[ca.vertical=2]="vertical",ca[ca.horizontalOnly=3]="horizontalOnly";const al=-17;class ll{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new ll;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new ll;return n.imageName=t,n}}class Za{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Za;for(let h=0;h<t.sections.length;h++){const p=t.sections[h];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;n+=h&&$r(h)&&!ol[t[o+1]]||p&&$r(p)&&!ol[t[o-1]]||!ol[t[o]]?t[o]:ol[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&kl[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&kl[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Za;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(ll.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void gi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(ll.forImage(n)),this.sectionIndex.push(this.sections.length-1)):gi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Il(i,t,n,o,h,p,f,g,v,P,C,z,R,O,U,K){const H=Za.fromFeature(i,h);let ct;z===d.WritingMode.vertical&&H.verticalizePunctuation();const{processBidirectionalText:dt,processStyledBidirectionalText:ot}=yr;if(dt&&H.sections.length===1){ct=[];const Ct=dt(H.toString(),pc(H,P,p,t,o,O,U));for(const se of Ct){const ue=new Za;ue.text=se,ue.sections=H.sections;for(let Yt=0;Yt<se.length;Yt++)ue.sectionIndex.push(0);ct.push(ue)}}else if(ot){ct=[];const Ct=ot(H.text,H.sectionIndex,pc(H,P,p,t,o,O,U));for(const se of Ct){const ue=new Za;ue.text=se[0],ue.sectionIndex=se[1],ue.sections=H.sections,ct.push(ue)}}else ct=function(Ct,se){const ue=[],Yt=Ct.text;let Xt=0;for(const $t of se)ue.push(Ct.substring(Xt,$t)),Xt=$t;return Xt<Yt.length&&ue.push(Ct.substring(Xt,Yt.length)),ue}(H,pc(H,P,p,t,o,O,U));const _t=[],xt={positionedLines:_t,text:H.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Ct,se,ue,Yt,Xt,$t,Qt,Jt,Bt,ye,pe,He){let zi=0,Ri=al,yn=0,us=0;const Fn=Jt==="right"?1:Jt==="left"?0:.5;let cn=0;for(const hn of Xt){hn.trim();const Un=hn.getMaxScale(),rr=(Un-1)*Sn,xr={positionedGlyphs:[],lineOffset:0};Ct.positionedLines[cn]=xr;const zr=xr.positionedGlyphs;let Dr=0;if(!hn.length()){Ri+=$t,++cn;continue}for(let Vn=0;Vn<hn.length();Vn++){const We=hn.getSection(Vn),Hr=hn.getSectionIndex(Vn),Zn=hn.getCharCode(Vn);let sr=0,Ds=null,eo=null,no=null,$o=Sn;const Rs=!(Bt===d.WritingMode.horizontal||!pe&&!ea(Zn)||pe&&(kl[Zn]||(Pn=Zn,Kt.Arabic(Pn)||Kt["Arabic Supplement"](Pn)||Kt["Arabic Extended-A"](Pn)||Kt["Arabic Presentation Forms-A"](Pn)||Kt["Arabic Presentation Forms-B"](Pn))));if(We.imageName){const ds=Yt[We.imageName];if(!ds)continue;no=We.imageName,Ct.iconsInText=Ct.iconsInText||!0,eo=ds.paddedRect;const Rr=ds.displaySize;We.scale=We.scale*Sn/He,Ds={width:Rr[0],height:Rr[1],left:Mr,top:-Rh,advance:Rs?Rr[1]:Rr[0]},sr=rr+(Sn-Rr[1]*We.scale),$o=Ds.advance;const Go=Rs?Rr[0]*We.scale-Sn*Un:Rr[1]*We.scale-Sn*Un;Go>0&&Go>Dr&&(Dr=Go)}else{const ds=ue[We.fontStack],Rr=ds&&ds[Zn];if(Rr&&Rr.rect)eo=Rr.rect,Ds=Rr.metrics;else{const Go=se[We.fontStack],pl=Go&&Go[Zn];if(!pl)continue;Ds=pl.metrics}sr=(Un-We.scale)*Sn}Rs?(Ct.verticalizable=!0,zr.push({glyph:Zn,imageName:no,x:zi,y:Ri+sr,vertical:Rs,scale:We.scale,fontStack:We.fontStack,sectionIndex:Hr,metrics:Ds,rect:eo}),zi+=$o*We.scale+ye):(zr.push({glyph:Zn,imageName:no,x:zi,y:Ri+sr,vertical:Rs,scale:We.scale,fontStack:We.fontStack,sectionIndex:Hr,metrics:Ds,rect:eo}),zi+=Ds.advance*We.scale+ye)}zr.length!==0&&(yn=Math.max(zi-ye,yn),Yd(zr,0,zr.length-1,Fn,Dr)),zi=0;const Ji=$t*Un+Dr;xr.lineOffset=Math.max(Dr,rr),Ri+=Ji,us=Math.max(Ji,us),++cn}var Pn;const Nn=Ri-al,{horizontalAlign:nr,verticalAlign:Lr}=fc(Qt);(function(hn,Un,rr,xr,zr,Dr,Ji,Vn,We){const Hr=(Un-rr)*zr;let Zn=0;Zn=Dr!==Ji?-Vn*xr-al:(-xr*We+.5)*Ji;for(const sr of hn)for(const Ds of sr.positionedGlyphs)Ds.x+=Hr,Ds.y+=Zn})(Ct.positionedLines,Fn,nr,Lr,yn,us,$t,Nn,Xt.length),Ct.top+=-Lr*Nn,Ct.bottom=Ct.top+Nn,Ct.left+=-nr*yn,Ct.right=Ct.left+yn}(xt,t,n,o,ct,f,g,v,z,P,R,K),!function(Ct){for(const se of Ct)if(se.positionedGlyphs.length!==0)return!1;return!0}(_t)&&xt}const kl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fh(i,t,n,o,h,p){if(t.imageName){const f=o[t.imageName];return f?f.displaySize[0]*t.scale*Sn/p+h:0}{const f=n[t.fontStack],g=f&&f[i];return g?g.metrics.advance*t.scale+h:0}}function Nh(i,t,n,o){const h=Math.pow(i-t,2);return o?i<t?h/2:2*h:h+Math.abs(n)*n}function Jd(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Uh(i,t,n,o,h,p){let f=null,g=Nh(t,n,h,p);for(const v of o){const P=Nh(t-v.x,n,h,p)+v.badness;P<=g&&(f=v,g=P)}return{index:i,x:t,priorBreak:f,badness:g}}function Vh(i){return i?Vh(i.priorBreak).concat(i.index):[]}function pc(i,t,n,o,h,p,f){if(p!=="point")return[];if(!i)return[];const g=[],v=function(R,O,U,K,H,ct){let dt=0;for(let ot=0;ot<R.length();ot++){const _t=R.getSection(ot);dt+=Fh(R.getCharCode(ot),_t,K,H,O,ct)}return dt/Math.max(1,Math.ceil(dt/U))}(i,t,n,o,h,f),P=i.text.indexOf("​")>=0;let C=0;for(let R=0;R<i.length();R++){const O=i.getSection(R),U=i.getCharCode(R);if(kl[U]||(C+=Fh(U,O,o,h,t,f)),R<i.length()-1){const K=!((z=U)<11904||!(Kt["Bopomofo Extended"](z)||Kt.Bopomofo(z)||Kt["CJK Compatibility Forms"](z)||Kt["CJK Compatibility Ideographs"](z)||Kt["CJK Compatibility"](z)||Kt["CJK Radicals Supplement"](z)||Kt["CJK Strokes"](z)||Kt["CJK Symbols and Punctuation"](z)||Kt["CJK Unified Ideographs Extension A"](z)||Kt["CJK Unified Ideographs"](z)||Kt["Enclosed CJK Letters and Months"](z)||Kt["Halfwidth and Fullwidth Forms"](z)||Kt.Hiragana(z)||Kt["Ideographic Description Characters"](z)||Kt["Kangxi Radicals"](z)||Kt["Katakana Phonetic Extensions"](z)||Kt.Katakana(z)||Kt["Vertical Forms"](z)||Kt["Yi Radicals"](z)||Kt["Yi Syllables"](z)));(Kd[U]||K||O.imageName)&&g.push(Uh(R+1,C,v,g,Jd(U,i.getCharCode(R+1),K&&P),!1))}}var z;return Vh(Uh(i.length(),C,v,g,0,!0))}function fc(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Yd(i,t,n,o,h){if(!o&&!h)return;const p=i[n],f=(i[n].x+p.metrics.advance*p.scale)*o;for(let g=t;g<=n;g++)i[g].x-=f,i[g].y+=h}function Qd(i,t,n){const{horizontalAlign:o,verticalAlign:h}=fc(n),p=t[0]-i.displaySize[0]*o,f=t[1]-i.displaySize[1]*h;return{image:i,top:f,bottom:f+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Zh(i,t,n,o,h,p){const f=i.image;let g;if(f.content){const H=f.content,ct=f.pixelRatio||1;g=[H[0]/ct,H[1]/ct,f.displaySize[0]-H[2]/ct,f.displaySize[1]-H[3]/ct]}const v=t.left*p,P=t.right*p;let C,z,R,O;n==="width"||n==="both"?(O=h[0]+v-o[3],z=h[0]+P+o[1]):(O=h[0]+(v+P-f.displaySize[0])/2,z=O+f.displaySize[0]);const U=t.top*p,K=t.bottom*p;return n==="height"||n==="both"?(C=h[1]+U-o[0],R=h[1]+K+o[2]):(C=h[1]+(U+K-f.displaySize[1])/2,R=C+f.displaySize[1]),{image:f,top:C,right:z,bottom:R,left:O,collisionPadding:g}}const cl=255,Co=128,ha=cl*Co;function qh(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new wi(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let f=p;for(;f<o.length&&o[f]<i+1;)f++;f=Math.min(o.length-1,f);const g=o[p],v=o[f];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:h}:{kind:"camera",minZoom:g,maxZoom:v,minSize:n.evaluate(new wi(g)),maxSize:n.evaluate(new wi(v)),interpolationType:h}}}function mc(i,t,n){let o="never";const h=i.get(t);return h?o=h:i.get(n)&&(o="always"),o}const tp=la.VectorTileFeature.types,ep=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Al(i,t,n,o,h,p,f,g,v,P,C,z,R){const O=g?Math.min(ha,Math.round(g[0])):0,U=g?Math.min(ha,Math.round(g[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*h),p,f,(O<<1)+(v?1:0),U,16*P,16*C,256*z,256*R)}function _c(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function ip(i){for(const t of i.sections)if(To(t.text))return!0;return!1}class gc{constructor(t){this.layoutVertexArray=new mt,this.indexArray=new zt,this.programConfigurations=t,this.segments=new Wt,this.dynamicLayoutVertexArray=new St,this.opacityVertexArray=new Mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new y}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Dd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ep,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ee("SymbolBuffers",gc);class yc{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Wt,this.collisionVertexArray=new Ut}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Rd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ee("CollisionBuffers",yc);class qa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xl([]),this.placementViewportMatrix=Xl([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qh(this.zoom,n["text-size"]),this.iconSizeData=qh(this.zoom,n["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=mc(o,"text-overlap","text-allow-overlap")!=="never"||mc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(f=>d.WritingMode[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new gc(new Qs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new gc(new Qs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new S,this.lineVertexArray=new A,this.symbolInstances=new b}calculateGlyphDependencies(t,n,o,h,p){for(let f=0;f<t.length;f++)if(n[t.charCodeAt(f)]=!0,(o||h)&&p){const g=ol[t.charAt(f)];g&&(n[g.charCodeAt(0)]=!0)}}populate(t,n,o){const h=this.layers[0],p=h.layout,f=p.get("text-font"),g=p.get("text-field"),v=p.get("icon-image"),P=(g.value.kind!=="constant"||g.value.value instanceof Zi&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),C=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,z=p.get("symbol-sort-key");if(this.features=[],!P&&!C)return;const R=n.iconDependencies,O=n.glyphDependencies,U=n.availableImages,K=new wi(this.zoom);for(const{feature:H,id:ct,index:dt,sourceLayerIndex:ot}of t){const _t=h._featureFilter.needGeometry,xt=Pa(H,_t);if(!h._featureFilter.filter(K,xt,o))continue;let Ct,se;if(_t||(xt.geometry=to(H)),P){const Yt=h.getValueAndResolveTokens("text-field",xt,o,U),Xt=Zi.factory(Yt);ip(Xt)&&(this.hasRTLText=!0),(!this.hasRTLText||na()==="unavailable"||this.hasRTLText&&yr.isParsed())&&(Ct=Od(Xt,h,xt))}if(C){const Yt=h.getValueAndResolveTokens("icon-image",xt,o,U);se=Yt instanceof Rn?Yt:Rn.fromString(Yt)}if(!Ct&&!se)continue;const ue=this.sortFeaturesByKey?z.evaluate(xt,{},o):void 0;if(this.features.push({id:ct,text:Ct,icon:se,index:dt,sourceLayerIndex:ot,geometry:xt.geometry,properties:H.properties,type:tp[H.type],sortKey:ue}),se&&(R[se.name]=!0),Ct){const Yt=f.evaluate(xt,{},o).join(","),Xt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.WritingMode.vertical)>=0;for(const $t of Ct.sections)if($t.image)R[$t.image.name]=!0;else{const Qt=ss(Ct.toString()),Jt=$t.fontStack||Yt,Bt=O[Jt]=O[Jt]||{};this.calculateGlyphDependencies($t.text,Bt,Xt,this.allowVerticalPlacement,Qt)}}}p.get("symbol-placement")==="line"&&(this.features=function(H){const ct={},dt={},ot=[];let _t=0;function xt(Yt){ot.push(H[Yt]),_t++}function Ct(Yt,Xt,$t){const Qt=dt[Yt];return delete dt[Yt],dt[Xt]=Qt,ot[Qt].geometry[0].pop(),ot[Qt].geometry[0]=ot[Qt].geometry[0].concat($t[0]),Qt}function se(Yt,Xt,$t){const Qt=ct[Xt];return delete ct[Xt],ct[Yt]=Qt,ot[Qt].geometry[0].shift(),ot[Qt].geometry[0]=$t[0].concat(ot[Qt].geometry[0]),Qt}function ue(Yt,Xt,$t){const Qt=$t?Xt[0][Xt[0].length-1]:Xt[0][0];return`${Yt}:${Qt.x}:${Qt.y}`}for(let Yt=0;Yt<H.length;Yt++){const Xt=H[Yt],$t=Xt.geometry,Qt=Xt.text?Xt.text.toString():null;if(!Qt){xt(Yt);continue}const Jt=ue(Qt,$t),Bt=ue(Qt,$t,!0);if(Jt in dt&&Bt in ct&&dt[Jt]!==ct[Bt]){const ye=se(Jt,Bt,$t),pe=Ct(Jt,Bt,ot[ye].geometry);delete ct[Jt],delete dt[Bt],dt[ue(Qt,ot[pe].geometry,!0)]=pe,ot[ye].geometry=null}else Jt in dt?Ct(Jt,Bt,$t):Bt in ct?se(Jt,Bt,$t):(xt(Yt),ct[Jt]=_t-1,dt[Bt]=_t-1)}return ot.filter(Yt=>Yt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,ct)=>H.sortKey-ct.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),p=t.dist(n[t.segment]);const f={};for(let g=t.segment+1;g<n.length;g++)f[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:h},g<n.length-1&&(h+=n[g+1].dist(n[g]));for(let g=t.segment||0;g>=0;g--)f[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:p},g>0&&(p+=n[g-1].dist(n[g]));for(let g=0;g<n.length;g++){const v=f[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,h,p,f,g,v,P,C,z,R){const O=t.indexArray,U=t.layoutVertexArray,K=t.segments.prepareSegment(4*n.length,U,O,this.canOverlap?f.sortKey:void 0),H=this.glyphOffsetArray.length,ct=K.vertexLength,dt=this.allowVerticalPlacement&&g===d.WritingMode.vertical?Math.PI/2:0,ot=f.text&&f.text.sections;for(let _t=0;_t<n.length;_t++){const{tl:xt,tr:Ct,bl:se,br:ue,tex:Yt,pixelOffsetTL:Xt,pixelOffsetBR:$t,minFontScaleX:Qt,minFontScaleY:Jt,glyphOffset:Bt,isSDF:ye,sectionIndex:pe}=n[_t],He=K.vertexLength,zi=Bt[1];Al(U,v.x,v.y,xt.x,zi+xt.y,Yt.x,Yt.y,o,ye,Xt.x,Xt.y,Qt,Jt),Al(U,v.x,v.y,Ct.x,zi+Ct.y,Yt.x+Yt.w,Yt.y,o,ye,$t.x,Xt.y,Qt,Jt),Al(U,v.x,v.y,se.x,zi+se.y,Yt.x,Yt.y+Yt.h,o,ye,Xt.x,$t.y,Qt,Jt),Al(U,v.x,v.y,ue.x,zi+ue.y,Yt.x+Yt.w,Yt.y+Yt.h,o,ye,$t.x,$t.y,Qt,Jt),_c(t.dynamicLayoutVertexArray,v,dt),O.emplaceBack(He,He+1,He+2),O.emplaceBack(He+1,He+2,He+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),_t!==n.length-1&&pe===n[_t+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,f,f.index,{},R,ot&&ot[pe])}t.placedSymbolArray.emplaceBack(v.x,v.y,H,this.glyphOffsetArray.length-H,ct,P,C,v.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],g,0,!1,0,z)}_addCollisionDebugVertex(t,n,o,h,p,f){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,n,o,h,p,f,g){const v=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),P=v.vertexLength,C=p.layoutVertexArray,z=p.collisionVertexArray,R=g.anchorX,O=g.anchorY;this._addCollisionDebugVertex(C,z,f,R,O,new At(t,n)),this._addCollisionDebugVertex(C,z,f,R,O,new At(o,n)),this._addCollisionDebugVertex(C,z,f,R,O,new At(o,h)),this._addCollisionDebugVertex(C,z,f,R,O,new At(t,h)),v.vertexLength+=4;const U=p.indexArray;U.emplaceBack(P,P+1),U.emplaceBack(P+1,P+2),U.emplaceBack(P+2,P+3),U.emplaceBack(P+3,P),v.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,h){for(let p=t;p<n;p++){const f=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,h?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yc(Rt,Ch.members,te),this.iconCollisionBox=new yc(Rt,Ch.members,te);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,h,p,f,g,v,P){const C={};for(let z=n;z<o;z++){const R=t.get(z);C.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.textFeatureIndex=R.featureIndex;break}for(let z=h;z<p;z++){const R=t.get(z);C.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalTextFeatureIndex=R.featureIndex;break}for(let z=f;z<g;z++){const R=t.get(z);C.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.iconFeatureIndex=R.featureIndex;break}for(let z=v;z<P;z++){const R=t.get(z);C.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,anchorPointX:R.anchorPointX,anchorPointY:R.anchorPointY},C.verticalIconFeatureIndex=R.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),h=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<h;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),h=[],p=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const v=this.symbolInstances.get(g);h.push(0|Math.round(n*v.anchorX+o*v.anchorY)),p.push(v.featureIndex)}return f.sort((g,v)=>h[g]-h[v]||p[v]-p[g]),f}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((h,p,f)=>{h>=0&&f.indexOf(h)===p&&this.addIndicesForPlacedSymbol(this.text,h)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jh,$h;ee("SymbolBucket",qa,{omit:["layers","collisionBoxArray","features","compareText"]}),qa.MAX_GLYPHS=65535,qa.addDynamicAttributes=_c;var vc={get paint(){return $h=$h||new me({"icon-opacity":new at(Pt.paint_symbol["icon-opacity"]),"icon-color":new at(Pt.paint_symbol["icon-color"]),"icon-halo-color":new at(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new $(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new $(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(Pt.paint_symbol["text-opacity"]),"text-color":new at(Pt.paint_symbol["text-color"],{runtimeType:ji,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new at(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new at(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new at(Pt.paint_symbol["text-halo-blur"]),"text-translate":new $(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new $(Pt.paint_symbol["text-translate-anchor"])})},get layout(){return jh=jh||new me({"symbol-placement":new $(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new $(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $(Pt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $(Pt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new $(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(Pt.layout_symbol["icon-size"]),"icon-text-fit":new $(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(Pt.layout_symbol["icon-image"]),"icon-rotate":new at(Pt.layout_symbol["icon-rotate"]),"icon-padding":new at(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new $(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new at(Pt.layout_symbol["icon-offset"]),"icon-anchor":new at(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new at(Pt.layout_symbol["text-field"]),"text-font":new at(Pt.layout_symbol["text-font"]),"text-size":new at(Pt.layout_symbol["text-size"]),"text-max-width":new at(Pt.layout_symbol["text-max-width"]),"text-line-height":new $(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new at(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new at(Pt.layout_symbol["text-justify"]),"text-radial-offset":new at(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new at(Pt.layout_symbol["text-anchor"]),"text-max-angle":new $(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new $(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new at(Pt.layout_symbol["text-rotate"]),"text-padding":new $(Pt.layout_symbol["text-padding"]),"text-keep-upright":new $(Pt.layout_symbol["text-keep-upright"]),"text-transform":new at(Pt.layout_symbol["text-transform"]),"text-offset":new at(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new $(Pt.layout_symbol["text-allow-overlap"]),"text-overlap":new $(Pt.layout_symbol["text-overlap"]),"text-ignore-placement":new $(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new $(Pt.layout_symbol["text-optional"])})}};class Gh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Tr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ee("FormatSectionOverride",Gh,{omit:["defaultValue"]});class Ml extends Mi{constructor(t){super(t,vc)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const p of o)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,h){const p=this.layout.get(t).evaluate(n,{},o,h),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||Et(f.value)||!p?p:function(g,v){return v.replace(/{([^{}]+)}/g,(P,C)=>C in g?String(g[C]):"")}(n.properties,p)}createBucket(t){return new qa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of vc.paint.overridableProperties){if(!Ml.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Gh(n),h=new et(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new he("source",h):new qt("composite",h,n.value.zoomStops),this.paint._values[t]=new E(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Ml.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),h=vc.paint.properties[n];let p=!1;const f=g=>{for(const v of g)if(h.overrides&&h.overrides.hasOverride(v))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Zi)f(o.value.value.sections);else if(o.value.kind==="source"){const g=P=>{p||(P instanceof hr&&ki(P.value)===Sr?f(P.value.sections):P instanceof co?f(P.sections):P.eachChild(g))},v=o.value;v._styleExpression&&g(v._styleExpression.expression)}return p}}let Hh;var np={get paint(){return Hh=Hh||new me({"background-color":new $(Pt.paint_background["background-color"]),"background-pattern":new Dt(Pt.paint_background["background-pattern"]),"background-opacity":new $(Pt.paint_background["background-opacity"])})}};let Wh;var rp={get paint(){return Wh=Wh||new me({"raster-opacity":new $(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new $(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new $(Pt.paint_raster["raster-saturation"]),"raster-contrast":new $(Pt.paint_raster["raster-contrast"]),"raster-resampling":new $(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new $(Pt.paint_raster["raster-fade-duration"])})}};class sp extends Mi{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const op={circle:class extends Mi{constructor(i){super(i,Hu)}createBucket(i){return new Gl(i)}queryRadius(i){const t=i;return Ja("circle-radius",this,t)+Ja("circle-stroke-width",this,t)+vl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,n,o,h,p,f,g){const v=xl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,f),P=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),C=this.paint.get("circle-pitch-alignment")==="map",z=C?v:function(O,U){return O.map(K=>nh(K,U))}(v,g),R=C?P*f:P;for(const O of o)for(const U of O){const K=C?U:nh(U,g);let H=R;const ct=bl([],[U.x,U.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?H*=ct[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(H*=p.cameraToCenterDistance/ct[3]),qu(z,K,H))return!0}return!1}},heatmap:class extends Mi{createBucket(i){return new rh(i)}constructor(i){super(i,Xu),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ah({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Mi{constructor(i){super(i,Ku)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Mi{constructor(i){super(i,ud)}recalculate(i,t){super.recalculate(i,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new sc(i)}queryRadius(){return vl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,n,o,h,p,f){return Jc(xl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,f),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Mi{constructor(i){super(i,Pd)}createBucket(i){return new ac(i)}queryRadius(){return vl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,n,o,h,p,f,g){const v=xl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,f),P=this.paint.get("fill-extrusion-height").evaluate(t,n),C=this.paint.get("fill-extrusion-base").evaluate(t,n),z=function(O,U,K,H){const ct=[];for(const dt of O){const ot=[dt.x,dt.y,0,1];bl(ot,ot,U),ct.push(new At(ot[0]/ot[3],ot[1]/ot[3]))}return ct}(v,g),R=function(O,U,K,H){const ct=[],dt=[],ot=H[8]*U,_t=H[9]*U,xt=H[10]*U,Ct=H[11]*U,se=H[8]*K,ue=H[9]*K,Yt=H[10]*K,Xt=H[11]*K;for(const $t of O){const Qt=[],Jt=[];for(const Bt of $t){const ye=Bt.x,pe=Bt.y,He=H[0]*ye+H[4]*pe+H[12],zi=H[1]*ye+H[5]*pe+H[13],Ri=H[2]*ye+H[6]*pe+H[14],yn=H[3]*ye+H[7]*pe+H[15],us=Ri+xt,Fn=yn+Ct,cn=He+se,Pn=zi+ue,Nn=Ri+Yt,nr=yn+Xt,Lr=new At((He+ot)/Fn,(zi+_t)/Fn);Lr.z=us/Fn,Qt.push(Lr);const hn=new At(cn/nr,Pn/nr);hn.z=Nn/nr,Jt.push(hn)}ct.push(Qt),dt.push(Jt)}return[ct,dt]}(o,C,P,g);return function(O,U,K){let H=1/0;Jc(K,U)&&(H=bh(K,U[0]));for(let ct=0;ct<U.length;ct++){const dt=U[ct],ot=O[ct];for(let _t=0;_t<dt.length-1;_t++){const xt=dt[_t],Ct=[xt,dt[_t+1],ot[_t+1],ot[_t],xt];Kc(K,Ct)&&(H=Math.min(H,bh(K,Ct)))}}return H!==1/0&&H}(R[0],R[1],z)}},line:class extends Mi{constructor(i){super(i,Ph),this.gradientVersion=0,El||(El=new Ld(Ph.paint.properties["line-width"].specification),El.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ti,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=El.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new lc(i)}queryRadius(i){const t=i,n=Eh(Ja("line-width",this,t),Ja("line-gap-width",this,t)),o=Ja("line-offset",this,t);return n/2+Math.abs(o)+vl(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,n,o,h,p,f){const g=xl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,f),v=f/2*Eh(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),P=this.paint.get("line-offset").evaluate(t,n);return P&&(o=function(C,z){const R=[];for(let O=0;O<C.length;O++){const U=C[O],K=[];for(let H=0;H<U.length;H++){const ct=U[H-1],dt=U[H],ot=U[H+1],_t=H===0?new At(0,0):dt.sub(ct)._unit()._perp(),xt=H===U.length-1?new At(0,0):ot.sub(dt)._unit()._perp(),Ct=_t._add(xt)._unit(),se=Ct.x*xt.x+Ct.y*xt.y;se!==0&&Ct._mult(1/se),K.push(Ct._mult(z)._add(dt))}R.push(K)}return R}(o,P*f)),function(C,z,R){for(let O=0;O<z.length;O++){const U=z[O];if(C.length>=3){for(let K=0;K<U.length;K++)if(Ba(C,U[K]))return!0}if(ju(C,U,R))return!0}return!1}(g,o,v)}isTileClipped(){return!0}},symbol:Ml,background:class extends Mi{constructor(i){super(i,np)}},raster:class extends Mi{constructor(i){super(i,rp)}}};class ap{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const xc=63710088e-1;class ua{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ua(de(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,h=t.lat*n,p=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return xc*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof ua)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ua(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ua(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Xh=2*Math.PI*xc;function Kh(i){return Xh*Math.cos(i*Math.PI/180)}function Jh(i){return(180+i)/360}function Yh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Qh(i,t){return i/Kh(t)}function bc(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ll{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=ua.convert(t);return new Ll(Jh(o.lng),Yh(o.lat),Qh(n,o.lat))}toLngLat(){return new ua(360*this.x-180,bc(this.y))}toAltitude(){return this.z*Kh(bc(this.y))}meterInMercatorCoordinateUnits(){return 1/Xh*(t=bc(this.y),1/Math.cos(t*Math.PI/180));var t}}function tu(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class wc{constructor(t,n,o){if(t<0||t>25||o<0||o>=Math.pow(2,t)||n<0||n>=Math.pow(2,t))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=hl(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const h=(f=this.y,g=this.z,v=tu(256*(p=this.x),256*(f=Math.pow(2,g)-f-1),g),P=tu(256*(p+1),256*(f+1),g),v[0]+","+v[1]+","+P[0]+","+P[1]);var p,f,g,v,P;const C=function(z,R,O){let U,K="";for(let H=z;H>0;H--)U=1<<H-1,K+=(R&U?1:0)+(O&U?2:0);return K}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new At((t.x*n-this.x)*Li,(t.y*n-this.y)*Li)}toString(){return`${this.z}/${this.x}/${this.y}`}}class eu{constructor(t,n){this.wrap=t,this.canonical=n,this.key=hl(t,n.z,n.z,n.x,n.y)}}class hs{constructor(t,n,o,h,p){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new wc(o,+h,+p),this.key=hl(n,t,o,h,p)}clone(){return new hs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new hs(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?hl(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):hl(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new hs(n,this.wrap,n,o,h),new hs(n,this.wrap,n,o+1,h),new hs(n,this.wrap,n,o,h+1),new hs(n,this.wrap,n,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new hs(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new eu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ll(t.x-this.wrap,t.y))}}function hl(i,t,n,o,h){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*h+o).toString(36)+n.toString(36)+t.toString(36)}ee("CanonicalTileID",wc),ee("OverscaledTileID",hs,{omit:["posMatrix"]});class iu{constructor(t,n,o){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void gi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const h=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=o||"mapbox";for(let p=0;p<h;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(h,p)]=this.data[this._idx(h-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,h)]=this.data[this._idx(p,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let p=0;p<h;p++)for(let f=0;f<h;f++){const g=this.get(p,f);g>this.max&&(this.max=g),g<this.min&&(this.min=g)}}get(t,n){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[h],o[h+1],o[h+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,o){return(256*t*256+256*n+o)/10-1e4}_unpackTerrarium(t,n,o){return 256*t+n+o/256-32768}getPixels(){return new cs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,p=n*this.dim+this.dim,f=o*this.dim,g=o*this.dim+this.dim;switch(n){case-1:h=p-1;break;case 1:p=h+1}switch(o){case-1:f=g-1;break;case 1:g=f+1}const v=-n*this.dim,P=-o*this.dim;for(let C=f;C<g;C++)for(let z=h;z<p;z++)this.data[this._idx(z,C)]=t.data[this._idx(z+v,C+P)]}}ee("DEMData",iu);class nu{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ru{constructor(t,n,o,h,p){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=h,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class su{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ms(Li,16,0),this.grid3D=new Ms(Li,16,0),this.featureIndexArray=new F,this.promoteId=n}insert(t,n,o,h,p,f){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,p);const v=f?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const C=n[P],z=[1/0,1/0,-1/0,-1/0];for(let R=0;R<C.length;R++){const O=C[R];z[0]=Math.min(z[0],O.x),z[1]=Math.min(z[1],O.y),z[2]=Math.max(z[2],O.x),z[3]=Math.max(z[3],O.y)}z[0]<Li&&z[1]<Li&&z[2]>=0&&z[3]>=0&&v.insert(g,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new la.VectorTile(new hc(this.rawTileData)).layers,this.sourceLayerCoder=new nu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,h){this.loadVTLayers();const p=t.params||{},f=Li/t.tileSize/t.scale,g=mo(p.filter),v=t.queryGeometry,P=t.queryPadding*f,C=au(v),z=this.grid.query(C.minX-P,C.minY-P,C.maxX+P,C.maxY+P),R=au(t.cameraQueryGeometry),O=this.grid3D.query(R.minX-P,R.minY-P,R.maxX+P,R.maxY+P,(H,ct,dt,ot)=>function(_t,xt,Ct,se,ue){for(const Xt of _t)if(xt<=Xt.x&&Ct<=Xt.y&&se>=Xt.x&&ue>=Xt.y)return!0;const Yt=[new At(xt,Ct),new At(xt,ue),new At(se,ue),new At(se,Ct)];if(_t.length>2){for(const Xt of Yt)if(Ba(_t,Xt))return!0}for(let Xt=0;Xt<_t.length-1;Xt++)if(Gu(_t[Xt],_t[Xt+1],Yt))return!0;return!1}(t.cameraQueryGeometry,H-P,ct-P,dt+P,ot+P));for(const H of O)z.push(H);z.sort(lp);const U={};let K;for(let H=0;H<z.length;H++){const ct=z[H];if(ct===K)continue;K=ct;const dt=this.featureIndexArray.get(ct);let ot=null;this.loadMatchingFeature(U,dt.bucketIndex,dt.sourceLayerIndex,dt.featureIndex,g,p.layers,p.availableImages,n,o,h,(_t,xt,Ct)=>(ot||(ot=to(_t)),xt.queryIntersectsFeature(v,_t,Ct,ot,this.z,t.transform,f,t.pixelPosMatrix)))}return U}loadMatchingFeature(t,n,o,h,p,f,g,v,P,C,z){const R=this.bucketLayerIDs[n];if(f&&!function(H,ct){for(let dt=0;dt<H.length;dt++)if(ct.indexOf(H[dt])>=0)return!0;return!1}(f,R))return;const O=this.sourceLayerCoder.decode(o),U=this.vtLayers[O].feature(h);if(p.needGeometry){const H=Pa(U,!0);if(!p.filter(new wi(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!p.filter(new wi(this.tileID.overscaledZ),U))return;const K=this.getId(U,O);for(let H=0;H<R.length;H++){const ct=R[H];if(f&&f.indexOf(ct)<0)continue;const dt=v[ct];if(!dt)continue;let ot={};K&&C&&(ot=C.getState(dt.sourceLayer||"_geojsonTileLayer",K));const _t=be({},P[ct]);_t.paint=ou(_t.paint,dt.paint,U,ot,g),_t.layout=ou(_t.layout,dt.layout,U,ot,g);const xt=!z||z(U,dt,ot);if(!xt)continue;const Ct=new ru(U,this.z,this.x,this.y,K);Ct.layer=_t;let se=t[ct];se===void 0&&(se=t[ct]=[]),se.push({featureIndex:h,feature:Ct,intersectionZ:xt})}}lookupSymbolFeatures(t,n,o,h,p,f,g,v){const P={};this.loadVTLayers();const C=mo(p);for(const z of t)this.loadMatchingFeature(P,o,h,z,C,f,g,v,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function ou(i,t,n,o,h){return Ci(i,(p,f)=>{const g=t instanceof N?t.get(f):null;return g&&g.evaluate?g.evaluate(n,o,h):g})}function au(i){let t=1/0,n=1/0,o=-1/0,h=-1/0;for(const p of i)t=Math.min(t,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),h=Math.max(h,p.y);return{minX:t,minY:n,maxX:o,maxY:h}}function lp(i,t){return t-i}function lu(i,t,n,o,h){const p=[];for(let f=0;f<i.length;f++){const g=i[f];let v;for(let P=0;P<g.length-1;P++){let C=g[P],z=g[P+1];C.x<t&&z.x<t||(C.x<t?C=new At(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x<t&&(z=new At(t,C.y+(t-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y<n&&z.y<n||(C.y<n?C=new At(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round():z.y<n&&(z=new At(C.x+(n-C.y)/(z.y-C.y)*(z.x-C.x),n)._round()),C.x>=o&&z.x>=o||(C.x>=o?C=new At(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round():z.x>=o&&(z=new At(o,C.y+(o-C.x)/(z.x-C.x)*(z.y-C.y))._round()),C.y>=h&&z.y>=h||(C.y>=h?C=new At(C.x+(h-C.y)/(z.y-C.y)*(z.x-C.x),h)._round():z.y>=h&&(z=new At(C.x+(h-C.y)/(z.y-C.y)*(z.x-C.x),h)._round()),v&&C.equals(v[v.length-1])||(v=[C],p.push(v)),v.push(z)))))}}return p}ee("FeatureIndex",su,{omit:["rawTileData","sourceLayerCoder"]});class da extends At{constructor(t,n,o,h){super(t,n),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new da(this.x,this.y,this.angle,this.segment)}}function cu(i,t,n,o,h){if(t.segment===void 0)return!0;let p=t,f=t.segment+1,g=0;for(;g>-n/2;){if(f--,f<0)return!1;g-=i[f].dist(p),p=i[f]}g+=i[f].dist(i[f+1]),f++;const v=[];let P=0;for(;g<n/2;){const C=i[f],z=i[f+1];if(!z)return!1;let R=i[f-1].angleTo(C)-C.angleTo(z);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:R}),P+=R;g-v[0].distance>o;)P-=v.shift().angleDelta;if(P>h)return!1;f++,g+=C.dist(z)}return!0}function hu(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function uu(i,t,n){return i?.6*t*n:0}function du(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function cp(i,t,n,o,h,p){const f=uu(n,h,p),g=du(n,o)*p;let v=0;const P=hu(i)/2;for(let C=0;C<i.length-1;C++){const z=i[C],R=i[C+1],O=z.dist(R);if(v+O>P){const U=(P-v)/O,K=dn.number(z.x,R.x,U),H=dn.number(z.y,R.y,U),ct=new da(K,H,R.angleTo(z),C);return ct._round(),!f||cu(i,ct,g,f,t)?ct:void 0}v+=O}}function hp(i,t,n,o,h,p,f,g,v){const P=uu(o,p,f),C=du(o,h),z=C*f,R=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return t-z<t/4&&(t=z+t/4),pu(i,R?t/2*g%t:(C/2+2*p)*f*g%t,t,P,n,z,R,!1,v)}function pu(i,t,n,o,h,p,f,g,v){const P=p/2,C=hu(i);let z=0,R=t-n,O=[];for(let U=0;U<i.length-1;U++){const K=i[U],H=i[U+1],ct=K.dist(H),dt=H.angleTo(K);for(;R+n<z+ct;){R+=n;const ot=(R-z)/ct,_t=dn.number(K.x,H.x,ot),xt=dn.number(K.y,H.y,ot);if(_t>=0&&_t<v&&xt>=0&&xt<v&&R-P>=0&&R+P<=C){const Ct=new da(_t,xt,dt,U);Ct._round(),o&&!cu(i,Ct,p,o,h)||O.push(Ct)}}z+=ct}return g||O.length||f||(O=pu(i,z/2,n,o,h,p,f,!0,v)),O}ee("Anchor",da);const ja=Mr;function fu(i,t,n,o){const h=[],p=i.image,f=p.pixelRatio,g=p.paddedRect.w-2*ja,v=p.paddedRect.h-2*ja,P=i.right-i.left,C=i.bottom-i.top,z=p.stretchX||[[0,g]],R=p.stretchY||[[0,v]],O=($t,Qt)=>$t+Qt[1]-Qt[0],U=z.reduce(O,0),K=R.reduce(O,0),H=g-U,ct=v-K;let dt=0,ot=U,_t=0,xt=K,Ct=0,se=H,ue=0,Yt=ct;if(p.content&&o){const $t=p.content;dt=zl(z,0,$t[0]),_t=zl(R,0,$t[1]),ot=zl(z,$t[0],$t[2]),xt=zl(R,$t[1],$t[3]),Ct=$t[0]-dt,ue=$t[1]-_t,se=$t[2]-$t[0]-ot,Yt=$t[3]-$t[1]-xt}const Xt=($t,Qt,Jt,Bt)=>{const ye=Dl($t.stretch-dt,ot,P,i.left),pe=Rl($t.fixed-Ct,se,$t.stretch,U),He=Dl(Qt.stretch-_t,xt,C,i.top),zi=Rl(Qt.fixed-ue,Yt,Qt.stretch,K),Ri=Dl(Jt.stretch-dt,ot,P,i.left),yn=Rl(Jt.fixed-Ct,se,Jt.stretch,U),us=Dl(Bt.stretch-_t,xt,C,i.top),Fn=Rl(Bt.fixed-ue,Yt,Bt.stretch,K),cn=new At(ye,He),Pn=new At(Ri,He),Nn=new At(Ri,us),nr=new At(ye,us),Lr=new At(pe/f,zi/f),hn=new At(yn/f,Fn/f),Un=t*Math.PI/180;if(Un){const zr=Math.sin(Un),Dr=Math.cos(Un),Ji=[Dr,-zr,zr,Dr];cn._matMult(Ji),Pn._matMult(Ji),nr._matMult(Ji),Nn._matMult(Ji)}const rr=$t.stretch+$t.fixed,xr=Qt.stretch+Qt.fixed;return{tl:cn,tr:Pn,bl:nr,br:Nn,tex:{x:p.paddedRect.x+ja+rr,y:p.paddedRect.y+ja+xr,w:Jt.stretch+Jt.fixed-rr,h:Bt.stretch+Bt.fixed-xr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:hn,minFontScaleX:se/f/P,minFontScaleY:Yt/f/C,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const $t=mu(z,H,U),Qt=mu(R,ct,K);for(let Jt=0;Jt<$t.length-1;Jt++){const Bt=$t[Jt],ye=$t[Jt+1];for(let pe=0;pe<Qt.length-1;pe++)h.push(Xt(Bt,Qt[pe],ye,Qt[pe+1]))}}else h.push(Xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return h}function zl(i,t,n){let o=0;for(const h of i)o+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return o}function mu(i,t,n){const o=[{fixed:-ja,stretch:0}];for(const[h,p]of i){const f=o[o.length-1];o.push({fixed:h-f.stretch,stretch:f.stretch}),o.push({fixed:h-f.stretch,stretch:f.stretch+(p-h)})}return o.push({fixed:t+ja,stretch:n}),o}function Dl(i,t,n,o){return i/t*n+o}function Rl(i,t,n,o){return i-t*n/o}class Bl{constructor(t,n,o,h,p,f,g,v,P,C){if(this.boxStartIndex=t.length,P){let z=f.top,R=f.bottom;const O=f.collisionPadding;O&&(z-=O[1],R+=O[3]);let U=R-z;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{let z=f.top*g-v[0],R=f.bottom*g+v[2],O=f.left*g-v[3],U=f.right*g+v[1];const K=f.collisionPadding;if(K&&(O-=K[0]*g,z-=K[1]*g,U+=K[2]*g,R+=K[3]*g),C){const H=new At(O,z),ct=new At(U,z),dt=new At(O,R),ot=new At(U,R),_t=C*Math.PI/180;H._rotate(_t),ct._rotate(_t),dt._rotate(_t),ot._rotate(_t),O=Math.min(H.x,ct.x,dt.x,ot.x),U=Math.max(H.x,ct.x,dt.x,ot.x),z=Math.min(H.y,ct.y,dt.y,ot.y),R=Math.max(H.y,ct.y,dt.y,ot.y)}t.emplaceBack(n.x,n.y,O,z,U,R,o,h,p)}this.boxEndIndex=t.length}}class up{constructor(t=[],n=dp){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,h=n[t];for(;t>0;){const p=t-1>>1,f=n[p];if(o(h,f)>=0)break;n[t]=f,t=p}n[t]=h}_down(t){const{data:n,compare:o}=this,h=this.length>>1,p=n[t];for(;t<h;){let f=1+(t<<1),g=n[f];const v=f+1;if(v<this.length&&o(n[v],g)<0&&(f=v,g=n[v]),o(g,p)>=0)break;n[t]=g,t=f}n[t]=p}}function dp(i,t){return i<t?-1:i>t?1:0}function pp(i,t=1,n=!1){let o=1/0,h=1/0,p=-1/0,f=-1/0;const g=i[0];for(let O=0;O<g.length;O++){const U=g[O];(!O||U.x<o)&&(o=U.x),(!O||U.y<h)&&(h=U.y),(!O||U.x>p)&&(p=U.x),(!O||U.y>f)&&(f=U.y)}const v=Math.min(p-o,f-h);let P=v/2;const C=new up([],fp);if(v===0)return new At(o,h);for(let O=o;O<p;O+=v)for(let U=h;U<f;U+=v)C.push(new $a(O+P,U+P,P,i));let z=function(O){let U=0,K=0,H=0;const ct=O[0];for(let dt=0,ot=ct.length,_t=ot-1;dt<ot;_t=dt++){const xt=ct[dt],Ct=ct[_t],se=xt.x*Ct.y-Ct.x*xt.y;K+=(xt.x+Ct.x)*se,H+=(xt.y+Ct.y)*se,U+=3*se}return new $a(K/U,H/U,0,O)}(i),R=C.length;for(;C.length;){const O=C.pop();(O.d>z.d||!z.d)&&(z=O,n&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,R)),O.max-z.d<=t||(P=O.h/2,C.push(new $a(O.p.x-P,O.p.y-P,P,i)),C.push(new $a(O.p.x+P,O.p.y-P,P,i)),C.push(new $a(O.p.x-P,O.p.y+P,P,i)),C.push(new $a(O.p.x+P,O.p.y+P,P,i)),R+=4)}return n&&(console.log(`num probes: ${R}`),console.log(`best distance: ${z.d}`)),z.p}function fp(i,t){return t.max-i.max}function $a(i,t,n,o){this.p=new At(i,t),this.h=n,this.d=function(h,p){let f=!1,g=1/0;for(let v=0;v<p.length;v++){const P=p[v];for(let C=0,z=P.length,R=z-1;C<z;R=C++){const O=P[C],U=P[R];O.y>h.y!=U.y>h.y&&h.x<(U.x-O.x)*(h.y-O.y)/(U.y-O.y)+O.x&&(f=!f),g=Math.min(g,Yc(h,O,U))}}return(f?1:-1)*Math.sqrt(g)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Tc=Number.POSITIVE_INFINITY;function _u(i,t){return t[1]!==Tc?function(n,o,h){let p=0,f=0;switch(o=Math.abs(o),h=Math.abs(h),n){case"top-right":case"top-left":case"top":f=h-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-h}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,f]}(i,t[0],t[1]):function(n,o){let h=0,p=0;o<0&&(o=0);const f=o/Math.sqrt(2);switch(n){case"top-right":case"top-left":p=f-7;break;case"bottom-right":case"bottom-left":p=7-f;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":h=-f;break;case"top-left":case"bottom-left":h=f;break;case"left":h=o;break;case"right":h=-o}return[h,p]}(i,t[0])}function Sc(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mp(i,t,n,o,h,p,f,g,v,P,C){let z=p.textMaxSize.evaluate(t,{});z===void 0&&(z=f);const R=i.layers[0].layout,O=R.get("icon-offset").evaluate(t,{},C),U=yu(n.horizontal),K=f/24,H=i.tilePixelRatio*K,ct=i.tilePixelRatio*z/24,dt=i.tilePixelRatio*g,ot=i.tilePixelRatio*R.get("symbol-spacing"),_t=R.get("text-padding")*i.tilePixelRatio,xt=function(Bt,ye,pe,He=1){const zi=Bt.get("icon-padding").evaluate(ye,{},pe),Ri=zi&&zi.values;return[Ri[0]*He,Ri[1]*He,Ri[2]*He,Ri[3]*He]}(R,t,C,i.tilePixelRatio),Ct=R.get("text-max-angle")/180*Math.PI,se=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",ue=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Yt=R.get("symbol-placement"),Xt=ot/2,$t=R.get("icon-text-fit");let Qt;o&&$t!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Qt=Zh(o,n.vertical,$t,R.get("icon-text-fit-padding"),O,K)),U&&(o=Zh(o,U,$t,R.get("icon-text-fit-padding"),O,K)));const Jt=(Bt,ye)=>{ye.x<0||ye.x>=Li||ye.y<0||ye.y>=Li||function(pe,He,zi,Ri,yn,us,Fn,cn,Pn,Nn,nr,Lr,hn,Un,rr,xr,zr,Dr,Ji,Vn,We,Hr,Zn,sr,Ds){const eo=pe.addToLineVertexArray(He,zi);let no,$o,Rs,ds,Rr=0,Go=0,pl=0,wu=0,Lc=-1,zc=-1;const Ho={};let Tu=sn(""),Dc=0,Rc=0;if(cn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Dc,Rc]=cn.layout.get("text-offset").evaluate(We,{},sr).map(Br=>Br*Sn):(Dc=cn.layout.get("text-radial-offset").evaluate(We,{},sr)*Sn,Rc=Tc),pe.allowVerticalPlacement&&Ri.vertical){const Br=cn.layout.get("text-rotate").evaluate(We,{},sr)+90;Rs=new Bl(Pn,He,Nn,nr,Lr,Ri.vertical,hn,Un,rr,Br),Fn&&(ds=new Bl(Pn,He,Nn,nr,Lr,Fn,zr,Dr,rr,Br))}if(yn){const Br=cn.layout.get("icon-rotate").evaluate(We,{}),Io=cn.layout.get("icon-text-fit")!=="none",fl=fu(yn,Br,Zn,Io),ml=Fn?fu(Fn,Br,Zn,Io):void 0;$o=new Bl(Pn,He,Nn,nr,Lr,yn,zr,Dr,!1,Br),Rr=4*fl.length;const Eu=pe.iconSizeData;let Ca=null;Eu.kind==="source"?(Ca=[Co*cn.layout.get("icon-size").evaluate(We,{})],Ca[0]>ha&&gi(`${pe.layerIds[0]}: Value for "icon-size" is >= ${cl}. Reduce your "icon-size".`)):Eu.kind==="composite"&&(Ca=[Co*Hr.compositeIconSizes[0].evaluate(We,{},sr),Co*Hr.compositeIconSizes[1].evaluate(We,{},sr)],(Ca[0]>ha||Ca[1]>ha)&&gi(`${pe.layerIds[0]}: Value for "icon-size" is >= ${cl}. Reduce your "icon-size".`)),pe.addSymbols(pe.icon,fl,Ca,Vn,Ji,We,d.WritingMode.none,He,eo.lineStartIndex,eo.lineLength,-1,sr),Lc=pe.icon.placedSymbolArray.length-1,ml&&(Go=4*ml.length,pe.addSymbols(pe.icon,ml,Ca,Vn,Ji,We,d.WritingMode.vertical,He,eo.lineStartIndex,eo.lineLength,-1,sr),zc=pe.icon.placedSymbolArray.length-1)}const Su=Object.keys(Ri.horizontal);for(const Br of Su){const Io=Ri.horizontal[Br];if(!no){Tu=sn(Io.text);const ml=cn.layout.get("text-rotate").evaluate(We,{},sr);no=new Bl(Pn,He,Nn,nr,Lr,Io,hn,Un,rr,ml)}const fl=Io.positionedLines.length===1;if(pl+=gu(pe,He,Io,us,cn,rr,We,xr,eo,Ri.vertical?d.WritingMode.horizontal:d.WritingMode.horizontalOnly,fl?Su:[Br],Ho,Lc,Hr,sr),fl)break}Ri.vertical&&(wu+=gu(pe,He,Ri.vertical,us,cn,rr,We,xr,eo,d.WritingMode.vertical,["vertical"],Ho,zc,Hr,sr));const yp=no?no.boxStartIndex:pe.collisionBoxArray.length,vp=no?no.boxEndIndex:pe.collisionBoxArray.length,xp=Rs?Rs.boxStartIndex:pe.collisionBoxArray.length,bp=Rs?Rs.boxEndIndex:pe.collisionBoxArray.length,wp=$o?$o.boxStartIndex:pe.collisionBoxArray.length,Tp=$o?$o.boxEndIndex:pe.collisionBoxArray.length,Sp=ds?ds.boxStartIndex:pe.collisionBoxArray.length,Pp=ds?ds.boxEndIndex:pe.collisionBoxArray.length;let ro=-1;const Fl=(Br,Io)=>Br&&Br.circleDiameter?Math.max(Br.circleDiameter,Io):Io;ro=Fl(no,ro),ro=Fl(Rs,ro),ro=Fl($o,ro),ro=Fl(ds,ro);const Pu=ro>-1?1:0;Pu&&(ro*=Ds/Sn),pe.glyphOffsetArray.length>=qa.MAX_GLYPHS&&gi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),We.sortKey!==void 0&&pe.addToSortKeyRanges(pe.symbolInstances.length,We.sortKey),pe.symbolInstances.emplaceBack(He.x,He.y,Ho.right>=0?Ho.right:-1,Ho.center>=0?Ho.center:-1,Ho.left>=0?Ho.left:-1,Ho.vertical||-1,Lc,zc,Tu,yp,vp,xp,bp,wp,Tp,Sp,Pp,Nn,pl,wu,Rr,Go,Pu,0,hn,Dc,Rc,ro)}(i,ye,Bt,n,o,h,Qt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,H,[_t,_t,_t,_t],se,v,dt,xt,ue,O,t,p,P,C,f)};if(Yt==="line")for(const Bt of lu(t.geometry,0,0,Li,Li)){const ye=hp(Bt,ot,Ct,n.vertical||U,o,24,ct,i.overscaling,Li);for(const pe of ye)U&&_p(i,U.text,Xt,pe)||Jt(Bt,pe)}else if(Yt==="line-center"){for(const Bt of t.geometry)if(Bt.length>1){const ye=cp(Bt,Ct,n.vertical||U,o,24,ct);ye&&Jt(Bt,ye)}}else if(t.type==="Polygon")for(const Bt of ic(t.geometry,0)){const ye=pp(Bt,16);Jt(Bt[0],new da(ye.x,ye.y,0))}else if(t.type==="LineString")for(const Bt of t.geometry)Jt(Bt,new da(Bt[0].x,Bt[0].y,0));else if(t.type==="Point")for(const Bt of t.geometry)for(const ye of Bt)Jt([ye],new da(ye.x,ye.y,0))}function gu(i,t,n,o,h,p,f,g,v,P,C,z,R,O,U){const K=function(dt,ot,_t,xt,Ct,se,ue,Yt){const Xt=xt.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,$t=[];for(const Qt of ot.positionedLines)for(const Jt of Qt.positionedGlyphs){if(!Jt.rect)continue;const Bt=Jt.rect||{};let ye=Rh+1,pe=!0,He=1,zi=0;const Ri=(Ct||Yt)&&Jt.vertical,yn=Jt.metrics.advance*Jt.scale/2;if(Yt&&ot.verticalizable&&(zi=Qt.lineOffset/2-(Jt.imageName?-(Sn-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*Sn)),Jt.imageName){const Ji=ue[Jt.imageName];pe=Ji.sdf,He=Ji.pixelRatio,ye=Mr/He}const us=Ct?[Jt.x+yn,Jt.y]:[0,0];let Fn=Ct?[0,0]:[Jt.x+yn+_t[0],Jt.y+_t[1]-zi],cn=[0,0];Ri&&(cn=Fn,Fn=[0,0]);const Pn=(Jt.metrics.left-ye)*Jt.scale-yn+Fn[0],Nn=(-Jt.metrics.top-ye)*Jt.scale+Fn[1],nr=Pn+Bt.w*Jt.scale/He,Lr=Nn+Bt.h*Jt.scale/He,hn=new At(Pn,Nn),Un=new At(nr,Nn),rr=new At(Pn,Lr),xr=new At(nr,Lr);if(Ri){const Ji=new At(-yn,yn-al),Vn=-Math.PI/2,We=Sn/2-yn,Hr=new At(5-al-We,-(Jt.imageName?We:0)),Zn=new At(...cn);hn._rotateAround(Vn,Ji)._add(Hr)._add(Zn),Un._rotateAround(Vn,Ji)._add(Hr)._add(Zn),rr._rotateAround(Vn,Ji)._add(Hr)._add(Zn),xr._rotateAround(Vn,Ji)._add(Hr)._add(Zn)}if(Xt){const Ji=Math.sin(Xt),Vn=Math.cos(Xt),We=[Vn,-Ji,Ji,Vn];hn._matMult(We),Un._matMult(We),rr._matMult(We),xr._matMult(We)}const zr=new At(0,0),Dr=new At(0,0);$t.push({tl:hn,tr:Un,bl:rr,br:xr,tex:Bt,writingMode:ot.writingMode,glyphOffset:us,sectionIndex:Jt.sectionIndex,isSDF:pe,pixelOffsetTL:zr,pixelOffsetBR:Dr,minFontScaleX:0,minFontScaleY:0})}return $t}(0,n,g,h,p,f,o,i.allowVerticalPlacement),H=i.textSizeData;let ct=null;H.kind==="source"?(ct=[Co*h.layout.get("text-size").evaluate(f,{})],ct[0]>ha&&gi(`${i.layerIds[0]}: Value for "text-size" is >= ${cl}. Reduce your "text-size".`)):H.kind==="composite"&&(ct=[Co*O.compositeTextSizes[0].evaluate(f,{},U),Co*O.compositeTextSizes[1].evaluate(f,{},U)],(ct[0]>ha||ct[1]>ha)&&gi(`${i.layerIds[0]}: Value for "text-size" is >= ${cl}. Reduce your "text-size".`)),i.addSymbols(i.text,K,ct,g,p,f,P,t,v.lineStartIndex,v.lineLength,R,U);for(const dt of C)z[dt]=i.text.placedSymbolArray.length-1;return 4*K.length}function yu(i){for(const t in i)return i[t];return null}function _p(i,t,n,o){const h=i.compareText;if(t in h){const p=h[t];for(let f=p.length-1;f>=0;f--)if(o.dist(p[f])<n)return!0}else h[t]=[];return h[t].push(o),!1}const vu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Pc{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=vu[15&o];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[g]=new Uint32Array(t,4,1);return new Pc(g,f,p,t)}constructor(t,n=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=vu.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,g=t*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+v,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+v),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+v,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ec(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:g}=this,v=[0,p.length-1,0],P=[];for(;v.length;){const C=v.pop()||0,z=v.pop()||0,R=v.pop()||0;if(z-R<=g){for(let H=R;H<=z;H++){const ct=f[2*H],dt=f[2*H+1];ct>=t&&ct<=o&&dt>=n&&dt<=h&&P.push(p[H])}continue}const O=R+z>>1,U=f[2*O],K=f[2*O+1];U>=t&&U<=o&&K>=n&&K<=h&&P.push(p[O]),(C===0?t<=U:n<=K)&&(v.push(R),v.push(O-1),v.push(1-C)),(C===0?o>=U:h>=K)&&(v.push(O+1),v.push(z),v.push(1-C))}return P}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:f}=this,g=[0,h.length-1,0],v=[],P=o*o;for(;g.length;){const C=g.pop()||0,z=g.pop()||0,R=g.pop()||0;if(z-R<=f){for(let H=R;H<=z;H++)bu(p[2*H],p[2*H+1],t,n)<=P&&v.push(h[H]);continue}const O=R+z>>1,U=p[2*O],K=p[2*O+1];bu(U,K,t,n)<=P&&v.push(h[O]),(C===0?t-o<=U:n-o<=K)&&(g.push(R),g.push(O-1),g.push(1-C)),(C===0?t+o>=U:n+o>=K)&&(g.push(O+1),g.push(z),g.push(1-C))}return v}}function Ec(i,t,n,o,h,p){if(h-o<=n)return;const f=o+h>>1;xu(i,t,f,o,h,p),Ec(i,t,n,o,f-1,1-p),Ec(i,t,n,f+1,h,1-p)}function xu(i,t,n,o,h,p){for(;h>o;){if(h-o>600){const P=h-o+1,C=n-o+1,z=Math.log(P),R=.5*Math.exp(2*z/3),O=.5*Math.sqrt(z*R*(P-R)/P)*(C-P/2<0?-1:1);xu(i,t,n,Math.max(o,Math.floor(n-C*R/P+O)),Math.min(h,Math.floor(n+(P-C)*R/P+O)),p)}const f=t[2*n+p];let g=o,v=h;for(ul(i,t,o,n),t[2*h+p]>f&&ul(i,t,o,h);g<v;){for(ul(i,t,g,v),g++,v--;t[2*g+p]<f;)g++;for(;t[2*v+p]>f;)v--}t[2*o+p]===f?ul(i,t,o,v):(v++,ul(i,t,v,h)),v<=n&&(o=v+1),n<=v&&(h=v-1)}}function ul(i,t,n,o){Cc(i,n,o),Cc(t,2*n,2*o),Cc(t,2*n+1,2*o+1)}function Cc(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function bu(i,t,n,o){const h=i-n,p=t-o;return h*h+p*p}var Ic;d.PerformanceMarkers=void 0,(Ic=d.PerformanceMarkers||(d.PerformanceMarkers={})).create="create",Ic.load="load",Ic.fullLoad="fullLoad";let Ol=null,dl=[];const kc=1e3/60,Ac="loadTime",Mc="fullLoadTime",gp={mark(i){performance.mark(i)},frame(i){const t=i;Ol!=null&&dl.push(t-Ol),Ol=t},clearMetrics(){Ol=null,dl=[],performance.clearMeasures(Ac),performance.clearMeasures(Mc);for(const i in d.PerformanceMarkers)performance.clearMarks(d.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure(Ac,d.PerformanceMarkers.create,d.PerformanceMarkers.load),performance.measure(Mc,d.PerformanceMarkers.create,d.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName(Ac)[0].duration,t=performance.getEntriesByName(Mc)[0].duration,n=dl.length,o=1/(dl.reduce((p,f)=>p+f,0)/n/1e3),h=dl.filter(p=>p>kc).reduce((p,f)=>p+(f-kc)/kc,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};d.AJAXError=mi,d.ARRAY_TYPE=Oa,d.Actor=class{constructor(i,t,n){this.target=i,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yi(["receive","process"],this),this.invoker=new ap(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qi()?i:window}send(i,t,n,o,h=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[p]=n);const f=lr(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:o,mustQueue:h,sourceMapId:this.mapId,data:bo(t,f)},f),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const t=i.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[n];const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o()}else Qi()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(t.error?n(rs(t.error)):n(null,rs(t.data)))}else{let n=!1;const o=lr(this.globalScope)?void 0:[],h=t.hasCallback?(g,v)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?bo(g):null,data:bo(v,o)},o)}:g=>{n=!0};let p=null;const f=rs(t.data);if(this.parent[t.type])p=this.parent[t.type](t.sourceMapId,f,h);else if(this.parent.getWorkerSource){const g=t.type.split(".");p=this.parent.getWorkerSource(t.sourceMapId,g[0],f.source)[g[1]](f,h)}else h(new Error(`Could not find function ${t.type}`));!n&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.AlphaImage=Qa,d.CanonicalTileID=wc,d.CollisionBoxArray=u,d.CollisionCircleLayoutArray=class extends aa{},d.Color=Te,d.DEMData=iu,d.DataConstantProperty=$,d.DictionaryCoder=nu,d.EXTENT=Li,d.ErrorEvent=Bi,d.EvaluationParameters=wi,d.Event=qn,d.Evented=wr,d.FeatureIndex=su,d.FillBucket=sc,d.FillExtrusionBucket=ac,d.GeoJSONFeature=ru,d.ImageAtlas=Oh,d.ImagePosition=dc,d.KDBush=Pc,d.LineBucket=lc,d.LineStripIndexArray=class extends e{},d.LngLat=ua,d.MercatorCoordinate=Ll,d.ONE_EM=Sn,d.OverscaledTileID=hs,d.PerformanceUtils=gp,d.Point=At,d.Pos3dArray=class extends ra{},d.PosArray=W,d.Properties=me,d.Protobuf=hc,d.QuadTriangleArray=class extends Ma{},d.RGBAImage=cs,d.RasterBoundsArray=class extends sa{},d.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},d.SegmentVector=Wt,d.SymbolBucket=qa,d.Transitionable=r,d.TriangleIndexArray=zt,d.Uniform1f=zs,d.Uniform1i=class extends ir{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends ir{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},d.Uniform3f=class extends ir{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},d.Uniform4f=Ta,d.UniformColor=On,d.UniformMatrix4f=class extends ir{constructor(i,t){super(i,t),this.current=wn}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},d.UnwrappedTileID=eu,d.ValidationError=Vt,d.ZoomHistory=wo,d.addDynamicAttributes=_c,d.arrayBufferToImage=function(i,t){const n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=xi})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(i)],{type:"image/png"});n.src=i.byteLength?URL.createObjectURL(o):xi},d.arrayBufferToImageBitmap=function(i,t){const n=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(n).then(o=>{t(null,o)}).catch(o=>{t(new Error(`Could not load image because of ${o.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},d.asyncAll=function(i,t,n){if(!i.length)return n(null,[]);let o=i.length;const h=new Array(i.length);let p=null;i.forEach((f,g)=>{t(f,(v,P)=>{v&&(p=v),h[g]=P,--o==0&&n(p,h)})})},d.bezier=Gt,d.bindAll=yi,d.clamp=Ft,d.clipLine=lu,d.clone=function(i){var t=new Oa(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},d.clone$1=hi,d.collisionCircleLayout=Bd,d.config=fi,d.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},d.create=function(){var i=new Oa(16);return Oa!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.createExpression=Lt,d.createFilter=mo,d.createLayout=Ei,d.createStyleLayer=function(i){return i.type==="custom"?new sp(i):new op[i.type](i)},d.deepEqual=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!i(t[o],n[o]))return!1;return!0}return t===n},d.derefLayers=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Wr(i[n],t[i[n].ref]));return i},d.diffStyles=function(i,t){if(!i)return[{command:Ve.setStyle,args:[t]}];let n=[];try{if(!ii(i.version,t.version))return[{command:Ve.setStyle,args:[t]}];ii(i.center,t.center)||n.push({command:Ve.setCenter,args:[t.center]}),ii(i.zoom,t.zoom)||n.push({command:Ve.setZoom,args:[t.zoom]}),ii(i.bearing,t.bearing)||n.push({command:Ve.setBearing,args:[t.bearing]}),ii(i.pitch,t.pitch)||n.push({command:Ve.setPitch,args:[t.pitch]}),ii(i.sprite,t.sprite)||n.push({command:Ve.setSprite,args:[t.sprite]}),ii(i.glyphs,t.glyphs)||n.push({command:Ve.setGlyphs,args:[t.glyphs]}),ii(i.transition,t.transition)||n.push({command:Ve.setTransition,args:[t.transition]}),ii(i.light,t.light)||n.push({command:Ve.setLight,args:[t.light]});const o={},h=[];(function(f,g,v,P){let C;for(C in g=g||{},f=f||{})Object.prototype.hasOwnProperty.call(f,C)&&(Object.prototype.hasOwnProperty.call(g,C)||ms(C,v,P));for(C in g)Object.prototype.hasOwnProperty.call(g,C)&&(Object.prototype.hasOwnProperty.call(f,C)?ii(f[C],g[C])||(f[C].type==="geojson"&&g[C].type==="geojson"&&Di(f,g,C)?v.push({command:Ve.setGeoJSONSourceData,args:[C,g[C].data]}):_s(C,g,v,P)):Xr(C,g,v))})(i.sources,t.sources,h,o);const p=[];i.layers&&i.layers.forEach(f=>{o[f.source]?n.push({command:Ve.removeLayer,args:[f.id]}):p.push(f)}),n=n.concat(h),function(f,g,v){g=g||[];const P=(f=f||[]).map(gs),C=g.map(gs),z=f.reduce(oi,{}),R=g.reduce(oi,{}),O=P.slice(),U=Object.create(null);let K,H,ct,dt,ot,_t,xt;for(K=0,H=0;K<P.length;K++)ct=P[K],Object.prototype.hasOwnProperty.call(R,ct)?H++:(v.push({command:Ve.removeLayer,args:[ct]}),O.splice(O.indexOf(ct,H),1));for(K=0,H=0;K<C.length;K++)ct=C[C.length-1-K],O[O.length-1-K]!==ct&&(Object.prototype.hasOwnProperty.call(z,ct)?(v.push({command:Ve.removeLayer,args:[ct]}),O.splice(O.lastIndexOf(ct,O.length-H),1)):H++,_t=O[O.length-K],v.push({command:Ve.addLayer,args:[R[ct],_t]}),O.splice(O.length-K,0,ct),U[ct]=!0);for(K=0;K<C.length;K++)if(ct=C[K],dt=z[ct],ot=R[ct],!U[ct]&&!ii(dt,ot))if(ii(dt.source,ot.source)&&ii(dt["source-layer"],ot["source-layer"])&&ii(dt.type,ot.type)){for(xt in jn(dt.layout,ot.layout,v,ct,null,Ve.setLayoutProperty),jn(dt.paint,ot.paint,v,ct,null,Ve.setPaintProperty),ii(dt.filter,ot.filter)||v.push({command:Ve.setFilter,args:[ct,ot.filter]}),ii(dt.minzoom,ot.minzoom)&&ii(dt.maxzoom,ot.maxzoom)||v.push({command:Ve.setLayerZoomRange,args:[ct,ot.minzoom,ot.maxzoom]}),dt)Object.prototype.hasOwnProperty.call(dt,xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?jn(dt[xt],ot[xt],v,ct,xt.slice(6),Ve.setPaintProperty):ii(dt[xt],ot[xt])||v.push({command:Ve.setLayerProperty,args:[ct,xt,ot[xt]]}));for(xt in ot)Object.prototype.hasOwnProperty.call(ot,xt)&&!Object.prototype.hasOwnProperty.call(dt,xt)&&xt!=="layout"&&xt!=="paint"&&xt!=="filter"&&xt!=="metadata"&&xt!=="minzoom"&&xt!=="maxzoom"&&(xt.indexOf("paint.")===0?jn(dt[xt],ot[xt],v,ct,xt.slice(6),Ve.setPaintProperty):ii(dt[xt],ot[xt])||v.push({command:Ve.setLayerProperty,args:[ct,xt,ot[xt]]}))}else v.push({command:Ve.removeLayer,args:[ct]}),_t=O[O.lastIndexOf(ct)+1],v.push({command:Ve.addLayer,args:[ot,_t]})}(p,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:Ve.setStyle,args:[t]}]}return n},d.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},d.earthRadius=xc,d.ease=Nt,d.emitValidationErrors=Ln,d.emptyStyle=function(){const i={},t=Pt.$version;for(const n in Pt.$root){const o=Pt.$root[n];if(o.required){let h=null;h=n==="version"?t:o.type==="array"?[]:{},h!=null&&(i[n]=h)}}return i},d.equals=function(i,t){var n=i[0],o=i[1],h=i[2],p=i[3],f=i[4],g=i[5],v=i[6],P=i[7],C=i[8],z=i[9],R=i[10],O=i[11],U=i[12],K=i[13],H=i[14],ct=i[15],dt=t[0],ot=t[1],_t=t[2],xt=t[3],Ct=t[4],se=t[5],ue=t[6],Yt=t[7],Xt=t[8],$t=t[9],Qt=t[10],Jt=t[11],Bt=t[12],ye=t[13],pe=t[14],He=t[15];return Math.abs(n-dt)<=vr*Math.max(1,Math.abs(n),Math.abs(dt))&&Math.abs(o-ot)<=vr*Math.max(1,Math.abs(o),Math.abs(ot))&&Math.abs(h-_t)<=vr*Math.max(1,Math.abs(h),Math.abs(_t))&&Math.abs(p-xt)<=vr*Math.max(1,Math.abs(p),Math.abs(xt))&&Math.abs(f-Ct)<=vr*Math.max(1,Math.abs(f),Math.abs(Ct))&&Math.abs(g-se)<=vr*Math.max(1,Math.abs(g),Math.abs(se))&&Math.abs(v-ue)<=vr*Math.max(1,Math.abs(v),Math.abs(ue))&&Math.abs(P-Yt)<=vr*Math.max(1,Math.abs(P),Math.abs(Yt))&&Math.abs(C-Xt)<=vr*Math.max(1,Math.abs(C),Math.abs(Xt))&&Math.abs(z-$t)<=vr*Math.max(1,Math.abs(z),Math.abs($t))&&Math.abs(R-Qt)<=vr*Math.max(1,Math.abs(R),Math.abs(Qt))&&Math.abs(O-Jt)<=vr*Math.max(1,Math.abs(O),Math.abs(Jt))&&Math.abs(U-Bt)<=vr*Math.max(1,Math.abs(U),Math.abs(Bt))&&Math.abs(K-ye)<=vr*Math.max(1,Math.abs(K),Math.abs(ye))&&Math.abs(H-pe)<=vr*Math.max(1,Math.abs(H),Math.abs(pe))&&Math.abs(ct-He)<=vr*Math.max(1,Math.abs(ct),Math.abs(He))},d.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:h}){return i.kind==="source"?o/Co:i.kind==="composite"?dn.number(o/Co,h/Co,n):t},d.evaluateSizeForZoom=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:f}=i,g=h?Ft(pn.interpolationFactor(h,t,p,f),0,1):0;i.kind==="camera"?o=dn.number(i.minSize,i.maxSize,g):n=g}return{uSizeT:n,uSize:o}},d.evaluateVariableOffset=_u,d.evented=No,d.exported=Ae,d.extend=be,d.filterObject=Yi,d.findLineIntersection=function(i,t,n,o){const h=t.y-i.y,p=t.x-i.x,f=o.y-n.y,g=o.x-n.x,v=f*p-g*h;if(v===0)return null;const P=(g*(i.y-n.y)-f*(i.x-n.x))/v;return new At(i.x+P*p,i.y+P*h)},d.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.getAnchorAlignment=fc,d.getAnchorJustification=Sc,d.getArrayBuffer=vn,d.getDefaultExportFromCjs=Ot,d.getJSON=function(i,t){return Pe(be(i,{type:"json"}),t)},d.getOverlapMode=mc,d.getProtocolAction=Qe,d.getRTLTextPluginStatus=na,d.getReferrer=ui,d.getVideo=function(i,t){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let o=0;o<i.length;o++){const h=window.document.createElement("source");un(i[o])||(n.crossOrigin="Anonymous"),h.src=i[o],n.appendChild(h)}return{cancel:()=>{}}},d.groupByLayout=function(i,t){const n={};for(let h=0;h<i.length;h++){const p=t&&t[i[h].id]||is(i[h]);t&&(t[i[h].id]=p);let f=n[p];f||(f=n[p]=[]),f.push(i[h])}const o=[];for(const h in n)o.push(n[h]);return o},d.identity=Xl,d.interpolate=dn,d.invert=function(i,t){var n=t[0],o=t[1],h=t[2],p=t[3],f=t[4],g=t[5],v=t[6],P=t[7],C=t[8],z=t[9],R=t[10],O=t[11],U=t[12],K=t[13],H=t[14],ct=t[15],dt=n*g-o*f,ot=n*v-h*f,_t=n*P-p*f,xt=o*v-h*g,Ct=o*P-p*g,se=h*P-p*v,ue=C*K-z*U,Yt=C*H-R*U,Xt=C*ct-O*U,$t=z*H-R*K,Qt=z*ct-O*K,Jt=R*ct-O*H,Bt=dt*Jt-ot*Qt+_t*$t+xt*Xt-Ct*Yt+se*ue;return Bt?(i[0]=(g*Jt-v*Qt+P*$t)*(Bt=1/Bt),i[1]=(h*Qt-o*Jt-p*$t)*Bt,i[2]=(K*se-H*Ct+ct*xt)*Bt,i[3]=(R*Ct-z*se-O*xt)*Bt,i[4]=(v*Xt-f*Jt-P*Yt)*Bt,i[5]=(n*Jt-h*Xt+p*Yt)*Bt,i[6]=(H*_t-U*se-ct*ot)*Bt,i[7]=(C*se-R*_t+O*ot)*Bt,i[8]=(f*Qt-g*Xt+P*ue)*Bt,i[9]=(o*Xt-n*Qt-p*ue)*Bt,i[10]=(U*Ct-K*_t+ct*dt)*Bt,i[11]=(z*_t-C*Ct-O*dt)*Bt,i[12]=(g*Yt-f*$t-v*ue)*Bt,i[13]=(n*$t-o*Yt+h*ue)*Bt,i[14]=(K*ot-U*xt-H*dt)*Bt,i[15]=(C*xt-z*ot+R*dt)*Bt,i):null},d.isImageBitmap=Ye,d.isSafari=lr,d.isWorker=Qi,d.keysDifference=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},d.lazyLoadRTLTextPlugin=function(){yr.isLoading()||yr.isLoaded()||na()!=="deferred"||xa()},d.makeRequest=Pe,d.mapObject=Ci,d.mercatorXfromLng=Jh,d.mercatorYfromLat=Yh,d.mercatorZfromAltitude=Qh,d.mul=Wu,d.mul$1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},d.multiply=ih,d.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},d.operations=Ve,d.ortho=function(i,t,n,o,h,p,f){var g=1/(t-n),v=1/(o-h),P=1/(p-f);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+n)*g,i[13]=(h+o)*v,i[14]=(f+p)*P,i[15]=1,i},d.parseCacheControl=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,h,p)=>{const f=h||p;return t[o]=!f||f.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},d.parseGlyphPbf=function(i){return new hc(i).readFields(Hd,[])},d.pbf=Ih,d.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Li/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0].layout,n=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new wi(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new wi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:v,maxZoom:P}=i.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new wi(v),i.canonical),n["text-size"].possiblyEvaluate(new wi(P),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:v,maxZoom:P}=i.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new wi(v),i.canonical),n["icon-size"].possiblyEvaluate(new wi(P),i.canonical)]}const h=t.get("text-line-height")*Sn,p=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",f=t.get("text-keep-upright"),g=t.get("text-size");for(const v of i.bucket.features){const P=t.get("text-font").evaluate(v,{},i.canonical).join(","),C=g.evaluate(v,{},i.canonical),z=o.layoutTextSize.evaluate(v,{},i.canonical),R=o.layoutIconSize.evaluate(v,{},i.canonical),O={horizontal:{},vertical:void 0},U=v.text;let K,H=[0,0];if(U){const ot=U.toString(),_t=t.get("text-letter-spacing").evaluate(v,{},i.canonical)*Sn,xt=ta(ot)?_t:0,Ct=t.get("text-anchor").evaluate(v,{},i.canonical),se=t.get("text-variable-anchor");if(!se){const Qt=t.get("text-radial-offset").evaluate(v,{},i.canonical);H=Qt?_u(Ct,[Qt*Sn,Tc]):t.get("text-offset").evaluate(v,{},i.canonical).map(Jt=>Jt*Sn)}let ue=p?"center":t.get("text-justify").evaluate(v,{},i.canonical);const Yt=t.get("symbol-placement"),Xt=Yt==="point"?t.get("text-max-width").evaluate(v,{},i.canonical)*Sn:0,$t=()=>{i.bucket.allowVerticalPlacement&&ss(ot)&&(O.vertical=Il(U,i.glyphMap,i.glyphPositions,i.imagePositions,P,Xt,h,Ct,"left",xt,H,d.WritingMode.vertical,!0,Yt,z,C))};if(!p&&se){const Qt=ue==="auto"?se.map(Bt=>Sc(Bt)):[ue];let Jt=!1;for(let Bt=0;Bt<Qt.length;Bt++){const ye=Qt[Bt];if(!O.horizontal[ye])if(Jt)O.horizontal[ye]=O.horizontal[0];else{const pe=Il(U,i.glyphMap,i.glyphPositions,i.imagePositions,P,Xt,h,"center",ye,xt,H,d.WritingMode.horizontal,!1,Yt,z,C);pe&&(O.horizontal[ye]=pe,Jt=pe.positionedLines.length===1)}}$t()}else{ue==="auto"&&(ue=Sc(Ct));const Qt=Il(U,i.glyphMap,i.glyphPositions,i.imagePositions,P,Xt,h,Ct,ue,xt,H,d.WritingMode.horizontal,!1,Yt,z,C);Qt&&(O.horizontal[ue]=Qt),$t(),ss(ot)&&p&&f&&(O.vertical=Il(U,i.glyphMap,i.glyphPositions,i.imagePositions,P,Xt,h,Ct,ue,xt,H,d.WritingMode.vertical,!1,Yt,z,C))}}let ct=!1;if(v.icon&&v.icon.name){const ot=i.imageMap[v.icon.name];ot&&(K=Qd(i.imagePositions[v.icon.name],t.get("icon-offset").evaluate(v,{},i.canonical),t.get("icon-anchor").evaluate(v,{},i.canonical)),ct=!!ot.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ct:i.bucket.sdfIcons!==ct&&gi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ot.pixelRatio!==i.bucket.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const dt=yu(O.horizontal)||O.vertical;i.bucket.iconsInText=!!dt&&dt.iconsInText,(dt||K)&&mp(i.bucket,v,O,K,i.imageMap,o,z,R,H,ct,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},d.perspective=function(i,t,n,o,h){var p,f=1/Math.tan(t/2);return i[0]=f/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+o)*(p=1/(o-h)),i[14]=2*h*o*p):(i[10]=-1,i[14]=-2*o),i},d.pick=function(i,t){const n={};for(let o=0;o<t.length;o++){const h=t[o];h in i&&(n[h]=i[h])}return n},d.plugin=yr,d.pointGeometry=yt,d.polygonIntersectsPolygon=Kc,d.potpack=Bh,d.register=ee,d.registerForPluginStateChange=function(i){return i({pluginStatus:zn,pluginURL:Ls}),No.on("pluginStateChange",i),i},d.renderColorRamp=ah,d.rotateX=function(i,t,n){var o=Math.sin(n),h=Math.cos(n),p=t[4],f=t[5],g=t[6],v=t[7],P=t[8],C=t[9],z=t[10],R=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*h+P*o,i[5]=f*h+C*o,i[6]=g*h+z*o,i[7]=v*h+R*o,i[8]=P*h-p*o,i[9]=C*h-f*o,i[10]=z*h-g*o,i[11]=R*h-v*o,i},d.rotateZ=function(i,t,n){var o=Math.sin(n),h=Math.cos(n),p=t[0],f=t[1],g=t[2],v=t[3],P=t[4],C=t[5],z=t[6],R=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*h+P*o,i[1]=f*h+C*o,i[2]=g*h+z*o,i[3]=v*h+R*o,i[4]=P*h-p*o,i[5]=C*h-f*o,i[6]=z*h-g*o,i[7]=R*h-v*o,i},d.sameOrigin=un,d.scale=function(i,t,n){var o=n[0],h=n[1],p=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},d.setRTLTextPlugin=function(i,t,n=!1){if(zn===ya||zn===Ks||zn===Js)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ls=Ae.resolveURL(i),zn=ya,So=t,ia(),n||xa()},d.sphericalToCartesian=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},d.toEvaluationFeature=Pa,d.transformMat4=bl,d.translate=function(i,t,n){var o,h,p,f,g,v,P,C,z,R,O,U,K=n[0],H=n[1],ct=n[2];return t===i?(i[12]=t[0]*K+t[4]*H+t[8]*ct+t[12],i[13]=t[1]*K+t[5]*H+t[9]*ct+t[13],i[14]=t[2]*K+t[6]*H+t[10]*ct+t[14],i[15]=t[3]*K+t[7]*H+t[11]*ct+t[15]):(h=t[1],p=t[2],f=t[3],g=t[4],v=t[5],P=t[6],C=t[7],z=t[8],R=t[9],O=t[10],U=t[11],i[0]=o=t[0],i[1]=h,i[2]=p,i[3]=f,i[4]=g,i[5]=v,i[6]=P,i[7]=C,i[8]=z,i[9]=R,i[10]=O,i[11]=U,i[12]=o*K+g*H+z*ct+t[12],i[13]=h*K+v*H+R*ct+t[13],i[14]=p*K+P*H+O*ct+t[14],i[15]=f*K+C*H+U*ct+t[15]),i},d.triggerPluginCompletionEvent=va,d.unicodeBlockLookup=Kt,d.uniqueId=function(){return ci++},d.v8Spec=Pt,d.validateCustomStyleLayer=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},d.validateLight=Ha,d.validateStyle=ns,d.vectorTile=la,d.warnOnce=gi,d.wrap=de}),wt(["./shared"],function(d){class Ot{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,B){for(const Q of D){this._layerConfigs[Q.id]=Q;const nt=this._layers[Q.id]=d.createStyleLayer(Q);nt._featureFilter=d.createFilter(nt.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of B)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const Z=d.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const Q of Z){const nt=Q.map(kt=>this._layers[kt.id]),ht=nt[0];if(ht.visibility==="none")continue;const st=ht.source||"";let rt=this.familiesBySource[st];rt||(rt=this.familiesBySource[st]={});const ut=ht.sourceLayer||"_geojsonTileLayer";let ft=rt[ut];ft||(ft=rt[ut]=[]),ft.push(nt)}}}class yt{constructor(D){const B={},Z=[];for(const st in D){const rt=D[st],ut=B[st]={};for(const ft in rt){const kt=rt[+ft];if(!kt||kt.bitmap.width===0||kt.bitmap.height===0)continue;const It={x:0,y:0,w:kt.bitmap.width+2,h:kt.bitmap.height+2};Z.push(It),ut[ft]={rect:It,metrics:kt.metrics}}}const{w:Q,h:nt}=d.potpack(Z),ht=new d.AlphaImage({width:Q||1,height:nt||1});for(const st in D){const rt=D[st];for(const ut in rt){const ft=rt[+ut];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const kt=B[st][ut].rect;d.AlphaImage.copy(ft.bitmap,ht,{x:0,y:0},{x:kt.x+1,y:kt.y+1},ft.bitmap)}}this.image=ht,this.positions=B}}d.register("GlyphAtlas",yt);class Se{constructor(D){this.tileID=new d.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId}parse(D,B,Z,Q,nt){this.status="parsing",this.data=D,this.collisionBoxArray=new d.CollisionBoxArray;const ht=new d.DictionaryCoder(Object.keys(D.layers).sort()),st=new d.FeatureIndex(this.tileID,this.promoteId);st.bucketLayerIDs=[];const rt={},ut={featureIndex:st,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Z},ft=B.familiesBySource[this.source];for(const Ne in ft){const $e=D.layers[Ne];if(!$e)continue;$e.version===1&&d.warnOnce(`Vector tile source "${this.source}" layer "${Ne}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=ht.encode(Ne),Fi=[];for(let Te=0;Te<$e.length;Te++){const Pi=$e.feature(Te),Hn=st.getId(Pi,Ne);Fi.push({feature:Pi,id:Hn,index:Te,sourceLayerIndex:ni})}for(const Te of ft[Ne]){const Pi=Te[0];Pi.source!==this.source&&d.warnOnce(`layer.source = ${Pi.source} does not equal this.source = ${this.source}`),Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(At(Te,this.zoom,Z),(rt[Pi.id]=Pi.createBucket({index:st.bucketLayerIDs.length,layers:Te,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source})).populate(Fi,ut,this.tileID.canonical),st.bucketLayerIDs.push(Te.map(Hn=>Hn.id)))}}let kt,It,fe,ke;const ie=d.mapObject(ut.glyphDependencies,Ne=>Object.keys(Ne).map(Number));Object.keys(ie).length?Q.send("getGlyphs",{uid:this.uid,stacks:ie,source:this.source,tileID:this.tileID,type:"glyphs"},(Ne,$e)=>{kt||(kt=Ne,It=$e,Ze.call(this))}):It={};const ae=Object.keys(ut.iconDependencies);ae.length?Q.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(Ne,$e)=>{kt||(kt=Ne,fe=$e,Ze.call(this))}):fe={};const ve=Object.keys(ut.patternDependencies);function Ze(){if(kt)return nt(kt);if(It&&fe&&ke){const Ne=new yt(It),$e=new d.ImageAtlas(fe,ke);for(const ni in rt){const Fi=rt[ni];Fi instanceof d.SymbolBucket?(At(Fi.layers,this.zoom,Z),d.performSymbolLayout({bucket:Fi,glyphMap:It,glyphPositions:Ne.positions,imageMap:fe,imagePositions:$e.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Fi.hasPattern&&(Fi instanceof d.LineBucket||Fi instanceof d.FillBucket||Fi instanceof d.FillExtrusionBucket)&&(At(Fi.layers,this.zoom,Z),Fi.addFeatures(ut,this.tileID.canonical,$e.patternPositions))}this.status="done",nt(null,{buckets:Object.values(rt).filter(ni=>!ni.isEmpty()),featureIndex:st,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ne.image,imageAtlas:$e,glyphMap:this.returnDependencies?It:null,iconMap:this.returnDependencies?fe:null,glyphPositions:this.returnDependencies?Ne.positions:null})}}ve.length?Q.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(Ne,$e)=>{kt||(kt=Ne,ke=$e,Ze.call(this))}):ke={},Ze.call(this)}}function At(X,D,B){const Z=new d.EvaluationParameters(D);for(const Q of X)Q.recalculate(Z,B)}function Ht(X,D){const B=d.getArrayBuffer(X.request,(Z,Q,nt,ht)=>{Z?D(Z):Q&&D(null,{vectorTile:new d.vectorTile.VectorTile(new d.Protobuf(Q)),rawData:Q,cacheControl:nt,expires:ht})});return()=>{B.cancel(),D()}}class le{constructor(D,B,Z,Q){this.actor=D,this.layerIndex=B,this.availableImages=Z,this.loadVectorData=Q||Ht,this.loading={},this.loaded={}}loadTile(D,B){const Z=D.uid;this.loading||(this.loading={});const Q=!!(D&&D.request&&D.request.collectResourceTiming)&&new d.RequestPerformance(D.request),nt=this.loading[Z]=new Se(D);nt.abort=this.loadVectorData(D,(ht,st)=>{if(delete this.loading[Z],ht||!st)return nt.status="done",this.loaded[Z]=nt,B(ht);const rt=st.rawData,ut={};st.expires&&(ut.expires=st.expires),st.cacheControl&&(ut.cacheControl=st.cacheControl);const ft={};if(Q){const kt=Q.finish();kt&&(ft.resourceTiming=JSON.parse(JSON.stringify(kt)))}nt.vectorTile=st.vectorTile,nt.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor,(kt,It)=>{if(kt||!It)return B(kt);B(null,d.extend({rawTileData:rt.slice(0)},It,ut,ft))}),this.loaded=this.loaded||{},this.loaded[Z]=nt})}reloadTile(D,B){const Z=this.loaded,Q=D.uid,nt=this;if(Z&&Z[Q]){const ht=Z[Q];ht.showCollisionBoxes=D.showCollisionBoxes;const st=(rt,ut)=>{const ft=ht.reloadCallback;ft&&(delete ht.reloadCallback,ht.parse(ht.vectorTile,nt.layerIndex,this.availableImages,nt.actor,ft)),B(rt,ut)};ht.status==="parsing"?ht.reloadCallback=st:ht.status==="done"&&(ht.vectorTile?ht.parse(ht.vectorTile,this.layerIndex,this.availableImages,this.actor,st):st())}}abortTile(D,B){const Z=this.loading,Q=D.uid;Z&&Z[Q]&&Z[Q].abort&&(Z[Q].abort(),delete Z[Q]),B()}removeTile(D,B){const Z=this.loaded,Q=D.uid;Z&&Z[Q]&&delete Z[Q],B()}}class ce{constructor(){this.loaded={}}loadTile(D,B){const{uid:Z,encoding:Q,rawImageData:nt}=D,ht=d.isImageBitmap(nt)?this.getImageData(nt):nt,st=new d.DEMData(Z,ht,Q);this.loaded=this.loaded||{},this.loaded[Z]=st,B(null,st)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(D){const B=this.loaded,Z=D.uid;B&&B[Z]&&delete B[Z]}}function Gt(X,D){if(X.length!==0){Nt(X[0],D);for(var B=1;B<X.length;B++)Nt(X[B],!D)}}function Nt(X,D){for(var B=0,Z=0,Q=0,nt=X.length,ht=nt-1;Q<nt;ht=Q++){var st=(X[Q][0]-X[ht][0])*(X[ht][1]+X[Q][1]),rt=B+st;Z+=Math.abs(B)>=Math.abs(st)?B-rt+st:st-rt+B,B=rt}B+Z>=0!=!!D&&X.reverse()}var Ft=d.getDefaultExportFromCjs(function X(D,B){var Z,Q=D&&D.type;if(Q==="FeatureCollection")for(Z=0;Z<D.features.length;Z++)X(D.features[Z],B);else if(Q==="GeometryCollection")for(Z=0;Z<D.geometries.length;Z++)X(D.geometries[Z],B);else if(Q==="Feature")X(D.geometry,B);else if(Q==="Polygon")Gt(D.coordinates,B);else if(Q==="MultiPolygon")for(Z=0;Z<D.coordinates.length;Z++)Gt(D.coordinates[Z],B);return D});const de=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;var be={exports:{}},ci=d.pointGeometry,yi=d.vectorTile.VectorTileFeature,Ci=Yi;function Yi(X,D){this.options=D||{},this.features=X,this.length=X.length}function hi(X,D){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=D||4096}Yi.prototype.feature=function(X){return new hi(this.features[X],this.options.extent)},hi.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var D=0;D<X.length;D++){for(var B=X[D],Z=[],Q=0;Q<B.length;Q++)Z.push(new ci(B[Q][0],B[Q][1]));this.geometry.push(Z)}return this.geometry},hi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,D=1/0,B=-1/0,Z=1/0,Q=-1/0,nt=0;nt<X.length;nt++)for(var ht=X[nt],st=0;st<ht.length;st++){var rt=ht[st];D=Math.min(D,rt.x),B=Math.max(B,rt.x),Z=Math.min(Z,rt.y),Q=Math.max(Q,rt.y)}return[D,Z,B,Q]},hi.prototype.toGeoJSON=yi.prototype.toGeoJSON;var Ui=d.pbf,gi=Ci;function we(X){var D=new Ui;return function(B,Z){for(var Q in B.layers)Z.writeMessage(3,Ii,B.layers[Q])}(X,D),D.finish()}function Ii(X,D){var B;D.writeVarintField(15,X.version||1),D.writeStringField(1,X.name||""),D.writeVarintField(5,X.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<X.length;B++)Z.feature=X.feature(B),D.writeMessage(2,Qi,Z);var Q=Z.keys;for(B=0;B<Q.length;B++)D.writeStringField(3,Q[B]);var nt=Z.values;for(B=0;B<nt.length;B++)D.writeMessage(4,Le,nt[B])}function Qi(X,D){var B=X.feature;B.id!==void 0&&D.writeVarintField(1,B.id),D.writeMessage(2,Vi,X),D.writeVarintField(3,B.type),D.writeMessage(4,xi,B)}function Vi(X,D){var B=X.feature,Z=X.keys,Q=X.values,nt=X.keycache,ht=X.valuecache;for(var st in B.properties){var rt=B.properties[st],ut=nt[st];if(rt!==null){ut===void 0&&(Z.push(st),nt[st]=ut=Z.length-1),D.writeVarint(ut);var ft=typeof rt;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(rt=JSON.stringify(rt));var kt=ft+":"+rt,It=ht[kt];It===void 0&&(Q.push(rt),ht[kt]=It=Q.length-1),D.writeVarint(It)}}}function lr(X,D){return(D<<3)+(7&X)}function Ye(X){return X<<1^X>>31}function xi(X,D){for(var B=X.loadGeometry(),Z=X.type,Q=0,nt=0,ht=B.length,st=0;st<ht;st++){var rt=B[st],ut=1;Z===1&&(ut=rt.length),D.writeVarint(lr(1,ut));for(var ft=Z===3?rt.length-1:rt.length,kt=0;kt<ft;kt++){kt===1&&Z!==1&&D.writeVarint(lr(2,ft-1));var It=rt[kt].x-Q,fe=rt[kt].y-nt;D.writeVarint(Ye(It)),D.writeVarint(Ye(fe)),Q+=It,nt+=fe}Z===3&&D.writeVarint(lr(7,1))}}function Le(X,D){var B=typeof X;B==="string"?D.writeStringField(1,X):B==="boolean"?D.writeBooleanField(7,X):B==="number"&&(X%1!=0?D.writeDoubleField(3,X):X<0?D.writeSVarintField(6,X):D.writeVarintField(5,X))}be.exports=we,be.exports.fromVectorTileJs=we,be.exports.fromGeojsonVt=function(X,D){D=D||{};var B={};for(var Z in X)B[Z]=new gi(X[Z].features,D),B[Z].name=Z,B[Z].version=D.version,B[Z].extent=D.extent;return we({layers:B})},be.exports.GeoJSONWrapper=gi;var br=d.getDefaultExportFromCjs(be.exports);const Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},fi=Math.fround||(mi=new Float32Array(1),X=>(mi[0]=+X,mi[0]));var mi;const ui=3,Qe=5,_e=6;class Pe{constructor(D){this.options=Object.assign(Object.create(Ae),D),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(D){const{log:B,minZoom:Z,maxZoom:Q}=this.options;B&&console.time("total time");const nt=`prepare ${D.length} points`;B&&console.time(nt),this.points=D;const ht=[];for(let rt=0;rt<D.length;rt++){const ut=D[rt];if(!ut.geometry)continue;const[ft,kt]=ut.geometry.coordinates,It=fi(tn(ft)),fe=fi(Dn(kt));ht.push(It,fe,1/0,rt,-1,1),this.options.reduce&&ht.push(0)}let st=this.trees[Q+1]=this._createTree(ht);B&&console.timeEnd(nt);for(let rt=Q;rt>=Z;rt--){const ut=+Date.now();st=this.trees[rt]=this._createTree(this._cluster(st,rt)),B&&console.log("z%d: %d clusters in %dms",rt,st.numItems,+Date.now()-ut)}return B&&console.timeEnd("total time"),this}getClusters(D,B){let Z=((D[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,D[1]));let nt=D[2]===180?180:((D[2]+180)%360+360)%360-180;const ht=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)Z=-180,nt=180;else if(Z>nt){const kt=this.getClusters([Z,Q,180,ht],B),It=this.getClusters([-180,Q,nt,ht],B);return kt.concat(It)}const st=this.trees[this._limitZoom(B)],rt=st.range(tn(Z),Dn(ht),tn(nt),Dn(Q)),ut=st.data,ft=[];for(const kt of rt){const It=this.stride*kt;ft.push(ut[It+Qe]>1?vn(ut,It,this.clusterProps):this.points[ut[It+ui]])}return ft}getChildren(D){const B=this._getOriginId(D),Z=this._getOriginZoom(D),Q="No cluster with the specified id.",nt=this.trees[Z];if(!nt)throw new Error(Q);const ht=nt.data;if(B*this.stride>=ht.length)throw new Error(Q);const st=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),rt=nt.within(ht[B*this.stride],ht[B*this.stride+1],st),ut=[];for(const ft of rt){const kt=ft*this.stride;ht[kt+4]===D&&ut.push(ht[kt+Qe]>1?vn(ht,kt,this.clusterProps):this.points[ht[kt+ui]])}if(ut.length===0)throw new Error(Q);return ut}getLeaves(D,B,Z){const Q=[];return this._appendLeaves(Q,D,B=B||10,Z=Z||0,0),Q}getTile(D,B,Z){const Q=this.trees[this._limitZoom(D)],nt=Math.pow(2,D),{extent:ht,radius:st}=this.options,rt=st/ht,ut=(Z-rt)/nt,ft=(Z+1+rt)/nt,kt={features:[]};return this._addTileFeatures(Q.range((B-rt)/nt,ut,(B+1+rt)/nt,ft),Q.data,B,Z,nt,kt),B===0&&this._addTileFeatures(Q.range(1-rt/nt,ut,1,ft),Q.data,nt,Z,nt,kt),B===nt-1&&this._addTileFeatures(Q.range(0,ut,rt/nt,ft),Q.data,-1,Z,nt,kt),kt.features.length?kt:null}getClusterExpansionZoom(D){let B=this._getOriginZoom(D)-1;for(;B<=this.options.maxZoom;){const Z=this.getChildren(D);if(B++,Z.length!==1)break;D=Z[0].properties.cluster_id}return B}_appendLeaves(D,B,Z,Q,nt){const ht=this.getChildren(B);for(const st of ht){const rt=st.properties;if(rt&&rt.cluster?nt+rt.point_count<=Q?nt+=rt.point_count:nt=this._appendLeaves(D,rt.cluster_id,Z,Q,nt):nt<Q?nt++:D.push(st),D.length===Z)break}return nt}_createTree(D){const B=new d.KDBush(D.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Z=0;Z<D.length;Z+=this.stride)B.add(D[Z],D[Z+1]);return B.finish(),B.data=D,B}_addTileFeatures(D,B,Z,Q,nt,ht){for(const st of D){const rt=st*this.stride,ut=B[rt+Qe]>1;let ft,kt,It;if(ut)ft=un(B,rt,this.clusterProps),kt=B[rt],It=B[rt+1];else{const ie=this.points[B[rt+ui]];ft=ie.properties;const[ae,ve]=ie.geometry.coordinates;kt=tn(ae),It=Dn(ve)}const fe={type:1,geometry:[[Math.round(this.options.extent*(kt*nt-Z)),Math.round(this.options.extent*(It*nt-Q))]],tags:ft};let ke;ke=ut||this.options.generateId?B[rt+ui]:this.points[B[rt+ui]].id,ke!==void 0&&(fe.id=ke),ht.features.push(fe)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,B){const{radius:Z,extent:Q,reduce:nt,minPoints:ht}=this.options,st=Z/(Q*Math.pow(2,B)),rt=D.data,ut=[],ft=this.stride;for(let kt=0;kt<rt.length;kt+=ft){if(rt[kt+2]<=B)continue;rt[kt+2]=B;const It=rt[kt],fe=rt[kt+1],ke=D.within(rt[kt],rt[kt+1],st),ie=rt[kt+Qe];let ae=ie;for(const ve of ke){const Ze=ve*ft;rt[Ze+2]>B&&(ae+=rt[Ze+Qe])}if(ae>ie&&ae>=ht){let ve,Ze=It*ie,Ne=fe*ie,$e=-1;const ni=((kt/ft|0)<<5)+(B+1)+this.points.length;for(const Fi of ke){const Te=Fi*ft;if(rt[Te+2]<=B)continue;rt[Te+2]=B;const Pi=rt[Te+Qe];Ze+=rt[Te]*Pi,Ne+=rt[Te+1]*Pi,rt[Te+4]=ni,nt&&(ve||(ve=this._map(rt,kt,!0),$e=this.clusterProps.length,this.clusterProps.push(ve)),nt(ve,this._map(rt,Te)))}rt[kt+4]=ni,ut.push(Ze/ae,Ne/ae,1/0,ni,-1,ae),nt&&ut.push($e)}else{for(let ve=0;ve<ft;ve++)ut.push(rt[kt+ve]);if(ae>1)for(const ve of ke){const Ze=ve*ft;if(!(rt[Ze+2]<=B)){rt[Ze+2]=B;for(let Ne=0;Ne<ft;Ne++)ut.push(rt[Ze+Ne])}}}}return ut}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,B,Z){if(D[B+Qe]>1){const ht=this.clusterProps[D[B+_e]];return Z?Object.assign({},ht):ht}const Q=this.points[D[B+ui]].properties,nt=this.options.map(Q);return Z&&nt===Q?Object.assign({},nt):nt}}function vn(X,D,B){return{type:"Feature",id:X[D+ui],properties:un(X,D,B),geometry:{type:"Point",coordinates:[(Z=X[D],360*(Z-.5)),qn(X[D+1])]}};var Z}function un(X,D,B){const Z=X[D+Qe],Q=Z>=1e4?`${Math.round(Z/1e3)}k`:Z>=1e3?Math.round(Z/100)/10+"k":Z,nt=X[D+_e],ht=nt===-1?{}:Object.assign({},B[nt]);return Object.assign(ht,{cluster:!0,cluster_id:X[D+ui],point_count:Z,point_count_abbreviated:Q})}function tn(X){return X/360+.5}function Dn(X){const D=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function qn(X){const D=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Bi(X,D,B,Z){for(var Q,nt=Z,ht=B-D>>1,st=B-D,rt=X[D],ut=X[D+1],ft=X[B],kt=X[B+1],It=D+3;It<B;It+=3){var fe=wr(X[It],X[It+1],rt,ut,ft,kt);if(fe>nt)Q=It,nt=fe;else if(fe===nt){var ke=Math.abs(It-ht);ke<st&&(Q=It,st=ke)}}nt>Z&&(Q-D>3&&Bi(X,D,Q,Z),X[Q+2]=nt,B-Q>3&&Bi(X,Q,B,Z))}function wr(X,D,B,Z,Q,nt){var ht=Q-B,st=nt-Z;if(ht!==0||st!==0){var rt=((X-B)*ht+(D-Z)*st)/(ht*ht+st*st);rt>1?(B=Q,Z=nt):rt>0&&(B+=ht*rt,Z+=st*rt)}return(ht=X-B)*ht+(st=D-Z)*st}function Pt(X,D,B,Z){var Q={id:X===void 0?null:X,type:D,geometry:B,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var ht=nt.geometry,st=nt.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")cr(nt,ht);else if(st==="Polygon"||st==="MultiLineString")for(var rt=0;rt<ht.length;rt++)cr(nt,ht[rt]);else if(st==="MultiPolygon")for(rt=0;rt<ht.length;rt++)for(var ut=0;ut<ht[rt].length;ut++)cr(nt,ht[rt][ut])}(Q),Q}function cr(X,D){for(var B=0;B<D.length;B+=3)X.minX=Math.min(X.minX,D[B]),X.minY=Math.min(X.minY,D[B+1]),X.maxX=Math.max(X.maxX,D[B]),X.maxY=Math.max(X.maxY,D[B+1])}function Wr(X,D,B,Z){if(D.geometry){var Q=D.geometry.coordinates,nt=D.geometry.type,ht=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),st=[],rt=D.id;if(B.promoteId?rt=D.properties[B.promoteId]:B.generateId&&(rt=Z||0),nt==="Point")ii(Q,st);else if(nt==="MultiPoint")for(var ut=0;ut<Q.length;ut++)ii(Q[ut],st);else if(nt==="LineString")Ve(Q,st,ht,!1);else if(nt==="MultiLineString"){if(B.lineMetrics){for(ut=0;ut<Q.length;ut++)Ve(Q[ut],st=[],ht,!1),X.push(Pt(rt,"LineString",st,D.properties));return}Xr(Q,st,ht,!1)}else if(nt==="Polygon")Xr(Q,st,ht,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(ut=0;ut<D.geometry.geometries.length;ut++)Wr(X,{id:rt,geometry:D.geometry.geometries[ut],properties:D.properties},B,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ut=0;ut<Q.length;ut++){var ft=[];Xr(Q[ut],ft,ht,!0),st.push(ft)}}X.push(Pt(rt,nt,st,D.properties))}}function ii(X,D){D.push(ms(X[0])),D.push(_s(X[1])),D.push(0)}function Ve(X,D,B,Z){for(var Q,nt,ht=0,st=0;st<X.length;st++){var rt=ms(X[st][0]),ut=_s(X[st][1]);D.push(rt),D.push(ut),D.push(0),st>0&&(ht+=Z?(Q*ut-rt*nt)/2:Math.sqrt(Math.pow(rt-Q,2)+Math.pow(ut-nt,2))),Q=rt,nt=ut}var ft=D.length-3;D[2]=1,Bi(D,0,ft,B),D[ft+2]=1,D.size=Math.abs(ht),D.start=0,D.end=D.size}function Xr(X,D,B,Z){for(var Q=0;Q<X.length;Q++){var nt=[];Ve(X[Q],nt,B,Z),D.push(nt)}}function ms(X){return X/360+.5}function _s(X){var D=Math.sin(X*Math.PI/180),B=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return B<0?0:B>1?1:B}function Di(X,D,B,Z,Q,nt,ht,st){if(Z/=D,nt>=(B/=D)&&ht<Z)return X;if(ht<B||nt>=Z)return null;for(var rt=[],ut=0;ut<X.length;ut++){var ft=X[ut],kt=ft.geometry,It=ft.type,fe=Q===0?ft.minX:ft.minY,ke=Q===0?ft.maxX:ft.maxY;if(fe>=B&&ke<Z)rt.push(ft);else if(!(ke<B||fe>=Z)){var ie=[];if(It==="Point"||It==="MultiPoint")jn(kt,ie,B,Z,Q);else if(It==="LineString")gs(kt,ie,B,Z,Q,!1,st.lineMetrics);else if(It==="MultiLineString")Vt(kt,ie,B,Z,Q,!1);else if(It==="Polygon")Vt(kt,ie,B,Z,Q,!0);else if(It==="MultiPolygon")for(var ae=0;ae<kt.length;ae++){var ve=[];Vt(kt[ae],ve,B,Z,Q,!0),ve.length&&ie.push(ve)}if(ie.length){if(st.lineMetrics&&It==="LineString"){for(ae=0;ae<ie.length;ae++)rt.push(Pt(ft.id,It,ie[ae],ft.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(ie.length===1?(It="LineString",ie=ie[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=ie.length===3?"Point":"MultiPoint"),rt.push(Pt(ft.id,It,ie,ft.tags))}}}return rt.length?rt:null}function jn(X,D,B,Z,Q){for(var nt=0;nt<X.length;nt+=3){var ht=X[nt+Q];ht>=B&&ht<=Z&&(D.push(X[nt]),D.push(X[nt+1]),D.push(X[nt+2]))}}function gs(X,D,B,Z,Q,nt,ht){for(var st,rt,ut=oi(X),ft=Q===0?en:ys,kt=X.start,It=0;It<X.length-3;It+=3){var fe=X[It],ke=X[It+1],ie=X[It+2],ae=X[It+3],ve=X[It+4],Ze=Q===0?fe:ke,Ne=Q===0?ae:ve,$e=!1;ht&&(st=Math.sqrt(Math.pow(fe-ae,2)+Math.pow(ke-ve,2))),Ze<B?Ne>B&&(rt=ft(ut,fe,ke,ae,ve,B),ht&&(ut.start=kt+st*rt)):Ze>Z?Ne<Z&&(rt=ft(ut,fe,ke,ae,ve,Z),ht&&(ut.start=kt+st*rt)):$n(ut,fe,ke,ie),Ne<B&&Ze>=B&&(rt=ft(ut,fe,ke,ae,ve,B),$e=!0),Ne>Z&&Ze<=Z&&(rt=ft(ut,fe,ke,ae,ve,Z),$e=!0),!nt&&$e&&(ht&&(ut.end=kt+st*rt),D.push(ut),ut=oi(X)),ht&&(kt+=st)}var ni=X.length-3;fe=X[ni],ke=X[ni+1],ie=X[ni+2],(Ze=Q===0?fe:ke)>=B&&Ze<=Z&&$n(ut,fe,ke,ie),ni=ut.length-3,nt&&ni>=3&&(ut[ni]!==ut[0]||ut[ni+1]!==ut[1])&&$n(ut,ut[0],ut[1],ut[2]),ut.length&&D.push(ut)}function oi(X){var D=[];return D.size=X.size,D.start=X.start,D.end=X.end,D}function Vt(X,D,B,Z,Q,nt){for(var ht=0;ht<X.length;ht++)gs(X[ht],D,B,Z,Q,nt,!1)}function $n(X,D,B,Z){X.push(D),X.push(B),X.push(Z)}function en(X,D,B,Z,Q,nt){var ht=(nt-D)/(Z-D);return X.push(nt),X.push(B+(Q-B)*ht),X.push(1),ht}function ys(X,D,B,Z,Q,nt){var ht=(nt-B)/(Q-B);return X.push(D+(Z-D)*ht),X.push(nt),X.push(1),ht}function Tr(X,D){for(var B=[],Z=0;Z<X.length;Z++){var Q,nt=X[Z],ht=nt.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")Q=Zt(nt.geometry,D);else if(ht==="MultiLineString"||ht==="Polygon"){Q=[];for(var st=0;st<nt.geometry.length;st++)Q.push(Zt(nt.geometry[st],D))}else if(ht==="MultiPolygon")for(Q=[],st=0;st<nt.geometry.length;st++){for(var rt=[],ut=0;ut<nt.geometry[st].length;ut++)rt.push(Zt(nt.geometry[st][ut],D));Q.push(rt)}B.push(Pt(nt.id,ht,Q,nt.tags))}return B}function Zt(X,D){var B=[];B.size=X.size,X.start!==void 0&&(B.start=X.start,B.end=X.end);for(var Z=0;Z<X.length;Z+=3)B.push(X[Z]+D,X[Z+1],X[Z+2]);return B}function Be(X,D){if(X.transformed)return X;var B,Z,Q,nt=1<<X.z,ht=X.x,st=X.y;for(B=0;B<X.features.length;B++){var rt=X.features[B],ut=rt.geometry,ft=rt.type;if(rt.geometry=[],ft===1)for(Z=0;Z<ut.length;Z+=2)rt.geometry.push(Ie(ut[Z],ut[Z+1],D,nt,ht,st));else for(Z=0;Z<ut.length;Z++){var kt=[];for(Q=0;Q<ut[Z].length;Q+=2)kt.push(Ie(ut[Z][Q],ut[Z][Q+1],D,nt,ht,st));rt.geometry.push(kt)}}return X.transformed=!0,X}function Ie(X,D,B,Z,Q,nt){return[Math.round(B*(X*Z-Q)),Math.round(B*(D*Z-nt))]}function ji(X,D,B,Z,Q){for(var nt=D===Q.maxZoom?0:Q.tolerance/((1<<D)*Q.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:Z,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<X.length;st++){ht.numFeatures++,Oi(ht,X[st],nt,Q);var rt=X[st].minX,ut=X[st].minY,ft=X[st].maxX,kt=X[st].maxY;rt<ht.minX&&(ht.minX=rt),ut<ht.minY&&(ht.minY=ut),ft>ht.maxX&&(ht.maxX=ft),kt>ht.maxY&&(ht.maxY=kt)}return ht}function Oi(X,D,B,Z){var Q=D.geometry,nt=D.type,ht=[];if(nt==="Point"||nt==="MultiPoint")for(var st=0;st<Q.length;st+=3)ht.push(Q[st]),ht.push(Q[st+1]),X.numPoints++,X.numSimplified++;else if(nt==="LineString")Me(ht,Q,X,B,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(st=0;st<Q.length;st++)Me(ht,Q[st],X,B,nt==="Polygon",st===0);else if(nt==="MultiPolygon")for(var rt=0;rt<Q.length;rt++){var ut=Q[rt];for(st=0;st<ut.length;st++)Me(ht,ut[st],X,B,!0,st===0)}if(ht.length){var ft=D.tags||null;if(nt==="LineString"&&Z.lineMetrics){for(var kt in ft={},D.tags)ft[kt]=D.tags[kt];ft.mapbox_clip_start=Q.start/Q.size,ft.mapbox_clip_end=Q.end/Q.size}var It={geometry:ht,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:ft};D.id!==null&&(It.id=D.id),X.features.push(It)}}function Me(X,D,B,Z,Q,nt){var ht=Z*Z;if(Z>0&&D.size<(Q?ht:Z))B.numPoints+=D.length/3;else{for(var st=[],rt=0;rt<D.length;rt+=3)(Z===0||D[rt+2]>ht)&&(B.numSimplified++,st.push(D[rt]),st.push(D[rt+1])),B.numPoints++;Q&&function(ut,ft){for(var kt=0,It=0,fe=ut.length,ke=fe-2;It<fe;ke=It,It+=2)kt+=(ut[It]-ut[ke])*(ut[It+1]+ut[ke+1]);if(kt>0===ft)for(It=0,fe=ut.length;It<fe/2;It+=2){var ie=ut[It],ae=ut[It+1];ut[It]=ut[fe-2-It],ut[It+1]=ut[fe-1-It],ut[fe-2-It]=ie,ut[fe-1-It]=ae}}(st,nt),X.push(st)}}function En(X,D){var B=(D=this.options=function(Q,nt){for(var ht in nt)Q[ht]=nt[ht];return Q}(Object.create(this.options),D)).debug;if(B&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(Q,nt){var ht=[];if(Q.type==="FeatureCollection")for(var st=0;st<Q.features.length;st++)Wr(ht,Q.features[st],nt,st);else Wr(ht,Q.type==="Feature"?Q:{geometry:Q},nt);return ht}(X,D);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(Q,nt){var ht=nt.buffer/nt.extent,st=Q,rt=Di(Q,1,-1-ht,ht,0,-1,2,nt),ut=Di(Q,1,1-ht,2+ht,0,-1,2,nt);return(rt||ut)&&(st=Di(Q,1,-ht,1+ht,0,-1,2,nt)||[],rt&&(st=Tr(rt,1).concat(st)),ut&&(st=st.concat(Tr(ut,-1)))),st}(Z,D),Z.length&&this.splitTile(Z,0,0,0),B&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Sr(X,D,B){return 32*((1<<X)*B+D)+X}function Cn(X,D){return D?X.properties[D]:X.id}function $i(X,D){if(X==null)return!0;if(X.type==="Feature")return Cn(X,D)!=null;if(X.type==="FeatureCollection"){const B=new Set;for(const Z of X.features){const Q=Cn(Z,D);if(Q==null||B.has(Q))return!1;B.add(Q)}return!0}return!1}function Gi(X,D){const B=new Map;if(X!=null)if(X.type==="Feature")B.set(Cn(X,D),X);else for(const Z of X.features)B.set(Cn(Z,D),Z);return B}function Ke(X,D){const B=X.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const Z=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!Z)return D(null,null);const Q=new class{constructor(ht){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=ht.length,this._features=ht}feature(ht){return new class{constructor(st){this._feature=st,this.extent=d.EXTENT,this.type=st.type,this.properties=st.tags,"id"in st&&!isNaN(st.id)&&(this.id=parseInt(st.id,10))}loadGeometry(){if(this._feature.type===1){const st=[];for(const rt of this._feature.geometry)st.push([new d.Point(rt[0],rt[1])]);return st}{const st=[];for(const rt of this._feature.geometry){const ut=[];for(const ft of rt)ut.push(new d.Point(ft[0],ft[1]));st.push(ut)}return st}}toGeoJSON(st,rt,ut){return de.call(this,st,rt,ut)}}(this._features[ht])}}(Z.features);let nt=br(Q);nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),D(null,{vectorTile:Q,rawData:nt.buffer})}En.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},En.prototype.splitTile=function(X,D,B,Z,Q,nt,ht){for(var st=[X,D,B,Z],rt=this.options,ut=rt.debug;st.length;){Z=st.pop(),B=st.pop(),D=st.pop(),X=st.pop();var ft=1<<D,kt=Sr(D,B,Z),It=this.tiles[kt];if(!It&&(ut>1&&console.time("creation"),It=this.tiles[kt]=ji(X,D,B,Z,rt),this.tileCoords.push({z:D,x:B,y:Z}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,B,Z,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));var fe="z"+D;this.stats[fe]=(this.stats[fe]||0)+1,this.total++}if(It.source=X,Q){if(D===rt.maxZoom||D===Q)continue;var ke=1<<Q-D;if(B!==Math.floor(nt/ke)||Z!==Math.floor(ht/ke))continue}else if(D===rt.indexMaxZoom||It.numPoints<=rt.indexMaxPoints)continue;if(It.source=null,X.length!==0){ut>1&&console.time("clipping");var ie,ae,ve,Ze,Ne,$e,ni=.5*rt.buffer/rt.extent,Fi=.5-ni,Te=.5+ni,Pi=1+ni;ie=ae=ve=Ze=null,Ne=Di(X,ft,B-ni,B+Te,0,It.minX,It.maxX,rt),$e=Di(X,ft,B+Fi,B+Pi,0,It.minX,It.maxX,rt),X=null,Ne&&(ie=Di(Ne,ft,Z-ni,Z+Te,1,It.minY,It.maxY,rt),ae=Di(Ne,ft,Z+Fi,Z+Pi,1,It.minY,It.maxY,rt),Ne=null),$e&&(ve=Di($e,ft,Z-ni,Z+Te,1,It.minY,It.maxY,rt),Ze=Di($e,ft,Z+Fi,Z+Pi,1,It.minY,It.maxY,rt),$e=null),ut>1&&console.timeEnd("clipping"),st.push(ie||[],D+1,2*B,2*Z),st.push(ae||[],D+1,2*B,2*Z+1),st.push(ve||[],D+1,2*B+1,2*Z),st.push(Ze||[],D+1,2*B+1,2*Z+1)}}},En.prototype.getTile=function(X,D,B){var Z=this.options,Q=Z.extent,nt=Z.debug;if(X<0||X>24)return null;var ht=1<<X,st=Sr(X,D=(D%ht+ht)%ht,B);if(this.tiles[st])return Be(this.tiles[st],Q);nt>1&&console.log("drilling down to z%d-%d-%d",X,D,B);for(var rt,ut=X,ft=D,kt=B;!rt&&ut>0;)ut--,ft=Math.floor(ft/2),kt=Math.floor(kt/2),rt=this.tiles[Sr(ut,ft,kt)];return rt&&rt.source?(nt>1&&console.log("found parent tile z%d-%d-%d",ut,ft,kt),nt>1&&console.time("drilling down"),this.splitTile(rt.source,ut,ft,kt,X,D,B),nt>1&&console.timeEnd("drilling down"),this.tiles[st]?Be(this.tiles[st],Q):null):null};class Bs extends le{constructor(D,B,Z,Q){super(D,B,Z,Ke),this._dataUpdateable=new Map,this.loadGeoJSON=(nt,ht)=>{const{promoteId:st}=nt;if(nt.request)return d.getJSON(nt.request,(rt,ut,ft,kt)=>{this._dataUpdateable=$i(ut,st)?Gi(ut,st):void 0,ht(rt,ut,ft,kt)});if(typeof nt.data=="string")try{const rt=JSON.parse(nt.data);this._dataUpdateable=$i(rt,st)?Gi(rt,st):void 0,ht(null,rt)}catch{ht(new Error(`Input data given to '${nt.source}' is not a valid GeoJSON object.`))}else nt.dataDiff?this._dataUpdateable?(function(rt,ut,ft){var kt,It,fe,ke;if(ut.removeAll&&rt.clear(),ut.remove)for(const ie of ut.remove)rt.delete(ie);if(ut.add)for(const ie of ut.add){const ae=Cn(ie,ft);ae!=null&&rt.set(ae,ie)}if(ut.update)for(const ie of ut.update){let ae=rt.get(ie.id);if(ae==null)continue;const ve=!ie.removeAllProperties&&(((kt=ie.removeProperties)===null||kt===void 0?void 0:kt.length)>0||((It=ie.addOrUpdateProperties)===null||It===void 0?void 0:It.length)>0);if((ie.newGeometry||ie.removeAllProperties||ve)&&(ae={...ae},rt.set(ie.id,ae),ve&&(ae.properties={...ae.properties})),ie.newGeometry&&(ae.geometry=ie.newGeometry),ie.removeAllProperties)ae.properties={};else if(((fe=ie.removeProperties)===null||fe===void 0?void 0:fe.length)>0)for(const Ze of ie.removeProperties)Object.prototype.hasOwnProperty.call(ae.properties,Ze)&&delete ae.properties[Ze];if(((ke=ie.addOrUpdateProperties)===null||ke===void 0?void 0:ke.length)>0)for(const{key:Ze,value:Ne}of ie.addOrUpdateProperties)ae.properties[Ze]=Ne}}(this._dataUpdateable,nt.dataDiff,st),ht(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ht(new Error(`Cannot update existing geojson data in ${nt.source}`)):ht(new Error(`Input data given to '${nt.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},Q&&(this.loadGeoJSON=Q)}loadData(D,B){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Q=!!(D&&D.request&&D.request.collectResourceTiming)&&new d.RequestPerformance(D.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(D,(nt,ht)=>{if(delete this._pendingCallback,delete this._pendingRequest,nt||!ht)return B(nt);if(typeof ht!="object")return B(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{Ft(ht,!0);try{if(D.filter){const rt=d.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(rt.result==="error")throw new Error(rt.value.map(ft=>`${ft.key}: ${ft.message}`).join(", "));ht={type:"FeatureCollection",features:ht.features.filter(ft=>rt.value.evaluate({zoom:0},ft))}}this._geoJSONIndex=D.cluster?new Pe(function({superclusterOptions:rt,clusterProperties:ut}){if(!ut||!rt)return rt;const ft={},kt={},It={accumulated:null,zoom:0},fe={properties:null},ke=Object.keys(ut);for(const ie of ke){const[ae,ve]=ut[ie],Ze=d.createExpression(ve),Ne=d.createExpression(typeof ae=="string"?[ae,["accumulated"],["get",ie]]:ae);ft[ie]=Ze.value,kt[ie]=Ne.value}return rt.map=ie=>{fe.properties=ie;const ae={};for(const ve of ke)ae[ve]=ft[ve].evaluate(It,fe);return ae},rt.reduce=(ie,ae)=>{fe.properties=ae;for(const ve of ke)It.accumulated=ie[ve],ie[ve]=kt[ve].evaluate(It,fe)},rt}(D)).load(ht.features):function(rt,ut){return new En(rt,ut)}(ht,D.geojsonVtOptions)}catch(rt){return B(rt)}this.loaded={};const st={};if(Q){const rt=Q.finish();rt&&(st.resourceTiming={},st.resourceTiming[D.source]=JSON.parse(JSON.stringify(rt)))}B(null,st)}})}reloadTile(D,B){const Z=this.loaded;return Z&&Z[D.uid]?super.reloadTile(D,B):this.loadTile(D,B)}removeSource(D,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(D,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(Z){B(Z)}}getClusterChildren(D,B){try{B(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(Z){B(Z)}}getClusterLeaves(D,B){try{B(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(Z){B(Z)}}}class Gn{constructor(D){this.self=D,this.actor=new d.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:le,geojson:Bs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,Z)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=Z},this.self.registerRTLTextPlugin=B=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=B.applyArabicShaping,d.plugin.processBidirectionalText=B.processBidirectionalText,d.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(D,B){this.referrer=B}setImages(D,B,Z){this.availableImages[D]=B;for(const Q in this.workerSources[D]){const nt=this.workerSources[D][Q];for(const ht in nt)nt[ht].availableImages=B}Z()}setLayers(D,B,Z){this.getLayerIndex(D).replace(B),Z()}updateLayers(D,B,Z){this.getLayerIndex(D).update(B.layers,B.removedIds),Z()}loadTile(D,B,Z){this.getWorkerSource(D,B.type,B.source).loadTile(B,Z)}loadDEMTile(D,B,Z){this.getDEMWorkerSource(D,B.source).loadTile(B,Z)}reloadTile(D,B,Z){this.getWorkerSource(D,B.type,B.source).reloadTile(B,Z)}abortTile(D,B,Z){this.getWorkerSource(D,B.type,B.source).abortTile(B,Z)}removeTile(D,B,Z){this.getWorkerSource(D,B.type,B.source).removeTile(B,Z)}removeDEMTile(D,B){this.getDEMWorkerSource(D,B.source).removeTile(B)}removeSource(D,B,Z){if(!this.workerSources[D]||!this.workerSources[D][B.type]||!this.workerSources[D][B.type][B.source])return;const Q=this.workerSources[D][B.type][B.source];delete this.workerSources[D][B.type][B.source],Q.removeSource!==void 0?Q.removeSource(B,Z):Z()}loadWorkerSource(D,B,Z){try{this.self.importScripts(B.url),Z()}catch(Q){Z(Q.toString())}}syncRTLPluginState(D,B,Z){try{d.plugin.setState(B);const Q=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&Q!=null){this.self.importScripts(Q);const nt=d.plugin.isParsed();Z(nt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Q}`),nt)}}catch(Q){Z(Q.toString())}}getAvailableImages(D){let B=this.availableImages[D];return B||(B=[]),B}getLayerIndex(D){let B=this.layerIndexes[D];return B||(B=this.layerIndexes[D]=new Ot),B}getWorkerSource(D,B,Z){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][B]||(this.workerSources[D][B]={}),!this.workerSources[D][B][Z]){const Q={send:(nt,ht,st)=>{this.actor.send(nt,ht,st,D)}};this.workerSources[D][B][Z]=new this.workerSourceTypes[B](Q,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][B][Z]}getDEMWorkerSource(D,B){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][B]||(this.demWorkerSources[D][B]=new ce),this.demWorkerSources[D][B]}}return d.isWorker()&&(self.worker=new Gn(self)),Gn}),wt(["./shared"],function(d){var Ot="3.1.0";class yt{static testProp(e){if(!yt.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in yt.docStyle)return e[s];return e[0]}static create(e,s,a){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),a&&a.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){yt.docStyle&&yt.selectProp&&(yt.userSelect=yt.docStyle[yt.selectProp],yt.docStyle[yt.selectProp]="none")}static enableDrag(){yt.docStyle&&yt.selectProp&&(yt.docStyle[yt.selectProp]=yt.userSelect)}static setTransform(e,s){e.style[yt.transformProp]=s}static addEventListener(e,s,a,u={}){e.addEventListener(s,a,"passive"in u?u:u.capture)}static removeEventListener(e,s,a,u={}){e.removeEventListener(s,a,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",yt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",yt.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",yt.suppressClickInternal,!0)},0)}static mousePos(e,s){const a=e.getBoundingClientRect();return new d.Point(s.clientX-a.left-e.clientLeft,s.clientY-a.top-e.clientTop)}static touchPos(e,s){const a=e.getBoundingClientRect(),u=[];for(let m=0;m<s.length;m++)u.push(new d.Point(s[m].clientX-a.left-e.clientLeft,s[m].clientY-a.top-e.clientTop));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}yt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,yt.selectProp=yt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),yt.transformProp=yt.testProp(["transform","WebkitTransform"]);const Se={supported:!1,testSupport:function(c){!le&&Ht&&(ce?Gt(c):At=c)}};let At,Ht,le=!1,ce=!1;function Gt(c){const e=c.createTexture();c.bindTexture(c.TEXTURE_2D,e);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Ht),c.isContextLost())return;Se.supported=!0}catch{}c.deleteTexture(e),le=!0}var Nt;typeof document<"u"&&(Ht=document.createElement("img"),Ht.onload=function(){At&&Gt(At),At=null,ce=!0},Ht.onerror=function(){le=!0,At=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(c){let e,s,a,u;c.resetRequestQueue=()=>{e=[],s=0,a=0,u={}},c.addThrottleControl=S=>{const A=a++;return u[A]=S,A},c.removeThrottleControl=S=>{delete u[S],T()},c.getImage=(S,A,k=!0)=>{Se.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*");const F={requestParameters:S,supportImageRefresh:k,callback:A,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),s--),T())}};return e.push(F),T(),F};const m=S=>{const{requestParameters:A,supportImageRefresh:k,callback:F}=S;return d.extend(A,{type:"image"}),(k!==!1||d.isWorker()||d.getProtocolAction(A.url)||A.headers&&!Object.keys(A.headers).reduce((W,j)=>W&&j==="accept",!0)?d.makeRequest:b)(A,(W,j,G,tt)=>{y(S,F,W,j,G,tt)})},y=(S,A,k,F,W,j)=>{k?A(k):F instanceof HTMLImageElement||F instanceof ImageBitmap?A(null,F):F&&((G,tt)=>{typeof createImageBitmap=="function"?d.arrayBufferToImageBitmap(G,tt):d.arrayBufferToImage(G,tt)})(F,(G,tt)=>{G!=null?A(G):tt!=null&&A(null,tt,{cacheControl:W,expires:j})}),S.cancelled||(S.completed=!0,s--,T())},T=()=>{const S=(()=>{const A=Object.keys(u);let k=!1;if(A.length>0){for(const F of A)if(k=u[F](),k)break}return k})()?d.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<S&&e.length>0;A++){const k=e.shift();if(k.cancelled){A--;continue}const F=m(k);s++,k.innerRequest=F}},b=(S,A)=>{const k=new Image,F=S.url;let W=!1;const j=S.credentials;return j&&j==="include"?k.crossOrigin="use-credentials":(j&&j==="same-origin"||!d.sameOrigin(F))&&(k.crossOrigin="anonymous"),k.fetchPriority="high",k.onload=()=>{A(null,k),k.onerror=k.onload=null},k.onerror=()=>{W||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),k.onerror=k.onload=null},k.src=F,{cancel:()=>{W=!0,k.src=""}}}}(Nt||(Nt={})),Nt.resetRequestQueue();var Ft,de=Nt;(function(c){c.Glyphs="Glyphs",c.Image="Image",c.Source="Source",c.SpriteImage="SpriteImage",c.SpriteJSON="SpriteJSON",c.Style="Style",c.Tile="Tile",c.Unknown="Unknown"})(Ft||(Ft={}));class be{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}normalizeSpriteURL(e,s,a){const u=function(m){const y=m.match(ci);if(!y)throw new Error(`Unable to parse URL "${m}"`);return{protocol:y[1],authority:y[2],path:y[3]||"/",params:y[4]?y[4].split("&"):[]}}(e);return u.path+=`${s}${a}`,function(m){const y=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${y}`}(u)}setTransformRequest(e){this._transformRequestFn=e}}const ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yi(c){var e=new d.ARRAY_TYPE(3);return e[0]=c[0],e[1]=c[1],e[2]=c[2],e}var Ci,Yi=function(c,e,s){return c[0]=e[0]-s[0],c[1]=e[1]-s[1],c[2]=e[2]-s[2],c};Ci=new d.ARRAY_TYPE(3),d.ARRAY_TYPE!=Float32Array&&(Ci[0]=0,Ci[1]=0,Ci[2]=0);var hi=function(c){var e=c[0],s=c[1];return e*e+s*s};function Ui(c){const e=[];if(typeof c=="string")e.push({id:"default",url:c});else if(c&&c.length>0){const s=[];for(const{id:a,url:u}of c){const m=`${a}${u}`;s.indexOf(m)===-1&&(s.push(m),e.push({id:a,url:u}))}}return e}function gi(c,e,s,a,u){if(a)return void c(a);if(u!==Object.values(e).length||u!==Object.values(s).length)return;const m={};for(const y in e){m[y]={};const T=d.exported.getImageCanvasContext(s[y]),b=e[y];for(const S in b){const{width:A,height:k,x:F,y:W,sdf:j,pixelRatio:G,stretchX:tt,stretchY:lt,content:gt}=b[S];m[y][S]={data:null,pixelRatio:G,sdf:j,stretchX:tt,stretchY:lt,content:gt,spriteData:{width:A,height:k,x:F,y:W,context:T}}}}c(null,m)}(function(){var c=new d.ARRAY_TYPE(2);d.ARRAY_TYPE!=Float32Array&&(c[0]=0,c[1]=0)})();class we{constructor(e,s,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,a){const{width:u,height:m}=e,y=!(this.size&&this.size[0]===u&&this.size[1]===m||a),{context:T}=this,{gl:b}=T;if(this.useMipmap=!!(s&&s.useMipmap),b.bindTexture(b.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!s||s.premultiply!==!1)),y)this.size=[u,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.isImageBitmap(e)?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,u,m,0,this.format,b.UNSIGNED_BYTE,e.data);else{const{x:S,y:A}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.isImageBitmap(e)?b.texSubImage2D(b.TEXTURE_2D,0,S,A,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,S,A,u,m,b.RGBA,b.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&b.generateMipmap(b.TEXTURE_2D)}bind(e,s,a){const{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),a!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,a||e),this.filter=e),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ii(c){const{userImage:e}=c;return!!(e&&e.render&&e.render())&&(c.data.replace(new Uint8Array(e.data.buffer)),!0)}class Qi extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,a);this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const a=s.spriteData;s.data=new d.RGBAImage({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let a=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(s.content,s)||(this.fire(new d.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,s){if(!e)return!0;let a=0;for(const u of e){if(u[0]<a||u[1]<u[0]||s<u[1])return!1;a=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const a=s.spriteData,u=a&&a.width||s.data.width,m=a&&a.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||m<e[1]||e[2]<0||u<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,a=!0){const u=this.getImage(e);if(a&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,s){let a=!0;if(!this.isLoaded())for(const u of e)this.images[u]||(a=!1);this.isLoaded()||a?this._notify(e,s):this.requestors.push({ids:e,callback:s})}_notify(e,s){const a={};for(const u of e){let m=this.getImage(u);m||(this.fire(new d.Event("styleimagemissing",{id:u})),m=this.getImage(u)),m?a[u]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:d.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],a=this.getImage(e);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const u={w:a.data.width+2,h:a.data.height+2,x:0,y:0},m=new d.ImagePosition(u,a);this.patterns[e]={bin:u,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:s,h:a}=d.potpack(e),u=this.atlasImage;u.resize({width:s||1,height:a||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],T=y.x+1,b=y.y+1,S=this.getImage(m).data,A=S.width,k=S.height;d.RGBAImage.copy(S,u,{x:0,y:0},{x:T,y:b},{width:A,height:k}),d.RGBAImage.copy(S,u,{x:0,y:k-1},{x:T,y:b-1},{width:A,height:1}),d.RGBAImage.copy(S,u,{x:0,y:0},{x:T,y:b+k},{width:A,height:1}),d.RGBAImage.copy(S,u,{x:A-1,y:0},{x:T-1,y:b},{width:1,height:k}),d.RGBAImage.copy(S,u,{x:0,y:0},{x:T+A,y:b},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const a=this.getImage(s);a||d.warnOnce(`Image with ID: "${s}" was not found`),Ii(a)&&this.updateImage(s,a)}}}const Vi=1e20;function lr(c,e,s,a,u,m,y,T,b){for(let S=e;S<e+a;S++)Ye(c,s*m+S,m,u,y,T,b);for(let S=s;S<s+u;S++)Ye(c,S*m+e,1,a,y,T,b)}function Ye(c,e,s,a,u,m,y){m[0]=0,y[0]=-Vi,y[1]=Vi,u[0]=c[e];for(let T=1,b=0,S=0;T<a;T++){u[T]=c[e+T*s];const A=T*T;do{const k=m[b];S=(u[T]-u[k]+A-k*k)/(T-k)/2}while(S<=y[b]&&--b>-1);b++,m[b]=T,y[b]=S,y[b+1]=Vi}for(let T=0,b=0;T<a;T++){for(;y[b+1]<T;)b++;const S=m[b],A=T-S;c[e+T*s]=u[S]+A*A}}class xi{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e,s){const a=[];for(const u in e)for(const m of e[u])a.push({stack:u,id:m});d.asyncAll(a,({stack:u,id:m},y)=>{let T=this.entries[u];T||(T=this.entries[u]={glyphs:{},requests:{},ranges:{}});let b=T.glyphs[m];if(b!==void 0)return void y(null,{stack:u,id:m,glyph:b});if(b=this._tinySDF(T,u,m),b)return T.glyphs[m]=b,void y(null,{stack:u,id:m,glyph:b});const S=Math.floor(m/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[S])return void y(null,{stack:u,id:m,glyph:b});if(!this.url)return void y(new Error("glyphsUrl is not set"));let A=T.requests[S];A||(A=T.requests[S]=[],xi.loadGlyphRange(u,S,this.url,this.requestManager,(k,F)=>{if(F){for(const W in F)this._doesCharSupportLocalGlyph(+W)||(T.glyphs[+W]=F[+W]);T.ranges[S]=!0}for(const W of A)W(k,F);delete T.requests[S]})),A.push((k,F)=>{k?y(k):F&&y(null,{stack:u,id:m,glyph:F[m]||null})})},(u,m)=>{if(u)s(u);else if(m){const y={};for(const{stack:T,id:b,glyph:S}of m)(y[T]||(y[T]={}))[b]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};s(null,y)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(d.unicodeBlockLookup["CJK Unified Ideographs"](e)||d.unicodeBlockLookup["Hangul Syllables"](e)||d.unicodeBlockLookup.Hiragana(e)||d.unicodeBlockLookup.Katakana(e))}_tinySDF(e,s,a){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let T="400";/bold/i.test(s)?T="900":/medium/i.test(s)?T="500":/light/i.test(s)&&(T="200"),m=e.tinySDF=new xi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:u,fontWeight:T})}const y=m.draw(String.fromCharCode(a));return{id:a,bitmap:new d.AlphaImage({width:y.width||30,height:y.height||30},y.data),metrics:{width:y.glyphWidth||24,height:y.glyphHeight||24,left:y.glyphLeft||0,top:y.glyphTop-27||-8,advance:y.glyphAdvance||24}}}}xi.loadGlyphRange=function(c,e,s,a,u){const m=256*e,y=m+255,T=a.transformRequest(s.replace("{fontstack}",c).replace("{range}",`${m}-${y}`),Ft.Glyphs);d.getArrayBuffer(T,(b,S)=>{if(b)u(b);else if(S){const A={};for(const k of d.parseGlyphPbf(S))A[k.id]=k;u(null,A)}})},xi.TinySDF=class{constructor({fontSize:c=24,buffer:e=3,radius:s=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=s;const T=this.size=c+4*e,b=this._createCanvas(T),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${y} ${m} ${c}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(c){const e=document.createElement("canvas");return e.width=e.height=c,e}draw(c){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:m}=this.ctx.measureText(c),y=Math.ceil(s),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-u))),b=Math.min(this.size-this.buffer,y+Math.ceil(a)),S=T+2*this.buffer,A=b+2*this.buffer,k=Math.max(S*A,0),F=new Uint8ClampedArray(k),W={data:F,width:S,height:A,glyphWidth:T,glyphHeight:b,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||b===0)return W;const{ctx:j,buffer:G,gridInner:tt,gridOuter:lt}=this;j.clearRect(G,G,T,b),j.fillText(c,G,G+y);const gt=j.getImageData(G,G,T,b);lt.fill(Vi,0,k),tt.fill(0,0,k);for(let Y=0;Y<b;Y++)for(let mt=0;mt<T;mt++){const St=gt.data[4*(Y*T+mt)+3]/255;if(St===0)continue;const Mt=(Y+G)*S+mt+G;if(St===1)lt[Mt]=0,tt[Mt]=Vi;else{const Rt=.5-St;lt[Mt]=Rt>0?Rt*Rt:0,tt[Mt]=Rt<0?Rt*Rt:0}}lr(lt,0,0,S,A,S,this.f,this.v,this.z),lr(tt,G,G,T,b,S,this.f,this.v,this.z);for(let Y=0;Y<k;Y++){const mt=Math.sqrt(lt[Y])-Math.sqrt(tt[Y]);F[Y]=Math.round(255-255*(mt/this.radius+this.cutoff))}return W}};class Le{constructor(){this.specification=d.v8Spec.light.position}possiblyEvaluate(e,s){return d.sphericalToCartesian(e.expression.evaluate(s))}interpolate(e,s,a){return{x:d.interpolate.number(e.x,s.x,a),y:d.interpolate.number(e.y,s.y,a),z:d.interpolate.number(e.z,s.z,a)}}}let br,Ae;class fi extends d.Evented{constructor(e){super(),br=br||new d.Properties({anchor:new d.DataConstantProperty(d.v8Spec.light.anchor),position:new Le,color:new d.DataConstantProperty(d.v8Spec.light.color),intensity:new d.DataConstantProperty(d.v8Spec.light.intensity)}),this._transitionable=new d.Transitionable(br),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.validateLight,e,s))for(const a in e){const u=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),u):this._transitionable.setValue(a,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,a){return(!a||a.validate!==!1)&&d.emitValidationErrors(this,e.call(d.validateStyle,d.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v8Spec})))}}class mi{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const a=e.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,s)),this.dashEntry[a]}getDashRanges(e,s,a){const u=[];let m=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,T=!0;u.push({left:m,right:y,isDash:T,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){T=!T;const A=e[S];m=b*a,b+=A,y=b*a,u.push({left:m,right:y,isDash:T,zeroLength:A===0})}return u}addRoundDash(e,s,a){const u=s/2;for(let m=-a;m<=a;m++){const y=this.width*(this.nextRow+a+m);let T=0,b=e[T];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++T]);const A=Math.abs(S-b.left),k=Math.abs(S-b.right),F=Math.min(A,k);let W;const j=m/a*(u+1);if(b.isDash){const G=u-Math.abs(j);W=Math.sqrt(F*F+G*G)}else W=u-Math.sqrt(F*F+j*j);this.data[y+S]=Math.max(0,Math.min(255,W+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const b=e[T],S=e[T+1];b.zeroLength?e.splice(T,1):S&&S.isDash===b.isDash&&(S.left=b.left,e.splice(T,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const u=this.width*this.nextRow;let m=0,y=e[m];for(let T=0;T<this.width;T++){T/y.right>1&&(y=e[++m]);const b=Math.abs(T-y.left),S=Math.abs(T-y.right),A=Math.min(b,S);this.data[u+T]=Math.max(0,Math.min(255,(y.isDash?A:-A)+128))}}addDash(e,s){const a=s?7:0,u=2*a+1;if(this.nextRow+u>this.height)return d.warnOnce("LineAtlas out of space"),null;let m=0;for(let T=0;T<e.length;T++)m+=e[T];if(m!==0){const T=this.width/m,b=this.getDashRanges(e,this.width,T);s?this.addRoundDash(b,T,a):this.addRegularDash(b)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:m};return this.nextRow+=u,this.dirty=!0,y}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class ui{constructor(e,s,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let m=0;m<u.length;m++){const y=new ui.Actor(u[m],s,a);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s,a){d.asyncAll(this.actors,(u,m)=>{u.send(e,s,m)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function Qe(c,e,s){const a=function(u,m){if(u)return s(u);if(m){const y=d.pick(d.extend(m,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(y.vectorLayers=m.vector_layers,y.vectorLayerIds=y.vectorLayers.map(T=>T.id)),s(null,y)}};return c.url?d.getJSON(e.transformRequest(c.url,Ft.Source),a):d.exported.frame(()=>a(null,c))}ui.Actor=d.Actor;class _e{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.LngLat?new d.LngLat(e.lng,e.lat):d.LngLat.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.LngLat?new d.LngLat(e.lng,e.lat):d.LngLat.convert(e),this}extend(e){const s=this._sw,a=this._ne;let u,m;if(e instanceof d.LngLat)u=e,m=e;else{if(!(e instanceof _e))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_e.convert(e)):this.extend(d.LngLat.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.LngLat.convert(e)):this;if(u=e._sw,m=e._ne,!u||!m)return this}return s||a?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new d.LngLat(u.lng,u.lat),this._ne=new d.LngLat(m.lng,m.lat)),this}getCenter(){return new d.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new d.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:a}=d.LngLat.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return e instanceof _e?e:e&&new _e(e)}static fromLngLat(e,s=0){const a=360*s/40075017,u=a/Math.cos(Math.PI/180*e.lat);return new _e(new d.LngLat(e.lng-u,e.lat-a),new d.LngLat(e.lng+u,e.lat+a))}}class Pe{constructor(e,s,a){this.bounds=_e.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),a=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*s),u=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*s),m=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*s),y=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*s);return e.x>=a&&e.x<m&&e.y>=u&&e.y<y}}class vn extends d.Evented{constructor(e,s,a,u){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(s,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qe(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new d.ErrorEvent(e)):s&&(d.extend(this,s),s.bounds&&(this.tileBounds=new Pe(s.bounds,this.minzoom,this.maxzoom)),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,Ft.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(y,T){return delete e.request,e.aborted?s(null):y&&y.status!==404?s(y):(T&&T.resourceTiming&&(e.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&e.setExpiryData(T),e.loadVectorData(T,this.map.painter),s(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}u.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=s:e.request=e.actor.send("reloadTile",u,m.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",u,m.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class un extends d.Evented{constructor(e,s,a,u){super(),this.id=e,this.dispatcher=a,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},s),d.extend(this,d.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qe(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new d.ErrorEvent(e)):s&&(d.extend(this,s),s.bounds&&(this.tileBounds=new Pe(s.bounds,this.minzoom,this.maxzoom)),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=de.getImage(this.map._requestManager.transformRequest(a,Ft.Tile),(u,m,y)=>{if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(u)e.state="errored",s(u);else if(m){this.map._refreshExpiredTiles&&y&&e.setExpiryData(y);const T=this.map.painter.context,b=T.gl;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new we(T,m,b.RGBA,{useMipmap:!0}),e.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),e.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(e,s){e.request&&(e.request.cancel(),delete e.request),s()}unloadTile(e,s){e.texture&&this.map.painter.saveTileTexture(e.texture),s()}hasTransition(){return!1}}class tn extends un{constructor(e,s,a,u){super(e,s,a,u),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function u(m,y){m&&(e.state="errored",s(m)),y&&(e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",s(null))}e.request=de.getImage(this.map._requestManager.transformRequest(a,Ft.Tile),function(m,y){if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(m)e.state="errored",s(m);else if(y){this.map._refreshExpiredTiles&&e.setExpiryData(y),delete y.cacheControl,delete y.expires;const T=d.isImageBitmap(y)&&(Ae==null&&(Ae=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ae)?y:d.exported.getImageData(y,1),b={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:T,encoding:this.encoding};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",b,u.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const s=e.canonical,a=Math.pow(2,s.z),u=(s.x-1+a)%a,m=s.x===0?e.wrap-1:e.wrap,y=(s.x+1+a)%a,T=s.x+1===a?e.wrap+1:e.wrap,b={};return b[new d.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y).key]={backfilled:!1},b[new d.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y).key]={backfilled:!1},s.y>0&&(b[new d.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y-1).key]={backfilled:!1},b[new d.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},b[new d.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y-1).key]={backfilled:!1}),s.y+1<a&&(b[new d.OverscaledTileID(e.overscaledZ,m,s.z,u,s.y+1).key]={backfilled:!1},b[new d.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},b[new d.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y+1).key]={backfilled:!1}),b}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class Dn extends d.Evented{constructor(e,s,a,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const m=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.EXTENT,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},s),this}getClusterChildren(e,s){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},s),this}getClusterLeaves(e,s,a,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:s,offset:a},u),this}_updateWorkerData(e){const s=d.extend({},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(d.exported.resolveURL(this._data),Ft.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(a,u)=>{if(this._pendingLoads--,this._removed||u&&u.abandoned)return void this.fire(new d.Event("dataabort",{dataType:"source"}));let m=null;if(u&&u.resourceTiming&&u.resourceTiming[this.id]&&(m=u.resourceTiming[this.id].slice(0)),a)return void this.fire(new d.ErrorEvent(a));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&d.extend(y,{resourceTiming:m}),this.fire(new d.Event("data",{...y,sourceDataType:"metadata"})),this.fire(new d.Event("data",{...y,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(e,s){const a=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(a,u,(m,y)=>(delete e.request,e.unloadVectorData(),e.aborted?s(null):m?s(m):(e.loadVectorData(y,this.map.painter,a==="reloadTile"),s(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var qn=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bi extends d.Evented{constructor(e,s,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e,s){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=de.getImage(this.map._requestManager.transformRequest(this.url,Ft.Image),(a,u)=>{this._request=null,this._loaded=!0,a?this.fire(new d.ErrorEvent(a)):u&&(this.image=u,e&&(this.coordinates=e),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(u){let m=1/0,y=1/0,T=-1/0,b=-1/0;for(const F of u)m=Math.min(m,F.x),y=Math.min(y,F.y),T=Math.max(T,F.x),b=Math.max(b,F.y);const S=Math.max(T-m,b-y),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),k=Math.pow(2,A);return new d.CanonicalTileID(A,Math.floor((m+T)/2*k),Math.floor((y+b)/2*k))}(s),this.minzoom=this.maxzoom=this.tileID.z;const a=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let a=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,a=!0)}a&&this.fire(new d.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class wr extends Bi{constructor(e,s,a,u){super(e,s,a,u),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,Ft.Source).url);d.getVideo(this.urls,(s,a)=>{this._loaded=!0,s?this.fire(new d.ErrorEvent(s)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new we(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let a=!1;for(const u in this.tiles){const m=this.tiles[u];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,a=!0)}a&&this.fire(new d.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Pt extends Bi{constructor(e,s,a,u){super(e,s,a,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,a=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(s,this.canvas,a.RGBA,{premultiply:!0});let u=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new d.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const cr={vector:vn,raster:un,"raster-dem":tn,geojson:Dn,video:wr,image:Bi,canvas:Pt};function Wr(c,e){const s=d.create();return d.translate(s,s,[1,1,0]),d.scale(s,s,[.5*c.width,.5*c.height,1]),d.multiply(s,s,c.calculatePosMatrix(e.toUnwrapped()))}function ii(c,e,s,a,u,m){const y=function(k,F,W){if(k)for(const j of k){const G=F[j];if(G&&G.source===W&&G.type==="fill-extrusion")return!0}else for(const j in F){const G=F[j];if(G.source===W&&G.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,c.id),T=m.maxPitchScaleFactor(),b=c.tilesIn(a,T,y);b.sort(Ve);const S=[];for(const k of b)S.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(e,s,c._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,u,m,T,Wr(c.transform,k.tileID))});const A=function(k){const F={},W={};for(const j of k){const G=j.queryResults,tt=j.wrappedTileID,lt=W[tt]=W[tt]||{};for(const gt in G){const Y=G[gt],mt=lt[gt]=lt[gt]||{},St=F[gt]=F[gt]||[];for(const Mt of Y)mt[Mt.featureIndex]||(mt[Mt.featureIndex]=!0,St.push(Mt))}}return F}(S);for(const k in A)A[k].forEach(F=>{const W=F.feature,j=c.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=j});return A}function Ve(c,e){const s=c.tileID,a=e.tileID;return s.overscaledZ-a.overscaledZ||s.canonical.y-a.canonical.y||s.wrap-a.wrap||s.canonical.x-a.canonical.x}class Xr{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,m){const y={};if(!m)return y;for(const T of u){const b=T.layerIds.map(S=>m.getLayer(S)).filter(Boolean);if(b.length!==0){T.layers=b,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(S=>b.filter(A=>A.id===S)[0]));for(const S of b)y[S.id]=T}}return y}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const m=this.buckets[u];if(m instanceof d.SymbolBucket&&m.hasRTLText){this.hasRTLText=!0,d.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const u in this.buckets){const m=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.CollisionBoxArray}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,a,u,m,y,T,b,S,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:A,transform:b,params:T,queryPadding:this.queryPadding*S},e,s,a):{}}querySourceFeatures(e,s){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),m=s&&s.sourceLayer?s.sourceLayer:"",y=u._geojsonTileLayer||u[m];if(!y)return;const T=d.createFilter(s&&s.filter),{z:b,x:S,y:A}=this.tileID.canonical,k={z:b,x:S,y:A};for(let F=0;F<y.length;F++){const W=y.feature(F);if(T.needGeometry){const tt=d.toEvaluationFeature(W,!0);if(!T.filter(new d.EvaluationParameters(this.tileID.overscaledZ),tt,this.tileID.canonical))continue}else if(!T.filter(new d.EvaluationParameters(this.tileID.overscaledZ),W))continue;const j=a.getId(W,m),G=new d.GeoJSONFeature(W,b,S,A,j);G.tile=k,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const a=d.parseCacheControl(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const m=this.expirationTime-s;m?this.expirationTime=a+Math.max(m,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const m=this.buckets[u],y=m.layers[0].sourceLayer||"_geojsonTileLayer",T=a[y],b=e[y];if(!T||!b||Object.keys(b).length===0)continue;m.update(b,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const S=s&&s.style&&s.style.getLayer(u);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<d.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=d.exported.now()+e}setDependencies(e,s){const a={};for(const u of s)a[u]=!0;this.dependencies[e]=a}hasDependency(e,s){for(const a of e){const u=this.dependencies[a];if(u){for(const m of s)if(u[m])return!0}}return!1}}class ms{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const m={value:s,timeout:void 0};if(a!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},a)),this.data[u].push(m),this.order.push(u),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const a=e.wrapped().key,u=s===void 0?0:this.data[a].indexOf(s),m=this.data[a][u];return this.data[a].splice(u,1),m.timeout&&clearTimeout(m.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||s.push(u);for(const a of s)this.remove(a.value.tileID,a)}}class _s{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,a){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.extend(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==u&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const m in this.state[e][u])a[m]||(this.deletedStates[e][u][m]=null)}else for(const m in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][m]===null&&delete this.deletedStates[e][u][m]}removeFeatureState(e,s,a){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const a=String(s),u=d.extend({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][s];if(m===null)return{};for(const y in m)delete u[y]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const m={};for(const y in this.stateChanges[u])this.state[u][y]||(this.state[u][y]={}),d.extend(this.state[u][y],this.stateChanges[u][y]),m[y]=this.state[u][y];a[u]=m}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const m={};if(this.deletedStates[u]===null)for(const y in this.state[u])m[y]={},this.state[u][y]={};else for(const y in this.deletedStates[u]){if(this.deletedStates[u][y]===null)this.state[u][y]={};else for(const T of Object.keys(this.deletedStates[u][y]))delete this.state[u][y][T];m[y]=this.state[u][y]}a[u]=a[u]||{},d.extend(a[u],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,s)}}class Di extends d.Evented{constructor(e,s,a){super(),this.id=e,this.dispatcher=a,this.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(u,m,y,T){const b=new cr[m.type](u,m,y,T);if(b.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${b.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],b),b}(e,s,a,this),this._tiles={},this._cache=new ms(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _s,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s){return this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new d.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const a=this._tiles[s];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(jn).map(e=>e.key)}getRenderableIds(e){const s=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&s.push(this._tiles[a]);return e?s.sort((a,u)=>{const m=a.tileID,y=u.tileID,T=new d.Point(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),b=new d.Point(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||b.y-T.y||b.x-T.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(jn).map(a=>a.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=s),this._loadTile(a,this._tileLoaded.bind(this,a,e,s)))}_tileLoaded(e,s,a,u){if(u)return e.state="errored",void(u.status!==404?this._source.fire(new d.ErrorEvent(u,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=d.exported.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const m=s[u];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);a(e,y),a(y,e)}}function a(u,m){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-u.tileID.canonical.x;const T=m.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),S=m.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+b)===1?y+=b:Math.abs(y-b)===1&&(y-=b)),m.dem&&u.dem&&(u.dem.backfillBorder(m.dem,y,T),u.neighboringTiles&&u.neighboringTiles[S]&&(u.neighboringTiles[S].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,a,u){for(const m in this._tiles){let y=this._tiles[m];if(u[m]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>a)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const S=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[S.key],y&&y.hasData()&&(T=S)}let b=T;for(;b.overscaledZ>s;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[T.key]=T;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=s?a:null}for(let a=e.overscaledZ-1;a>=s;a--){const u=e.scaledTo(a),m=this._getLoadedTile(u);if(m)return m}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*a*(this._maxTileCacheZoomLevels===null?d.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(m)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const a={};for(const u in this._tiles){const m=this._tiles[u];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),a[m.tileID.key]=m}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}update(e,s){if(this.transform=e,this.terrain=s,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new d.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(a=a.filter(A=>this._source.hasTile(A)))):a=[];const u=e.coveringZoomLevel(this._source),m=Math.max(u-Di.maxOverzooming,this._source.minzoom),y=Math.max(u+Di.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const k of a)if(k.canonical.z>this._source.minzoom){const F=k.scaledTo(k.canonical.z-1);A[F.key]=F;const W=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));A[W.key]=W}a=a.concat(Object.values(A))}const T=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new d.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=this._updateRetainedTiles(a,u);if(gs(this._source.type)){const A={},k={},F=Object.keys(b),W=d.exported.now();for(const j of F){const G=b[j],tt=this._tiles[j];if(!tt||tt.fadeEndTime!==0&&tt.fadeEndTime<=W)continue;const lt=this.findLoadedParent(G,m);lt&&(this._addTile(lt.tileID),A[lt.tileID.key]=lt.tileID),k[j]=G}this._retainLoadedChildren(k,u,y,b);for(const j in A)b[j]||(this._coveredTiles[j]=!0,b[j]=A[j]);if(s){const j={},G={};for(const tt of a)this._tiles[tt.key].hasData()?j[tt.key]=tt:G[tt.key]=tt;for(const tt in G){const lt=G[tt].children(this._source.maxzoom);this._tiles[lt[0].key]&&this._tiles[lt[1].key]&&this._tiles[lt[2].key]&&this._tiles[lt[3].key]&&(j[lt[0].key]=b[lt[0].key]=lt[0],j[lt[1].key]=b[lt[1].key]=lt[1],j[lt[2].key]=b[lt[2].key]=lt[2],j[lt[3].key]=b[lt[3].key]=lt[3],delete G[tt])}for(const tt in G){const lt=this.findLoadedParent(G[tt],this._source.minzoom);if(lt){j[lt.tileID.key]=b[lt.tileID.key]=lt.tileID;for(const gt in j)j[gt].isChildOf(lt.tileID)&&delete j[gt]}}for(const tt in this._tiles)j[tt]||(this._coveredTiles[tt]=!0)}}for(const A in b)this._tiles[A].clearFadeHold();const S=d.keysDifference(this._tiles,b);for(const A of S){const k=this._tiles[A];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){const a={},u={},m=Math.max(s-Di.maxOverzooming,this._source.minzoom),y=Math.max(s+Di.maxUnderzooming,this._source.minzoom),T={};for(const b of e){const S=this._addTile(b);a[b.key]=b,S.hasData()||s<this._source.maxzoom&&(T[b.key]=b)}this._retainLoadedChildren(T,s,y,a);for(const b of e){let S=this._tiles[b.key];if(S.hasData())continue;if(s+1>this._source.maxzoom){const k=b.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){a[k.key]=k;continue}}else{const k=b.children(this._source.maxzoom);if(a[k[0].key]&&a[k[1].key]&&a[k[2].key]&&a[k[3].key])continue}let A=S.wasRequested();for(let k=b.overscaledZ-1;k>=m;--k){const F=b.scaledTo(k);if(u[F.key])break;if(u[F.key]=!0,S=this.getTile(F),!S&&A&&(S=this._addTile(F)),S){const W=S.hasData();if((A||W)&&(a[F.key]=F),A=S.wasRequested(),W)break}}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}s.push(u.key);const m=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;u=m}for(const m of s)this._loadedParentTiles[m]=a}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const a=s;return s||(s=new Xr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s.uses++,this._tiles[e.key]=s,a||this._source.fire(new d.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=s.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,a){const u=[],m=this.transform;if(!m)return u;const y=a?m.getCameraQueryGeometry(e):e,T=e.map(j=>m.pointCoordinate(j,this.terrain)),b=y.map(j=>m.pointCoordinate(j,this.terrain)),S=this.getIds();let A=1/0,k=1/0,F=-1/0,W=-1/0;for(const j of b)A=Math.min(A,j.x),k=Math.min(k,j.y),F=Math.max(F,j.x),W=Math.max(W,j.y);for(let j=0;j<S.length;j++){const G=this._tiles[S[j]];if(G.holdingForFade())continue;const tt=G.tileID,lt=Math.pow(2,m.zoom-G.tileID.overscaledZ),gt=s*G.queryPadding*d.EXTENT/G.tileSize/lt,Y=[tt.getTilePoint(new d.MercatorCoordinate(A,k)),tt.getTilePoint(new d.MercatorCoordinate(F,W))];if(Y[0].x-gt<d.EXTENT&&Y[0].y-gt<d.EXTENT&&Y[1].x+gt>=0&&Y[1].y+gt>=0){const mt=T.map(Mt=>tt.getTilePoint(Mt)),St=b.map(Mt=>tt.getTilePoint(Mt));u.push({tile:G,tileID:tt,queryGeometry:mt,cameraQueryGeometry:St,scale:lt})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of s)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(gs(this._source.type)){const e=d.exported.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,a){this._state.updateState(e=e||"_geojsonTileLayer",s,a)}removeFeatureState(e,s,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,a)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,a){const u=this._tiles[e];u&&u.setDependencies(s,a)}reloadTilesForDependencies(e,s){for(const a in this._tiles)this._tiles[a].hasDependency(e,s)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,s))}}function jn(c,e){const s=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return c.overscaledZ-e.overscaledZ||a-s||e.canonical.y-c.canonical.y||e.canonical.x-c.canonical.x}function gs(c){return c==="raster"||c==="image"||c==="video"}Di.maxOverzooming=10,Di.maxUnderzooming=3;const oi="mapboxgl_preloaded_worker_pool";class Vt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vt.workerCount;)this.workers.push(new Worker(d.config.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oi]}numActive(){return Object.keys(this.active).length}}const $n=Math.floor(d.exported.hardwareConcurrency/2);let en;function ys(){return en||(en=new Vt),en}Vt.workerCount=d.isSafari(globalThis)?Math.max(Math.min($n,3),1):1;class Tr{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.clamp(e,0,1);let s=1,a=this._distances[s];const u=e*this.paddedLength+this.padding;for(;a<u&&s<this._distances.length;)a=this._distances[++s];const m=s-1,y=this._distances[m],T=a-y,b=T>0?(u-y)/T:0;return this.points[m].mult(1-b).add(this.points[s].mult(b))}}function Zt(c,e){let s=!0;return c==="always"||c!=="never"&&e!=="never"||(s=!1),s}class Be{constructor(e,s,a){const u=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(s/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)u.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,a,u,m){this._forEachCell(s,a,u,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(m)}insertCircle(e,s,a,u){this._forEachCell(s-u,a-u,s+u,a+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(a),this.circles.push(u)}_insertBoxCell(e,s,a,u,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,s,a,u,m,y){this.circleCells[m].push(y)}_query(e,s,a,u,m,y,T){if(a<0||e>this.width||u<0||s>this.height)return[];const b=[];if(e<=0&&s<=0&&this.width<=a&&this.height<=u){if(m)return[{key:null,x1:e,y1:s,x2:a,y2:u}];for(let S=0;S<this.boxKeys.length;S++)b.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const A=this.circles[3*S],k=this.circles[3*S+1],F=this.circles[3*S+2];b.push({key:this.circleKeys[S],x1:A-F,y1:k-F,x2:A+F,y2:k+F})}}else this._forEachCell(e,s,a,u,this._queryCell,b,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},T);return b}query(e,s,a,u){return this._query(e,s,a,u,!1,null)}hitTest(e,s,a,u,m,y){return this._query(e,s,a,u,!0,m,y).length>0}hitTestCircle(e,s,a,u,m){const y=e-a,T=e+a,b=s-a,S=s+a;if(T<0||y>this.width||S<0||b>this.height)return!1;const A=[];return this._forEachCell(y,b,T,S,this._queryCellCircle,A,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:a},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(e,s,a,u,m,y,T,b){const{seenUids:S,hitTest:A,overlapMode:k}=T,F=this.boxCells[m];if(F!==null){const j=this.bboxes;for(const G of F)if(!S.box[G]){S.box[G]=!0;const tt=4*G,lt=this.boxKeys[G];if(e<=j[tt+2]&&s<=j[tt+3]&&a>=j[tt+0]&&u>=j[tt+1]&&(!b||b(lt))&&(!A||!Zt(k,lt.overlapMode))&&(y.push({key:lt,x1:j[tt],y1:j[tt+1],x2:j[tt+2],y2:j[tt+3]}),A))return!0}}const W=this.circleCells[m];if(W!==null){const j=this.circles;for(const G of W)if(!S.circle[G]){S.circle[G]=!0;const tt=3*G,lt=this.circleKeys[G];if(this._circleAndRectCollide(j[tt],j[tt+1],j[tt+2],e,s,a,u)&&(!b||b(lt))&&(!A||!Zt(k,lt.overlapMode))){const gt=j[tt],Y=j[tt+1],mt=j[tt+2];if(y.push({key:lt,x1:gt-mt,y1:Y-mt,x2:gt+mt,y2:Y+mt}),A)return!0}}}return!1}_queryCellCircle(e,s,a,u,m,y,T,b){const{circle:S,seenUids:A,overlapMode:k}=T,F=this.boxCells[m];if(F!==null){const j=this.bboxes;for(const G of F)if(!A.box[G]){A.box[G]=!0;const tt=4*G,lt=this.boxKeys[G];if(this._circleAndRectCollide(S.x,S.y,S.radius,j[tt+0],j[tt+1],j[tt+2],j[tt+3])&&(!b||b(lt))&&!Zt(k,lt.overlapMode))return y.push(!0),!0}}const W=this.circleCells[m];if(W!==null){const j=this.circles;for(const G of W)if(!A.circle[G]){A.circle[G]=!0;const tt=3*G,lt=this.circleKeys[G];if(this._circlesCollide(j[tt],j[tt+1],j[tt+2],S.x,S.y,S.radius)&&(!b||b(lt))&&!Zt(k,lt.overlapMode))return y.push(!0),!0}}}_forEachCell(e,s,a,u,m,y,T,b){const S=this._convertToXCellCoord(e),A=this._convertToYCellCoord(s),k=this._convertToXCellCoord(a),F=this._convertToYCellCoord(u);for(let W=S;W<=k;W++)for(let j=A;j<=F;j++)if(m.call(this,e,s,a,u,this.xCellCount*j+W,y,T,b))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,a,u,m,y){const T=u-e,b=m-s,S=a+y;return S*S>T*T+b*b}_circleAndRectCollide(e,s,a,u,m,y,T){const b=(y-u)/2,S=Math.abs(e-(u+b));if(S>b+a)return!1;const A=(T-m)/2,k=Math.abs(s-(m+A));if(k>A+a)return!1;if(S<=b||k<=A)return!0;const F=S-b,W=k-A;return F*F+W*W<=a*a}}function Ie(c,e,s,a,u){const m=d.create();return e?(d.scale(m,m,[1/u,1/u,1]),s||d.rotateZ(m,m,a.angle)):d.multiply(m,a.labelPlaneMatrix,c),m}function ji(c,e,s,a,u){if(e){const m=d.clone(c);return d.scale(m,m,[u,u,1]),s||d.rotateZ(m,m,-a.angle),m}return a.glCoordMatrix}function Oi(c,e,s){let a;s?(a=[c.x,c.y,s(c.x,c.y),1],d.transformMat4(a,a,e)):(a=[c.x,c.y,0,1],Q(a,a,e));const u=a[3];return{point:new d.Point(a[0]/u,a[1]/u),signedDistanceFromCamera:u}}function Me(c,e){return .5+c/e*.5}function En(c,e){const s=c[0]/c[3],a=c[1]/c[3];return s>=-e[0]&&s<=e[0]&&a>=-e[1]&&a<=e[1]}function Sr(c,e,s,a,u,m,y,T,b,S){const A=a?c.textSizeData:c.iconSizeData,k=d.evaluateSizeForZoom(A,s.transform.zoom),F=[256/s.width*2+1,256/s.height*2+1],W=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;W.clear();const j=c.lineVertexArray,G=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,tt=s.transform.width/s.transform.height;let lt=!1;for(let gt=0;gt<G.length;gt++){const Y=G.get(gt);if(Y.hidden||Y.writingMode===d.WritingMode.vertical&&!lt){Z(Y.numGlyphs,W);continue}let mt;if(lt=!1,S?(mt=[Y.anchorX,Y.anchorY,S(Y.anchorX,Y.anchorY),1],d.transformMat4(mt,mt,e)):(mt=[Y.anchorX,Y.anchorY,0,1],Q(mt,mt,e)),!En(mt,F)){Z(Y.numGlyphs,W);continue}const St=Me(s.transform.cameraToCenterDistance,mt[3]),Mt=d.evaluateSizeForFeature(A,k,Y),Rt=y?Mt/St:Mt*St,Ut=new d.Point(Y.anchorX,Y.anchorY),zt=Oi(Ut,u,S).point,te={projections:{},offsets:{}},ge=Gi(Y,Rt,!1,T,e,u,m,c.glyphOffsetArray,j,W,zt,Ut,te,tt,b,S);lt=ge.useVertical,(ge.notEnoughRoom||lt||ge.needsFlipping&&Gi(Y,Rt,!0,T,e,u,m,c.glyphOffsetArray,j,W,zt,Ut,te,tt,b,S).notEnoughRoom)&&Z(Y.numGlyphs,W)}a?c.text.dynamicLayoutVertexBuffer.updateData(W):c.icon.dynamicLayoutVertexBuffer.updateData(W)}function Cn(c,e,s,a,u,m,y,T,b,S,A,k,F){const W=T.glyphStartIndex+T.numGlyphs,j=T.lineStartIndex,G=T.lineStartIndex+T.lineLength,tt=e.getoffsetX(T.glyphStartIndex),lt=e.getoffsetX(W-1),gt=D(c*tt,s,a,u,m,y,T.segment,j,G,b,S,A,k,F);if(!gt)return null;const Y=D(c*lt,s,a,u,m,y,T.segment,j,G,b,S,A,k,F);return Y?{first:gt,last:Y}:null}function $i(c,e,s,a){return c===d.WritingMode.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*a?{useVertical:!0}:(c===d.WritingMode.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function Gi(c,e,s,a,u,m,y,T,b,S,A,k,F,W,j,G){const tt=e/24,lt=c.lineOffsetX*tt,gt=c.lineOffsetY*tt;let Y;if(c.numGlyphs>1){const mt=c.glyphStartIndex+c.numGlyphs,St=c.lineStartIndex,Mt=c.lineStartIndex+c.lineLength,Rt=Cn(tt,T,lt,gt,s,A,k,c,b,m,F,j,G);if(!Rt)return{notEnoughRoom:!0};const Ut=Oi(Rt.first.point,y,G).point,zt=Oi(Rt.last.point,y,G).point;if(a&&!s){const te=$i(c.writingMode,Ut,zt,W);if(te)return te}Y=[Rt.first];for(let te=c.glyphStartIndex+1;te<mt-1;te++)Y.push(D(tt*T.getoffsetX(te),lt,gt,s,A,k,c.segment,St,Mt,b,m,F,j,G));Y.push(Rt.last)}else{if(a&&!s){const St=Oi(k,u,G).point,Mt=c.lineStartIndex+c.segment+1,Rt=new d.Point(b.getx(Mt),b.gety(Mt)),Ut=Oi(Rt,u,G),zt=Ut.signedDistanceFromCamera>0?Ut.point:Ke(k,Rt,St,1,u,G),te=$i(c.writingMode,St,zt,W);if(te)return te}const mt=D(tt*T.getoffsetX(c.glyphStartIndex),lt,gt,s,A,k,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,b,m,F,j,G);if(!mt)return{notEnoughRoom:!0};Y=[mt]}for(const mt of Y)d.addDynamicAttributes(S,mt.point,mt.angle);return{}}function Ke(c,e,s,a,u,m){const y=Oi(c.add(c.sub(e)._unit()),u,m).point,T=s.sub(y);return s.add(T._mult(a/T.mag()))}function Bs(c,e){const{projectionCache:s,lineVertexArray:a,labelPlaneMatrix:u,tileAnchorPoint:m,distanceFromAnchor:y,getElevation:T,previousVertex:b,direction:S,absOffsetX:A}=e;if(s.projections[c])return s.projections[c];const k=new d.Point(a.getx(c),a.gety(c)),F=Oi(k,u,T);if(F.signedDistanceFromCamera>0)return s.projections[c]=F.point,F.point;const W=c-S;return Ke(y===0?m:new d.Point(a.getx(W),a.gety(W)),k,b,A-y+1,u,T)}function Gn(c,e,s){return c._unit()._perp()._mult(e*s)}function X(c,e,s,a,u,m,y,T){const{projectionCache:b,direction:S}=T;if(b.offsets[c])return b.offsets[c];const A=s.add(e);if(c+S<a||c+S>=u)return b.offsets[c]=A,A;const k=Bs(c+S,T),F=Gn(k.sub(s),y,S),W=s.add(F),j=k.add(F);return b.offsets[c]=d.findLineIntersection(m,A,W,j)||A,b.offsets[c]}function D(c,e,s,a,u,m,y,T,b,S,A,k,F,W){const j=a?c-e:c+e;let G=j>0?1:-1,tt=0;a&&(G*=-1,tt=Math.PI),G<0&&(tt+=Math.PI);let lt,gt,Y=G>0?T+y:T+y+1,mt=u,St=u,Mt=0,Rt=0;const Ut=Math.abs(j),zt=[];let te;for(;Mt+Rt<=Ut;){if(Y+=G,Y<T||Y>=b)return null;Mt+=Rt,St=mt,gt=lt;const Wt={projectionCache:k,lineVertexArray:S,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:Mt,getElevation:W,previousVertex:St,direction:G,absOffsetX:Ut};if(mt=Bs(Y,Wt),s===0)zt.push(St),te=mt.sub(St);else{let Ce;const ne=mt.sub(St);Ce=ne.mag()===0?Gn(Bs(Y+G,Wt).sub(mt),s,G):Gn(ne,s,G),gt||(gt=St.add(Ce)),lt=X(Y,Ce,mt,T,b,gt,s,Wt),zt.push(gt),te=lt.sub(gt)}Rt=te.mag()}const ge=te._mult((Ut-Mt)/Rt)._add(gt||St),Re=tt+Math.atan2(mt.y-St.y,mt.x-St.x);return zt.push(ge),{point:ge,angle:F?Re:0,path:zt}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Z(c,e){for(let s=0;s<c;s++){const a=e.length;e.resize(a+4),e.float32.set(B,3*a)}}function Q(c,e,s){const a=e[0],u=e[1];return c[0]=s[0]*a+s[4]*u+s[12],c[1]=s[1]*a+s[5]*u+s[13],c[3]=s[3]*a+s[7]*u+s[15],c}const nt=100;class ht{constructor(e,s=new Be(e.width+200,e.height+200,25),a=new Be(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+nt,this.screenBottomBoundary=e.height+nt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,a,u,m,y){const T=this.projectAndGetPerspectiveRatio(u,e.anchorPointX,e.anchorPointY,y),b=a*T.perspectiveRatio,S=e.x1*b+T.point.x,A=e.y1*b+T.point.y,k=e.x2*b+T.point.x,F=e.y2*b+T.point.y;return!this.isInsideGrid(S,A,k,F)||s!=="always"&&this.grid.hitTest(S,A,k,F,s,m)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[S,A,k,F],offscreen:this.isOffscreen(S,A,k,F)}}placeCollisionCircles(e,s,a,u,m,y,T,b,S,A,k,F,W,j){const G=[],tt=new d.Point(s.anchorX,s.anchorY),lt=Oi(tt,y,j),gt=Me(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),Y=(A?m/gt:m*gt)/d.ONE_EM,mt=Oi(tt,T,j).point,St=Cn(Y,u,s.lineOffsetX*Y,s.lineOffsetY*Y,!1,mt,tt,s,a,T,{projections:{},offsets:{}},!1,j);let Mt=!1,Rt=!1,Ut=!0;if(St){const zt=.5*F*gt+W,te=new d.Point(-100,-100),ge=new d.Point(this.screenRightBoundary,this.screenBottomBoundary),Re=new Tr,Wt=St.first,Ce=St.last;let ne=[];for(let si=Wt.path.length-1;si>=1;si--)ne.push(Wt.path[si]);for(let si=1;si<Ce.path.length;si++)ne.push(Ce.path[si]);const ri=2.5*zt;if(b){const si=ne.map(Oe=>Oi(Oe,b,j));ne=si.some(Oe=>Oe.signedDistanceFromCamera<=0)?[]:si.map(Oe=>Oe.point)}let rn=[];if(ne.length>0){const si=ne[0].clone(),Oe=ne[0].clone();for(let Ki=1;Ki<ne.length;Ki++)si.x=Math.min(si.x,ne[Ki].x),si.y=Math.min(si.y,ne[Ki].y),Oe.x=Math.max(Oe.x,ne[Ki].x),Oe.y=Math.max(Oe.y,ne[Ki].y);rn=si.x>=te.x&&Oe.x<=ge.x&&si.y>=te.y&&Oe.y<=ge.y?[ne]:Oe.x<te.x||si.x>ge.x||Oe.y<te.y||si.y>ge.y?[]:d.clipLine([ne],te.x,te.y,ge.x,ge.y)}for(const si of rn){Re.reset(si,.25*zt);let Oe=0;Oe=Re.length<=.5*zt?1:Math.ceil(Re.paddedLength/ri)+1;for(let Ki=0;Ki<Oe;Ki++){const er=Ki/Math.max(Oe-1,1),sn=Re.lerp(er),bn=sn.x+nt,kr=sn.y+nt;G.push(bn,kr,zt,0);const as=bn-zt,ls=kr-zt,ir=bn+zt,zs=kr+zt;if(Ut=Ut&&this.isOffscreen(as,ls,ir,zs),Rt=Rt||this.isInsideGrid(as,ls,ir,zs),e!=="always"&&this.grid.hitTestCircle(bn,kr,zt,e,k)&&(Mt=!0,!S))return{circles:[],offscreen:!1,collisionDetected:Mt}}}}return{circles:!S&&Mt||!Rt||gt<this.perspectiveRatioCutoff?[]:G,offscreen:Ut,collisionDetected:Mt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let a=1/0,u=1/0,m=-1/0,y=-1/0;for(const A of e){const k=new d.Point(A.x+nt,A.y+nt);a=Math.min(a,k.x),u=Math.min(u,k.y),m=Math.max(m,k.x),y=Math.max(y,k.y),s.push(k)}const T=this.grid.query(a,u,m,y).concat(this.ignoredGrid.query(a,u,m,y)),b={},S={};for(const A of T){const k=A.key;if(b[k.bucketInstanceId]===void 0&&(b[k.bucketInstanceId]={}),b[k.bucketInstanceId][k.featureIndex])continue;const F=[new d.Point(A.x1,A.y1),new d.Point(A.x2,A.y1),new d.Point(A.x2,A.y2),new d.Point(A.x1,A.y2)];d.polygonIntersectsPolygon(s,F)&&(b[k.bucketInstanceId][k.featureIndex]=!0,S[k.bucketInstanceId]===void 0&&(S[k.bucketInstanceId]=[]),S[k.bucketInstanceId].push(k.featureIndex))}return S}insertCollisionBox(e,s,a,u,m,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:y,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,a,u,m,y){const T=a?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:m,collisionGroupID:y,overlapMode:s};for(let S=0;S<e.length;S+=4)T.insertCircle(b,e[S],e[S+1],e[S+2])}projectAndGetPerspectiveRatio(e,s,a,u){let m;return u?(m=[s,a,u(s,a),1],d.transformMat4(m,m,e)):(m=[s,a,0,1],Q(m,m,e)),{point:new d.Point((m[0]/m[3]+1)/2*this.transform.width+nt,(-m[1]/m[3]+1)/2*this.transform.height+nt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(e,s,a,u){return a<nt||e>=this.screenRightBoundary||u<nt||s>this.screenBottomBoundary}isInsideGrid(e,s,a,u){return a>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.identity([]);return d.translate(e,e,[-100,-100,0]),e}}function st(c,e,s){return e*(d.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}class rt{constructor(e,s,a,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class ut{constructor(e,s,a,u,m){this.text=new rt(e?e.text:null,s,a,m),this.icon=new rt(e?e.icon:null,s,u,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ft{constructor(e,s,a){this.text=e,this.icon=s,this.skipFade=a}}class kt{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class It{constructor(e,s,a,u,m){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=u,this.tileID=m}}class fe{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:a=>a.collisionGroupID===s}}return this.collisionGroups[e]}}function ke(c,e,s,a,u){const{horizontalAlign:m,verticalAlign:y}=d.getAnchorAlignment(c),T=-(m-.5)*e,b=-(y-.5)*s,S=d.evaluateVariableOffset(c,a);return new d.Point(T+S[0]*u,b+S[1]*u)}function ie(c,e,s,a,u,m){const{x1:y,x2:T,y1:b,y2:S,anchorPointX:A,anchorPointY:k}=c,F=new d.Point(e,s);return a&&F._rotate(u?m:-m),{x1:y+F.x,y1:b+F.y,x2:T+F.x,y2:S+F.y,anchorPointX:A,anchorPointY:k}}class ae{constructor(e,s,a,u,m){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new fe(u),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,s,a,u){const m=a.getBucket(s),y=a.latestFeatureIndex;if(!m||!y||s.id!==m.layerIds[0])return;const T=a.collisionBoxArray,b=m.layers[0].layout,S=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),A=a.tileSize/d.EXTENT,k=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),F=b.get("text-pitch-alignment")==="map",W=b.get("text-rotation-alignment")==="map",j=st(a,1,this.transform.zoom),G=Ie(k,F,W,this.transform,j);let tt=null;if(F){const gt=ji(k,F,W,this.transform,j);tt=d.multiply([],this.transform.labelPlaneMatrix,gt)}this.retainedQueryData[m.bucketInstanceId]=new It(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,a.tileID);const lt={bucket:m,layout:b,posMatrix:k,textLabelPlaneMatrix:G,labelToScreenMatrix:tt,scale:S,textPixelRatio:A,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(u)for(const gt of m.sortKeyRanges){const{sortKey:Y,symbolInstanceStart:mt,symbolInstanceEnd:St}=gt;e.push({sortKey:Y,symbolInstanceStart:mt,symbolInstanceEnd:St,parameters:lt})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:lt})}attemptAnchorPlacement(e,s,a,u,m,y,T,b,S,A,k,F,W,j,G,tt){const lt=[F.textOffset0,F.textOffset1],gt=ke(e,a,u,lt,m),Y=this.collisionIndex.placeCollisionBox(ie(s,gt.x,gt.y,y,T,this.transform.angle),k,b,S,A.predicate,tt);if((!G||this.collisionIndex.placeCollisionBox(ie(G,gt.x,gt.y,y,T,this.transform.angle),k,b,S,A.predicate,tt).box.length!==0)&&Y.box.length>0){let mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:lt,width:a,height:u,anchor:e,textBoxScale:m,prevAnchor:mt},this.markUsedJustification(W,e,F,j),W.allowVerticalPlacement&&(this.markUsedOrientation(W,j,F),this.placedOrientations[F.crossTileID]=j),{shift:gt,placedGlyphBoxes:Y}}}placeLayerBucketPart(e,s,a){const{bucket:u,layout:m,posMatrix:y,textLabelPlaneMatrix:T,labelToScreenMatrix:b,textPixelRatio:S,holdingForFade:A,collisionBoxArray:k,partiallyEvaluatedTextSize:F,collisionGroup:W}=e.parameters,j=m.get("text-optional"),G=m.get("icon-optional"),tt=d.getOverlapMode(m,"text-overlap","text-allow-overlap"),lt=tt==="always",gt=d.getOverlapMode(m,"icon-overlap","icon-allow-overlap"),Y=gt==="always",mt=m.get("text-rotation-alignment")==="map",St=m.get("text-pitch-alignment")==="map",Mt=m.get("icon-text-fit")!=="none",Rt=m.get("symbol-z-order")==="viewport-y",Ut=lt&&(Y||!u.hasIconData()||G),zt=Y&&(lt||!u.hasTextData()||j);!u.collisionArrays&&k&&u.deserializeCollisionBoxes(k);const te=this.retainedQueryData[u.bucketInstanceId].tileID,ge=this.terrain?(Wt,Ce)=>this.terrain.getElevation(te,Wt,Ce):null,Re=(Wt,Ce)=>{if(s[Wt.crossTileID])return;if(A)return void(this.placements[Wt.crossTileID]=new ft(!1,!1,!1));let ne=!1,ri=!1,rn=!0,si=null,Oe={box:null,offscreen:null},Ki={box:null,offscreen:null},er=null,sn=null,bn=null,kr=0,as=0,ls=0;Ce.textFeatureIndex?kr=Ce.textFeatureIndex:Wt.useRuntimeCollisionCircles&&(kr=Wt.featureIndex),Ce.verticalTextFeatureIndex&&(as=Ce.verticalTextFeatureIndex);const ir=Ce.textBox;if(ir){const On=li=>{let _n=d.WritingMode.horizontal;if(u.allowVerticalPlacement&&!li&&this.prevPlacement){const Tn=this.prevPlacement.placedOrientations[Wt.crossTileID];Tn&&(this.placedOrientations[Wt.crossTileID]=Tn,_n=Tn,this.markUsedOrientation(u,_n,Wt))}return _n},wn=(li,_n)=>{if(u.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&Ce.verticalTextBox){for(const Tn of u.writingModes)if(Tn===d.WritingMode.vertical?(Oe=_n(),Ki=Oe):Oe=li(),Oe&&Oe.box&&Oe.box.length)break}else Oe=li()};if(m.get("text-variable-anchor")){let li=m.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wt.crossTileID]){const pi=this.prevPlacement.variableOffsets[Wt.crossTileID];li.indexOf(pi.anchor)>0&&(li=li.filter(gn=>gn!==pi.anchor),li.unshift(pi.anchor))}const _n=(pi,gn,Ar)=>{const Ra=pi.x2-pi.x1,Qs=pi.y2-pi.y1,$l=Wt.textBoxScale,gl=Mt&&gt==="never"?gn:null;let Li={box:[],offscreen:!1};const Ka=tt!=="never"?2*li.length:li.length;for(let Sa=0;Sa<Ka;++Sa){const to=this.attemptAnchorPlacement(li[Sa%li.length],pi,Ra,Qs,$l,mt,St,S,y,W,Sa>=li.length?tt:"never",Wt,u,Ar,gl,ge);if(to&&(Li=to.placedGlyphBoxes,Li&&Li.box&&Li.box.length)){ne=!0,si=to.shift;break}}return Li};wn(()=>_n(ir,Ce.iconBox,d.WritingMode.horizontal),()=>{const pi=Ce.verticalTextBox;return u.allowVerticalPlacement&&!(Oe&&Oe.box&&Oe.box.length)&&Wt.numVerticalGlyphVertices>0&&pi?_n(pi,Ce.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),Oe&&(ne=Oe.box,rn=Oe.offscreen);const Tn=On(Oe&&Oe.box);if(!ne&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[Wt.crossTileID];pi&&(this.variableOffsets[Wt.crossTileID]=pi,this.markUsedJustification(u,pi.anchor,Wt,Tn))}}else{const li=(_n,Tn)=>{const pi=this.collisionIndex.placeCollisionBox(_n,tt,S,y,W.predicate,ge);return pi&&pi.box&&pi.box.length&&(this.markUsedOrientation(u,Tn,Wt),this.placedOrientations[Wt.crossTileID]=Tn),pi};wn(()=>li(ir,d.WritingMode.horizontal),()=>{const _n=Ce.verticalTextBox;return u.allowVerticalPlacement&&Wt.numVerticalGlyphVertices>0&&_n?li(_n,d.WritingMode.vertical):{box:null,offscreen:null}}),On(Oe&&Oe.box&&Oe.box.length)}}if(er=Oe,ne=er&&er.box&&er.box.length>0,rn=er&&er.offscreen,Wt.useRuntimeCollisionCircles){const On=u.text.placedSymbolArray.get(Wt.centerJustifiedTextSymbolIndex),wn=d.evaluateSizeForFeature(u.textSizeData,F,On),li=m.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(tt,On,u.lineVertexArray,u.glyphOffsetArray,wn,y,T,b,a,St,W.predicate,Wt.collisionCircleDiameter,li,ge),sn.circles.length&&sn.collisionDetected&&!a&&d.warnOnce("Collisions detected, but collision boxes are not shown"),ne=lt||sn.circles.length>0&&!sn.collisionDetected,rn=rn&&sn.offscreen}if(Ce.iconFeatureIndex&&(ls=Ce.iconFeatureIndex),Ce.iconBox){const On=wn=>{const li=Mt&&si?ie(wn,si.x,si.y,mt,St,this.transform.angle):wn;return this.collisionIndex.placeCollisionBox(li,gt,S,y,W.predicate,ge)};Ki&&Ki.box&&Ki.box.length&&Ce.verticalIconBox?(bn=On(Ce.verticalIconBox),ri=bn.box.length>0):(bn=On(Ce.iconBox),ri=bn.box.length>0),rn=rn&&bn.offscreen}const zs=j||Wt.numHorizontalGlyphVertices===0&&Wt.numVerticalGlyphVertices===0,Ta=G||Wt.numIconVertices===0;if(zs||Ta?Ta?zs||(ri=ri&&ne):ne=ri&&ne:ri=ne=ri&&ne,ne&&er&&er.box&&this.collisionIndex.insertCollisionBox(er.box,tt,m.get("text-ignore-placement"),u.bucketInstanceId,Ki&&Ki.box&&as?as:kr,W.ID),ri&&bn&&this.collisionIndex.insertCollisionBox(bn.box,gt,m.get("icon-ignore-placement"),u.bucketInstanceId,ls,W.ID),sn&&(ne&&this.collisionIndex.insertCollisionCircles(sn.circles,tt,m.get("text-ignore-placement"),u.bucketInstanceId,kr,W.ID),a)){const On=u.bucketInstanceId;let wn=this.collisionCircleArrays[On];wn===void 0&&(wn=this.collisionCircleArrays[On]=new kt);for(let li=0;li<sn.circles.length;li+=4)wn.circles.push(sn.circles[li+0]),wn.circles.push(sn.circles[li+1]),wn.circles.push(sn.circles[li+2]),wn.circles.push(sn.collisionDetected?1:0)}if(Wt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Wt.crossTileID]=new ft(ne||Ut,ri||zt,rn||u.justReloaded),s[Wt.crossTileID]=!0};if(Rt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Wt=u.getSortedSymbolIndexes(this.transform.angle);for(let Ce=Wt.length-1;Ce>=0;--Ce){const ne=Wt[Ce];Re(u.symbolInstances.get(ne),u.collisionArrays[ne])}}else for(let Wt=e.symbolInstanceStart;Wt<e.symbolInstanceEnd;Wt++)Re(u.symbolInstances.get(Wt),u.collisionArrays[Wt]);if(a&&u.bucketInstanceId in this.collisionCircleArrays){const Wt=this.collisionCircleArrays[u.bucketInstanceId];d.invert(Wt.invProjMatrix,y),Wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}markUsedJustification(e,s,a,u){let m;m=u===d.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(s)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const T of y)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=m>=0&&T!==m?0:a.crossTileID)}markUsedOrientation(e,s,a){const u=s===d.WritingMode.horizontal||s===d.WritingMode.horizontalOnly?s:0,m=s===d.WritingMode.vertical?s:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const T of y)e.text.placedSymbolArray.get(T).placedOrientation=u;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,m=s?s.opacities:{},y=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const b in this.placements){const S=this.placements[b],A=m[b];A?(this.opacities[b]=new ut(A,u,S.text,S.icon),a=a||S.text!==A.text.placed||S.icon!==A.icon.placed):(this.opacities[b]=new ut(null,u,S.text,S.icon,S.skipFade),a=a||S.text||S.icon)}for(const b in m){const S=m[b];if(!this.opacities[b]){const A=new ut(S,u,!1,!1);A.isHidden()||(this.opacities[b]=A,a=a||S.text.placed||S.icon.placed)}}for(const b in y)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=y[b]);for(const b in T)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=T[b]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const a={};for(const u of s){const m=u.getBucket(e);m&&u.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,a,u.collisionBoxArray)}}updateBucketOpacities(e,s,a){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const u=e.layers[0].layout,m=new ut(null,0,!1,!1,!0),y=u.get("text-allow-overlap"),T=u.get("icon-allow-overlap"),b=u.get("text-variable-anchor"),S=u.get("text-rotation-alignment")==="map",A=u.get("text-pitch-alignment")==="map",k=u.get("icon-text-fit")!=="none",F=new ut(null,0,y&&(T||!e.hasIconData()||u.get("icon-optional")),T&&(y||!e.hasTextData()||u.get("text-optional")),!0);!e.collisionArrays&&a&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(a);const W=(j,G,tt)=>{for(let lt=0;lt<G/4;lt++)j.opacityVertexArray.emplaceBack(tt);j.hasVisibleVertices=j.hasVisibleVertices||tt!==Zi};for(let j=0;j<e.symbolInstances.length;j++){const G=e.symbolInstances.get(j),{numHorizontalGlyphVertices:tt,numVerticalGlyphVertices:lt,crossTileID:gt}=G;let Y=this.opacities[gt];s[gt]?Y=m:Y||(Y=F,this.opacities[gt]=Y),s[gt]=!0;const mt=G.numIconVertices>0,St=this.placedOrientations[G.crossTileID],Mt=St===d.WritingMode.vertical,Rt=St===d.WritingMode.horizontal||St===d.WritingMode.horizontalOnly;if(tt>0||lt>0){const Ut=Hn(Y.text);W(e.text,tt,Mt?Zi:Ut),W(e.text,lt,Rt?Zi:Ut);const zt=Y.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Re=>{Re>=0&&(e.text.placedSymbolArray.get(Re).hidden=zt||Mt?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=zt||Rt?1:0);const te=this.variableOffsets[G.crossTileID];te&&this.markUsedJustification(e,te.anchor,G,St);const ge=this.placedOrientations[G.crossTileID];ge&&(this.markUsedJustification(e,"left",G,ge),this.markUsedOrientation(e,ge,G))}if(mt){const Ut=Hn(Y.icon),zt=!(k&&G.verticalPlacedIconSymbolIndex&&Mt);G.placedIconSymbolIndex>=0&&(W(e.icon,G.numIconVertices,zt?Ut:Zi),e.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=Y.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(W(e.icon,G.numVerticalIconVertices,zt?Zi:Ut),e.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ut=e.collisionArrays[j];if(Ut){let zt=new d.Point(0,0);if(Ut.textBox||Ut.verticalTextBox){let ge=!0;if(b){const Re=this.variableOffsets[gt];Re?(zt=ke(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale),S&&zt._rotate(A?this.transform.angle:-this.transform.angle)):ge=!1}Ut.textBox&&ve(e.textCollisionBox.collisionVertexArray,Y.text.placed,!ge||Mt,zt.x,zt.y),Ut.verticalTextBox&&ve(e.textCollisionBox.collisionVertexArray,Y.text.placed,!ge||Rt,zt.x,zt.y)}const te=!!(!Rt&&Ut.verticalIconBox);Ut.iconBox&&ve(e.iconCollisionBox.collisionVertexArray,Y.icon.placed,te,k?zt.x:0,k?zt.y:0),Ut.verticalIconBox&&ve(e.iconCollisionBox.collisionVertexArray,Y.icon.placed,!te,k?zt.x:0,k?zt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=j.invProjMatrix,e.placementViewportMatrix=j.viewportMatrix,e.collisionCircleArray=j.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function ve(c,e,s,a,u){c.emplaceBack(e?1:0,s?1:0,a||0,u||0),c.emplaceBack(e?1:0,s?1:0,a||0,u||0),c.emplaceBack(e?1:0,s?1:0,a||0,u||0),c.emplaceBack(e?1:0,s?1:0,a||0,u||0)}const Ze=Math.pow(2,25),Ne=Math.pow(2,24),$e=Math.pow(2,17),ni=Math.pow(2,16),Fi=Math.pow(2,9),Te=Math.pow(2,8),Pi=Math.pow(2,1);function Hn(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const e=c.placed?1:0,s=Math.floor(127*c.opacity);return s*Ze+e*Ne+s*$e+e*ni+s*Fi+e*Te+s*Pi+e}const Zi=0;class In{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,a,u,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(y,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((T,b)=>T.sortKey-b.sortKey));this._currentPartIndex<y.length;)if(s.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,m())return!0;return!1}}class Rn{constructor(e,s,a,u,m,y,T,b){this.placement=new ae(e,s,y,T,b),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,s,a){const u=d.exported.now(),m=()=>!this._forceFullPlacement&&d.exported.now()-u>2;for(;this._currentPlacementIndex>=0;){const y=s[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=T)&&(!y.maxzoom||y.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new In(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const vs=512/d.EXTENT/2;class so{constructor(e,s,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const u=new Map;for(let m=0;m<s.length;m++){const y=s.get(m),T=y.key,b=u.get(T);b?b.push(y):u.set(T,[y])}for(const[m,y]of u){const T={positions:y.map(b=>({x:Math.floor(b.anchorX*vs),y:Math.floor(b.anchorY*vs)})),crossTileIDs:y.map(b=>b.crossTileID)};if(T.positions.length>128){const b=new d.KDBush(T.positions.length,16,Uint16Array);for(const{x:S,y:A}of T.positions)b.add(S,A);b.finish(),delete T.positions,T.index=b}this._symbolsByKey[m]=T}}getScaledCoordinates(e,s){const{x:a,y:u,z:m}=this.tileID.canonical,{x:y,y:T,z:b}=s.canonical,S=vs/Math.pow(2,b-m),A=(T*d.EXTENT+e.anchorY)*S,k=u*d.EXTENT*vs;return{x:Math.floor((y*d.EXTENT+e.anchorX)*S-a*d.EXTENT*vs),y:Math.floor(A-k)}}findMatches(e,s,a){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const T=this._symbolsByKey[y.key];if(!T)continue;const b=this.getScaledCoordinates(y,s);if(T.index){const S=T.index.range(b.x-u,b.y-u,b.x+u,b.y+u).sort();for(const A of S){const k=T.crossTileIDs[A];if(!a[k]){a[k]=!0,y.crossTileID=k;break}}}else if(T.positions)for(let S=0;S<T.positions.length;S++){const A=T.positions[S],k=T.crossTileIDs[S];if(Math.abs(A.x-b.x)<=u&&Math.abs(A.y-b.y)<=u&&!a[k]){a[k]=!0,y.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ki{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const a in this.indexes){const u=this.indexes[a],m={};for(const y in u){const T=u[y];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),m[T.tileID.key]=T}this.indexes[a]=m}this.lng=e}addBucket(e,s,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<s.symbolInstances.length;m++)s.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const T in y){const b=y[T];b.tileID.isChildOf(e)&&b.findMatches(s.symbolInstances,e,u)}else{const T=y[e.scaledTo(Number(m)).key];T&&T.findMatches(s.symbolInstances,e,u)}}for(let m=0;m<s.symbolInstances.length;m++){const y=s.symbolInstances.get(m);y.crossTileID||(y.crossTileID=a.generate(),u[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new so(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const a of s.getCrossTileIDsLists())for(const u of a)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const a in this.indexes){const u=this.indexes[a];for(const m in u)e[u[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,u[m]),delete u[m],s=!0)}return s}}class hr{constructor(){this.layerIndexes={},this.crossTileIDs=new ki,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,a){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new nn);let m=!1;const y={};u.handleWrapJump(a);for(const T of s){const b=T.getBucket(e);b&&e.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(T.tileID,b,this.crossTileIDs)&&(m=!0),y[b.bucketInstanceId]=!0)}return u.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const s={};e.forEach(a=>{s[a]=!0});for(const a in this.layerIndexes)s[a]||delete this.layerIndexes[a]}}const di=(c,e)=>d.emitValidationErrors(c,e&&e.filter(s=>s.identifier!=="source.canvas")),ur=d.pick(d.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Ue=d.pick(d.operations,["setCenter","setZoom","setBearing","setPitch"]),bi=d.emptyStyle();class Ni extends d.Evented{constructor(e,s={}){super(),this.map=e,this.dispatcher=new ui(ys(),this,e._getMapId()),this.imageManager=new Qi,this.imageManager.setEventedParent(this),this.glyphManager=new xi(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new mi(256,512),this.crossTileSymbolIndex=new hr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const a=this;this._rtlTextPluginCallback=Ni.registerForPluginStateChange(u=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(m,y)=>{if(d.triggerPluginCompletionEvent(m),y&&y.every(T=>T))for(const T in a.sourceCaches){const b=a.sourceCaches[T].getSource().type;b!=="vector"&&b!=="geojson"||a.sourceCaches[T].reload()}})}),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const m=this.sourceCaches[u.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const b=this._layers[T];b.source===y.id&&this._validateLayer(b)}})}loadURL(e,s={},a){this.fire(new d.Event("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,Ft.Style);this._request=d.getJSON(u,(m,y)=>{this._request=null,m?this.fire(new d.ErrorEvent(m)):y&&this._load(y,s,a)})}loadJSON(e,s={},a){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(e,s,a)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(bi,{validate:!1})}_load(e,s,a){const u=s.transformStyle?s.transformStyle(a,e):e;if(!s.validate||!di(this,d.validateStyle(u))){this._loaded=!0,this.stylesheet=u;for(const m in u.sources)this.addSource(m,u.sources[m],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs),this._createLayers(),this.light=new fi(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}}_createLayers(){const e=d.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const a=d.createStyleLayer(s);a.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=a}}_loadSprite(e,s=!1,a=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(u,m,y,T){const b=Ui(u),S=b.length,A=y>1?"@2x":"",k={},F={},W={};for(const{id:j,url:G}of b){const tt=m.transformRequest(m.normalizeSpriteURL(G,A,".json"),Ft.SpriteJSON),lt=`${j}_${tt.url}`;k[lt]=d.getJSON(tt,(mt,St)=>{delete k[lt],F[j]=St,gi(T,F,W,mt,S)});const gt=m.transformRequest(m.normalizeSpriteURL(G,A,".png"),Ft.SpriteImage),Y=`${j}_${gt.url}`;k[Y]=de.getImage(gt,(mt,St)=>{delete k[Y],W[j]=St,gi(T,F,W,mt,S)})}return{cancel(){for(const j of Object.values(k))j.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),(u,m)=>{if(this._spriteRequest=null,u)this.fire(new d.ErrorEvent(u));else if(m)for(const y in m){this._spritesImagesIds[y]=[];const T=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(b=>!(b in m)):[];for(const b of T)this.imageManager.removeImage(b),this._changedImages[b]=!0;for(const b in m[y]){const S=y==="default"?b:`${y}:${b}`;this._spritesImagesIds[y].push(S),S in this.imageManager.images?this.imageManager.updateImage(S,m[y][b],!1):this.imageManager.addImage(S,m[y][b]),s&&(this._changedImages[S]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"})),a&&a(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const a=e.sourceLayer;if(!a)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(a)===-1)&&this.fire(new d.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){const s=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s);const a=[];for(const u of e)s[u]&&a.push(s[u]);return a}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const a of s){const u=this._layers[a];u.type!=="custom"&&(e[a]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(u.length||m.length)&&this._updateWorkerLayers(u,m);for(const y in this._updatedSources){const T=this._updatedSources[y];if(T==="reload")this._reloadSource(y);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const a={};for(const u in this.sourceCaches){const m=this.sourceCaches[u];a[u]=m.used,m.used=!1}for(const u of this._order){const m=this._layers[u];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const u in a){const m=this.sourceCaches[u];a[u]!==m.used&&m.fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.z=e.zoom,s&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){this._checkLoaded();const a=this.serialize();if(e=s.transformStyle?s.transformStyle(a,e):e,di(this,d.validateStyle(e)))return!1;(e=d.clone$1(e)).layers=d.derefLayers(e.layers);const u=d.diffStyles(a,e).filter(y=>!(y.command in Ue));if(u.length===0)return!1;const m=u.filter(y=>!(y.command in ur));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);for(const y of u)y.command!=="setTransition"&&this[y.command].apply(this,y.args);return this.stylesheet=e,!0}addImage(e,s){if(this.getImage(e))return this.fire(new d.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.validateStyle.source,`sources.${e}`,s,null,a))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new Di(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new d.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,a={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.ErrorEvent(new Error(`Layer "${u}" already exists on this map.`)));let m;if(e.type==="custom"){if(di(this,d.validateCustomStyleLayer(e)))return;m=d.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(u,e.source),e=d.clone$1(e),e=d.extend(e,{source:u})),this._validate(d.validateStyle.layer,`layers.${u}`,e,{arrayIndex:-1},a))return;m=d.createStyleLayer(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:u}})}const y=s?this._order.indexOf(s):this._order.length;if(s&&y===-1)this.fire(new d.ErrorEvent(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(y,0,u),this._layerOrderChanged=!0,this._layers[u]=m,this._removedLayers[u]&&m.source&&m.type!=="custom"){const T=this._removedLayers[u];delete this._removedLayers[u],T.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const a=this._order.indexOf(e);this._order.splice(a,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,a){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===a||(s!=null&&(u.minzoom=s),a!=null&&(u.maxzoom=a),this._updateLayer(u)):this.fire(new d.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,a={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.deepEqual(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.validateStyle.filter,`layers.${u.id}.filter`,s,null,a)||(u.filter=d.clone$1(s),this._updateLayer(u)))}else this.fire(new d.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,s,a,u={}){this._checkLoaded();const m=this.getLayer(e);m?d.deepEqual(m.getLayoutProperty(s),a)||(m.setLayoutProperty(s,a,u),this._updateLayer(m)):this.fire(new d.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const a=this.getLayer(e);if(a)return a.getLayoutProperty(s);this.fire(new d.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,a,u={}){this._checkLoaded();const m=this.getLayer(e);m?d.deepEqual(m.getPaintProperty(s),a)||(m.setPaintProperty(s,a,u)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new d.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const a=e.source,u=e.sourceLayer,m=this.sourceCaches[a];if(m===void 0)return void this.fire(new d.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&u?this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||u?(e.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),m.setFeatureState(u,e.id,s)):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const a=e.source,u=this.sourceCaches[a];if(u===void 0)return void this.fire(new d.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const m=u.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(y,e.id,s):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,a=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),u.getFeatureState(a,e.id)):void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e=d.mapObject(this.sourceCaches,u=>u.serialize()),s=this._serializeByIds(this._order),a=this.stylesheet;return d.filterObject({version:a.version,name:a.name,metadata:a.metadata,light:a.light,center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,sprite:a.sprite,glyphs:a.glyphs,transition:a.transition,sources:e,layers:s},u=>u!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=y=>this._layers[y].type==="fill-extrusion",a={},u=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T)){a[T]=y;for(const b of e){const S=b[T];if(S)for(const A of S)u.push(A)}}}u.sort((y,T)=>T.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T))for(let b=u.length-1;b>=0;b--){const S=u[b].feature;if(a[S.layer.id]<y)break;m.push(S),u.pop()}else for(const b of e){const S=b[T];if(S)for(const A of S)m.push(A.feature)}}return m}queryRenderedFeatures(e,s,a){s&&s.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of s.layers){const b=this._layers[T];if(!b)return this.fire(new d.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];u[b.source]=!0}}const m=[];s.availableImages=this._availableImages;const y=this._serializedAllLayers();for(const T in this.sourceCaches)s.layers&&!u[T]||m.push(ii(this.sourceCaches[T],this._layers,y,e,s,a));return this.placement&&m.push(function(T,b,S,A,k,F,W){const j={},G=F.queryRenderedSymbols(A),tt=[];for(const lt of Object.keys(G).map(Number))tt.push(W[lt]);tt.sort(Ve);for(const lt of tt){const gt=lt.featureIndex.lookupSymbolFeatures(G[lt.bucketInstanceId],b,lt.bucketIndex,lt.sourceLayerIndex,k.filter,k.layers,k.availableImages,T);for(const Y in gt){const mt=j[Y]=j[Y]||[],St=gt[Y];St.sort((Mt,Rt)=>{const Ut=lt.featureSortOrder;if(Ut){const zt=Ut.indexOf(Mt.featureIndex);return Ut.indexOf(Rt.featureIndex)-zt}return Rt.featureIndex-Mt.featureIndex});for(const Mt of St)mt.push(Mt)}}for(const lt in j)j[lt].forEach(gt=>{const Y=gt.feature,mt=S[T[lt].source].getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=mt});return j}(this._layers,y,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const a=this.sourceCaches[e];return a?function(u,m){const y=u.getRenderableIds().map(S=>u.getTileByID(S)),T=[],b={};for(let S=0;S<y.length;S++){const A=y[S],k=A.tileID.canonical.key;b[k]||(b[k]=!0,A.querySourceFeatures(T,m))}return T}(a,s):[]}addSourceType(e,s,a){return Ni.getSourceType(e)?a(new Error(`A source type called "${e}" already exists.`)):(Ni.setSourceType(e,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:s.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const a=this.light.getLight();let u=!1;for(const y in e)if(!d.deepEqual(e[y],a[y])){u=!0;break}if(!u)return;const m={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(m)}_validate(e,s,a,u,m={}){return(!m||m.validate!==!1)&&di(this,e.call(d.validateStyle,d.extend({key:s,style:this.serialize(),value:a,styleSpec:d.v8Spec},u)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const a=this.sourceCaches[s];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,a,u,m=!1){let y=!1,T=!1;const b={};for(const S of this._order){const A=this._layers[S];if(A.type!=="symbol")continue;if(!b[A.source]){const F=this.sourceCaches[A.source];b[A.source]=F.getRenderableIds(!0).map(W=>F.getTileByID(W)).sort((W,j)=>j.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(j.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(A,b[A.source],e.center.lng);y=y||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),e.zoom))&&(this.pauseablePlacement=new Rn(e,this.map.terrain,this._order,m,s,a,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),T=!0),y&&this.pauseablePlacement.placement.setStale()),T||y)for(const S of this._order){const A=this._layers[S];A.type==="symbol"&&this.placement.updateLayerOpacities(A,b[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s,a){this.imageManager.getImages(s.icons,a),this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(e,s,a){this.glyphManager.getGlyphs(s.stacks,a);const u=this.sourceCaches[s.source];u&&u.setDependencies(s.tileID.key,s.type,[""])}getResource(e,s,a){return d.makeRequest(s,a)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.validateStyle.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,a={},u){this._checkLoaded();const m=[{id:e,url:s}],y=[...Ui(this.stylesheet.sprite),...m];this._validate(d.validateStyle.sprite,"sprite",y,null,a)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,u))}removeSprite(e){this._checkLoaded();const s=Ui(this.stylesheet.sprite);if(s.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;s.splice(s.findIndex(a=>a.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}else this.fire(new d.ErrorEvent(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ui(this.stylesheet.sprite)}setSprite(e,s={},a){this._checkLoaded(),e&&this._validate(d.validateStyle.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}Ni.getSourceType=function(c){return cr[c]},Ni.setSourceType=function(c,e){cr[c]=e},Ni.registerForPluginStateChange=d.registerForPluginStateChange;var Or=d.createLayout([{name:"a_pos",type:"Int16",components:2}]),Wn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const dr={prelude:re(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:re(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:re(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:re(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:re("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:re(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:re(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:re("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:re("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:re("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:re(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:re(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:re(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:re(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:re(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:re(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:re(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:re(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:re(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:re(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:re(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:re(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:re(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:re(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:re(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:re("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Wn),terrainDepth:re("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Wn),terrainCoords:re("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Wn)};function re(c,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),u=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(u):u,T={};return{fragmentSource:c=c.replace(s,(b,S,A,k,F)=>(T[F]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${k} ${F};
#else
uniform ${A} ${k} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${k} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(b,S,A,k,F)=>{const W=k==="float"?"vec2":"vec4",j=F.match(/color/)?"color":W;return T[F]?S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${W} a_${F};
varying ${A} ${k} ${F};
#else
uniform ${A} ${k} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${A} ${k} ${F} = u_${F};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${W} a_${F};
#else
uniform ${A} ${k} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${k} ${F} = a_${F};
#else
    ${A} ${k} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${k} ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${A} ${k} ${F} = u_${F};
#endif
`}),staticAttributes:a,staticUniforms:y}}class ai{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,a,u,m,y,T,b,S){this.context=e;let A=this.boundPaintVertexBuffers.length!==u.length;for(let k=0;!A&&k<u.length;k++)this.boundPaintVertexBuffers[k]!==u[k]&&(A=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==a||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==b||this.boundDynamicVertexBuffer3!==S?this.freshBind(s,a,u,m,y,T,b,S):(e.bindVertexArray.set(this.vao),T&&T.bind(),m&&m.dynamicDraw&&m.bind(),b&&b.bind(),S&&S.bind())}freshBind(e,s,a,u,m,y,T,b){const S=e.numAttributes,A=this.context,k=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=u,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=b,s.enableAttributes(k,e);for(const F of a)F.enableAttributes(k,e);y&&y.enableAttributes(k,e),T&&T.enableAttributes(k,e),b&&b.enableAttributes(k,e),s.bind(),s.setVertexAttribPointers(k,e,m);for(const F of a)F.bind(),F.setVertexAttribPointers(k,e,m);y&&(y.bind(),y.setVertexAttribPointers(k,e,m)),u&&u.bind(),T&&(T.bind(),T.setVertexAttribPointers(k,e,m)),b&&(b.bind(),b.setVertexAttribPointers(k,e,m)),A.currentNumAttributes=S}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function pr(c){const e=[];for(let s=0;s<c.length;s++){if(c[s]===null)continue;const a=c[s].split(" ");e.push(a.pop())}return e}class Xn{constructor(e,s,a,u,m,y,T){const b=e.gl;this.program=b.createProgram();const S=pr(a.staticAttributes),A=u?u.getBinderAttributes():[],k=S.concat(A),F=dr.prelude.staticUniforms?pr(dr.prelude.staticUniforms):[],W=a.staticUniforms?pr(a.staticUniforms):[],j=u?u.getBinderUniforms():[],G=F.concat(W).concat(j),tt=[];for(const Rt of G)tt.indexOf(Rt)<0&&tt.push(Rt);const lt=u?u.defines():[];y&&lt.push("#define OVERDRAW_INSPECTOR;"),T&&lt.push("#define TERRAIN3D;");const gt=lt.concat(dr.prelude.fragmentSource,a.fragmentSource).join(`
`),Y=lt.concat(dr.prelude.vertexSource,a.vertexSource).join(`
`),mt=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(mt,gt),b.compileShader(mt),b.attachShader(this.program,mt);const St=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(St,Y),b.compileShader(St),b.attachShader(this.program,St),this.attributes={};const Mt={};this.numAttributes=k.length;for(let Rt=0;Rt<this.numAttributes;Rt++)k[Rt]&&(b.bindAttribLocation(this.program,Rt,k[Rt]),this.attributes[k[Rt]]=Rt);b.linkProgram(this.program),b.deleteShader(St),b.deleteShader(mt);for(let Rt=0;Rt<tt.length;Rt++){const Ut=tt[Rt];if(Ut&&!Mt[Ut]){const zt=b.getUniformLocation(this.program,Ut);zt&&(Mt[Ut]=zt)}}this.fixedUniforms=m(e,Mt),this.terrainUniforms=((Rt,Ut)=>({u_depth:new d.Uniform1i(Rt,Ut.u_depth),u_terrain:new d.Uniform1i(Rt,Ut.u_terrain),u_terrain_dim:new d.Uniform1f(Rt,Ut.u_terrain_dim),u_terrain_matrix:new d.UniformMatrix4f(Rt,Ut.u_terrain_matrix),u_terrain_unpack:new d.Uniform4f(Rt,Ut.u_terrain_unpack),u_terrain_exaggeration:new d.Uniform1f(Rt,Ut.u_terrain_exaggeration)}))(e,Mt),this.binderUniforms=u?u.getUniforms(e,Mt):[]}draw(e,s,a,u,m,y,T,b,S,A,k,F,W,j,G,tt,lt,gt){const Y=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(u),e.setColorMode(m),e.setCullFace(y),b){e.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,b.depthTexture),e.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,b.texture);for(const St in this.terrainUniforms)this.terrainUniforms[St].set(b[St])}for(const St in this.fixedUniforms)this.fixedUniforms[St].set(T[St]);G&&G.setUniforms(e,this.binderUniforms,W,{zoom:j});let mt=0;switch(s){case Y.LINES:mt=2;break;case Y.TRIANGLES:mt=3;break;case Y.LINE_STRIP:mt=1}for(const St of F.get()){const Mt=St.vaos||(St.vaos={});(Mt[S]||(Mt[S]=new ai)).bind(e,this,A,G?G.getPaintVertexBuffers():[],k,St.vertexOffset,tt,lt,gt),Y.drawElements(s,St.primitiveLength*mt,Y.UNSIGNED_SHORT,St.primitiveOffset*mt*2)}}}function kn(c,e,s){const a=1/st(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,y=m*(s.tileID.canonical.x+s.tileID.wrap*u),T=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[y>>16,T>>16],u_pixel_coord_lower:[65535&y,65535&T]}}const xs=(c,e,s,a)=>{const u=e.style.light,m=u.properties.get("position"),y=[m.x,m.y,m.z],T=function(){var S=new d.ARRAY_TYPE(9);return d.ARRAY_TYPE!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[5]=0,S[6]=0,S[7]=0),S[0]=1,S[4]=1,S[8]=1,S}();u.properties.get("anchor")==="viewport"&&function(S,A){var k=Math.sin(A),F=Math.cos(A);S[0]=F,S[1]=k,S[2]=0,S[3]=-k,S[4]=F,S[5]=0,S[6]=0,S[7]=0,S[8]=1}(T,-e.transform.angle),function(S,A,k){var F=A[0],W=A[1],j=A[2];S[0]=F*k[0]+W*k[3]+j*k[6],S[1]=F*k[1]+W*k[4]+j*k[7],S[2]=F*k[2]+W*k[5]+j*k[8]}(y,y,T);const b=u.properties.get("color");return{u_matrix:c,u_lightpos:y,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+s,u_opacity:a}},bs=(c,e,s,a,u,m,y)=>d.extend(xs(c,e,s,a),kn(m,e,y),{u_height_factor:-Math.pow(2,u.overscaledZ)/y.tileSize/8}),Fr=c=>({u_matrix:c}),Ai=(c,e,s,a)=>d.extend(Fr(c),kn(s,e,a)),Kr=(c,e)=>({u_matrix:c,u_world:e}),ws=(c,e,s,a,u)=>d.extend(Ai(c,e,s,a),{u_world:u}),Os=(c,e,s,a)=>{const u=c.transform;let m,y;if(a.paint.get("circle-pitch-alignment")==="map"){const T=st(s,1,u.zoom);m=!0,y=[T,T]}else m=!1,y=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(e.posMatrix,s,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:y}},Fs=(c,e,s)=>{const a=st(s,1,e.zoom),u=Math.pow(2,e.zoom-s.tileID.overscaledZ),m=s.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[e.pixelsToGLUnits[0]/(a*u),e.pixelsToGLUnits[1]/(a*u)],u_overscale_factor:m}},Pr=(c,e,s=1)=>({u_matrix:c,u_color:e,u_overlay:0,u_overlay_scale:s}),Kn=c=>({u_matrix:c}),oo=(c,e,s,a)=>({u_matrix:c,u_extrude_scale:st(e,1,s),u_intensity:a});function Ns(c,e){const s=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new d.MercatorCoordinate(0,a/s).toLngLat().lat,new d.MercatorCoordinate(0,(a+1)/s).toLngLat().lat]}const Jn=(c,e,s,a)=>{const u=c.transform;return{u_matrix:Ss(c,e,s,a),u_ratio:1/st(e,1,u.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Ts=(c,e,s,a,u)=>d.extend(Jn(c,e,s,u),{u_image:0,u_image_height:a}),an=(c,e,s,a,u)=>{const m=c.transform,y=Nr(e,m);return{u_matrix:Ss(c,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/st(e,1,m.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Us=(c,e,s,a,u,m)=>{const y=c.lineAtlas,T=Nr(e,c.transform),b=s.layout.get("line-cap")==="round",S=y.getDash(a.from,b),A=y.getDash(a.to,b),k=S.width*u.fromScale,F=A.width*u.toScale;return d.extend(Jn(c,e,s,m),{u_patternscale_a:[T/k,-S.height/2],u_patternscale_b:[T/F,-A.height/2],u_sdfgamma:y.width/(256*Math.min(k,F)*c.pixelRatio)/2,u_image:0,u_tex_y_a:S.y,u_tex_y_b:A.y,u_mix:u.t})};function Nr(c,e){return 1/st(c,1,e.tileZoom)}function Ss(c,e,s,a){return c.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const De=(c,e,s,a,u)=>{return{u_matrix:c,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(y=u.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=u.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:An(u.paint.get("raster-hue-rotate"))};var m,y};function An(c){c*=Math.PI/180;const e=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ti=(c,e,s,a,u,m,y,T,b,S)=>{const A=u.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:A.width/A.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:y,u_coord_matrix:T,u_is_text:+b,u_pitch_with_map:+a,u_texsize:S,u_texture:0}},Jr=(c,e,s,a,u,m,y,T,b,S,A)=>{const k=u.transform;return d.extend(ti(c,e,s,a,u,m,y,T,b,S),{u_gamma_scale:a?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:u.pixelRatio,u_is_halo:+A})},Ps=(c,e,s,a,u,m,y,T,b,S)=>d.extend(Jr(c,e,s,a,u,m,y,T,!0,b,!0),{u_texsize_icon:S,u_texture_icon:1}),dn=(c,e,s)=>({u_matrix:c,u_opacity:e,u_color:s}),pn=(c,e,s,a,u,m)=>d.extend(function(y,T,b,S){const A=b.imageManager.getPattern(y.from.toString()),k=b.imageManager.getPattern(y.to.toString()),{width:F,height:W}=b.imageManager.getPixelSize(),j=Math.pow(2,S.tileID.overscaledZ),G=S.tileSize*Math.pow(2,b.transform.tileZoom)/j,tt=G*(S.tileID.canonical.x+S.tileID.wrap*j),lt=G*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[F,W],u_mix:T.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/st(S,1,b.transform.tileZoom),u_pixel_coord_upper:[tt>>16,lt>>16],u_pixel_coord_lower:[65535&tt,65535&lt]}}(a,m,s,u),{u_matrix:c,u_opacity:e}),Er={fillExtrusion:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_lightpos:new d.Uniform3f(c,e.u_lightpos),u_lightintensity:new d.Uniform1f(c,e.u_lightintensity),u_lightcolor:new d.Uniform3f(c,e.u_lightcolor),u_vertical_gradient:new d.Uniform1f(c,e.u_vertical_gradient),u_opacity:new d.Uniform1f(c,e.u_opacity)}),fillExtrusionPattern:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_lightpos:new d.Uniform3f(c,e.u_lightpos),u_lightintensity:new d.Uniform1f(c,e.u_lightintensity),u_lightcolor:new d.Uniform3f(c,e.u_lightcolor),u_vertical_gradient:new d.Uniform1f(c,e.u_vertical_gradient),u_height_factor:new d.Uniform1f(c,e.u_height_factor),u_image:new d.Uniform1i(c,e.u_image),u_texsize:new d.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new d.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new d.Uniform3f(c,e.u_scale),u_fade:new d.Uniform1f(c,e.u_fade),u_opacity:new d.Uniform1f(c,e.u_opacity)}),fill:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix)}),fillPattern:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_image:new d.Uniform1i(c,e.u_image),u_texsize:new d.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new d.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new d.Uniform3f(c,e.u_scale),u_fade:new d.Uniform1f(c,e.u_fade)}),fillOutline:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_world:new d.Uniform2f(c,e.u_world)}),fillOutlinePattern:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_world:new d.Uniform2f(c,e.u_world),u_image:new d.Uniform1i(c,e.u_image),u_texsize:new d.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new d.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new d.Uniform3f(c,e.u_scale),u_fade:new d.Uniform1f(c,e.u_fade)}),circle:(c,e)=>({u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(c,e.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(c,e.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(c,e.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(c,e.u_matrix)}),collisionBox:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_pixels_to_tile_units:new d.Uniform1f(c,e.u_pixels_to_tile_units),u_extrude_scale:new d.Uniform2f(c,e.u_extrude_scale),u_overscale_factor:new d.Uniform1f(c,e.u_overscale_factor)}),collisionCircle:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_inv_matrix:new d.UniformMatrix4f(c,e.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(c,e.u_viewport_size)}),debug:(c,e)=>({u_color:new d.UniformColor(c,e.u_color),u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_overlay:new d.Uniform1i(c,e.u_overlay),u_overlay_scale:new d.Uniform1f(c,e.u_overlay_scale)}),clippingMask:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix)}),heatmap:(c,e)=>({u_extrude_scale:new d.Uniform1f(c,e.u_extrude_scale),u_intensity:new d.Uniform1f(c,e.u_intensity),u_matrix:new d.UniformMatrix4f(c,e.u_matrix)}),heatmapTexture:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_world:new d.Uniform2f(c,e.u_world),u_image:new d.Uniform1i(c,e.u_image),u_color_ramp:new d.Uniform1i(c,e.u_color_ramp),u_opacity:new d.Uniform1f(c,e.u_opacity)}),hillshade:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_image:new d.Uniform1i(c,e.u_image),u_latrange:new d.Uniform2f(c,e.u_latrange),u_light:new d.Uniform2f(c,e.u_light),u_shadow:new d.UniformColor(c,e.u_shadow),u_highlight:new d.UniformColor(c,e.u_highlight),u_accent:new d.UniformColor(c,e.u_accent)}),hillshadePrepare:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_image:new d.Uniform1i(c,e.u_image),u_dimension:new d.Uniform2f(c,e.u_dimension),u_zoom:new d.Uniform1f(c,e.u_zoom),u_unpack:new d.Uniform4f(c,e.u_unpack)}),line:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_ratio:new d.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(c,e.u_units_to_pixels)}),lineGradient:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_ratio:new d.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(c,e.u_units_to_pixels),u_image:new d.Uniform1i(c,e.u_image),u_image_height:new d.Uniform1f(c,e.u_image_height)}),linePattern:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_texsize:new d.Uniform2f(c,e.u_texsize),u_ratio:new d.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_image:new d.Uniform1i(c,e.u_image),u_units_to_pixels:new d.Uniform2f(c,e.u_units_to_pixels),u_scale:new d.Uniform3f(c,e.u_scale),u_fade:new d.Uniform1f(c,e.u_fade)}),lineSDF:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_ratio:new d.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(c,e.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(c,e.u_patternscale_a),u_patternscale_b:new d.Uniform2f(c,e.u_patternscale_b),u_sdfgamma:new d.Uniform1f(c,e.u_sdfgamma),u_image:new d.Uniform1i(c,e.u_image),u_tex_y_a:new d.Uniform1f(c,e.u_tex_y_a),u_tex_y_b:new d.Uniform1f(c,e.u_tex_y_b),u_mix:new d.Uniform1f(c,e.u_mix)}),raster:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_tl_parent:new d.Uniform2f(c,e.u_tl_parent),u_scale_parent:new d.Uniform1f(c,e.u_scale_parent),u_buffer_scale:new d.Uniform1f(c,e.u_buffer_scale),u_fade_t:new d.Uniform1f(c,e.u_fade_t),u_opacity:new d.Uniform1f(c,e.u_opacity),u_image0:new d.Uniform1i(c,e.u_image0),u_image1:new d.Uniform1i(c,e.u_image1),u_brightness_low:new d.Uniform1f(c,e.u_brightness_low),u_brightness_high:new d.Uniform1f(c,e.u_brightness_high),u_saturation_factor:new d.Uniform1f(c,e.u_saturation_factor),u_contrast_factor:new d.Uniform1f(c,e.u_contrast_factor),u_spin_weights:new d.Uniform3f(c,e.u_spin_weights)}),symbolIcon:(c,e)=>({u_is_size_zoom_constant:new d.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new d.Uniform1f(c,e.u_size_t),u_size:new d.Uniform1f(c,e.u_size),u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new d.Uniform1f(c,e.u_pitch),u_rotate_symbol:new d.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new d.Uniform1f(c,e.u_fade_change),u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new d.Uniform1i(c,e.u_is_text),u_pitch_with_map:new d.Uniform1i(c,e.u_pitch_with_map),u_texsize:new d.Uniform2f(c,e.u_texsize),u_texture:new d.Uniform1i(c,e.u_texture)}),symbolSDF:(c,e)=>({u_is_size_zoom_constant:new d.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new d.Uniform1f(c,e.u_size_t),u_size:new d.Uniform1f(c,e.u_size),u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new d.Uniform1f(c,e.u_pitch),u_rotate_symbol:new d.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new d.Uniform1f(c,e.u_fade_change),u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new d.Uniform1i(c,e.u_is_text),u_pitch_with_map:new d.Uniform1i(c,e.u_pitch_with_map),u_texsize:new d.Uniform2f(c,e.u_texsize),u_texture:new d.Uniform1i(c,e.u_texture),u_gamma_scale:new d.Uniform1f(c,e.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(c,e.u_is_halo)}),symbolTextAndIcon:(c,e)=>({u_is_size_zoom_constant:new d.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new d.Uniform1f(c,e.u_size_t),u_size:new d.Uniform1f(c,e.u_size),u_camera_to_center_distance:new d.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new d.Uniform1f(c,e.u_pitch),u_rotate_symbol:new d.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new d.Uniform1f(c,e.u_fade_change),u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new d.Uniform1i(c,e.u_is_text),u_pitch_with_map:new d.Uniform1i(c,e.u_pitch_with_map),u_texsize:new d.Uniform2f(c,e.u_texsize),u_texsize_icon:new d.Uniform2f(c,e.u_texsize_icon),u_texture:new d.Uniform1i(c,e.u_texture),u_texture_icon:new d.Uniform1i(c,e.u_texture_icon),u_gamma_scale:new d.Uniform1f(c,e.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(c,e.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(c,e.u_is_halo)}),background:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_opacity:new d.Uniform1f(c,e.u_opacity),u_color:new d.UniformColor(c,e.u_color)}),backgroundPattern:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_opacity:new d.Uniform1f(c,e.u_opacity),u_image:new d.Uniform1i(c,e.u_image),u_pattern_tl_a:new d.Uniform2f(c,e.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(c,e.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(c,e.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(c,e.u_pattern_br_b),u_texsize:new d.Uniform2f(c,e.u_texsize),u_mix:new d.Uniform1f(c,e.u_mix),u_pattern_size_a:new d.Uniform2f(c,e.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(c,e.u_pattern_size_b),u_scale_a:new d.Uniform1f(c,e.u_scale_a),u_scale_b:new d.Uniform1f(c,e.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(c,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(c,e.u_tile_units_to_pixels)}),terrain:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_texture:new d.Uniform1i(c,e.u_texture),u_ele_delta:new d.Uniform1f(c,e.u_ele_delta)}),terrainDepth:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_ele_delta:new d.Uniform1f(c,e.u_ele_delta)}),terrainCoords:(c,e)=>({u_matrix:new d.UniformMatrix4f(c,e.u_matrix),u_texture:new d.Uniform1i(c,e.u_texture),u_terrain_coords_id:new d.Uniform1f(c,e.u_terrain_coords_id),u_ele_delta:new d.Uniform1f(c,e.u_ele_delta)})};class Yr{constructor(e,s,a){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ur={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qi{constructor(e,s,a,u){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let a=0;a<this.attributes.length;a++){const u=s.attributes[this.attributes[a].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,a){for(let u=0;u<this.attributes.length;u++){const m=this.attributes[u],y=s.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[Ur[m.type]],!1,this.itemSize,m.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ee=new WeakMap;function fr(c){if(Ee.has(c))return Ee.get(c);{const e=c.getParameter(c.VERSION).startsWith("WebGL 2.0");return Ee.set(c,e),e}}class qe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ko extends qe{getDefault(){return d.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Vs extends qe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Zs extends qe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Wo extends qe{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Qr extends qe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xe extends qe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class pa extends qe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Yn extends qe{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ao extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Xo extends qe{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class fa extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class lo extends qe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class co extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ho extends qe{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ao extends qe{getDefault(){return d.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Es extends qe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class uo extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Ko extends qe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Bn extends qe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ts extends qe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Mo extends qe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Mn extends qe{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class es extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Lo extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class qs extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ei extends qe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class js extends qe{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Hi extends qe{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const a=this.gl;fr(a)?a.bindVertexArray(e):(s=a.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class po extends qe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $s extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class M extends qe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class w extends qe{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class I extends w{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class q extends w{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class et extends w{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Et{constructor(e,s,a,u,m){this.context=e,this.width=s,this.height=a;const y=e.gl,T=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new I(e,T),u)this.depthAttachment=m?new et(e,T):new q(e,T);else if(m)throw new Error("Stencil cannot be setted without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Lt{constructor(e,s,a){this.blendFunction=e,this.blendColor=s,this.mask=a}}Lt.Replace=[1,0],Lt.disabled=new Lt(Lt.Replace,d.Color.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,d.Color.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,771],d.Color.transparent,[!0,!0,!0,!0]);class he{constructor(e){var s,a;if(this.gl=e,this.clearColor=new ko(this),this.clearDepth=new Vs(this),this.clearStencil=new Zs(this),this.colorMask=new Wo(this),this.depthMask=new Qr(this),this.stencilMask=new Xe(this),this.stencilFunc=new pa(this),this.stencilOp=new Yn(this),this.stencilTest=new ao(this),this.depthRange=new Xo(this),this.depthTest=new fa(this),this.depthFunc=new lo(this),this.blend=new co(this),this.blendFunc=new ho(this),this.blendColor=new Ao(this),this.blendEquation=new Es(this),this.cullFace=new uo(this),this.cullFaceSide=new Ko(this),this.frontFace=new Bn(this),this.program=new ts(this),this.activeTexture=new Mo(this),this.viewport=new Mn(this),this.bindFramebuffer=new es(this),this.bindRenderbuffer=new Lo(this),this.bindTexture=new qs(this),this.bindVertexBuffer=new ei(this),this.bindElementBuffer=new js(this),this.bindVertexArray=new Hi(this),this.pixelStoreUnpack=new po(this),this.pixelStoreUnpackPremultiplyAlpha=new $s(this),this.pixelStoreUnpackFlipY=new M(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),fr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Yr(this,e,s)}createVertexBuffer(e,s,a){return new qi(this,e,s,a)}createRenderbuffer(e,s,a){const u=this.gl,m=u.createRenderbuffer();return this.bindRenderbuffer.set(m),u.renderbufferStorage(u.RENDERBUFFER,e,s,a),this.bindRenderbuffer.set(null),m}createFramebuffer(e,s,a,u){return new Et(this,e,s,a,u)}clear({color:e,depth:s,stencil:a}){const u=this.gl;let m=0;e&&(m|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),a!==void 0&&(m|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),u.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.deepEqual(e.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return fr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return fr(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class qt{constructor(e,s,a){this.func=e,this.mask=s,this.range=a}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const Ge=7680;class xe{constructor(e,s,a,u,m,y){this.test=e,this.ref=s,this.mask=a,this.fail=u,this.depthFail=m,this.pass=y}}xe.disabled=new xe({func:519,mask:0},0,0,Ge,Ge,Ge);class ze{constructor(e,s,a){this.enable=e,this.mode=s,this.frontFace=a}}let Qn;function fo(c,e,s,a,u,m,y){const T=c.context,b=T.gl,S=c.useProgram("collisionBox"),A=[];let k=0,F=0;for(let Y=0;Y<a.length;Y++){const mt=a[Y],St=e.getTile(mt),Mt=St.getBucket(s);if(!Mt)continue;let Rt=mt.posMatrix;u[0]===0&&u[1]===0||(Rt=c.translatePosMatrix(mt.posMatrix,St,u,m));const Ut=y?Mt.textCollisionBox:Mt.iconCollisionBox,zt=Mt.collisionCircleArray;if(zt.length>0){const te=d.create(),ge=Rt;d.mul(te,Mt.placementInvProjMatrix,c.transform.glCoordMatrix),d.mul(te,te,Mt.placementViewportMatrix),A.push({circleArray:zt,circleOffset:F,transform:ge,invTransform:te,coord:mt}),k+=zt.length/4,F=k}Ut&&S.draw(T,b.LINES,qt.disabled,xe.disabled,c.colorModeForRenderPass(),ze.disabled,Fs(Rt,c.transform,St),c.style.map.terrain&&c.style.map.terrain.getTerrainData(mt),s.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,null,c.transform.zoom,null,null,Ut.collisionVertexBuffer)}if(!y||!A.length)return;const W=c.useProgram("collisionCircle"),j=new d.CollisionCircleLayoutArray;j.resize(4*k),j._trim();let G=0;for(const Y of A)for(let mt=0;mt<Y.circleArray.length/4;mt++){const St=4*mt,Mt=Y.circleArray[St+0],Rt=Y.circleArray[St+1],Ut=Y.circleArray[St+2],zt=Y.circleArray[St+3];j.emplace(G++,Mt,Rt,Ut,zt,0),j.emplace(G++,Mt,Rt,Ut,zt,1),j.emplace(G++,Mt,Rt,Ut,zt,2),j.emplace(G++,Mt,Rt,Ut,zt,3)}(!Qn||Qn.length<2*k)&&(Qn=function(Y){const mt=2*Y,St=new d.QuadTriangleArray;St.resize(mt),St._trim();for(let Mt=0;Mt<mt;Mt++){const Rt=6*Mt;St.uint16[Rt+0]=4*Mt+0,St.uint16[Rt+1]=4*Mt+1,St.uint16[Rt+2]=4*Mt+2,St.uint16[Rt+3]=4*Mt+2,St.uint16[Rt+4]=4*Mt+3,St.uint16[Rt+5]=4*Mt+0}return St}(k));const tt=T.createIndexBuffer(Qn,!0),lt=T.createVertexBuffer(j,d.collisionCircleLayout.members,!0);for(const Y of A){const mt={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(gt=c.transform).cameraToCenterDistance,u_viewport_size:[gt.width,gt.height]};W.draw(T,b.TRIANGLES,qt.disabled,xe.disabled,c.colorModeForRenderPass(),ze.disabled,mt,c.style.map.terrain&&c.style.map.terrain.getTerrainData(Y.coord),s.id,lt,tt,d.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,c.transform.zoom,null,null,null)}var gt;lt.destroy(),tt.destroy()}ze.disabled=new ze(!1,1029,2305),ze.backCCW=new ze(!0,1029,2305);const mo=d.identity(new Float32Array(16));function ma(c,e,s,a,u,m){const{horizontalAlign:y,verticalAlign:T}=d.getAnchorAlignment(c),b=-(y-.5)*e,S=-(T-.5)*s,A=d.evaluateVariableOffset(c,a);return new d.Point((b/u+A[0])*m,(S/u+A[1])*m)}function _o(c,e,s,a,u,m,y,T,b,S,A){const k=c.text.placedSymbolArray,F=c.text.dynamicLayoutVertexArray,W=c.icon.dynamicLayoutVertexArray,j={};F.clear();for(let G=0;G<k.length;G++){const tt=k.get(G),lt=tt.hidden||!tt.crossTileID||c.allowVerticalPlacement&&!tt.placedOrientation?null:a[tt.crossTileID];if(lt){const gt=new d.Point(tt.anchorX,tt.anchorY),Y=Oi(gt,s?y:m,A),mt=Me(u.cameraToCenterDistance,Y.signedDistanceFromCamera);let St=d.evaluateSizeForFeature(c.textSizeData,b,tt)*mt/d.ONE_EM;s&&(St*=c.tilePixelRatio/T);const{width:Mt,height:Rt,anchor:Ut,textOffset:zt,textBoxScale:te}=lt,ge=ma(Ut,Mt,Rt,zt,te,St),Re=s?Oi(gt.add(ge),m,A).point:Y.point.add(e?ge.rotate(-u.angle):ge),Wt=c.allowVerticalPlacement&&tt.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Ce=0;Ce<tt.numGlyphs;Ce++)d.addDynamicAttributes(F,Re,Wt);S&&tt.associatedIconIndex>=0&&(j[tt.associatedIconIndex]={shiftedAnchor:Re,angle:Wt})}else Z(tt.numGlyphs,F)}if(S){W.clear();const G=c.icon.placedSymbolArray;for(let tt=0;tt<G.length;tt++){const lt=G.get(tt);if(lt.hidden)Z(lt.numGlyphs,W);else{const gt=j[tt];if(gt)for(let Y=0;Y<lt.numGlyphs;Y++)d.addDynamicAttributes(W,gt.shiftedAnchor,gt.angle);else Z(lt.numGlyphs,W)}}c.icon.dynamicLayoutVertexBuffer.updateData(W)}c.text.dynamicLayoutVertexBuffer.updateData(F)}function go(c,e,s){return s.iconsInText&&e?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function fn(c,e,s,a,u,m,y,T,b,S,A,k){const F=c.context,W=F.gl,j=c.transform,G=T==="map",tt=b==="map",lt=T!=="viewport"&&s.layout.get("symbol-placement")!=="point",gt=G&&!tt&&!lt,Y=!s.layout.get("symbol-sort-key").isConstant();let mt=!1;const St=c.depthModeForSublayer(0,qt.ReadOnly),Mt=s.layout.get("text-variable-anchor"),Rt=[];for(const Ut of a){const zt=e.getTile(Ut),te=zt.getBucket(s);if(!te)continue;const ge=u?te.text:te.icon;if(!ge||!ge.segments.get().length||!ge.hasVisibleVertices)continue;const Re=ge.programConfigurations.get(s.id),Wt=u||te.sdfIcons,Ce=u?te.textSizeData:te.iconSizeData,ne=tt||j.pitch!==0,ri=c.useProgram(go(Wt,u,te),Re),rn=d.evaluateSizeForZoom(Ce,j.zoom),si=c.style.map.terrain&&c.style.map.terrain.getTerrainData(Ut);let Oe,Ki,er,sn,bn=[0,0],kr=null;if(u)Ki=zt.glyphAtlasTexture,er=W.LINEAR,Oe=zt.glyphAtlasTexture.size,te.iconsInText&&(bn=zt.imageAtlasTexture.size,kr=zt.imageAtlasTexture,sn=ne||c.options.rotating||c.options.zooming||Ce.kind==="composite"||Ce.kind==="camera"?W.LINEAR:W.NEAREST);else{const gn=s.layout.get("icon-size").constantOr(0)!==1||te.iconsNeedLinear;Ki=zt.imageAtlasTexture,er=Wt||c.options.rotating||c.options.zooming||gn||ne?W.LINEAR:W.NEAREST,Oe=zt.imageAtlasTexture.size}const as=st(zt,1,c.transform.zoom),ls=Ie(Ut.posMatrix,tt,G,c.transform,as),ir=ji(Ut.posMatrix,tt,G,c.transform,as),zs=Mt&&te.hasTextData(),Ta=s.layout.get("icon-text-fit")!=="none"&&zs&&te.hasIconData();if(lt){const gn=c.style.map.terrain?(Ra,Qs)=>c.style.map.terrain.getElevation(Ut,Ra,Qs):null,Ar=s.layout.get("text-rotation-alignment")==="map";Sr(te,Ut.posMatrix,c,u,ls,ir,tt,S,Ar,gn)}const On=c.translatePosMatrix(Ut.posMatrix,zt,m,y),wn=lt||u&&Mt||Ta?mo:ls,li=c.translatePosMatrix(ir,zt,m,y,!0),_n=Wt&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Tn;Tn=Wt?te.iconsInText?Ps(Ce.kind,rn,gt,tt,c,On,wn,li,Oe,bn):Jr(Ce.kind,rn,gt,tt,c,On,wn,li,u,Oe,!0):ti(Ce.kind,rn,gt,tt,c,On,wn,li,u,Oe);const pi={program:ri,buffers:ge,uniformValues:Tn,atlasTexture:Ki,atlasTextureIcon:kr,atlasInterpolation:er,atlasInterpolationIcon:sn,isSDF:Wt,hasHalo:_n};if(Y&&te.canOverlap){mt=!0;const gn=ge.segments.get();for(const Ar of gn)Rt.push({segments:new d.SegmentVector([Ar]),sortKey:Ar.sortKey,state:pi,terrainData:si})}else Rt.push({segments:ge.segments,sortKey:0,state:pi,terrainData:si})}mt&&Rt.sort((Ut,zt)=>Ut.sortKey-zt.sortKey);for(const Ut of Rt){const zt=Ut.state;if(F.activeTexture.set(W.TEXTURE0),zt.atlasTexture.bind(zt.atlasInterpolation,W.CLAMP_TO_EDGE),zt.atlasTextureIcon&&(F.activeTexture.set(W.TEXTURE1),zt.atlasTextureIcon&&zt.atlasTextureIcon.bind(zt.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),zt.isSDF){const te=zt.uniformValues;zt.hasHalo&&(te.u_is_halo=1,Vr(zt.buffers,Ut.segments,s,c,zt.program,St,A,k,te,Ut.terrainData)),te.u_is_halo=0}Vr(zt.buffers,Ut.segments,s,c,zt.program,St,A,k,zt.uniformValues,Ut.terrainData)}}function Vr(c,e,s,a,u,m,y,T,b,S){const A=a.context;u.draw(A,A.gl.TRIANGLES,m,y,T,ze.disabled,b,S,s.id,c.layoutVertexBuffer,c.indexBuffer,e,s.paint,a.transform.zoom,c.programConfigurations.get(s.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function zo(c,e,s,a,u){if(!s||!a||!a.imageAtlas)return;const m=a.imageAtlas.patternPositions;let y=m[s.to.toString()],T=m[s.from.toString()];if(!y||!T){const b=u.getPaintProperty(e);y=m[b],T=m[b]}y&&T&&c.setConstantPatternPositions(y,T)}function xn(c,e,s,a,u,m,y){const T=c.context.gl,b="fill-pattern",S=s.paint.get(b),A=S&&S.constantOr(1),k=s.getCrossfadeParameters();let F,W,j,G,tt;y?(W=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=T.LINES):(W=A?"fillPattern":"fill",F=T.TRIANGLES);const lt=S.constantOr(null);for(const gt of a){const Y=e.getTile(gt);if(A&&!Y.patternsLoaded())continue;const mt=Y.getBucket(s);if(!mt)continue;const St=mt.programConfigurations.get(s.id),Mt=c.useProgram(W,St),Rt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(gt);A&&(c.context.activeTexture.set(T.TEXTURE0),Y.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),St.updatePaintBuffers(k)),zo(St,b,lt,Y,s);const Ut=Rt?gt:null,zt=c.translatePosMatrix(Ut?Ut.posMatrix:gt.posMatrix,Y,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(y){G=mt.indexBuffer2,tt=mt.segments2;const te=[T.drawingBufferWidth,T.drawingBufferHeight];j=W==="fillOutlinePattern"&&A?ws(zt,c,k,Y,te):Kr(zt,te)}else G=mt.indexBuffer,tt=mt.segments,j=A?Ai(zt,c,k,Y):Fr(zt);Mt.draw(c.context,F,u,c.stencilModeForClipping(gt),m,ze.disabled,j,Rt,s.id,mt.layoutVertexBuffer,G,tt,s.paint,c.transform.zoom,St)}}function Cs(c,e,s,a,u,m,y){const T=c.context,b=T.gl,S="fill-extrusion-pattern",A=s.paint.get(S),k=A.constantOr(1),F=s.getCrossfadeParameters(),W=s.paint.get("fill-extrusion-opacity"),j=A.constantOr(null);for(const G of a){const tt=e.getTile(G),lt=tt.getBucket(s);if(!lt)continue;const gt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(G),Y=lt.programConfigurations.get(s.id),mt=c.useProgram(k?"fillExtrusionPattern":"fillExtrusion",Y);k&&(c.context.activeTexture.set(b.TEXTURE0),tt.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),Y.updatePaintBuffers(F)),zo(Y,S,j,tt,s);const St=c.translatePosMatrix(G.posMatrix,tt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Mt=s.paint.get("fill-extrusion-vertical-gradient"),Rt=k?bs(St,c,Mt,W,G,F,tt):xs(St,c,Mt,W);mt.draw(T,T.gl.TRIANGLES,u,m,y,ze.backCCW,Rt,gt,s.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,s.paint,c.transform.zoom,Y,c.style.map.terrain&&lt.centroidVertexBuffer)}}function is(c,e,s,a,u,m,y){const T=c.context,b=T.gl,S=s.fbo;if(!S)return;const A=c.useProgram("hillshade"),k=c.style.map.terrain&&c.style.map.terrain.getTerrainData(e);T.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,S.colorAttachment.get()),A.draw(T,b.TRIANGLES,u,m,y,ze.disabled,((F,W,j,G)=>{const tt=j.paint.get("hillshade-shadow-color"),lt=j.paint.get("hillshade-highlight-color"),gt=j.paint.get("hillshade-accent-color");let Y=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=F.transform.angle);const mt=!F.options.moving;return{u_matrix:G?G.posMatrix:F.transform.calculatePosMatrix(W.tileID.toUnwrapped(),mt),u_image:0,u_latrange:Ns(0,W.tileID),u_light:[j.paint.get("hillshade-exaggeration"),Y],u_shadow:tt,u_highlight:lt,u_accent:gt}})(c,s,a,k?e:null),k,a.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function yo(c,e,s,a,u,m){const y=c.context,T=y.gl,b=e.dem;if(b&&b.data){const S=b.dim,A=b.stride,k=b.getPixels();if(y.activeTexture.set(T.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||c.getTileTexture(A),e.demTexture){const W=e.demTexture;W.update(k,{premultiply:!1}),W.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new we(y,k,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);y.activeTexture.set(T.TEXTURE0);let F=e.fbo;if(!F){const W=new we(y,{width:S,height:S,data:null},T.RGBA);W.bind(T.LINEAR,T.CLAMP_TO_EDGE),F=e.fbo=y.createFramebuffer(S,S,!0,!1),F.colorAttachment.set(W.texture)}y.bindFramebuffer.set(F.framebuffer),y.viewport.set([0,0,S,S]),c.useProgram("hillshadePrepare").draw(y,T.TRIANGLES,a,u,m,ze.disabled,((W,j)=>{const G=j.stride,tt=d.create();return d.ortho(tt,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(tt,tt,[0,-d.EXTENT,0]),{u_matrix:tt,u_image:1,u_dimension:[G,G],u_zoom:W.overscaledZ,u_unpack:j.getUnpackVector()}})(e.tileID,b),null,s.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function _i(c,e,s,a,u,m){const y=a.paint.get("raster-fade-duration");if(!m&&y>0){const T=d.exported.now(),b=(T-c.timeAdded)/y,S=e?(T-e.timeAdded)/y:-1,A=s.getSource(),k=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),W=F&&c.refreshedUponExpiration?1:d.clamp(F?b:1-S,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),e?{opacity:1,mix:1-W}:{opacity:W,mix:0}}return{opacity:1,mix:0}}const Cr=new d.Color(1,0,0,1),mn=new d.Color(0,1,0,1),Jo=new d.Color(0,0,1,1),mr=new d.Color(1,0,1,1),Gs=new d.Color(0,1,1,1);function Zr(c,e,s,a){vo(c,0,e+s/2,c.transform.width,s,a)}function Hs(c,e,s,a){vo(c,e-s/2,0,s,c.transform.height,a)}function vo(c,e,s,a,u,m){const y=c.context,T=y.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*c.pixelRatio,s*c.pixelRatio,a*c.pixelRatio,u*c.pixelRatio),y.clear({color:m}),T.disable(T.SCISSOR_TEST)}function qr(c,e,s){const a=c.context,u=a.gl,m=s.posMatrix,y=c.useProgram("debug"),T=qt.disabled,b=xe.disabled,S=c.colorModeForRenderPass(),A="$debug",k=c.style.map.terrain&&c.style.map.terrain.getTerrainData(s);a.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,W=Math.floor((F&&F.byteLength||0)/1024),j=e.getTile(s).tileSize,G=512/Math.min(j,512)*(s.overscaledZ/c.transform.zoom)*.5;let tt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(tt+=` => ${s.overscaledZ}`),function(lt,gt){lt.initDebugOverlayCanvas();const Y=lt.debugOverlayCanvas,mt=lt.context.gl,St=lt.debugOverlayCanvas.getContext("2d");St.clearRect(0,0,Y.width,Y.height),St.shadowColor="white",St.shadowBlur=2,St.lineWidth=1.5,St.strokeStyle="white",St.textBaseline="top",St.font="bold 36px Open Sans, sans-serif",St.fillText(gt,5,5),St.strokeText(gt,5,5),lt.debugOverlayTexture.update(Y),lt.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(c,`${tt} ${W}kB`),y.draw(a,u.TRIANGLES,T,b,Lt.alphaBlended,ze.disabled,Pr(m,d.Color.transparent,G),null,A,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),y.draw(a,u.LINE_STRIP,T,b,S,ze.disabled,Pr(m,d.Color.red),k,A,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function _a(c,e,s){const a=c.context,u=a.gl,m=c.colorModeForRenderPass(),y=new qt(u.LEQUAL,qt.ReadWrite,c.depthRangeFor3D),T=c.useProgram("terrain"),b=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]);for(const S of s){const A=c.renderToTexture.getTexture(S),k=e.getTerrainData(S.tileID);a.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,A.texture);const F={u_matrix:c.transform.calculatePosMatrix(S.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(c.transform.zoom)};T.draw(a,u.TRIANGLES,y,xe.disabled,m,ze.backCCW,F,k,"terrain",b.vertexBuffer,b.indexBuffer,b.segments)}}const Is={symbol:function(c,e,s,a,u){if(c.renderPass!=="translucent")return;const m=xe.disabled,y=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(T,b,S,A,k,F,W){const j=b.transform,G=k==="map",tt=F==="map";for(const lt of T){const gt=A.getTile(lt),Y=gt.getBucket(S);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const mt=d.evaluateSizeForZoom(Y.textSizeData,j.zoom),St=st(gt,1,b.transform.zoom),Mt=Ie(lt.posMatrix,tt,G,b.transform,St),Rt=S.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(mt){const Ut=Math.pow(2,j.zoom-gt.tileID.overscaledZ);_o(Y,G,tt,W,j,Mt,lt.posMatrix,Ut,mt,Rt,b.style.map.terrain?(zt,te)=>b.style.map.terrain.getElevation(lt,zt,te):null)}}}(a,c,s,e,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),u),s.paint.get("icon-opacity").constantOr(1)!==0&&fn(c,e,s,a,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),m,y),s.paint.get("text-opacity").constantOr(1)!==0&&fn(c,e,s,a,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),m,y),e.map.showCollisionBoxes&&(fo(c,e,s,a,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),fo(c,e,s,a,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,e,s,a){if(c.renderPass!=="translucent")return;const u=s.paint.get("circle-opacity"),m=s.paint.get("circle-stroke-width"),y=s.paint.get("circle-stroke-opacity"),T=!s.layout.get("circle-sort-key").isConstant();if(u.constantOr(1)===0&&(m.constantOr(1)===0||y.constantOr(1)===0))return;const b=c.context,S=b.gl,A=c.depthModeForSublayer(0,qt.ReadOnly),k=xe.disabled,F=c.colorModeForRenderPass(),W=[];for(let j=0;j<a.length;j++){const G=a[j],tt=e.getTile(G),lt=tt.getBucket(s);if(!lt)continue;const gt=lt.programConfigurations.get(s.id),Y=c.useProgram("circle",gt),mt=lt.layoutVertexBuffer,St=lt.indexBuffer,Mt=c.style.map.terrain&&c.style.map.terrain.getTerrainData(G),Rt={programConfiguration:gt,program:Y,layoutVertexBuffer:mt,indexBuffer:St,uniformValues:Os(c,G,tt,s),terrainData:Mt};if(T){const Ut=lt.segments.get();for(const zt of Ut)W.push({segments:new d.SegmentVector([zt]),sortKey:zt.sortKey,state:Rt})}else W.push({segments:lt.segments,sortKey:0,state:Rt})}T&&W.sort((j,G)=>j.sortKey-G.sortKey);for(const j of W){const{programConfiguration:G,program:tt,layoutVertexBuffer:lt,indexBuffer:gt,uniformValues:Y,terrainData:mt}=j.state;tt.draw(b,S.TRIANGLES,A,k,F,ze.disabled,Y,mt,s.id,lt,gt,j.segments,s.paint,c.transform.zoom,G)}},heatmap:function(c,e,s,a){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const u=c.context,m=u.gl,y=xe.disabled,T=new Lt([m.ONE,m.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(b,S,A){const k=b.gl;b.activeTexture.set(k.TEXTURE1),b.viewport.set([0,0,S.width/4,S.height/4]);let F=A.heatmapFbo;if(F)k.bindTexture(k.TEXTURE_2D,F.colorAttachment.get()),b.bindFramebuffer.set(F.framebuffer);else{const W=k.createTexture();k.bindTexture(k.TEXTURE_2D,W),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,k.LINEAR),F=A.heatmapFbo=b.createFramebuffer(S.width/4,S.height/4,!1,!1),function(j,G,tt,lt){var gt,Y;const mt=j.gl,St=(gt=j.HALF_FLOAT)!==null&&gt!==void 0?gt:mt.UNSIGNED_BYTE,Mt=(Y=j.RGBA16F)!==null&&Y!==void 0?Y:mt.RGBA;mt.texImage2D(mt.TEXTURE_2D,0,Mt,G.width/4,G.height/4,0,mt.RGBA,St,null),lt.colorAttachment.set(tt)}(b,S,W,F)}})(u,c,s),u.clear({color:d.Color.transparent});for(let b=0;b<a.length;b++){const S=a[b];if(e.hasRenderableParent(S))continue;const A=e.getTile(S),k=A.getBucket(s);if(!k)continue;const F=k.programConfigurations.get(s.id),W=c.useProgram("heatmap",F),{zoom:j}=c.transform;W.draw(u,m.TRIANGLES,qt.disabled,y,T,ze.disabled,oo(S.posMatrix,A,j,s.paint.get("heatmap-intensity")),null,s.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,s.paint,c.transform.zoom,F)}u.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(u,m){const y=u.context,T=y.gl,b=m.heatmapFbo;if(!b)return;y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,b.colorAttachment.get()),y.activeTexture.set(T.TEXTURE1);let S=m.colorRampTexture;S||(S=m.colorRampTexture=new we(y,m.colorRamp,T.RGBA)),S.bind(T.LINEAR,T.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(y,T.TRIANGLES,qt.disabled,xe.disabled,u.colorModeForRenderPass(),ze.disabled,((A,k,F,W)=>{const j=d.create();d.ortho(j,0,A.width,A.height,0,0,1);const G=A.context.gl;return{u_matrix:j,u_world:[G.drawingBufferWidth,G.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}})(u,m),null,m.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,m.paint,u.transform.zoom)}(c,s))},line:function(c,e,s,a){if(c.renderPass!=="translucent")return;const u=s.paint.get("line-opacity"),m=s.paint.get("line-width");if(u.constantOr(1)===0||m.constantOr(1)===0)return;const y=c.depthModeForSublayer(0,qt.ReadOnly),T=c.colorModeForRenderPass(),b=s.paint.get("line-dasharray"),S=s.paint.get("line-pattern"),A=S.constantOr(1),k=s.paint.get("line-gradient"),F=s.getCrossfadeParameters(),W=A?"linePattern":b?"lineSDF":k?"lineGradient":"line",j=c.context,G=j.gl;let tt=!0;for(const lt of a){const gt=e.getTile(lt);if(A&&!gt.patternsLoaded())continue;const Y=gt.getBucket(s);if(!Y)continue;const mt=Y.programConfigurations.get(s.id),St=c.context.program.get(),Mt=c.useProgram(W,mt),Rt=tt||Mt.program!==St,Ut=c.style.map.terrain&&c.style.map.terrain.getTerrainData(lt),zt=S.constantOr(null);if(zt&&gt.imageAtlas){const Re=gt.imageAtlas,Wt=Re.patternPositions[zt.to.toString()],Ce=Re.patternPositions[zt.from.toString()];Wt&&Ce&&mt.setConstantPatternPositions(Wt,Ce)}const te=Ut?lt:null,ge=A?an(c,gt,s,F,te):b?Us(c,gt,s,b,F,te):k?Ts(c,gt,s,Y.lineClipsArray.length,te):Jn(c,gt,s,te);if(A)j.activeTexture.set(G.TEXTURE0),gt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),mt.updatePaintBuffers(F);else if(b&&(Rt||c.lineAtlas.dirty))j.activeTexture.set(G.TEXTURE0),c.lineAtlas.bind(j);else if(k){const Re=Y.gradients[s.id];let Wt=Re.texture;if(s.gradientVersion!==Re.version){let Ce=256;if(s.stepInterpolant){const ne=e.getSource().maxzoom,ri=lt.canonical.z===ne?Math.ceil(1<<c.transform.maxZoom-lt.canonical.z):1;Ce=d.clamp(d.nextPowerOfTwo(Y.maxLineLength/d.EXTENT*1024*ri),256,j.maxTextureSize)}Re.gradient=d.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Ce,image:Re.gradient||void 0,clips:Y.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new we(j,Re.gradient,G.RGBA),Re.version=s.gradientVersion,Wt=Re.texture}j.activeTexture.set(G.TEXTURE0),Wt.bind(s.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}Mt.draw(j,G.TRIANGLES,y,c.stencilModeForClipping(lt),T,ze.disabled,ge,Ut,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,c.transform.zoom,mt,Y.layoutVertexBuffer2),tt=!1}},fill:function(c,e,s,a){const u=s.paint.get("fill-color"),m=s.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const y=c.colorModeForRenderPass(),T=s.paint.get("fill-pattern"),b=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&u.constantOr(d.Color.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===b){const S=c.depthModeForSublayer(1,c.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly);xn(c,e,s,a,S,y,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const S=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly);xn(c,e,s,a,S,y,!0)}},"fill-extrusion":function(c,e,s,a){const u=s.paint.get("fill-extrusion-opacity");if(u!==0&&c.renderPass==="translucent"){const m=new qt(c.context.gl.LEQUAL,qt.ReadWrite,c.depthRangeFor3D);if(u!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Cs(c,e,s,a,m,xe.disabled,Lt.disabled),Cs(c,e,s,a,m,c.stencilModeFor3D(),c.colorModeForRenderPass());else{const y=c.colorModeForRenderPass();Cs(c,e,s,a,m,xe.disabled,y)}}},hillshade:function(c,e,s,a){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const u=c.context,m=c.depthModeForSublayer(0,qt.ReadOnly),y=c.colorModeForRenderPass(),[T,b]=c.renderPass==="translucent"?c.stencilConfigForOverlap(a):[{},a];for(const S of b){const A=e.getTile(S);A.needsHillshadePrepare!==void 0&&A.needsHillshadePrepare&&c.renderPass==="offscreen"?yo(c,A,s,m,xe.disabled,y):c.renderPass==="translucent"&&is(c,S,A,s,m,T[S.overscaledZ],y)}u.viewport.set([0,0,c.width,c.height])},raster:function(c,e,s,a){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!a.length)return;const u=c.context,m=u.gl,y=e.getSource(),T=c.useProgram("raster"),b=c.colorModeForRenderPass(),[S,A]=y instanceof Bi?[{},a]:c.stencilConfigForOverlap(a),k=A[A.length-1].overscaledZ,F=!c.options.moving;for(const W of A){const j=c.depthModeForSublayer(W.overscaledZ-k,s.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,m.LESS),G=e.getTile(W);G.registerFadeDuration(s.paint.get("raster-fade-duration"));const tt=e.findLoadedParent(W,0),lt=_i(G,tt,e,s,c.transform,c.style.map.terrain);let gt,Y;const mt=s.paint.get("raster-resampling")==="nearest"?m.NEAREST:m.LINEAR;u.activeTexture.set(m.TEXTURE0),G.texture.bind(mt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),u.activeTexture.set(m.TEXTURE1),tt?(tt.texture.bind(mt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),gt=Math.pow(2,tt.tileID.overscaledZ-G.tileID.overscaledZ),Y=[G.tileID.canonical.x*gt%1,G.tileID.canonical.y*gt%1]):G.texture.bind(mt,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST);const St=c.style.map.terrain&&c.style.map.terrain.getTerrainData(W),Mt=St?W:null,Rt=Mt?Mt.posMatrix:c.transform.calculatePosMatrix(W.toUnwrapped(),F),Ut=De(Rt,Y||[0,0],gt||1,lt,s);y instanceof Bi?T.draw(u,m.TRIANGLES,j,xe.disabled,b,ze.disabled,Ut,St,s.id,y.boundsBuffer,c.quadTriangleIndexBuffer,y.boundsSegments):T.draw(u,m.TRIANGLES,j,S[W.overscaledZ],b,ze.disabled,Ut,St,s.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,e,s,a){const u=s.paint.get("background-color"),m=s.paint.get("background-opacity");if(m===0)return;const y=c.context,T=y.gl,b=c.transform,S=b.tileSize,A=s.paint.get("background-pattern");if(c.isPatternMissing(A))return;const k=!A&&u.a===1&&m===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==k)return;const F=xe.disabled,W=c.depthModeForSublayer(0,k==="opaque"?qt.ReadWrite:qt.ReadOnly),j=c.colorModeForRenderPass(),G=c.useProgram(A?"backgroundPattern":"background"),tt=a||b.coveringTiles({tileSize:S,terrain:c.style.map.terrain});A&&(y.activeTexture.set(T.TEXTURE0),c.imageManager.bind(c.context));const lt=s.getCrossfadeParameters();for(const gt of tt){const Y=a?gt.posMatrix:c.transform.calculatePosMatrix(gt.toUnwrapped()),mt=A?pn(Y,m,c,A,{tileID:gt,tileSize:S},lt):dn(Y,m,u),St=c.style.map.terrain&&c.style.map.terrain.getTerrainData(gt);G.draw(y,T.TRIANGLES,W,F,j,ze.disabled,mt,St,s.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}},debug:function(c,e,s){for(let a=0;a<s.length;a++)qr(c,e,s[a])},custom:function(c,e,s){const a=c.context,u=s.implementation;if(c.renderPass==="offscreen"){const m=u.prerender;m&&(c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),m.call(u,a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),a.setStencilMode(xe.disabled);const m=u.renderingMode==="3d"?new qt(c.context.gl.LEQUAL,qt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,qt.ReadOnly);a.setDepthMode(m),u.render(a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState(),a.bindFramebuffer.set(null)}}};class Ia{constructor(e,s){this.context=new he(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.create(),renderTime:0},this.setup(),this.numSublayers=Di.maxUnderzooming+Di.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hr}resize(e,s,a){if(this.width=e*a,this.height=s*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.PosArray;s.emplaceBack(0,0),s.emplaceBack(d.EXTENT,0),s.emplaceBack(0,d.EXTENT),s.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(s,Or.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const a=new d.PosArray;a.emplaceBack(0,0),a.emplaceBack(d.EXTENT,0),a.emplaceBack(0,d.EXTENT),a.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=e.createVertexBuffer(a,Or.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const u=new d.RasterBoundsArray;u.emplaceBack(0,0,0,0),u.emplaceBack(d.EXTENT,0,d.EXTENT,0),u.emplaceBack(0,d.EXTENT,0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(u,qn.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.PosArray;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,Or.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const y=new d.LineStripIndexArray;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const T=new d.TriangleIndexArray;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const b=this.context.gl;this.stencilClearMode=new xe({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=d.create();d.ortho(a,0,this.width,this.height,0,0,1),d.scale(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,qt.disabled,this.stencilClearMode,Lt.disabled,ze.disabled,Kn(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const a=this.context,u=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(Lt.disabled),a.setDepthMode(qt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of s){const T=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,b=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y);m.draw(a,u.TRIANGLES,qt.disabled,new xe({func:u.ALWAYS,mask:0},T,255,u.KEEP,u.KEEP,u.REPLACE),Lt.disabled,ze.disabled,Kn(y.posMatrix),b,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new xe({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new xe({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,a=e.sort((y,T)=>T.overscaledZ-y.overscaledZ),u=a[a.length-1].overscaledZ,m=a[0].overscaledZ-u+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let T=0;T<m;T++)y[T+u]=new xe({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=m,[y,a]}return[{[u]:xe.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Lt([e.CONSTANT_COLOR,e.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lt.unblended:Lt.alphaBlended}depthModeForSublayer(e,s,a){if(!this.opaquePassEnabledForLayer())return qt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new qt(a||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const a=this.style._order,u=this.style.sourceCaches,m={},y={},T={};for(const b in u){const S=u[b];S.used&&S.prepare(this.context),m[b]=S.getVisibleCoordinates(),y[b]=m[b].slice().reverse(),T[b]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let b=0;b<a.length;b++)if(this.style._layers[a[b]].is3D()){this.opaquePassCutoff=b;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!d.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||b.length)&&(d.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,A){const k=S.context,F=k.gl,W=Lt.unblended,j=new qt(F.LEQUAL,qt.ReadWrite,[0,1]),G=A.getTerrainMesh(),tt=A.sourceCache.getRenderableTiles(),lt=S.useProgram("terrainDepth");k.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),k.clear({color:d.Color.transparent,depth:1});for(const gt of tt){const Y=A.getTerrainData(gt.tileID),mt={u_matrix:S.transform.calculatePosMatrix(gt.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(S.transform.zoom)};lt.draw(k,F.TRIANGLES,j,xe.disabled,W,ze.backCCW,mt,Y,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,A){const k=S.context,F=k.gl,W=Lt.unblended,j=new qt(F.LEQUAL,qt.ReadWrite,[0,1]),G=A.getTerrainMesh(),tt=A.getCoordsTexture(),lt=A.sourceCache.getRenderableTiles(),gt=S.useProgram("terrainCoords");k.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),k.clear({color:d.Color.transparent,depth:1}),A.coordsIndex=[];for(const Y of lt){const mt=A.getTerrainData(Y.tileID);k.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,tt.texture);const St={u_matrix:S.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(S.transform.zoom)};gt.draw(k,F.TRIANGLES,j,xe.disabled,W,ze.backCCW,St,mt,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),A.coordsIndex.push(Y.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const b of a){const S=this.style._layers[b];if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const A=y[S.source];(S.type==="custom"||A.length)&&this.renderLayer(this,u[S.source],S,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const b=this.style._layers[a[this.currentLayer]],S=u[b.source],A=m[b.source];this._renderTileClippingMasks(b,A),this.renderLayer(this,S,b,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const b=this.style._layers[a[this.currentLayer]],S=u[b.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(b))continue;const A=(b.type==="symbol"?T:y)[b.source];this._renderTileClippingMasks(b,m[b.source]),this.renderLayer(this,S,b,A)}if(this.options.showTileBoundaries){const b=function(S,A){let k=null;const F=Object.values(S._layers).flatMap(tt=>tt.source&&!tt.isHidden(A)?[S.sourceCaches[tt.source]]:[]),W=F.filter(tt=>tt.getSource().type==="vector"),j=F.filter(tt=>tt.getSource().type!=="vector"),G=tt=>{(!k||k.getSource().maxzoom<tt.getSource().maxzoom)&&(k=tt)};return W.forEach(tt=>G(tt)),k||j.forEach(tt=>G(tt)),k}(this.style,this.transform.zoom);b&&Is.debug(this,b,b.getVisibleCoordinates())}this.options.showPadding&&function(b){const S=b.transform.padding;Zr(b,b.transform.height-(S.top||0),3,Cr),Zr(b,S.bottom||0,3,mn),Hs(b,S.left||0,3,Jo),Hs(b,b.transform.width-(S.right||0),3,mr);const A=b.transform.centerPoint;(function(k,F,W,j){vo(k,F-1,W-10,2,20,j),vo(k,F-10,W-1,20,2,j)})(b,A.x,b.transform.height-A.y,Gs)}(this),this.context.setDefault()}renderLayer(e,s,a,u){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(u||[]).length)&&(this.id=a.id,Is[a.type](e,s,a,u,this.style.placement.variableOffsets))}translatePosMatrix(e,s,a,u,m){if(!a[0]&&!a[1])return e;const y=m?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(y){const S=Math.sin(y),A=Math.cos(y);a=[a[0]*A-a[1]*S,a[0]*S+a[1]*A]}const T=[m?a[0]:st(s,a[0],this.transform.zoom),m?a[1]:st(s,a[1],this.transform.zoom),0],b=new Float32Array(16);return d.translate(b,e,T),b}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!s||!a}useProgram(e,s){this.cache=this.cache||{};const a=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Xn(this.context,e,dr[e],s,Er[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class _r{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,a){const u=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const b=1/(T=d.transformMat4([],T,e))[3]/s*u;return d.mul$1(T,T,[b,b,1/T[3],b])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const b=function(F,W){var j=W[0],G=W[1],tt=W[2],lt=j*j+G*G+tt*tt;return lt>0&&(lt=1/Math.sqrt(lt)),F[0]=W[0]*lt,F[1]=W[1]*lt,F[2]=W[2]*lt,F}([],function(F,W,j){var G=W[0],tt=W[1],lt=W[2],gt=j[0],Y=j[1],mt=j[2];return F[0]=tt*mt-lt*Y,F[1]=lt*gt-G*mt,F[2]=G*Y-tt*gt,F}([],Yi([],m[T[0]],m[T[1]]),Yi([],m[T[2]],m[T[1]]))),S=-((A=b)[0]*(k=m[T[1]])[0]+A[1]*k[1]+A[2]*k[2]);var A,k;return b.concat(S)});return new _r(m,y)}}class tr{constructor(e,s){this.min=e,this.max=s,this.center=function(a,u,m){return a[0]=.5*u[0],a[1]=.5*u[1],a[2]=.5*u[2],a}([],function(a,u,m){return a[0]=u[0]+m[0],a[1]=u[1]+m[1],a[2]=u[2]+m[2],a}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],a=yi(this.min),u=yi(this.max);for(let m=0;m<s.length;m++)a[m]=s[m]?this.min[m]:this.center[m],u[m]=s[m]?this.center[m]:this.max[m];return u[2]=this.max[2],new tr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let u=0;u<e.planes.length;u++){const m=e.planes[u];let y=0;for(let T=0;T<s.length;T++)d.dot(m,s[T])>=0&&y++;if(y===0)return 0;y!==s.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const b=e.points[T][u]-this.min[u];m=Math.min(m,b),y=Math.max(y,b)}if(y<0||m>this.max[u]-this.min[u])return 0}return 1}}class Do{constructor(e=0,s=0,a=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=a,this.right=u}interpolate(e,s,a){return s.top!=null&&e.top!=null&&(this.top=d.interpolate.number(e.top,s.top,a)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.interpolate.number(e.bottom,s.bottom,a)),s.left!=null&&e.left!=null&&(this.left=d.interpolate.number(e.left,s.left,a)),s.right!=null&&e.right!=null&&(this.right=d.interpolate.number(e.right,s.right,a)),this}getCenter(e,s){const a=d.clamp((this.left+e-this.right)/2,0,e),u=d.clamp((this.top+s-this.bottom)/2,0,s);return new d.Point(a,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Do(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class xo{constructor(e,s,a,u,m){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=a??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Do,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const e=new xo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.wrap(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var a=new d.ARRAY_TYPE(4);return d.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,u,m){var y=u[0],T=u[1],b=u[2],S=u[3],A=Math.sin(m),k=Math.cos(m);a[0]=y*k+b*A,a[1]=T*k+S*A,a[2]=y*-A+b*k,a[3]=T*-A+S*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,a){this._unmodified=!1,this._edgeInsets.interpolate(e,s,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new d.Point(0,0)),u=this.pointCoordinate(new d.Point(this.width,0)),m=this.pointCoordinate(new d.Point(this.width,this.height)),y=this.pointCoordinate(new d.Point(0,this.height)),T=Math.floor(Math.min(a.x,u.x,m.x,y.x)),b=Math.floor(Math.max(a.x,u.x,m.x,y.x)),S=1;for(let A=T-S;A<=b+S;A++)A!==0&&s.push(new d.UnwrappedTileID(A,e))}return s}coveringTiles(e){var s,a;let u=this.coveringZoomLevel(e);const m=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),T=d.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,u),S=[b*y.x,b*y.y,0],A=[b*T.x,b*T.y,0],k=_r.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const W=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,j=Y=>({aabb:new tr([Y*b,0,0],[(Y+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),G=[],tt=[],lt=u,gt=e.reparseOverscaled?m:u;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)G.push(j(-Y)),G.push(j(Y));for(G.push(j(0));G.length>0;){const Y=G.pop(),mt=Y.x,St=Y.y;let Mt=Y.fullyVisible;if(!Mt){const ge=Y.aabb.intersects(k);if(ge===0)continue;Mt=ge===2}const Rt=e.terrain?S:A,Ut=Y.aabb.distanceX(Rt),zt=Y.aabb.distanceY(Rt),te=Math.max(Math.abs(Ut),Math.abs(zt));if(Y.zoom===lt||te>W+(1<<lt-Y.zoom)-2&&Y.zoom>=F){const ge=lt-Y.zoom,Re=S[0]-.5-(mt<<ge),Wt=S[1]-.5-(St<<ge);tt.push({tileID:new d.OverscaledTileID(Y.zoom===lt?gt:Y.zoom,Y.wrap,Y.zoom,mt,St),distanceSq:hi([A[0]-.5-mt,A[1]-.5-St]),tileDistanceToCamera:Math.sqrt(Re*Re+Wt*Wt)})}else for(let ge=0;ge<4;ge++){const Re=(mt<<1)+ge%2,Wt=(St<<1)+(ge>>1),Ce=Y.zoom+1;let ne=Y.aabb.quadrant(ge);if(e.terrain){const ri=new d.OverscaledTileID(Ce,Y.wrap,Ce,Re,Wt),rn=e.terrain.getMinMaxElevation(ri),si=(s=rn.minElevation)!==null&&s!==void 0?s:this.elevation,Oe=(a=rn.maxElevation)!==null&&a!==void 0?a:this.elevation;ne=new tr([ne.min[0],ne.min[1],si],[ne.max[0],ne.max[1],Oe])}G.push({aabb:ne,zoom:Ce,x:Re,y:Wt,wrap:Y.wrap,fullyVisible:Mt})}}return tt.sort((Y,mt)=>Y.distanceSq-mt.distanceSq).map(Y=>Y.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.Point(d.mercatorXfromLng(e.lng)*this.worldSize,d.mercatorYfromLat(s)*this.worldSize)}unproject(e){return new d.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(e){this.freezeElevation||(this.elevation=e?this.getElevation(this._center,e):0)}getElevation(e,s){const a=d.MercatorCoordinate.fromLngLat(e.wrap()),u=(1<<this.tileZoom)*d.EXTENT,m=a.x*u,y=a.y*u,T=Math.floor(m/d.EXTENT),b=Math.floor(y/d.EXTENT),S=new d.OverscaledTileID(this.tileZoom,0,this.tileZoom,T,b);return s.getElevation(S,m%d.EXTENT,y%d.EXTENT,d.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.pointLocation(this.centerPoint,e),a=this.getElevation(s,e);if(!(this.elevation-a))return;const u=this.getCameraPosition(),m=d.MercatorCoordinate.fromLngLat(u.lngLat,u.altitude),y=d.MercatorCoordinate.fromLngLat(s,a),T=m.x-y.x,b=m.y-y.y,S=m.z-y.z,A=Math.sqrt(T*T+b*b+S*S),k=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=a,this._center=s,this.zoom=k}setLocationAtPoint(e,s){const a=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),y=new d.MercatorCoordinate(m.x-(a.x-u.x),m.y-(a.y-u.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),this.getElevation(e,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.MercatorCoordinate.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const a=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.transformMat4(a,a,this.pixelMatrixInverse),d.transformMat4(u,u,this.pixelMatrixInverse);const m=a[3],y=u[3],T=a[1]/m,b=u[1]/y,S=a[2]/m,A=u[2]/y,k=S===A?0:(0-S)/(A-S);return new d.MercatorCoordinate(d.interpolate.number(a[0]/m,u[0]/y,k)/this.worldSize,d.interpolate.number(T,b,k)/this.worldSize)}coordinatePoint(e,s=0,a=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.transformMat4(u,u,a),new d.Point(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new _e().extend(this.pointLocation(new d.Point(0,e))).extend(this.pointLocation(new d.Point(this.width,e))).extend(this.pointLocation(new d.Point(this.width,this.height))).extend(this.pointLocation(new d.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _e([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,s=!1){const a=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[a])return u[a];const m=e.canonical,y=this.worldSize/this.zoomScale(m.z),T=m.x+Math.pow(2,m.z)*e.wrap,b=d.identity(new Float64Array(16));return d.translate(b,b,[T*y,m.y*y,0]),d.scale(b,b,[y/d.EXTENT,y/d.EXTENT,1]),d.multiply(b,s?this.alignedProjMatrix:this.projMatrix,b),u[a]=new Float32Array(b),u[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,s,a,u,m=-90,y=90,T=-180,b=180;const S=this.size,A=this._unmodified;if(this.latRange){const W=this.latRange;m=d.mercatorYfromLat(W[1])*this.worldSize,y=d.mercatorYfromLat(W[0])*this.worldSize,e=y-m<S.y?S.y/(y-m):0}if(this.lngRange){const W=this.lngRange;T=d.wrap(d.mercatorXfromLng(W[0])*this.worldSize,0,this.worldSize),b=d.wrap(d.mercatorXfromLng(W[1])*this.worldSize,0,this.worldSize),b<T&&(b+=this.worldSize),s=b-T<S.x?S.x/(b-T):0}const k=this.point,F=Math.max(s||0,e||0);if(F)return this.center=this.unproject(new d.Point(s?(b+T)/2:k.x,e?(y+m)/2:k.y)),this.zoom+=this.scaleZoom(F),this._unmodified=A,void(this._constraining=!1);if(this.latRange){const W=k.y,j=S.y/2;W-j<m&&(u=m+j),W+j>y&&(u=y-j)}if(this.lngRange){const W=(T+b)/2,j=d.wrap(k.x,W-this.worldSize/2,W+this.worldSize/2),G=S.x/2;j-G<T&&(a=T+G),j+G>b&&(a=b-G)}a===void 0&&u===void 0||(this.center=this.unproject(new d.Point(a!==void 0?a:k.x,u!==void 0?u:k.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let u=d.identity(new Float64Array(16));d.scale(u,u,[this.width/2,-this.height/2,1]),d.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.identity(new Float64Array(16)),d.scale(u,u,[1,-1,1]),d.translate(u,u,[-1,-1,0]),d.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const m=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,y=Math.PI/2+this._pitch,T=this._fov*(.5+e.y/this.height),b=Math.sin(T)*m/Math.sin(d.clamp(Math.PI-y-T,.01,Math.PI-.01)),S=this.getHorizon(),A=2*Math.atan(S/this.cameraToCenterDistance)*(.5+e.y/(2*S)),k=Math.sin(A)*m/Math.sin(d.clamp(Math.PI-y-A,.01,Math.PI-.01)),F=Math.min(b,k),W=1.01*(Math.cos(Math.PI/2-this._pitch)*F+m),j=this.height/50;u=new Float64Array(16),d.perspective(u,this._fov,this.width/this.height,j,W),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,d.scale(u,u,[1,-1,1]),d.translate(u,u,[0,0,-this.cameraToCenterDistance]),d.rotateX(u,u,this._pitch),d.rotateZ(u,u,this.angle),d.translate(u,u,[-s,-a,0]),this.mercatorMatrix=d.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),d.scale(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,u),d.translate(u,u,[0,0,-this.elevation]),this.projMatrix=u,this.invProjMatrix=d.invert([],u),this.pixelMatrix3D=d.multiply(new Float64Array(16),this.labelPlaneMatrix,u);const G=this.width%2/2,tt=this.height%2/2,lt=Math.cos(this.angle),gt=Math.sin(this.angle),Y=s-Math.round(s)+lt*G+gt*tt,mt=a-Math.round(a)+lt*tt+gt*G,St=new Float64Array(u);if(d.translate(St,St,[Y>.5?Y-1:Y,mt>.5?mt-1:mt,0]),this.alignedProjMatrix=St,u=d.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.Point(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.Point(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let a=s.x,u=s.y,m=s.x,y=s.y;for(const T of e)a=Math.min(a,T.x),u=Math.min(u,T.y),m=Math.max(m,T.x),y=Math.max(y,T.y);return[new d.Point(a,u),new d.Point(m,u),new d.Point(m,y),new d.Point(a,y),new d.Point(a,u)]}}}class Ro{constructor(e){this._hashName=e&&encodeURIComponent(e),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,a){let u=!1,m=null;const y=()=>{m=null,u&&(s(),m=setTimeout(y,300),u=!1)};return()=>(u=!0,m||y(),m)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,u=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,u),y=Math.round(s.lng*m)/m,T=Math.round(s.lat*m)/m,b=this._map.getBearing(),S=this._map.getPitch();let A="";if(A+=e?`/${y}/${T}/${a}`:`${a}/${T}/${y}`,(b||S)&&(A+="/"+Math.round(10*b)/10),S&&(A+=`/${Math.round(S)}`),this._hashName){const k=this._hashName;let F=!1;const W=window.location.hash.slice(1).split("&").map(j=>{const G=j.split("=")[0];return G===k?(F=!0,`${G}=${A}`):j}).filter(j=>j);return F||W.push(`${k}=${A}`),`#${W.join("&")}`}return`#${A}`}_getCurrentHash(){const e=window.location.hash.replace("#","");if(this._hashName){let s;return e.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(s=a)}),(s&&s[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:s,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch{}}}const Ws={linearity:.3,easing:d.bezier(0,0,.3,1)},Bo=d.extend({deceleration:2500,maxSpeed:1400},Ws),Xs=d.extend({deceleration:20,maxSpeed:1400},Ws),ks=d.extend({deceleration:1e3,maxSpeed:360},Ws),Yo=d.extend({deceleration:1e3,maxSpeed:90},Ws);class Ir{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=d.exported.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)s.zoom+=m.zoomDelta||0,s.bearing+=m.bearingDelta||0,s.pitch+=m.pitchDelta||0,m.panDelta&&s.pan._add(m.panDelta),m.around&&(s.around=m.around),m.pinchAround&&(s.pinchAround=m.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const m=As(s.pan.mag(),a,d.extend({},Bo,e||{}));u.offset=s.pan.mult(m.amount/s.pan.mag()),u.center=this._map.transform.center,gr(u,m)}if(s.zoom){const m=As(s.zoom,a,Xs);u.zoom=this._map.transform.zoom+m.amount,gr(u,m)}if(s.bearing){const m=As(s.bearing,a,ks);u.bearing=this._map.transform.bearing+d.clamp(m.amount,-179,179),gr(u,m)}if(s.pitch){const m=As(s.pitch,a,Yo);u.pitch=this._map.transform.pitch+m.amount,gr(u,m)}if(u.zoom||u.bearing){const m=s.pinchAround===void 0?s.around:s.pinchAround;u.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.extend(u,{noMoveStart:!0})}}function gr(c,e){(!c.duration||c.duration<e.duration)&&(c.duration=e.duration,c.easing=e.easing)}function As(c,e,s){const{maxSpeed:a,linearity:u,deceleration:m}=s,y=d.clamp(c*u/(e/1e3),-a,a),T=Math.abs(y)/(m*u);return{easing:s.easing,duration:1e3*T,amount:y*(T/2)}}class Wi extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,a,u={}){const m=yt.mousePos(s.getCanvasContainer(),a),y=s.unproject(m);super(e,d.extend({point:m,lngLat:y,originalEvent:a},u)),this._defaultPrevented=!1,this.target=s}}class ns extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,a){const u=e==="touchend"?a.changedTouches:a.touches,m=yt.touchPos(s.getCanvasContainer(),u),y=m.map(b=>s.unproject(b)),T=m.reduce((b,S,A,k)=>b.add(S.div(k.length)),new d.Point(0,0));super(e,{points:m,point:T,lngLats:y,lngLat:s.unproject(T),originalEvent:a}),this._defaultPrevented=!1}}class Ha extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class ka{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ha(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Wi(e.type,this._map,e))}mouseup(e){this._map.fire(new Wi(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Wi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Wi(e.type,this._map,e))}mouseover(e){this._map.fire(new Wi(e.type,this._map,e))}mouseout(e){this._map.fire(new Wi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ns(e.type,this._map,e))}touchmove(e){this._map.fire(new ns(e.type,this._map,e))}touchend(e){this._map.fire(new ns(e.type,this._map,e))}touchcancel(e){this._map.fire(new ns(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Wi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Wi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ln{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.Point.convert(e),this._map.terrain)}}class Ms{constructor(e,s){this._map=e,this._tr=new Ln(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(yt.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const a=s;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=a,this._box||(this._box=yt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(u.x,a.x),y=Math.max(u.x,a.x),T=Math.min(u.y,a.y),b=Math.max(u.y,a.y);yt.setTransform(this._box,`translate(${m}px,${T}px)`),this._box.style.width=y-m+"px",this._box.style.height=b-T+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const a=this._startPos,u=s;if(this.reset(),yt.suppressClick(),a.x!==u.x||a.y!==u.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(a,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(yt.remove(this._box),this._box=null),yt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.Event(e,{originalEvent:s}))}}function jr(c,e){if(c.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${e.length}`);const s={};for(let a=0;a<c.length;a++)s[c[a].identifier]=e[a];return s}class ee{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(u){const m=new d.Point(0,0);for(const y of u)m._add(y);return m.div(u.length)}(s),this.touches=jr(a,s)))}touchmove(e,s,a){if(this.aborted||!this.centroid)return;const u=jr(a,s);for(const m in this.touches){const y=u[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,s,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Qo{constructor(e){this.singleTap=new ee(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,a){this.singleTap.touchstart(e,s,a)}touchmove(e,s,a){this.singleTap.touchmove(e,s,a)}touchend(e,s,a){const u=this.singleTap.touchend(e,s,a);if(u){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(u)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class bo{constructor(e){this._tr=new Ln(e),this._zoomIn=new Qo({numTouches:1,numTaps:2}),this._zoomOut=new Qo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,a){this._zoomIn.touchstart(e,s,a),this._zoomOut.touchstart(e,s,a)}touchmove(e,s,a){this._zoomIn.touchmove(e,s,a),this._zoomOut.touchmove(e,s,a)}touchend(e,s,a){const u=this._zoomIn.touchend(e,s,a),m=this._zoomOut.touchend(e,s,a),y=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(u)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rs{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(a,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&yt.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const wo={0:1,2:2};class Kt{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=yt.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,a){const u=wo[a];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return yt.mouseButton(e)===this._eventButton}}class ss{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const ta=c=>{c.mousedown=c.dragStart,c.mousemoveWindow=c.dragMove,c.mouseup=c.dragEnd,c.contextmenu=function(e){e.preventDefault()}},ga=({enable:c,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const a=new Kt({checkCorrectEvent:u=>yt.mouseButton(u)===0&&u.ctrlKey||yt.mouseButton(u)===2});return new rs({clickTolerance:e,move:(u,m)=>({bearingDelta:(m.x-u.x)*s}),moveStateManager:a,enable:c,assignEvents:ta})},ea=({enable:c,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const a=new Kt({checkCorrectEvent:u=>yt.mouseButton(u)===0&&u.ctrlKey||yt.mouseButton(u)===2});return new rs({clickTolerance:e,move:(u,m)=>({pitchDelta:(m.y-u.y)*s}),moveStateManager:a,enable:c,assignEvents:ta})};class $r{constructor(e,s){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,s,a){return this._calculateTransform(e,s,a)}touchmove(e,s,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,s,a)}touchend(e,s,a){this._calculateTransform(e,s,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,a){a.length>0&&(this._active=!0);const u=jr(a,s),m=new d.Point(0,0),y=new d.Point(0,0);let T=0;for(const S in u){const A=u[S],k=this._touches[S];k&&(m._add(A),y._add(A.sub(k)),T++,u[S]=A)}if(this._touches=u,T<this._minTouches||!y.mag())return;const b=y.div(T);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(T),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,s,a){return{}}touchstart(e,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,a){if(!this._firstTwoTouches)return;e.preventDefault();const[u,m]=this._firstTwoTouches,y=Fo(a,s,u),T=Fo(a,s,m);if(!y||!T)return;const b=this._aroundCenter?null:y.add(T).div(2);return this._move([y,T],b,e)}touchend(e,s,a){if(!this._firstTwoTouches)return;const[u,m]=this._firstTwoTouches,y=Fo(a,s,u),T=Fo(a,s,m);y&&T||(this._active&&yt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fo(c,e,s){for(let a=0;a<c.length;a++)if(c[a].identifier===s)return e[a]}function To(c,e){return Math.log(c/e)/Math.LN2}class ya extends Oo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(To(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:To(this._distance,a),pinchAround:s}}}function Ks(c,e){return 180*c.angleWith(e)/Math.PI}class Js extends Oo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s){const a=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ks(this._vector,a),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,a=Ks(e,this._startVector);return Math.abs(a)<s}}function So(c){return Math.abs(c.y)>Math.abs(c.x)}class zn extends Oo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,a){super.touchstart(e,s,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,So(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,m,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,a){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,m=s.mag()>=2;if(!u&&!m)return;if(!u||!m)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==s.y>0;return So(e)&&So(s)&&y}}const Ls={panStep:100,bearingStep:15,pitchStep:10};class va{constructor(e){this._tr=new Ln(e);const s=Ls;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,a=0,u=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,u=0),{cameraAnimation:T=>{const b=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:ia,zoom:s?Math.round(b.zoom)+s*(e.shiftKey?2:1):b.zoom,bearing:b.bearing+a*this._bearingStep,pitch:b.pitch+u*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:b.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ia(c){return c*(2-c)}const No=4.000244140625;class na{constructor(e,s){this._map=e,this._tr=new Ln(e),this._el=e.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=d.exported.now(),u=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%No==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=yt.mousePos(this._el,e),a=this._tr;this._around=d.LngLat.convert(this._aroundCenter?a.center:a.unproject(s)),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>No?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&b!==0&&(b=1/b);const S=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(S*b))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,u=this._easing;let m,y=!1;if(this._type==="wheel"&&a&&u){const T=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),b=u(T);m=d.interpolate.number(a,s,b),T<1?this._frameId||(this._frameId=!0):y=!0}else m=s,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.ease;if(this._prevEase){const a=this._prevEase,u=(d.exported.now()-a.start)/a.duration,m=a.easing(u+.01)-a.easing(u),y=.27/Math.sqrt(m*m+1e-4)*.01,T=Math.sqrt(.0729-y*y);s=d.bezier(y,T,.25,1)}return this._prevEase={start:d.exported.now(),duration:e,easing:s},s}reset(){this._active=!1}}class xa{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yr{constructor(e){this._tr=new Ln(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wi{constructor(){this._tap=new Qo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,s,a){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=s[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(e,s,a))}touchmove(e,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const u=s[0],m=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,s,a)}touchend(e,s,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(e,s,a)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(e,s,a){this._el=e,this._mousePan=s,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ba{constructor(e,s,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class r{constructor(e,s,a,u){this._el=e,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const l=c=>c.zoom||c.drag||c.pitch||c.rotate;class _ extends d.Event{}function x(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class E{constructor(e,s){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ir(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),d.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,m,y]of this._listeners)yt.addEventListener(u,m,u===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,s,a]of this._listeners)yt.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new ka(s,e));const u=s.boxZoom=new Ms(s,e);this._add("boxZoom",u);const m=new bo(s),y=new yr(s);s.doubleClickZoom=new xa(y,m),this._add("tapZoom",m),this._add("clickZoom",y);const T=new wi;this._add("tapDragZoom",T);const b=s.touchPitch=new zn(s);this._add("touchPitch",b);const S=ga(e),A=ea(e);s.dragRotate=new ba(e,S,A),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);const k=(({enable:lt,clickTolerance:gt})=>{const Y=new Kt({checkCorrectEvent:mt=>yt.mouseButton(mt)===0&&!mt.ctrlKey});return new rs({clickTolerance:gt,move:(mt,St)=>({around:St,panDelta:St.sub(mt)}),activateOnStart:!0,moveStateManager:Y,enable:lt,assignEvents:ta})})(e),F=new $r(e,s);s.dragPan=new Uo(a,k,F),this._add("mousePan",k),this._add("touchPan",F,["touchZoom","touchRotate"]);const W=new Js,j=new ya;s.touchZoomRotate=new r(a,j,W,T),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]);const G=s.scrollZoom=new na(s,this);this._add("scrollZoom",G,["mousePan"]);const tt=s.keyboard=new va(s);this._add("keyboard",tt),this._add("blockableMapEvent",new Wa(s));for(const lt of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[lt]&&s[lt].enable(e[lt])}_add(e,s,a){this._handlers.push({handlerName:e,handler:s,allowed:a}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!l(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,a){for(const u in e)if(u!==a&&(!s||s.indexOf(u)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const s=[];for(const a of e)this._el.contains(a.target)&&s.push(a);return s}handleEvent(e,s){if(e.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=e.type==="renderFrame"?void 0:e,u={needsRenderFrame:!1},m={},y={},T=e.touches,b=T?this._getMapTouches(T):void 0,S=b?yt.touchPos(this._el,b):yt.mousePos(this._el,e);for(const{handlerName:F,handler:W,allowed:j}of this._handlers){if(!W.isEnabled())continue;let G;this._blockedByActive(y,j,F)?W.reset():W[s||e.type]&&(G=W[s||e.type](e,S,b),this.mergeHandlerResult(u,m,G,F,a),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||W.isActive())&&(y[F]=W)}const A={};for(const F in this._previousActiveHandlers)y[F]||(A[F]=a);this._previousActiveHandlers=y,(Object.keys(A).length||x(u))&&(this._changes.push([u,m,A]),this._triggerRenderFrame()),(Object.keys(y).length||x(u))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=u;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(e,s,a,u,m){if(!a)return;d.extend(e,a);const y={handlerName:u,originalEvent:a.originalEvent||m};a.zoomDelta!==void 0&&(s.zoom=y),a.panDelta!==void 0&&(s.drag=y),a.pitchDelta!==void 0&&(s.pitch=y),a.bearingDelta!==void 0&&(s.rotate=y)}_applyChanges(){const e={},s={},a={};for(const[u,m,y]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.Point(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.extend(s,m),d.extend(a,y);this._updateMapTransform(e,s,a),this._changes=[]}_updateMapTransform(e,s,a){const u=this._map,m=u._getTransformForUpdate(),y=u.terrain;if(!(x(e)||y&&this._terrainMovement))return this._fireEvents(s,a,!0);let{panDelta:T,zoomDelta:b,bearingDelta:S,pitchDelta:A,around:k,pinchAround:F}=e;F!==void 0&&(k=F),u._stop(!0),k=k||u.transform.centerPoint;const W=m.pointLocation(T?k.sub(T):k);S&&(m.bearing+=S),A&&(m.pitch+=A),b&&(m.zoom+=b),y?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(T)):m.setLocationAtPoint(W,k):(this._terrainMovement=!0,m.freezeElevation=!0,m.setLocationAtPoint(W,k),this._map.once("moveend",()=>{m.freezeElevation=!1,this._terrainMovement=!1,m.recalculateZoom(u.terrain)})):m.setLocationAtPoint(W,k),u._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,a,!0)}_fireEvents(e,s,a){const u=l(this._eventsInProgress),m=l(e),y={};for(const A in e){const{originalEvent:k}=e[A];this._eventsInProgress[A]||(y[`${A}start`]=k),this._eventsInProgress[A]=e[A]}!u&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in y)this._fireEvent(A,y[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in e){const{originalEvent:k}=e[A];this._fireEvent(A,k)}const T={};let b;for(const A in this._eventsInProgress){const{handlerName:k,originalEvent:F}=this._eventsInProgress[A];this._handlersById[k].isActive()||(delete this._eventsInProgress[A],b=s[k]||F,T[`${A}end`]=b)}for(const A in T)this._fireEvent(A,T[A]);const S=l(this._eventsInProgress);if(a&&(u||m)&&!S){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;A?(k(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:b})):(this._map.fire(new d.Event("moveend",{originalEvent:b})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.Event(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new _("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const N={extend:(c,...e)=>d.extend(c,...e),run(c){c()},logToElement(c,e=!1,s="log"){const a=window.document.getElementById(s);a&&(e&&(a.innerHTML=""),a.innerHTML+=`<br>${c}`)}};class $ extends d.Evented{constructor(e,s){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,d.bindAll(["_renderFrameCallback"],this),this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,a){return e=d.Point.convert(e).mult(-1),this.panTo(this.transform.center,d.extend({offset:e},s),a)}panTo(e,s,a){return this.easeTo(d.extend({center:e},s),a)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,a){return this.easeTo(d.extend({zoom:e},s),a)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,a){return this.easeTo(d.extend({bearing:e},s),a)}resetNorth(e,s){return this.rotateTo(0,d.extend({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=_e.convert(e);const a=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,s)}_cameraForBoxAndBearing(e,s,a,u){const m={top:0,bottom:0,right:0,left:0};if(typeof(u=d.extend({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const St=u.padding;u.padding={top:St,bottom:St,right:St,left:St}}u.padding=d.extend(m,u.padding);const y=this.transform,T=y.padding,b=y.project(d.LngLat.convert(e)),S=y.project(d.LngLat.convert(s)),A=b.rotate(-a*Math.PI/180),k=S.rotate(-a*Math.PI/180),F=new d.Point(Math.max(A.x,k.x),Math.max(A.y,k.y)),W=new d.Point(Math.min(A.x,k.x),Math.min(A.y,k.y)),j=F.sub(W),G=(y.width-(T.left+T.right+u.padding.left+u.padding.right))/j.x,tt=(y.height-(T.top+T.bottom+u.padding.top+u.padding.bottom))/j.y;if(tt<0||G<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const lt=Math.min(y.scaleZoom(y.scale*Math.min(G,tt)),u.maxZoom),gt=d.Point.convert(u.offset),Y=new d.Point((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(a*Math.PI/180),mt=gt.add(Y).mult(y.scale/y.zoomScale(lt));return{center:y.unproject(b.add(S).div(2).sub(mt)),zoom:lt,bearing:a}}fitBounds(e,s,a){return this._fitInternal(this.cameraForBounds(e,s),s,a)}fitScreenCoordinates(e,s,a,u,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.Point.convert(e)),this.transform.pointLocation(d.Point.convert(s)),a,u),u,m)}_fitInternal(e,s,a){return e?(delete(s=d.extend(e,s)).padding,s.linear?this.easeTo(s,a):this.flyTo(s,a)):this}jumpTo(e,s){this.stop();const a=this._getTransformForUpdate();let u=!1,m=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(u=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=d.LngLat.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(m=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new d.Event("movestart",s)).fire(new d.Event("move",s)),u&&this.fire(new d.Event("zoomstart",s)).fire(new d.Event("zoom",s)).fire(new d.Event("zoomend",s)),m&&this.fire(new d.Event("rotatestart",s)).fire(new d.Event("rotate",s)).fire(new d.Event("rotateend",s)),y&&this.fire(new d.Event("pitchstart",s)).fire(new d.Event("pitch",s)).fire(new d.Event("pitchend",s)),this.fire(new d.Event("moveend",s))}calculateCameraOptionsFromTo(e,s,a,u=0){const m=d.MercatorCoordinate.fromLngLat(e,s),y=d.MercatorCoordinate.fromLngLat(a,u),T=y.x-m.x,b=y.y-m.y,S=y.z-m.z,A=Math.hypot(T,b,S);if(A===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(T,b),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),W=180*Math.atan2(T,-b)/Math.PI;let j=180*Math.acos(k/A)/Math.PI;return j=S<0?90-j:90+j,{center:y.toLngLat(),zoom:F,pitch:j,bearing:W}}easeTo(e,s){this._stop(!1,e.easeId),((e=d.extend({offset:[0,0],duration:500,easing:d.ease},e)).animate===!1||!e.essential&&d.exported.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),u=this.getZoom(),m=this.getBearing(),y=this.getPitch(),T=this.getPadding(),b="zoom"in e?+e.zoom:u,S="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:y,k="padding"in e?e.padding:a.padding,F=d.Point.convert(e.offset);let W=a.centerPoint.add(F);const j=a.pointLocation(W),G=d.LngLat.convert(e.center||j);this._normalizeCenter(G);const tt=a.project(j),lt=a.project(G).sub(tt),gt=a.zoomScale(b-u);let Y,mt;e.around&&(Y=d.LngLat.convert(e.around),mt=a.locationPoint(Y));const St={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||b!==u,this._rotating=this._rotating||m!==S,this._pitching=this._pitching||A!==y,this._padding=!a.isPaddingEqual(k),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,St),this.terrain&&this._prepareElevation(G),this._ease(Mt=>{if(this._zooming&&(a.zoom=d.interpolate.number(u,b,Mt)),this._rotating&&(a.bearing=d.interpolate.number(m,S,Mt)),this._pitching&&(a.pitch=d.interpolate.number(y,A,Mt)),this._padding&&(a.interpolatePadding(T,k,Mt),W=a.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Mt),Y)a.setLocationAtPoint(Y,mt);else{const Rt=a.zoomScale(a.zoom-u),Ut=b>u?Math.min(2,gt):Math.max(.5,gt),zt=Math.pow(Ut,1-Mt),te=a.unproject(tt.add(lt.mult(Mt*zt)).mult(Rt));a.setLocationAtPoint(a.renderWorldCopies?te.wrap():te,W)}this._applyUpdatedTransform(a),this._fireMoveEvents(s)},Mt=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,Mt)},e),this}_prepareEase(e,s,a={}){this._moving=!0,s||a.moving||this.fire(new d.Event("movestart",e)),this._zooming&&!a.zooming&&this.fire(new d.Event("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new d.Event("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new d.Event("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(e,this.terrain),this.transform.freezeElevation=!0}_updateElevation(e){const s=this.transform.getElevation(this._elevationCenter,this.terrain);if(e<1&&s!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(s-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.interpolate.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;const s=e.clone(),{center:a,zoom:u,pitch:m,bearing:y,elevation:T}=this.transformCameraUpdate(s);a&&(s.center=a),u!==void 0&&(s.zoom=u),m!==void 0&&(s.pitch=m),y!==void 0&&(s.bearing=y),T!==void 0&&(s.elevation=T),this.transform.apply(s)}_fireMoveEvents(e){this.fire(new d.Event("move",e)),this._zooming&&this.fire(new d.Event("zoom",e)),this._rotating&&this.fire(new d.Event("rotate",e)),this._pitching&&this.fire(new d.Event("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const a=this._zooming,u=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new d.Event("zoomend",e)),u&&this.fire(new d.Event("rotateend",e)),m&&this.fire(new d.Event("pitchend",e)),this.fire(new d.Event("moveend",e))}flyTo(e,s){if(!e.essential&&d.exported.prefersReducedMotion){const ne=d.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ne,s)}this.stop(),e=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},e);const a=this._getTransformForUpdate(),u=this.getZoom(),m=this.getBearing(),y=this.getPitch(),T=this.getPadding(),b="zoom"in e?d.clamp(+e.zoom,a.minZoom,a.maxZoom):u,S="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:y,k="padding"in e?e.padding:a.padding,F=a.zoomScale(b-u),W=d.Point.convert(e.offset);let j=a.centerPoint.add(W);const G=a.pointLocation(j),tt=d.LngLat.convert(e.center||G);this._normalizeCenter(tt);const lt=a.project(G),gt=a.project(tt).sub(lt);let Y=e.curve;const mt=Math.max(a.width,a.height),St=mt/F,Mt=gt.mag();if("minZoom"in e){const ne=d.clamp(Math.min(e.minZoom,u,b),a.minZoom,a.maxZoom),ri=mt/a.zoomScale(ne-u);Y=Math.sqrt(ri/Mt*2)}const Rt=Y*Y;function Ut(ne){const ri=(St*St-mt*mt+(ne?-1:1)*Rt*Rt*Mt*Mt)/(2*(ne?St:mt)*Rt*Mt);return Math.log(Math.sqrt(ri*ri+1)-ri)}function zt(ne){return(Math.exp(ne)-Math.exp(-ne))/2}function te(ne){return(Math.exp(ne)+Math.exp(-ne))/2}const ge=Ut(0);let Re=function(ne){return te(ge)/te(ge+Y*ne)},Wt=function(ne){return mt*((te(ge)*(zt(ri=ge+Y*ne)/te(ri))-zt(ge))/Rt)/Mt;var ri},Ce=(Ut(1)-ge)/Y;if(Math.abs(Mt)<1e-6||!isFinite(Ce)){if(Math.abs(mt-St)<1e-6)return this.easeTo(e,s);const ne=St<mt?-1:1;Ce=Math.abs(Math.log(St/mt))/Y,Wt=function(){return 0},Re=function(ri){return Math.exp(ne*Y*ri)}}return e.duration="duration"in e?+e.duration:1e3*Ce/("screenSpeed"in e?+e.screenSpeed/Y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==S,this._pitching=A!==y,this._padding=!a.isPaddingEqual(k),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(tt),this._ease(ne=>{const ri=ne*Ce,rn=1/Re(ri);a.zoom=ne===1?b:u+a.scaleZoom(rn),this._rotating&&(a.bearing=d.interpolate.number(m,S,ne)),this._pitching&&(a.pitch=d.interpolate.number(y,A,ne)),this._padding&&(a.interpolatePadding(T,k,ne),j=a.centerPoint.add(W)),this.terrain&&!e.freezeElevation&&this._updateElevation(ne);const si=ne===1?tt:a.unproject(lt.add(gt.mult(Wt(ri))).mult(rn));a.setLocationAtPoint(a.renderWorldCopies?si.wrap():si,j),this._applyUpdatedTransform(a),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,s)}if(!e){const a=this.handlers;a&&a.stop(!1)}return this}_ease(e,s,a){a.animate===!1||a.duration===0?(e(1),s()):(this._easeStart=d.exported.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,s){e=d.wrap(e,-180,180);const a=Math.abs(e-s);return Math.abs(e-360-s)<a&&(e-=360),Math.abs(e+360-s)<a&&(e+=360),e}_normalizeCenter(e){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const a=e.lng-s.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.transform.getElevation(d.LngLat.convert(e),this.terrain)-this.transform.elevation:null}}class at{constructor(e={}){this.options=e,d.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=yt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=yt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=yt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){yt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const a=this._map._getUIString(`AttributionControl.${s}`);e.title=a,e.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"&&e.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const m=s[u];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,m)=>u.length-m.length),e=e.filter((u,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(u)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class Tt{constructor(e={}){this.options=e,d.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=yt.create("div","maplibregl-ctrl");const s=yt.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){yt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const e=this._container.children;if(e.length){const s=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact"):s.classList.remove("maplibregl-compact")}}}class Dt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,a=s?this._queue.concat(s):this._queue;for(const u of a)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const a of s)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const oe={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var me=d.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class je extends d.Evented{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const a={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))a[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.ortho(u.posMatrix,0,d.EXTENT,0,d.EXTENT,0,1),this._tiles[u.key]=new Xr(u,this.tileSize));for(const u in this._tiles)a[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const a=this._tiles[s];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const a of this._renderableTilesKeys){const u=this._tiles[a].tileID;if(u.canonical.equals(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16),d.ortho(m.posMatrix,0,d.EXTENT,0,d.EXTENT,0,1),s[a]=m}else if(u.canonical.isChildOf(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const y=u.canonical.z-e.canonical.z,T=u.canonical.x-(u.canonical.x>>y<<y),b=u.canonical.y-(u.canonical.y>>y<<y),S=d.EXTENT>>y;d.ortho(m.posMatrix,0,S,0,S,0,1),d.translate(m.posMatrix,m.posMatrix,[-T*S,-b*S,0]),s[a]=m}else if(e.canonical.isChildOf(u.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const y=e.canonical.z-u.canonical.z,T=e.canonical.x-(e.canonical.x>>y<<y),b=e.canonical.y-(e.canonical.y>>y<<y),S=d.EXTENT>>y;d.ortho(m.posMatrix,0,d.EXTENT,0,d.EXTENT,0,1),d.translate(m.posMatrix,m.posMatrix,[T*S,b*S,0]),d.scale(m.posMatrix,m.posMatrix,[1/2**y,1/2**y,0]),s[a]=m}}return s}getSourceTile(e,s){const a=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>a.maxzoom&&(u=a.maxzoom),u<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&s)for(;u>=a.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(u--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Mi{constructor(e,s,a){this.painter=e,this.sourceCache=new je(s),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,a,u=d.EXTENT){if(!(s>=0&&s<u&&a>=0&&a<u))return 0;let m=0;const y=this.getTerrainData(e);if(y.tile&&y.tile.dem){const T=function(j,G,tt){var lt=G[0],gt=G[1];return j[0]=tt[0]*lt+tt[4]*gt+tt[12],j[1]=tt[1]*lt+tt[5]*gt+tt[13],j}([],[s/u*d.EXTENT,a/u*d.EXTENT],y.u_terrain_matrix),b=[T[0]*y.tile.dem.dim,T[1]*y.tile.dem.dim],S=[Math.floor(b[0]),Math.floor(b[1])],A=y.tile.dem.get(S[0],S[1]),k=y.tile.dem.get(S[0],S[1]+1),F=y.tile.dem.get(S[0]+1,S[1]),W=y.tile.dem.get(S[0]+1,S[1]+1);m=d.interpolate.number(d.interpolate.number(A,k,b[0]-S[0]),d.interpolate.number(F,W,b[0]-S[0]),b[1]-S[1])}return m}getElevation(e,s,a,u=d.EXTENT){return this.getDEMElevation(e,s,a,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,m=new d.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(u,m,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(u,new d.RGBAImage({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.identity([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new we(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const a=s&&s+s.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const u=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?m=e.canonical.z-u:d.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),T=e.canonical.y-(e.canonical.y>>m<<m),b=d.fromScaling(new Float64Array(16),[1/(d.EXTENT<<m),1/(d.EXTENT<<m),0]);d.translate(b,b,[y*d.EXTENT,T*d.EXTENT,0]),this._demMatrixCache[e.key]={matrix:b,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,a=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(s.context,{width:a,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(s.context,{width:a,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(a,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,a,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let T=0;T<this._coordsTextureSize;T++,y+=4)s[y+0]=255&T,s[y+1]=255&m,s[y+2]=T>>8<<4|m>>8,s[y+3]=0;const a=new d.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new we(e,a,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){const s=new Uint8Array(4),a=this.painter.context,u=a.gl;a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),a.bindFramebuffer.set(null);const m=s[0]+(s[2]>>4<<8),y=s[1]+((15&s[2])<<8),T=this.coordsIndex[255-s[3]],b=T&&this.sourceCache.getTileByID(T);if(!b)return null;const S=this._coordsTextureSize,A=(1<<b.tileID.canonical.z)*S;return new d.MercatorCoordinate((b.tileID.canonical.x*S+m)/A,(b.tileID.canonical.y*S+y)/A,this.getElevation(b.tileID,m,y,S))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.Pos3dArray,a=new d.TriangleIndexArray,u=this.meshSize,m=d.EXTENT/u,y=u*u;for(let k=0;k<=u;k++)for(let F=0;F<=u;F++)s.emplaceBack(F*m,k*m,0);for(let k=0;k<y;k+=u+1)for(let F=0;F<u;F++)a.emplaceBack(F+k,u+F+k+1,u+F+k+2),a.emplaceBack(F+k,u+F+k+2,F+k+1);const T=s.length,b=T+2*(u+1);for(const k of[0,1])for(let F=0;F<=u;F++)for(const W of[0,1])s.emplaceBack(F*m,k*d.EXTENT,W);for(let k=0;k<2*u;k+=2)a.emplaceBack(b+k,b+k+1,b+k+3),a.emplaceBack(b+k,b+k+3,b+k+2),a.emplaceBack(T+k,T+k+3,T+k+1),a.emplaceBack(T+k,T+k+2,T+k+3);const S=s.length,A=S+2*(u+1);for(const k of[0,1])for(let F=0;F<=u;F++)for(const W of[0,1])s.emplaceBack(k*d.EXTENT,F*m,W);for(let k=0;k<2*u;k+=2)a.emplaceBack(S+k,S+k+1,S+k+3),a.emplaceBack(S+k,S+k+3,S+k+2),a.emplaceBack(A+k,A+k+3,A+k+1),a.emplaceBack(A+k,A+k+2,A+k+3);return this._mesh={indexBuffer:e.createIndexBuffer(a),vertexBuffer:e.createVertexBuffer(s,me.members),segments:d.SegmentVector.simpleSegment(0,0,s.length,a.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.earthRadius/Math.pow(2,e)/5}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return s&&s.dem&&(a.minElevation=s.dem.min*this.exaggeration,a.maxElevation=s.dem.max*this.exaggeration),a}}class ln{constructor(e,s,a){this._context=e,this._size=s,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(a.texture),{id:e,fbo:s,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Xi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Je{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new ln(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(s)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const u=e.sourceCaches[a].getVisibleCoordinates();for(const m of u){const y=this.terrain.sourceCache.getTerrainCoords(m);for(const T in y)this._coordsDescendingInv[a][T]||(this._coordsDescendingInv[a][T]=[]),this._coordsDescendingInv[a][T].push(y[T])}}this._coordsDescendingInvStr={};for(const a of e._order){const u=e._layers[a],m=u.source;if(Xi[u.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const y in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][y]=this._coordsDescendingInv[m][y].map(T=>T.key).sort().join()}}for(const a of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[u][a.tileID.key];m&&m!==a.rttCoords[u]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,a=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Xi[s]&&(this._prevType&&Xi[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(Xi[this._prevType]||Xi[s]&&u){this._prevType=s;const m=this._stacks.length-1,y=this._stacks[m]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(_a(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[m]){const S=this.pool.getObjectForId(T.rtt[m].id);if(S.stamp===T.rtt[m].stamp){this.pool.useObject(S);continue}}const b=this.pool.getOrCreateFreeObject();this.pool.useObject(b),this.pool.stampObject(b),T.rtt[m]={id:b.id,stamp:b.stamp},a.context.bindFramebuffer.set(b.fbo.framebuffer),a.context.clear({color:d.Color.transparent,stencil:0}),a.currentStencilSource=void 0;for(let S=0;S<y.length;S++){const A=a.style._layers[y[S]],k=A.source?this._coordsDescendingInv[A.source][T.tileID.key]:[T.tileID];a.context.viewport.set([0,0,b.fbo.width,b.fbo.height]),a._renderTileClippingMasks(A,k),a.renderLayer(a,a.style.sourceCaches[A.source],A,k),A.source&&(T.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][T.tileID.key])}}return _a(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Xi[s]}return!1}}const Ei=Ot,Aa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0},Po=c=>{c.touchstart=c.dragStart,c.touchmoveWindow=c.dragMove,c.touchend=c.dragEnd},ra={showCompass:!0,showZoom:!0,visualizePitch:!1};class sa{constructor(e,s,a=!1){this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=ga({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:y,clickTolerance:T,bearingDegreesPerPixelMoved:b=.8})=>{const S=new ss;return new rs({clickTolerance:T,move:(A,k)=>({bearingDelta:(k.x-A.x)*b}),moveStateManager:S,enable:y,assignEvents:Po})})({clickTolerance:u,enable:!0}),this.map=e,a&&(this.mousePitch=ea({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:y,clickTolerance:T,pitchDegreesPerPixelMoved:b=-.5})=>{const S=new ss;return new rs({clickTolerance:T,move:(A,k)=>({pitchDelta:(k.y-A.y)*b}),moveStateManager:S,enable:y,assignEvents:Po})})({clickTolerance:m,enable:!0})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),yt.addEventListener(s,"mousedown",this.mousedown),yt.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),yt.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),yt.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),yt.disableDrag()}moveMouse(e,s){const a=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&a.setBearing(a.getBearing()+u),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(e,s)||{};m&&a.setPitch(a.getPitch()+m)}}moveTouch(e,s){const a=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&a.setBearing(a.getBearing()+u),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(e,s)||{};m&&a.setPitch(a.getPitch()+m)}}off(){const e=this.element;yt.removeEventListener(e,"mousedown",this.mousedown),yt.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),yt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),yt.removeEventListener(window,"touchend",this.touchend),yt.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){yt.enableDrag(),yt.removeEventListener(window,"mousemove",this.mousemove),yt.removeEventListener(window,"mouseup",this.mouseup),yt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),yt.removeEventListener(window,"touchend",this.touchend)}mousedown(e){this.startMouse(d.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),yt.mousePos(this.element,e)),yt.addEventListener(window,"mousemove",this.mousemove),yt.addEventListener(window,"mouseup",this.mouseup)}mousemove(e){this.moveMouse(e,yt.mousePos(this.element,e))}mouseup(e){this.mouseRotate.dragEnd(e),this.mousePitch&&this.mousePitch.dragEnd(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=yt.touchPos(this.element,e.targetTouches)[0],this.startTouch(e,this._startPos),yt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),yt.addEventListener(window,"touchend",this.touchend))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=yt.touchPos(this.element,e.targetTouches)[0],this.moveTouch(e,this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Gr;function Vo(c,e,s){if(c=new d.LngLat(c.lng,c.lat),e){const a=new d.LngLat(c.lng-360,c.lat),u=new d.LngLat(c.lng+360,c.lat),m=s.locationPoint(c).distSqr(e);s.locationPoint(a).distSqr(e)<m?c=a:s.locationPoint(u).distSqr(e)<m&&(c=u)}for(;Math.abs(c.lng-s.center.lng)>180;){const a=s.locationPoint(c);if(a.x>=0&&a.y>=0&&a.x<=s.width&&a.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const Ti={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ys(c,e,s){const a=c.classList;for(const u in Ti)a.remove(`maplibregl-${s}-anchor-${u}`);a.add(`maplibregl-${s}-anchor-${e}`)}class Zo extends d.Evented{constructor(e,s){if(super(),(e instanceof HTMLElement||s)&&(e=d.extend({element:e},s)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=d.Point.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=yt.create("div"),this._element.setAttribute("aria-label","Map marker");const a=yt.createNS("http://www.w3.org/2000/svg","svg"),u=41,m=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${m}px`),a.setAttributeNS(null,"viewBox",`0 0 ${m} ${u}`);const y=yt.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=yt.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const b=yt.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const gt of S){const Y=yt.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",gt.rx),Y.setAttributeNS(null,"ry",gt.ry),b.appendChild(Y)}const A=yt.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const k=yt.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(k);const F=yt.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"opacity","0.25"),F.setAttributeNS(null,"fill","#000000");const W=yt.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),F.appendChild(W);const j=yt.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const G=yt.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const tt=yt.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");const lt=yt.createNS("http://www.w3.org/2000/svg","circle");lt.setAttributeNS(null,"fill","#FFFFFF"),lt.setAttributeNS(null,"cx","5.5"),lt.setAttributeNS(null,"cy","5.5"),lt.setAttributeNS(null,"r","5.4999962"),G.appendChild(tt),G.appendChild(lt),T.appendChild(b),T.appendChild(A),T.appendChild(F),T.appendChild(j),T.appendChild(G),a.appendChild(T),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(a),this._offset=d.Point.convert(e&&e.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Ys(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),yt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const s=e.code,a=e.charCode||e.keyCode;s!=="Space"&&s!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(e){const s=e.originalEvent.target,a=this._element;this._popup&&(s===a||a.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Vo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),e&&e.type!=="moveend"||(this._pos=this._pos.round()),yt.setTransform(this._element,`${Ti[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${s}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const u=this._map.unproject(this._pos),m=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=u.distanceTo(this._lngLat)>20*m?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(e){return this._offset=d.Point.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const wa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Eo=0,os=!1;const oa={maxWidth:100,unit:"metric"};function aa(c,e,s){const a=s&&s.maxWidth||100,u=c._container.clientHeight/2,m=c.unproject([0,u]),y=c.unproject([a,u]),T=m.distanceTo(y);if(s&&s.unit==="imperial"){const b=3.2808*T;b>5280?qo(e,a,b/5280,c._getUIString("ScaleControl.Miles")):qo(e,a,b,c._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?qo(e,a,T/1852,c._getUIString("ScaleControl.NauticalMiles")):T>=1e3?qo(e,a,T/1e3,c._getUIString("ScaleControl.Kilometers")):qo(e,a,T,c._getUIString("ScaleControl.Meters"))}function qo(c,e,s,a){const u=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let T=m/y;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(b){const S=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*S)/S}(T),y*T}(s);c.style.width=e*(u/s)+"px",c.innerHTML=`${u}&nbsp;${a}`}const Ma={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function La(c){if(c){if(typeof c=="number"){const e=Math.round(Math.sqrt(.5*Math.pow(c,2)));return{center:new d.Point(0,0),top:new d.Point(0,c),"top-left":new d.Point(e,e),"top-right":new d.Point(-e,e),bottom:new d.Point(0,-c),"bottom-left":new d.Point(e,-e),"bottom-right":new d.Point(-e,-e),left:new d.Point(c,0),right:new d.Point(-c,0)}}if(c instanceof d.Point||Array.isArray(c)){const e=d.Point.convert(c);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.Point.convert(c.center||[0,0]),top:d.Point.convert(c.top||[0,0]),"top-left":d.Point.convert(c["top-left"]||[0,0]),"top-right":d.Point.convert(c["top-right"]||[0,0]),bottom:d.Point.convert(c.bottom||[0,0]),"bottom-left":d.Point.convert(c["bottom-left"]||[0,0]),"bottom-right":d.Point.convert(c["bottom-right"]||[0,0]),left:d.Point.convert(c.left||[0,0]),right:d.Point.convert(c.right||[0,0])}}return La(new d.Point(0,0))}const za=Ot,Da={setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends ${constructor(c){var e;if(d.PerformanceUtils.mark(d.PerformanceMarkers.create),(c=d.extend({},Aa,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new xo(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._interactive=c.interactive,this._cooperativeGestures=c.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new Dt,this._controls=[],this._mapId=d.uniqueId(),this._locale=d.extend({},oe,c.locale),this._clickTolerance=c.clickTolerance,this._pixelRatio=(e=c.pixelRatio)!==null&&e!==void 0?e:devicePixelRatio,this.transformCameraUpdate=c.transformCameraUpdate,this._imageQueueHandle=de.addThrottleControl(()=>this.isMoving()),this._requestManager=new be(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),d.bindAll(["_onWindowOnline","_onMapScroll","_cooperativeGesturesOnWheel","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;this._resizeObserver=new ResizeObserver(a=>{s?this._trackResize&&this.resize(a)._update():s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new E(this,c),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=c.hash&&new Ro(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,d.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new at({customAttribution:c.customAttribution})),c.maplibreLogo&&this.addControl(new Tt,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(c,e){if(e===void 0&&(e=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(s,a.firstChild):a.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(c);return e>-1&&this._controls.splice(e,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,e,s,a){return a==null&&this.terrain&&(a=this.transform.getElevation(s,this.terrain)),super.calculateCameraOptionsFromTo(c,e,s,a)}resize(c){var e;const s=this._containerDimensions(),a=s[0],u=s[1];this._resizeCanvas(a,u,this.getPixelRatio()),this.transform.resize(a,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,u),this.painter.resize(a,u,this.getPixelRatio());const m=!this._moving;return m&&(this.stop(),this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c))),this.fire(new d.Event("resize",c)),m&&this.fire(new d.Event("moveend",c)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(c){const[e,s]=this._containerDimensions();this._pixelRatio=c,this._resizeCanvas(e,s,c),this.painter.resize(e,s,c)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(_e.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(c){return this.transform.locationPoint(d.LngLat.convert(c),this.style&&this.terrain)}unproject(c){return this.transform.pointLocation(d.Point.convert(c),this.terrain)}isMoving(){var c;return this._moving||((c=this.handlers)===null||c===void 0?void 0:c.isMoving())}isZooming(){var c;return this._zooming||((c=this.handlers)===null||c===void 0?void 0:c.isZooming())}isRotating(){var c;return this._rotating||((c=this.handlers)===null||c===void 0?void 0:c.isRotating())}_createDelegatedListener(c,e,s){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:m=>{const y=this.getLayer(e)?this.queryRenderedFeatures(m.point,{layers:[e]}):[];y.length?a||(a=!0,s.call(this,new Wi(c,this,m.originalEvent,{features:y}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:y=>{(this.getLayer(e)?this.queryRenderedFeatures(y.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,s.call(this,new Wi(c,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,s.call(this,new Wi(c,this,y.originalEvent)))}}}}{const a=u=>{const m=this.getLayer(e)?this.queryRenderedFeatures(u.point,{layers:[e]}):[];m.length&&(u.features=m,s.call(this,u),delete u.features)};return{layer:e,listener:s,delegates:{[c]:a}}}}on(c,e,s){if(s===void 0)return super.on(c,e);const a=this._createDelegatedListener(c,e,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const u in a.delegates)this.on(u,a.delegates[u]);return this}once(c,e,s){if(s===void 0)return super.once(c,e);const a=this._createDelegatedListener(c,e,s);for(const u in a.delegates)this.once(u,a.delegates[u]);return this}off(c,e,s){return s===void 0?super.off(c,e):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const u=this._delegatedListeners[c];for(let m=0;m<u.length;m++){const y=u[m];if(y.layer===e&&y.listener===s){for(const T in y.delegates)this.off(T,y.delegates[T]);return u.splice(m,1),this}}})(),this)}queryRenderedFeatures(c,e){if(!this.style)return[];let s;const a=c instanceof d.Point||Array.isArray(c),u=a?c:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:c)||{},u instanceof d.Point||typeof u[0]=="number")s=[d.Point.convert(u)];else{const m=d.Point.convert(u[0]),y=d.Point.convert(u[1]);s=[m,new d.Point(y.x,m.y),y,new d.Point(m.x,y.y),m]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(c,e){return this.style.querySourceFeatures(c,e)}setStyle(c,e){return(e=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(c,e))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const e=this._locale[c];if(e==null)throw new Error(`Missing UI string '${c}'`);return e}_updateStyle(c,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(c,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!c)),c?(this.style=new Ni(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c,e,s):this.style.loadJSON(c,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ni(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,e){if(typeof c=="string"){const s=this._requestManager.transformRequest(c,Ft.Style);d.getJSON(s,(a,u)=>{a?this.fire(new d.ErrorEvent(a)):u&&this._updateDiff(u,e)})}else typeof c=="object"&&this._updateDiff(c,e)}_updateDiff(c,e){try{this.style.setState(c,e)&&this._update(!0)}catch(s){d.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(c,e){return this._lazyInitEmptyStyle(),this.style.addSource(c,e),this._update(!0)}isSourceLoaded(c){const e=this.style&&this.style.sourceCaches[c];if(e!==void 0)return e.loaded();this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),c){const e=this.style.sourceCaches[c.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${c.source}`);for(const s in this.style._layers){const a=this.style._layers[s];a.type==="hillshade"&&a.source===c.source&&d.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Mi(this.painter,e,c),this.painter.renderToTexture=new Je(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId===c.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new d.Event("terrain",{terrain:c})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const e in c){const s=c[e]._tiles;for(const a in s){const u=s[a];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}addSourceType(c,e,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,e,s)}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,e,{pixelRatio:s=1,sdf:a=!1,stretchX:u,stretchY:m,content:y}={}){if(this._lazyInitEmptyStyle(),e instanceof HTMLImageElement||d.isImageBitmap(e)){const{width:T,height:b,data:S}=d.exported.getImageData(e);this.style.addImage(c,{data:new d.RGBAImage({width:T,height:b},S),pixelRatio:s,stretchX:u,stretchY:m,content:y,sdf:a,version:0})}else{if(e.width===void 0||e.height===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:b,data:S}=e,A=e;this.style.addImage(c,{data:new d.RGBAImage({width:T,height:b},new Uint8Array(S)),pixelRatio:s,stretchX:u,stretchY:m,content:y,sdf:a,version:0,userImage:A}),A.onAdd&&A.onAdd(this,c)}}}updateImage(c,e){const s=this.style.getImage(c);if(!s)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||d.isImageBitmap(e)?d.exported.getImageData(e):e,{width:u,height:m,data:y}=a;if(u===void 0||m===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||m!==s.data.height)return this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||d.isImageBitmap(e));s.data.replace(y,T),this.style.updateImage(c,s)}getImage(c){return this.style.getImage(c)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,e){de.getImage(this._requestManager.transformRequest(c,Ft.Image),e)}listImages(){return this.style.listImages()}addLayer(c,e){return this._lazyInitEmptyStyle(),this.style.addLayer(c,e),this._update(!0)}moveLayer(c,e){return this.style.moveLayer(c,e),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,e,s){return this.style.setLayerZoomRange(c,e,s),this._update(!0)}setFilter(c,e,s={}){return this.style.setFilter(c,e,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,e,s,a={}){return this.style.setPaintProperty(c,e,s,a),this._update(!0)}getPaintProperty(c,e){return this.style.getPaintProperty(c,e)}setLayoutProperty(c,e,s,a={}){return this.style.setLayoutProperty(c,e,s,a),this._update(!0)}getLayoutProperty(c,e){return this.style.getLayoutProperty(c,e)}setGlyphs(c,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(c,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(c,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(c,e,s,a=>{a||this._update(!0)}),this}removeSprite(c){return this._lazyInitEmptyStyle(),this.style.removeSprite(c),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(c,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(c,e,s=>{s||this._update(!0)}),this}setLight(c,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,e){return this.style.setFeatureState(c,e),this._update()}removeFeatureState(c,e){return this.style.removeFeatureState(c,e),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,e=0;return this._container&&(c=this._container.clientWidth||400,e=this._container.clientHeight||300),[c,e]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map");const e=this._canvasContainer=yt.create("div","maplibregl-canvas-container",c);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=yt.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const a=this._controlContainer=yt.create("div","maplibregl-control-container",c),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{u[m]=yt.create("div",`maplibregl-ctrl-${m} `,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_cooperativeGesturesOnWheel(c){this._onCooperativeGesture(c,c[this._metaKey],1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=yt.create("div","maplibregl-cooperative-gesture-screen",this._container);let c=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(c=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${c}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){yt.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(c,e,s){this._canvas.width=s*c,this._canvas.height=s*e,this._canvas.style.width=`${c}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const c={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:c},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const s=this._canvas.getContext("webgl2",c)||this._canvas.getContext("webgl",c);if(!s){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new Ia(s,this.transform),Se.testSupport(s)}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(c,e,s){return!e&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,m=d.exported.now();this.style.zoomHistory.update(u,m);const y=new d.EvaluationParameters(u,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=y.crossFadingFactor();T===1&&T===this._crossFadingFactor||(s=!0,this._crossFadingFactor=T),this.style.update(y)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.PerformanceUtils.mark(d.PerformanceMarkers.load),this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.Event("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,d.PerformanceUtils.mark(d.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var c;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),de.removeThrottleControl(this._imageQueueHandle),(c=this._resizeObserver)===null||c===void 0||c.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),yt.remove(this._canvasContainer),yt.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),d.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=d.exported.frame(c=>{d.PerformanceUtils.frame(c),this._frame=null,this._render(c)}))}_onWindowOnline(){this._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get version(){return Ei}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(c){this.options=d.extend({},ra,c),this._container=yt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),yt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),yt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=yt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map.getZoom(),e=c===this._map.getMaxZoom(),s=c===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){yt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,e){const s=yt.create("button",c,this._container);return s.type="button",s.addEventListener("click",e),s}_setButtonTitle(c,e){const s=this._map._getUIString(`NavigationControl.${e}`);c.title=s,c.setAttribute("aria-label",s)}},GeolocateControl:class extends d.Evented{constructor(c){super(),this.options=d.extend({},wa,c),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(c){return this._map=c,this._container=yt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,s=!1){Gr===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(a=>{Gr=a.state!=="denied",e(Gr)}).catch(()=>{Gr=!!window.navigator.geolocation,e(Gr)}):(Gr=!!window.navigator.geolocation,e(Gr)):e(Gr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),yt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Eo=0,os=!1}_isOutOfMapMaxBounds(c){const e=this._map.getMaxBounds(),s=c.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.Event("geolocate",c)),this._finish()}}_updateCamera(c){const e=new d.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,a=this._map.getBearing(),u=d.extend({bearing:a},this.options.fitBoundsOptions),m=_e.fromLngLat(e,s);this._map.fitBounds(m,u,{geolocateSource:!0})}_updateMarker(c){if(c){const e=new d.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.getBounds(),e=c.getSouthEast(),s=c.getNorthEast(),a=e.distanceTo(s),u=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&os)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=yt.create("button","maplibregl-ctrl-geolocate",this._container),yt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=yt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Zo(this._dotElement),this._circleElement=yt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Zo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Eo--,os=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Eo++,Eo>1?(c={maximumAge:6e5,timeout:0},os=!0):(c=this.options.positionOptions,os=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:at,LogoControl:Tt,ScaleControl:class{constructor(c){this.options=d.extend({},oa,c),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){aa(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=yt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){yt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,aa(this._map,this._container,this.options)}},FullscreenControl:class extends d.Evented{constructor(c={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=yt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){yt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const c=this._fullscreenButton=yt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);yt.create("span","maplibregl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new d.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(c){this.options=c,d.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(c){return this._map=c,this._container=yt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=yt.create("button","maplibregl-ctrl-terrain",this._container),yt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){yt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends d.Evented{constructor(c){super(),this.options=d.extend(Object.create(Ma),c),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&yt.remove(this._content),this._container&&(yt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=d.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const e=document.createDocumentFragment(),s=document.createElement("body");let a;for(s.innerHTML=c;a=s.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=yt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}_createCloseButton(){this.options.closeButton&&(this._closeButton=yt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(c){this._update(c.point)}_onMouseMove(c){this._update(c.point)}_onDrag(c){this._update(c.point)}_update(c){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=yt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=yt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(m=>this._container.classList.add(m)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!c))return;const e=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);let s=this.options.anchor;const a=La(this.options.offset);if(!s){const m=this._container.offsetWidth,y=this._container.offsetHeight;let T;T=e.y+a.bottom.y<y?["top"]:e.y>this._map.transform.height-y?["bottom"]:[],e.x<m/2?T.push("left"):e.x>this._map.transform.width-m/2&&T.push("right"),s=T.length===0?"bottom":T.join("-")}const u=e.add(a[s]).round();yt.setTransform(this._container,`${Ti[s]} translate(${u.x}px,${u.y}px)`),Ys(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Xa);c&&c.focus()}_onClose(){this.remove()}},Marker:Zo,Style:Ni,LngLat:d.LngLat,LngLatBounds:_e,Point:d.Point,MercatorCoordinate:d.MercatorCoordinate,Evented:d.Evented,AJAXError:d.AJAXError,config:d.config,CanvasSource:Pt,GeoJSONSource:Dn,ImageSource:Bi,RasterDEMTileSource:tn,RasterTileSource:un,VectorTileSource:vn,VideoSource:wr,prewarm:function(){ys().acquire(oi)},clearPrewarmedResources:function(){const c=en;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(oi),en=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return za},get workerCount(){return Vt.workerCount},set workerCount(c){Vt.workerCount=c},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){d.config.MAX_PARALLEL_IMAGE_REQUESTS=c},get workerUrl(){return d.config.WORKER_URL},set workerUrl(c){d.config.WORKER_URL=c},addProtocol(c,e){d.config.REGISTERED_PROTOCOLS[c]=e},removeProtocol(c){delete d.config.REGISTERED_PROTOCOLS[c]}};return N.extend(Da,{isSafari:d.isSafari,getPerformanceMetrics:d.PerformanceUtils.getPerformanceMetrics}),Da});var bt=J;return bt})})(pf);window.Pusher=df;window.Echo=new hf({broadcaster:"pusher",key:"b509699f6109a8a7fec0",cluster:"ap1",forceTLS:!0});function mf(vt){const pt=Fe.useRef(),[V,it]=Fe.useState(!1),[J,wt]=Fe.useState(!1),[bt,d]=Fe.useState(!0),[Ot,yt]=Fe.useState([-.01745613099920127,109.34030619134353]),[Se]=Fe.useState(13),[At]=Fe.useState("YGBPAuY7utv2Y7SgHp2N"),[Ht,le]=Fe.useState(null),[ce,Gt]=Fe.useState(0),[Nt,Ft]=Fe.useState(0),[de,be]=Fe.useState(0);window.Echo.channel("my-channel").listen(".my-event",Ye=>{le(Ye.message)});const ci=[{name:"Standar",kode:"https://api.maptiler.com/maps/basic-v2/{z}/{x}/{y}@2x.png?key="+At},{name:"osm",kode:"https://api.maptiler.com/maps/openstreetmap/{z}/{x}/{y}.jpg?key="+At},{name:"satelit",kode:"https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key="+At}],[yi,Ci]=Fe.useState(ci[0].kode),Yi=Ye=>{ci.map(xi=>{xi.name==Ye&&Ci(xi.kode)})},[hi,Ui]=Fe.useState(),[gi,we]=Fe.useState(),Ii=(Ye,xi)=>{yt(Ye),it(!0),Ui(xi),xi=="sensor1"&&(Ht&&Ht.name==xi?we(Ht.value):we(ce)),xi=="sensor2"&&(Ht&&Ht.name==xi?we(Ht.value):we(Nt)),xi=="sensor3"&&(Ht&&Ht.name==xi?we(Ht.value):we(de))},Qi=Ye=>{it(Ye)},Vi=Ye=>{wt(Ye)},lr=Ye=>{d(Ye)};return Fe.useEffect(()=>{vt.sensor1&&Gt(vt.sensor1.value),vt.sensor2&&Ft(vt.sensor2.value),vt.sensor3&&be(vt.sensor3.value)},[]),Si(Ga,{children:[jt(Ip,{title:"Dashboard"}),jt(Gp,{}),jt(Jp,{socket:gi,api:hi,sidebar:V,handle:Qi}),jt(Wp,{layer:ci,area:Vi,marker:lr,handle:Yi}),jt("div",{className:"border-map",children:Si(qp,{center:Ot,zoom:Se,ref:pt,className:"map",zoomControl:!1,children:[jt(jp,{url:yi,attribution:'<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>'}),bt==!0?Si(Ga,{children:[jt(Oc,{position:[-.013507799364533998,109.34150794692324],eventHandlers:{click:()=>{Ii([-.013507799364533998,109.34150794692324],"sensor1")}},children:jt(Fc,{children:jt(Nc,{value:Ht!=null&&Ht.name=="sensor1"?Ht.value:ce})})}),jt(Oc,{position:[-.015396,109.308033],eventHandlers:{click:()=>{Ii([-.015396,109.308033],"sensor2")}},children:jt(Fc,{children:jt(Nc,{value:Ht!=null&&Ht.name=="sensor2"?Ht.value:Nt})})}),jt(Oc,{position:[-.041145549983687454,109.35197836838654],eventHandlers:{click:()=>{Ii([-.041145549983687454,109.35197836838654],"sensor3")}},children:jt(Fc,{className:"mb-7",children:jt(Nc,{value:Ht!=null&&Ht.name=="sensor3"?Ht.value:de})})})]}):"",J==!0?Si(Ga,{children:[jt(Bc,{center:[-.013507799364533998,109.34150794692324],pathOptions:{color:"rgb(255, 187, 0)",fillColor:"rgb(255, 187, 0)",stroke:!1,fillOpacity:.6},radius:1200}),jt(Bc,{center:[-.015396,109.308033],pathOptions:{color:"rgb(0, 161, 8)",fillColor:"rgb(0, 161, 8)",stroke:!1,fillOpacity:.6},radius:1200}),jt(Bc,{center:[-.041145549983687454,109.35197836838654],pathOptions:{color:"rgb(240, 13, 13)",fillColor:"rgb(240, 13, 13)",stroke:!1,fillOpacity:.6},radius:1200})]}):""]})})]})}export{mf as default};
